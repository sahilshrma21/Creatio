(self.webpackChunkapp_studio_enterprise_relationship_diagram=self.webpackChunkapp_studio_enterprise_relationship_diagram||[]).push([[1314,8239,5036,6118,7344,8160,1034,8056,1906,4640],{41314:(C,c,a)=>{a.r(c),a.d(c,{CommonDiagramElementFactory:()=>i.Bu,CommonDiagramEventHandlerServerController:()=>i.pW,CommonDiagramEventService:()=>g.e,CommonDiagramLoader:()=>i.OD,CommonElementToolsConfig:()=>i.wK});var i=a(33429),g=a(5029),l=a(29450),u=a.n(l),o={};for(const r in l)["default","CommonDiagramElementFactory","CommonDiagramEventHandlerServerController","CommonDiagramLoader","CommonElementToolsConfig","CommonDiagramEventService"].indexOf(r)<0&&(o[r]=()=>l[r]);a.d(c,o)},33429:(C,c,a)=>{a.d(c,{Bu:()=>l,pW:()=>r,OD:()=>u,wK:()=>d});var i=a(29450),g=a(33177);class l extends i.DiagramElementFactory{generateId(t){return g.IdGenerator.generateUUID()}}class u extends i.DiagramLoader{getConnectionAttributes(t,e){return{...super.getConnectionAttributes(t,e),itemName:e.itemName,order:this.elements.items.connection.order}}}var o=a(74742);let r=class extends i.CommonDiagramEventHandlerController{constructor(t,e,n,s,h,E){super(t,E),this.eventBus=t,this.graphicsFactory=e,this.elementRegistry=n,this.modeling=s,this.selection=h,this.diagramUtils=E}onItemNameChanged({id:t,name:e}){const n=this.elementRegistry.getGraphics(t),s=this.elementRegistry.get(t);s.itemName=e,this.graphicsFactory.update(this.diagramUtils.isConnection(s)?"connection":"shape",s,n)}onElementCaptionChanged({id:t,caption:e}){const n=this.elementRegistry.get(t);if(n){const s=n.caption,h=e&&e.trim();s!==h&&this.modeling.updateLabel(n,e)}}getPasteElementConfig(t){const e=this.getFlowElementConfigFromShape(t);return Object.assign(e,{sourceId:t.sourceId})}findElements(t){const e=[];return t.forEach(n=>{const s=this.elementRegistry.get(n);s&&e.push(s)}),e}getFlowElementConfigFromShape(t){return{itemName:t.itemName,id:t.id,caption:t.caption,parentId:t.parent.id,position:{x:t.rx,y:t.ry}}}addElement(t){const e=t.context,n=e.shape||e.element||e.connection;e.hints.isElementCopyPaste?this.service.pasteElement(this.getPasteElementConfig(n)):super.addElement(t)}subscribeServerDiagramChanges(){const t=this.service;this.eventBus.on([i.Handlers.elements.removing],e=>{const n=e.elements.map(s=>s.id);return t.removing(n)}),this.eventBus.on([i.Handlers.element.doubleClick],e=>{t.elementDoubleClick(e.element.itemName)}),this.eventBus.on(["diagram.item.selected"],e=>{const n=e.id,s=n&&this.elementRegistry.get(n);t.selectionChanged(s&&this.getFlowElementConfigFromShape(s))})}getShape(t){const e=super.getShape(t),n=t.context.shape||t.context.element;return e.type=n.userTaskType||n.type,e}subscribeServerChanges(){this.subscribeServerDiagramChanges();const t=this.service;return[t.elementIsValidChanged$.subscribe(e=>this.eventBus.fire(i.Handlers.element.validation,e)),t.elementNameChanged$.subscribe(({id:e,name:n})=>{this.onItemNameChanged({id:e,name:n})}),t.elementCaptionChanged$.subscribe(({id:e,caption:n})=>{this.onElementCaptionChanged({id:e,caption:n})}),t.elementRemoved$.subscribe(e=>{const n=this.findElements(e);this.modeling.removeElements(n,!0)}),t.elementUpdateType$.subscribe(({id:e,config:n})=>{const s=this.elementRegistry.get(e);this.diagramUtils.isConnection(s)||this.modeling.updateElementType({id:e,config:n,force:!0})}),t.elementSelected$.subscribe(({id:e})=>{const n=this.elementRegistry.get(e);n?this.selection.select(n,!1):this.selection.select([],!1)}),t.elementCenterViewBox$.subscribe(({id:e})=>{const n=this.elementRegistry.get(e);n&&this.modeling.centerViewbox(n)}),t.elementMarkersChanged$.subscribe(({id:e,markers:n})=>{const s=this.elementRegistry.get(e);this.modeling.updateElementMarkers(s,n)})]}};r=(0,o.__decorate)([(0,o.__param)(0,(0,i.Inject)("eventBus")),(0,o.__param)(1,(0,i.Inject)("graphicsFactory")),(0,o.__param)(2,(0,i.Inject)("elementRegistry")),(0,o.__param)(3,(0,i.Inject)("modeling")),(0,o.__param)(4,(0,i.Inject)("selection")),(0,o.__param)(5,(0,i.Inject)("diagramUtils")),(0,o.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],r);class d extends i.DiagramElementToolsConfig{getAddItems(){const t=this.config.customElementToolsConfig?this.config.customElementToolsConfig.addItems||[]:[];return[...super.getAddItems(),...t]}getTools(){const t=this.config.customElementToolsConfig?this.config.customElementToolsConfig.tools||[]:[];return{...super.getTools(),...t}}}},5029:(C,c,a)=>{a.d(c,{e:()=>m});var i=a(8239),g=a(29450),l=a(33177),u=a(97600),o=a(21322),r=a(27049),d=a(94450);class m extends g.BaseDiagramEventService{constructor(e){super(),this.customEventClient=e,this.changeBuffer=[],this.elementNameChanged$=this.customEventClient.subscribe("updateElementName"),this.elementCaptionChanged$=this.customEventClient.subscribe("elementCaptionChanged"),this.elementRemoved$=this.customEventClient.subscribe("elementRemoved"),this.removeCancelled$=this.customEventClient.subscribe("removeCancelled"),this.elementUpdateType$=this.customEventClient.subscribe("elementUpdateType"),this.elementIsValidChanged$=this.customEventClient.subscribe("setIsElementValid"),this.elementSelected$=this.customEventClient.subscribe("elementSelected"),this.elementCenterViewBox$=this.customEventClient.subscribe("elementCenterViewBox"),this.elementMarkersChanged$=this.customEventClient.subscribe("updateElementMarkers"),this.init()}init(){super.init(),this.customEventClient.subscribe("diagramDataLoaded").subscribe(e=>this.endLoading$.next(e))}bufferiseOps(e,n,s){this.changeBuffer.push({commandType:e,path:n,newValues:s})}commit(){var e=this;return(0,i.Z)(function*(){if(e.changeBuffer.length){const n=u.cloneDeep(e.changeBuffer);e.changeBuffer=[],e.customEventClient.createOutboundChannel("diagramChanged").next(n)}})()}getDiagramConfig(){var e=this;return(0,i.Z)(function*(){const n=(0,o.lastValueFrom)(e.customEventClient.subscribe("setDiagramConfig").pipe((0,r.first)()),{defaultValue:null});return e.customEventClient.createOutboundChannel("getDiagramConfig").next({}),n})()}diagramInitialized(){this.customEventClient.createOutboundChannel("diagramInitialized").next({})}removing(e){return this.customEventClient.createOutboundChannel("diagramElementRemoving").next(e),!1}updatingTypeValidate({id:e,config:n}){return this.customEventClient.createOutboundChannel("diagramElementValidateUpdatingType").next({id:e,config:n}),!1}typeUpdated(e){this.customEventClient.createOutboundChannel("diagramElementTypeUpdated").next(e)}selectionChanged(e){this.customEventClient.createOutboundChannel("diagramElementClick").next(e)}elementDoubleClick(e){this.customEventClient.createOutboundChannel("diagramElementDoubleClick").next(e)}pasteElement(e){this.customEventClient.createOutboundChannel("pasteDiagramElement").next(e)}canCopy(e){var n=this;return(0,i.Z)(function*(){const s=(0,o.lastValueFrom)(n.customEventClient.subscribe("setCanCopy").pipe((0,r.first)()),{defaultValue:null});return n.customEventClient.createOutboundChannel("getCanCopy").next(e),s})()}}m.\u0275fac=function(e){return new(e||m)(d.\u0275\u0275inject(l.CustomEventService))},m.\u0275prov=d.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})},8239:(C,c,a)=>{a.d(c,{Z:()=>g});function i(l,u,o,r,d,m,t){try{var e=l[m](t),n=e.value}catch(s){o(s);return}e.done?u(n):Promise.resolve(n).then(r,d)}function g(l){return function(){var u=this,o=arguments;return new Promise(function(r,d){var m=l.apply(u,o);function t(n){i(m,r,d,t,e,"next",n)}function e(n){i(m,r,d,t,e,"throw",n)}t(void 0)})}}}}]);
