(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[5872],{15872:(vi,rr,D)=>{D.r(rr),D.d(rr,{BaseDataGridActionsPreprocessor:()=>Ht,ChartWidgetAdaptAxesFormattingPreprocessor:()=>Ue,ChartWidgetPreprocessor:()=>Ze,ComponentsPreprocessorsModule:()=>Qe,CustomQuickFilterAdditionalPreprocessingService:()=>pr,DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION:()=>Sr,DataGridActionsPreprocessor:()=>X,DataGridActiveRowPreprocessor:()=>de,DataGridBulkActionsPreprocessor:()=>K,DataGridBulkActionsPreprocessorsModule:()=>k,DataGridCancelItemsChangesPreprocessor:()=>ae,DataGridColumnsPreprocessor:()=>B,DataGridCreateItemPreprocessor:()=>oe,DataGridDeleteItemPreprocessor:()=>ne,DataGridEditingCellViewPreprocessor:()=>ee,DataGridFilterOptionsBackwardCompatibilityPreprocessor:()=>te,DataGridFilterOptionsPostprocessorsModule:()=>it,DataGridFilterOptionsPreprocessor:()=>re,DataGridFilterOptionsPreprocessorsModule:()=>tt,DataGridHeaderToolbarPreprocessor:()=>ie,DataGridPagingPreprocessor:()=>le,DataGridPlaceholderPreprocessor:()=>ue,DataGridPreprocessorsModule:()=>U,DataGridReloadItemsPreprocessor:()=>ce,DataGridRestrictionsPreprocessor:()=>_e,DataGridRowDoubleClickPreprocessor:()=>me,DataGridRowsSelectionPreprocessor:()=>pe,DataGridSaveItemsChangesPreprocessor:()=>se,DataGridSelectionOptionsBackwardCompatibilityPreprocessor:()=>fe,DataGridSelectionOptionsPostprocessorsModule:()=>ot,DataGridSelectionOptionsPreprocessorsModule:()=>q,DataGridStageCellViewPreprocessor:()=>ge,DataSourceUtils:()=>E,QuickFilterAdditionalPreprocessingService:()=>Q,QuickFilterPreprocessor:()=>Oe,QuickFilterPreprocessorService:()=>L,QuickFilterValueAttributeUpdaterService:()=>z,SearchFilterPreprocessor:()=>Ve,SearchFilterPreprocessorService:()=>J,ShellHeaderPreprocessor:()=>jt,WidgetDataProvidingPostprocessor:()=>We,WidgetDataProvidingPostprocessorModule:()=>x,WidgetDataProvidingPreprocessor:()=>He,WidgetDataProvidingPreprocessorModule:()=>w,WidgetPreprocessorsModule:()=>G,findViewModelAttributeByModelPath:()=>Wt,getDataSourceFilterAttribute:()=>or,getDefaultPagingConfig:()=>Jt,getPaginationChange:()=>zt,getSearchFilterAttributeName:()=>nr});var Ut=D(31134),T=D(33177),y=D(41307),f=D(34038),N=D(46338),m=D(49475),g=D(24709),u=D(8239),h=D(21322);function zt(c){return{request:"crt.LoadDataRequest",params:{dataSourceName:c,parameters:[]}}}function Jt(){return{rowCount:30}}var A=D(75378);class E{static _getMasterRecordEntitySchemaName(e,t,r){if(!e?.startsWith("$"))return Promise.resolve(null);const i=e.substring(1),a=t.viewModelConfig.attributes?.[i];if(!a)return Promise.resolve(null);let o="";a&&(0,g.isModelAttributeConfig)(a)&&(o=a.modelConfig?.path??"");const n=o?.split("."),l=n?.shift()??"",d=n?.pop()??"";return E.getDataSchemaName({models:r,schema:t,dataSourceName:l,attributeName:d})}static _findRelatedPath(e,t){const r=e.split(".");if(r.length!==2)return;const i=r[0],a=r[1],d=t.modelConfig?.dataSources?.[i]?.config?.attributes?.[a];if(!!d?.path)return`${i}.${d.path}`}static _getRelativeAttributePath(e,t){const i=(t.viewModelConfig.attributes??{})[e]??{};if(!(0,g.isModelAttributeConfig)(i)||!i.modelConfig?.path)return;const a=i.modelConfig.path;return this._findRelatedPath(a,t)??a}static _createDependency(e,t){return[{attributePath:t,relationPath:e}]}static _getReferenceColumnName(e){return e.masterRecordColumnName??e.recordColumnName}static getDataSchemaName(e){var t=this;return(0,u.Z)(function*(){const r=yield t.getDataSchema(e.models,e.dataSourceName);return r?e.attributeName?r?.attributes.find(a=>a.name===e.attributeName)?.referenceSchemaName??r?.name:r?.name:e.schema.modelConfig?.dataSources?.[e.dataSourceName]?.config?.entitySchemaName})()}static getDataSchema(e,t){const r=e.find(i=>i.getDataSource()?.dataSourceName===t);return(0,h.firstValueFrom)(r?.getSchema()??(0,h.of)(null))}static getDataSourcePrimaryAttribute(e,t="Id"){const r=e.modelConfig?.primaryDataSourceName;if(!r)return"";const i=e.viewModelConfig?.attributes;return i&&!i[t]&&(i[t]={modelConfig:{path:`${r}.${t}`}}),t}static getDataSourceNameByAttribute(e){if(!e?.startsWith("$"))return null;const t=e.substring(1);return this.getAttributeDSName(t)}static getAttributeDSName(e){return`${e}${g.DATA_SOURCE_PREFIX}`}static createDataSourceConfig(e){return{type:"crt.EntityDataSource",scope:A.DataSourceScope.ViewElement,config:{entitySchemaName:e}}}static getRecordEntitySchemaName(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=E.getDataSourceNameByAttribute(e);return!o||!!!(yield E.getDataSchema(i,o))?.findAttributeByName(a._recordSchemaNameColumnName)?Promise.resolve(null):a._getMasterRecordEntitySchemaName(t,r,i)})()}static addDependencies(e,t,r){const i=e.modelConfig?.dependencies??{};if(!i[r]&&t.masterRecordColumnValue){const a=t.masterRecordColumnValue.split("$")[1];if(!a)return;const o=this._getRelativeAttributePath(a,e);if(!o)return;const n=this._getReferenceColumnName(t);if(!n)return;i[r]=this._createDependency(o,n),e.modelConfig=e.modelConfig??{},e.modelConfig.dependencies=i}}}E._recordSchemaNameColumnName="RecordSchemaName";const ir="SysFile";function vr(c){const e=[];return c.forEach(t=>{const r={expressionType:2,parameter:{dataValueType:10,value:{Id:t,value:t}}};e.push(r)}),e}function ar(c){const e=[],t={expressionType:2,parameter:{dataValueType:1,value:c}};return e.push(t),e}function or(c,e,t,r){const i={};if(c?.length){const a=(0,A.generateGuid)(),o={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"FileGroup"},isAggregative:!1,dataValueType:10,referenceSchemaName:"FileGroup",rightExpressions:vr(c)};i[a]=o}if(e?.trim()){const a=(0,A.generateGuid)(),o={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"Tag"},isAggregative:!1,dataValueType:2,rightExpressions:ar(e)};i[a]=o}if(r&&t===ir){const a=(0,A.generateGuid)(),o={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"RecordSchemaName"},isAggregative:!1,dataValueType:2,rightExpressions:ar(r)};i[a]=o}return Object.getOwnPropertyNames(i).length?{value:{items:i,logicalOperation:0,isEnabled:!0,filterType:6,rootSchemaName:t||ir}}:null}function nr(c,e){return`${c}_${e}`}function Wt(c,e){let t="";return e&&Object.keys(c).forEach(r=>{const i=c[r];i&&(0,g.isModelAttributeConfig)(i)&&i.modelConfig?.path===e&&(t=r)}),t}var s=D(94450);class ze{get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._actionDashboardPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._dcmSettingsService=t,this._actionDashboardPreprocessingDisableFeature="DisableActionDashboardPreprocessing"}_addStageAttribute(e,t,r){const i=e.viewModelConfig.attributes||{},a=`${r}.${t}`;if(!Wt(i,a)){const o=`LookupAttribute_${t}`;i[o]={modelConfig:{path:a}},e.viewModelConfig.attributes=i}}_extendWithDcmStageAttribute(e,t){var r=this;return(0,u.Z)(function*(){const i=yield(0,h.lastValueFrom)(r._dcmSettingsService.getStageColumnName(t.viewConfig.entitySchemaName),{defaultValue:null});i&&r._addStageAttribute(e,i,t.viewConfig.dataSourceName)})()}_extendWithPrimaryValueAttribute(e,t,r,i){const a=e.viewModelConfig.attributes||{},o=`${r}.${i}`;let n=Wt(a,o);n||(n=`ActionDashboard_${i}`,a[n]={modelConfig:{path:o}},e.viewModelConfig.attributes=a),t.viewConfig.primaryColumnValue=`$${n}`}processItemsAsync(e,t,r){var i=this;return(0,u.Z)(function*(){if(!t)return;const a=e.map(function(){var o=(0,u.Z)(function*(n){const l=t.getDataSource(),d=yield(0,h.lastValueFrom)(t.getSchema());n.viewConfig.dataSourceName=l.dataSourceName,n.viewConfig.entitySchemaName=d.name,n.viewConfig.primaryDisplayColumnValue=`$${d.primaryDisplayAttributeName}`,yield i._extendWithDcmStageAttribute(r,n),i._extendWithPrimaryValueAttribute(r,n,l.dataSourceName,d.primaryAttributeName||"Id")});return function(n){return o.apply(this,arguments)}}());yield Promise.all(a)})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",r.viewConfig).forEach(a=>{a.viewConfig.allowedActions||(a.viewConfig.allowedActions=(0,f.getDefaultDashboardActions)())}),e})()}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if((yield r.isProcessingDisabled)||t.length===0)return e;const i=e,a=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",i.viewConfig),o=i.modelConfig?.primaryDataSourceName,n=t.find(l=>l.name===o);return yield r.processItemsAsync(a,n,i),e})()}}ze.\u0275fac=function(e){return new(e||ze)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(y.DcmSettingsService))},ze.\u0275prov=s.\u0275\u0275defineInjectable({token:ze,factory:ze.\u0275fac});class Je{get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState("DisableApprovalsPreprocessing"))}constructor(e,t){this._featureService=e,this._sysSettingsService=t,this._componentName="crt.Approval",this._dataLoadedAttributeSuffix="_DataLoaded",this._approvalMetricsAttributeSuffix="_ApprovalsMetrics",this._approvalChangedHandlerAttributeSuffix="_ApprovalChangedHandler",this._listAttributeSuffix="_ApprovalList"}_getApprovals(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalName(e){return e.name.replace(/\./g,"_")}_getAcceptApprovalSettingValue(){return(0,h.lastValueFrom)(this._sysSettingsService.getByCodes(["AcceptApprovalWithoutComment"]).pipe((0,h.pluck)("values"),(0,h.map)(e=>e.AcceptApprovalWithoutComment?.value)))}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e,a=r._getApprovals(i);for(const o of a){const n=o?.viewConfig;let l=i.viewModelConfig.attributes;l||(l=i.viewModelConfig.attributes={});const d=r._getApprovalName(n);l[`${d}${r._listAttributeSuffix}`]={value:null},l[`${d}${r._approvalMetricsAttributeSuffix}`]={value:null},l[`${d}${r._dataLoadedAttributeSuffix}`]={value:!1},l[`${d}${r._approvalChangedHandlerAttributeSuffix}`]={value:!1}}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield i.isProcessingDisabled)return e;const a=yield i._getAcceptApprovalSettingValue(),o=e,n=i._getApprovals(o);for(const l of n){const d=l?.viewConfig,p=i._getApprovalName(d),_=`${p}${i._listAttributeSuffix}`,S=`${p}${i._dataLoadedAttributeSuffix}`,C=`${p}${i._approvalChangedHandlerAttributeSuffix}`,v=`${p}${i._approvalMetricsAttributeSuffix}`;d.recordId="$Id",d.approval=`$${_}`,d.approvalsMetrics=`$${v}`,d.dataLoaded=`$${S}`,d.approvalChangedHandler=`$${C}`,d.loadData={request:"crt.ApprovalLoadDataRequest",params:{dataAttribute:_,dataMetricsAttribute:v,dataLoadedAttribute:S,config:"@event"}},a?d.approve={request:"crt.ApprovalActionHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:C}}:d.approve={request:"crt.ApprovalCofirmationHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:C}},d.reject={request:"crt.ApprovalCofirmationHandlerRequest",params:{config:"@event",approvalChangedHandlerAttributeName:C}}}return e})()}}Je.\u0275fac=function(e){return new(e||Je)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(y.SysSettingsService))},Je.\u0275prov=s.\u0275\u0275defineInjectable({token:Je,factory:Je.\u0275fac});var M=D(77207);class Ye{constructor(e,t){this._sysSettingsService=e,this._translateService=t,this._componentName="crt.ApprovalList"}_getApprovalLists(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getApprovalListName(e){return e.items?.slice(1)}_getAcceptApprovalSettingValue(){return(0,h.lastValueFrom)(this._sysSettingsService.getByCodes(["AcceptApprovalWithoutComment"]).pipe((0,h.pluck)("values"),(0,h.map)(e=>e.AcceptApprovalWithoutComment?.value)))}_createDataFilter(e,t){const r=new A.FilterGroup;r.addSchemaColumnFilterWithParameter(A.ComparisonType.Equal,"IsCanceled",!1),e[`${t}_PredefinedFilter`]={value:r.toJson()};const i=e[t];i?.modelConfig&&(i.modelConfig.filterAttributes=i.modelConfig.filterAttributes||[],i.modelConfig.filterAttributes.push({loadOnChange:!1,name:`${t}_PredefinedFilter`}))}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e,a=r._getApprovalLists(i);for(const o of a){const n=o?.viewConfig;let l=i.viewModelConfig.attributes;l||(l=i.viewModelConfig.attributes={});const d=r._getApprovalListName(n);l[`${d}_ApprovalsList`]={value:[]},l[`${d}_EntityName`]={value:n.entityName},r._createDataFilter(l,d)}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=yield i._getAcceptApprovalSettingValue(),n=i._getApprovalLists(a);for(const l of n){const d=l?.viewConfig,p=i._getApprovalListName(d),_=`${p}_ApprovalsList`,S=`$${p}.${p}${g.DATA_SOURCE_PREFIX}_Id`,C=o?"crt.ApprovalListActionRequest":"crt.ApprovalListConfirmationRequest";d.recordId="$Id",d.rowToolbarItems=[{type:"crt.MenuItem",caption:i._translateService.instant("ApprovalList.ApproveButtonLabel"),icon:"approve-icon",iconColor:"accent",disabled:`${S} | crt.ToDisabledApprovalActionConverter: $${_}`,clicked:{request:C,params:{config:{id:S,schemaName:d.approvalEntityName,actionType:f.ApprovalActionType.Approve},loadDataConfig:{parentSchemaName:d.entityName,parentRecordId:"$Id"},approvalListAttributeName:_,viewElementName:p}}},{type:"crt.MenuItem",caption:i._translateService.instant("ApprovalList.RejectButtonLabel"),icon:"reject-icon",iconColor:"warn",disabled:`${S} | crt.ToDisabledApprovalActionConverter: $${_}`,clicked:{request:"crt.ApprovalListConfirmationRequest",params:{config:{id:S,schemaName:d.approvalEntityName,actionType:f.ApprovalActionType.Reject},loadDataConfig:{parentSchemaName:d.entityName,parentRecordId:"$Id"},approvalListAttributeName:_,viewElementName:p}}}],d.reloadData={request:"crt.ApprovalListReloadRequest",params:{config:"@event",viewElementName:p}}}return e})()}}Ye.\u0275fac=function(e){return new(e||Ye)(s.\u0275\u0275inject(y.SysSettingsService),s.\u0275\u0275inject(M.TranslateService))},Ye.\u0275prov=s.\u0275\u0275defineInjectable({token:Ye,factory:Ye.\u0275fac});class Ht{hasEntityEditPage(e,t){return(0,u.Z)(function*(){const r={type:"crt.7XRequest",action:"HasEntityEditPage",$context:e,payload:{entityName:t}};return yield A.HandlerChainService.instance.process(r)})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){return yield Promise.all((0,N.getDataGridViewConfigsWithItemsBinding)(e,i.viewItemTypes).filter(a=>!a.rowToolbarItems).map(a=>i.setRowToolbarMenuItems(a,r))),e})()}}class X extends Ht{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var r=this;return(0,u.Z)(function*(){const i=e.items.slice(1),a=t.getBoundDataSourceNameByAttributePath(i),o=t.getBoundDataSchemaByAttributePath(i)?.name,n=yield r.hasEntityEditPage(t,o),l=`$${i}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:n,disabled:l,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Copy"),icon:"copy-row-action",visible:n,disabled:l,clicked:{request:"crt.CopyRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${a}_Id`},useRelativeContext:!1}}]})()}}X.\u0275fac=function(e){return new(e||X)(s.\u0275\u0275inject(M.TranslateService))},X.\u0275prov=s.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac});var I=D(52045);class K{constructor(e){this._dataGridDefaultBulkActionsCreator=e,this.viewItemTypes=["crt.DataGrid"]}_setDefaultBulkActions(e,t){const r=(0,I.parseExpression)(e.items).attributePath;if(!r)return;const a=t[r]?.modelConfig?.path;!a||(e.bulkActions=this._dataGridDefaultBulkActionsCreator.createDefaultBulkActions(a,e))}crtOnMetaDataInit(e){const t=e,r=t.viewModelConfig.attributes??{};return(0,N.getDataGridViewConfigsWithItemsBinding)(t,this.viewItemTypes).filter(i=>i.bulkActions===void 0).forEach(i=>{this._setDefaultBulkActions(i,r)}),Promise.resolve(e)}}K.\u0275fac=function(e){return new(e||K)(s.\u0275\u0275inject(f.DataGridDefaultBulkActionsCreator))},K.\u0275prov=s.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac});var b=D(97600);class Xe{constructor(e){this._dataGridDefaultBulkActionsCreator=e,this.viewItemTypes=["crt.DataGrid"]}_clearDefaultBulkActions(e,t){const r=(0,I.parseExpression)(e.items).attributePath;if(!r)return;const a=t[r]?.modelConfig?.path;if(!a)return;const o=this._dataGridDefaultBulkActionsCreator.createDefaultBulkActions(a,e);o&&(0,b.isEqual)(e.bulkActions,o)&&(e.bulkActions=void 0)}crtOnMetaDataChanged(e){const t=e,r=t.viewModelConfig.attributes??{};return(0,N.getDataGridViewConfigsWithItemsBinding)(t,this.viewItemTypes).forEach(i=>{this._clearDefaultBulkActions(i,r)}),Promise.resolve(e)}}Xe.\u0275fac=function(e){return new(e||Xe)(s.\u0275\u0275inject(f.DataGridDefaultBulkActionsCreator))},Xe.\u0275prov=s.\u0275\u0275defineInjectable({token:Xe,factory:Xe.\u0275fac});class k{}k.\u0275fac=function(e){return new(e||k)},k.\u0275mod=s.\u0275\u0275defineNgModule({type:k}),k.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:K,multi:!0},{provide:g.CRT_METADATA_POSTPROCESSOR,useClass:Xe,multi:!0}]});var R=D(14537),Yt=D(96578);class ${constructor(e,t,r,i,a,o){this._comboboxDropdownPageSizeService=e,this._translateService=t,this._dataSchemaRepository=r,this._rightsService=i,this._featureValues=a,this._window=o,this._disableLookupSelectionWindowFeatureName="DisableLookupSelectionWindow"}_getBindedAttributeName(e){return e.slice(1).split(".").pop()||""}_setComboboxShowListEvent(e,t){e.showList||(e.showList=this._createLoadDataRequestConfig(t),e.showList.params={...e.showList.params,config:{loadType:A.DataSourceLoadType.Reload}})}_setComboboxPaginationChange(e,t){e.paginationChange||(e.paginationChange=this._createLoadDataRequestConfig(t))}_createLoadDataRequestConfig(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:`${e}_DS`,parameters:[],primaryDisplayFilterValue:"@event.filterValue"},useRelativeContext:!0}}_removeValueDetailsIfNeed(e){this._isNotNeedRemoveValueDetails()||delete e.valueDetails}_isNotNeedRemoveValueDetails(){return this._featureValues.EnableComboboxValueDetails}_setComboboxListActions(e,t){if(!e.listActions&&(e.listActions=[],e.isAddAllowed)){const i={...f.defaultAddRecordActionConfig,name:T.NameGenerator.generateUnique("ListAction")};e.listActions.push(i)}const r=this._findAddRecordListAction(e);if(r){const i=e.attributeName;r.clicked.params={itemsAttributeName:`${t}`,attributeName:`${i}`,detail:"@event.detail"}}}_findAddRecordListAction(e){return e?.listActions?.find(t=>t.code===f.ComboboxActionCodeEnum.AddRecord)}_setComboboxControlActions(e,t){if(!e.controlActions&&(e.controlActions=[],e.isGoToSourceAllowed)){const a={...f.defaultGoToRecordListActionConfig,name:T.NameGenerator.generateUnique("ControlAction")};e.controlActions.push(a)}const r=e.controlActions.find(a=>a.code===f.ComboboxActionCodeEnum.GoToRecordList);r&&(r.clicked.params={itemsAttributeName:`${t}`});const i=e.controlActions.find(a=>a.code===f.ComboboxActionCodeEnum.OpenLookupPage);i&&(i.clicked.params={itemsAttributeName:`${t}`,itemAttributeName:`${e.attributeName}`})}_getReferenceSchemaName(e,t){const r=t[`${e.attributeName}_List`];return this._getEmbeddedEntitySchemaNameFromAttributeConfig(r)}_setComboboxLinkViewConfig(e,t){const r=e.items.slice(1),i=this._getReferenceSchemaName(e,t),a=this._translateService.instant("ComboBox.EmptyDisplayValue"),o=e.attributeName;e.linkViewConfig={type:"crt.Link",mode:"preventDefault",caption:`$${o} | crt.ToObjectProp : 'displayValue' : '${a}'`,href:`$${o} | crt.ToObjectProp : 'value' | crt.ToRecordLinkAsync : '${r}'`,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:o,recordId:`$${o} | crt.ToObjectProp : 'value'`,entityName:i}}}}_setComboboxConfig(e,t){this._setComboboxShowListEvent(e,t),this._setComboboxListActions(e,t),this._setComboboxControlActions(e,t),this._setComboboxPaginationChange(e,t),this._removeValueDetailsIfNeed(e)}_checkEditPagesAndExtendWithLinkViewConfig(e,t,r){var i=this;return(0,u.Z)(function*(){yield Promise.all(e.filter(a=>a.showValueAsLink).map(function(){var a=(0,u.Z)(function*(o){(yield i._hasEditPage(o,t,r))&&i._setComboboxLinkViewConfig(o,t)});return function(o){return a.apply(this,arguments)}}()))})()}_addListAttribute(e,t){const r=e[t];e[t]={isCollection:!0,isLookup:!0,...r}}_addBusinessRuleListFilterAttribute(e,t){const r=(0,m.getBusinessRuleFilterAttributeName)(t);e[r]||(e[r]={value:{}})}_setEmbeddedModel(e,t){var r=this;return(0,u.Z)(function*(){const{vmListAttribute:i,model:a,comboboxAttributeName:o,vmAttribute:n}=e,p=(yield r._getModelSchema(a))?.attributes?.find(({name:_})=>_===t)?.referenceSchemaName;!p||(i.embeddedModel=r._createEmbeddedModel((0,m.getItemsAttributeName)(o),p,n.modelConfig?.showDeactivatedRecords))})()}_setViewModelConfig(e,t){var r=this;return(0,u.Z)(function*(){const{vmListAttribute:i,model:a,comboboxAttributeName:o}=e,l=(yield r._getModelSchema(a))?.findAttributeByName(t);if(!l){i.viewModelConfig={attributes:{value:{},displayValue:{},primaryColorValue:{}}};return}const d=yield r._getDataSchema(l?.referenceSchemaName),p=r._createViewModelConfig((0,m.getItemsAttributeName)(o),d);d?.primaryColorAttributeName&&(p.attributes.primaryColorValue={modelConfig:{path:`${(0,m.getItemsAttributeName)(o)}_DS.${d?.primaryColorAttributeName}`}}),i.viewModelConfig=p})()}_getFilterAttributes(e,t){const r=e.modelConfig,i={name:(0,m.getBusinessRuleFilterAttributeName)((0,m.getItemsAttributeName)(t)),loadOnChange:!0},a=r?.filterAttributes??[];return a.find(o=>o.name===i.name)||a.push(i),a}_setModelConfig(e,t){var r=this;return(0,u.Z)(function*(){const{vmListAttribute:i,model:a,comboboxAttributeName:o}=e,n=yield r._getModelConfigDefaultSorting(a,t),l=yield r._comboboxDropdownPageSizeService.getPageSize(),d=r._getFilterAttributes(i,o),p=r._createModelConfig((0,m.getItemsAttributeName)(o),n,l,d);r._mergeModelConfig(i,p)})()}_getModelConfigDefaultSorting(e,t){var r=this;return(0,u.Z)(function*(){const i=[],o=(yield r._getModelSchema(e))?.findAttributeByName(t);if(o){const n=yield r._getDataSchema(o.referenceSchemaName);i.push(r._getDefaultSorting(n))}return i})()}_getDefaultSorting(e){return{columnName:e?.primaryDisplayAttributeName,direction:"asc"}}_getDataSchema(e){var t=this;return(0,u.Z)(function*(){let r;try{r=yield(0,h.lastValueFrom)(t._dataSchemaRepository.get(e),{defaultValue:null})}catch{r=null}return Promise.resolve(r)})()}_mergeModelConfig(e,t){const r=e.modelConfig;e.modelConfig=(0,b.merge)(t,r)}_getComboboxLookupModeFromDataSchema({attribute:e,models:t}){var r=this;return(0,u.Z)(function*(){const i=r._getDataSourceNameFromAttributeConfig(e),a=r._getTargetFieldNameFromAttributeConfig(e),o=r._getModelByDataSourceName(i,t),l=(yield r._getModelSchema(o))?.findAttributeByName(a),d=Yt.LookupMode.List;return l?.lookupMode??d})()}_setComboboxMode({viewConfig:e,attributes:t,models:r,comboboxAttributeName:i}){var a=this;return(0,u.Z)(function*(){const o=!a._featureValues[a._disableLookupSelectionWindowFeatureName];if(!(0,b.get)(a._window,"Terrasoft")?.isAngularHost||!o){e.mode=Yt.LookupMode.List;return}const l=t[i]??{};!(0,g.isModelAttributeConfig)(l)||(e.mode===void 0&&(e.mode=yield a._getComboboxLookupModeFromDataSchema({attribute:l,models:r})),e.mode===Yt.LookupMode.SelectionWindow&&a._setSelectionWindowAction(e,t))})()}_setComboboxListAttribute({attributes:e,models:t,comboboxAttributeName:r}){var i=this;return(0,u.Z)(function*(){const a=e[r]??{};if(!(0,g.isModelAttributeConfig)(a))return;const o=i._getDataSourceNameFromAttributeConfig(a),n=i._getTargetFieldNameFromAttributeConfig(a),l=e[(0,m.getItemsAttributeName)(r)],d=i._getModelByDataSourceName(o,t),p={vmListAttribute:l,model:d,comboboxAttributeName:r,vmAttribute:a};yield i._setEmbeddedModel(p,n),yield i._setViewModelConfig(p,n),yield i._setModelConfig(p,n)})()}_setComboboxListSortingAttribute(e,t){const r=this._getComboboxListSortingAttributeName(t),i=e[r];e[r]={...i,isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}_getComboboxListSortingAttributeName(e){return`${e}_Sorting`}_hasEditPage(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getReferenceSchemaName(e,t);if(!a)return Promise.resolve(!1);const o={type:"crt.7XRequest",action:"HasEntityEditPage",$context:r,payload:{entityName:a}};return yield A.HandlerChainService.instance.process(o)})()}_createAttributeConfigByDataSchema(e,t){var r=this;return(0,u.Z)(function*(){const i=[r._getDefaultSorting(t)],a=yield r._comboboxDropdownPageSizeService.getPageSize();return{isCollection:!0,isLookup:!0,embeddedModel:r._createEmbeddedModel(e,t.name),viewModelConfig:r._createViewModelConfig(e,t),modelConfig:r._createModelConfig(e,i,a,[])}})()}_createAndAddFilterAttribute(e){const t=e.filterAttributeName||`${e.listAttributeName}_Filter`,a=((e.attributes[e.listAttributeName]||{}).modelConfig||{}).filterAttributes||[];!!a.find(n=>n.name===t)||a.push({name:t,loadOnChange:!0}),e.attributes[t]={value:e.filter}}_createEmbeddedModel(e,t,r=!1){return{name:`${e}_DS`,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t,useRecordDeactivation:!r}}}}_createViewModelConfig(e,t){return{attributes:{value:{modelConfig:{path:`${e}_DS.${t?.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${e}_DS.${t?.primaryDisplayAttributeName}`,ignoreValidators:!this._featureValues.DisableIgnoreLookupsDisplayValueValidators}}}}}_createModelConfig(e,t,r,i){return{path:`${e}_DS`,sortingConfig:{attributeName:this._getComboboxListSortingAttributeName(e),default:t},pagingConfig:{rowCount:r,rowsOffset:null},filterAttributes:i}}_getFiltersConfig(e,t){const i=e[t]?.modelConfig?.filterAttributes;if(!i)return null;const a={};return i.forEach(o=>{a[o.name]={value:"$"+o.name}}),{filterAttributes:i,attributesConfig:a}}_setSelectionWindowAction(e,t){const r=(0,m.getItemsAttributeName)(e.control).slice(1),i=e.attributeName;if(!r||!i)return;const a=this._getFiltersConfig(t,r),o=!!this._findAddRecordListAction(e),n=t[i]??{},l=Boolean(n.modelConfig?.showDeactivatedRecords);e.selectionWindowIconPressed={request:"crt.OpenSelectionWindowRequest",params:{itemsAttributeName:r,itemAttributeName:i,filtersConfig:a,features:{showDeactivatedRecords:l,create:{enabled:o}}}}}_actualizeComboboxAddRecordAction(e,t,r){var i=this;return(0,u.Z)(function*(){if(i._featureValues.DisableCheckingForAddRecordActionInCombobox)return;const a=e.filter(d=>!!i._findAddRecordListAction(d)),o=yield i._getViewConfigsWithEditPage(a,t,r),n=i._getDifferentElementsInConfigCollections(a,o),l=yield i._getIsNotAllowedAddRecordActionViewConfigs(o,t);[...n,...l].forEach(d=>i._disableAddRecordAction(d))})()}_getDifferentElementsInConfigCollections(e,t){return e.filter(r=>!t.some(i=>r.attributeName===i.attributeName))}_getViewConfigsWithEditPage(e,t,r){var i=this;return(0,u.Z)(function*(){return(yield Promise.all(e.map(function(){var a=(0,u.Z)(function*(o){return(yield i._isViewConfigIfWithoutEditPage(o,t,r))?null:o});return function(o){return a.apply(this,arguments)}}()))).filter(a=>!!a)})()}_isViewConfigIfWithoutEditPage(e,t,r){var i=this;return(0,u.Z)(function*(){return!i._getReferenceSchemaName(e,t)||!(yield i._hasEditPage(e,t,r))})()}_getIsNotAllowedAddRecordActionViewConfigs(e,t){var r=this;return(0,u.Z)(function*(){if(!e||e.length===0)return[];const i=yield r._getIsNotAllowedAddRecordActionSchemaNames(e,t);return e.filter(a=>i.includes(r._getReferenceSchemaName(a,t)))})()}_getIsNotAllowedAddRecordActionSchemaNames(e,t){var r=this;return(0,u.Z)(function*(){const i=[...new Set(e?.map(o=>r._getReferenceSchemaName(o,t)))];return(yield(0,h.lastValueFrom)(r._rightsService.getCanAdd(i).pipe((0,h.catchError)(()=>(0,h.of)(null)))))?.filter(o=>!o.result).map(o=>o.schemaName)??[]})()}_disableAddRecordAction(e){this._removeAddRecordAction(e),this._disableAddRecordInSelectionWindow(e)}_removeAddRecordAction(e){const t=this._findAddRecordListAction(e);e.listActions=e.listActions.filter(r=>r!==t)}_disableAddRecordInSelectionWindow(e){const r=(e.selectionWindowIconPressed?.params?.features||{}).create||{};r.enabled=!1}_setActivityResultFilters(e,t,r){var i=this;return(0,u.Z)(function*(){!(yield i._isNeedAddActivityResultFilter(e,t,r))||i._addActivityResultFiltersAttributes(e,r)})()}_isNeedAddActivityResultFilter(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e[r],o=i._getDataSourceNameFromAttributeConfig(a);if((0,b.isEmpty)(o))return!1;const n=i._getModelByDataSourceName(o,t);if((yield i._getModelSchema(n))?.name!=="Activity")return!1;const d=(0,m.getItemsAttributeName)(r),p=e[d];return i._getEmbeddedEntitySchemaNameFromAttributeConfig(p)==="ActivityResult"})()}_getModelSchema(e){return(0,h.lastValueFrom)(e.getSchema(),{defaultValue:null})}_getEmbeddedEntitySchemaNameFromAttributeConfig(e){return e&&"embeddedModel"in e&&e.embeddedModel?.config?.config?.entitySchemaName}_getModelByDataSourceName(e,t){return t.find(r=>r.name===e)}_addActivityResultFiltersAttributes(e,t){const r=(0,m.getItemsAttributeName)(t),i=e[t],a=this._getDataSourceNameFromAttributeConfig(i);this._createAndAddBusinessProcessOnlyFilterAttribute(e,r),this._createResultByCategoryFilterAttribute(e,r,a)}_getDataSourceNameFromAttributeConfig(e){return e.modelConfig?.path.split(".")[0]}_getTargetFieldNameFromAttributeConfig(e){return e.modelConfig?.path.split(".").pop()}_createAndAddBusinessProcessOnlyFilterAttribute(e,t){const r=this._createBusinessProcessOnlyFilter();this._createAndAddFilterAttribute({attributes:e,listAttributeName:t,filter:r,filterAttributeName:`${t}_BusinessProcessOnlyFilter`})}_createBusinessProcessOnlyFilter(){const e=new A.FilterGroup;return e.addSchemaColumnFilterWithParameter(A.ComparisonType.Equal,"BusinessProcessOnly",!1,"BusinessProcessOnlyFilter"),e}_createResultByCategoryFilterAttribute(e,t,r){const i=`${t}_CategoryFilter`;this._createAndAddFilterAttribute({attributes:e,listAttributeName:t,filter:null,filterAttributeName:i}),e[i]={from:[this._getOrCreateAttributeByModelConfigPath(`${r}.ActivityCategory`,e),this._getOrCreateAttributeByModelConfigPath(`${r}.AllowedResult`,e)],converter:"crt.ActivityResultsFilters"}}_getOrCreateAttributeByModelConfigPath(e,t){const r=this._findAttributeByModelConfigPath(e,t);return r||this._createAttributeWithModelConfigPath(e,t)}_findAttributeByModelConfigPath(e,t){return Object.keys(t).find(r=>(t[r]??{}).modelConfig?.path===e)}_createAttributeWithModelConfigPath(e,t){const r=e.replace(".","_");return t[r]={modelConfig:{path:e}},r}crtOnMetaDataInit(e,t){e=e.filter(r=>(0,R.isBindToViewModelAttribute)(r.control,t)),e.forEach(r=>{const i=r.control,a=this._getBindedAttributeName(i),o=r.items,n=(0,m.getItemsAttributeName)(a);if((0,R.isBindToViewModelAttribute)(o,t)){const l=o.slice(1).split(".").pop();t[l].isLookup=!0}else this._addListAttribute(t,n),r.items=(0,m.getItemsAttributeName)(i);this._addBusinessRuleListFilterAttribute(t,n),r.attributeName=a,this._setComboboxConfig(r,n)})}crtOnModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){e=e.filter(a=>(0,R.isBindToViewModelAttribute)(a.control,t)),yield Promise.all(e.map(function(){var a=(0,u.Z)(function*(o){const n=i._getBindedAttributeName(o.control);i._setComboboxListSortingAttribute(t,(0,m.getItemsAttributeName)(n)),yield i._setComboboxListAttribute({attributes:t,models:r,comboboxAttributeName:n}),yield i._setActivityResultFilters(t,r,n),yield i._setComboboxMode({viewConfig:o,attributes:t,models:r,comboboxAttributeName:n})});return function(o){return a.apply(this,arguments)}}()))})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){e=e.filter(a=>(0,R.isBindToViewModelAttribute)(a.items,t)),yield i._checkEditPagesAndExtendWithLinkViewConfig(e,t,r),yield i._actualizeComboboxAddRecordAction(e,t,r)})()}setupComboboxMetadataByEntitySchema(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=yield a._getDataSchema(r);if(!o)return;const n=(0,m.getItemsAttributeName)(e.name);t[n]=yield a._createAttributeConfigByDataSchema(n,o),i&&a._createAndAddFilterAttribute({attributes:t,listAttributeName:n,filter:i}),a._setComboboxListSortingAttribute(t,n),e.items=`$${n}`,a._setComboboxShowListEvent(e,n),a._setComboboxPaginationChange(e,n)})()}}$.\u0275fac=function(e){return new(e||$)(s.\u0275\u0275inject(f.ComboboxDropdownPageSizeService),s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(g.DataSchemaRepositoryService),s.\u0275\u0275inject(y.RightsService),s.\u0275\u0275inject(m.FEATURE_VALUES),s.\u0275\u0275inject(T.WINDOW_TOKEN))},$.\u0275prov=s.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac});class Ke{constructor(e){this._comboboxPreprocessorService=e}_getComboboxesViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ComboBox",e.viewConfig).map(t=>t.viewConfig)}crtOnMetaDataInit(e){const t=e,r=t.viewModelConfig.attributes,i=this._getComboboxesViewConfigs(t);return this._comboboxPreprocessorService.crtOnMetaDataInit(i,r),Promise.resolve(e)}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e,a=i.viewModelConfig.attributes,o=r._getComboboxesViewConfigs(i);return yield r._comboboxPreprocessorService.crtOnModelInit(o,a,t),e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=a.viewModelConfig.attributes,n=i._getComboboxesViewConfigs(a);return yield i._comboboxPreprocessorService.crtOnViewModelInit(n,o,r),e})()}}Ke.\u0275fac=function(e){return new(e||Ke)(s.\u0275\u0275inject($))},Ke.\u0275prov=s.\u0275\u0275defineInjectable({token:Ke,factory:Ke.\u0275fac});const Ir={[A.DataValueType.Integer]:0,[A.DataValueType.FLOAT1]:1,[A.DataValueType.FLOAT2]:2,[A.DataValueType.FLOAT3]:3,[A.DataValueType.FLOAT4]:4,[A.DataValueType.FLOAT8]:8,[A.DataValueType.Money]:2};class j{process(e,t){const r=Ir[t]??null;r!==null&&!e.format&&(e.format={decimalPrecision:r})}}j.\u0275fac=function(e){return new(e||j)},j.\u0275prov=s.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac});class et{constructor(e){this._numberInputPreprocessorService=e}_process(e,t){if(!(0,I.isBindingExpression)(e.control))return;const r=(0,I.parseExpression)(e.control).attributePath;if(!r)return;const a=t.getBoundDataSchemaAttributeByAttributePath(r)?.dataValueType;!a||this._numberInputPreprocessorService.process(e,a)}crtOnViewModelInit(e,t,r){const i=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.NumberInput",i.viewConfig).forEach(o=>{this._process(o.viewConfig,r)}),Promise.resolve(e)}}et.\u0275fac=function(e){return new(e||et)(s.\u0275\u0275inject(j))},et.\u0275prov=s.\u0275\u0275defineInjectable({token:et,factory:et.\u0275fac});class ee{constructor(e,t,r,i,a){this._editingCellViewConfigCreatorFactory=e,this._featureService=t,this._metadataModifierService=r,this._comboboxPreprocessorService=i,this._numberInputPreprocessorService=a}_isEditingModeDisabled(){return(0,h.firstValueFrom)(this._featureService.getFeatureState(N.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_updateAttributeProperties(e,t,r){R.ViewElementConfigUtils.updateCollectionAttributeProperties(t,e,r,[{name:"readonly",defaultValue:!1}])}_addColumnsEditingCellViewConfigs(e,t,r,i=!1){var a=this;return(0,u.Z)(function*(){const o=e.columns;if(!Array.isArray(o))return;const n=e.items,l=o.filter(d=>!d.editingCellView);for(const d of l){const _=yield a._editingCellViewConfigCreatorFactory.create({dataValueType:d.dataValueType,columnName:d.code}).getViewElementConfig({column:d,itemsAttributeName:n,context:t});i&&_&&a._updateAttributeProperties(r,_,n),_&&a._metadataModifierService.addProperty(d,"editingCellView",_)}})()}_getColumnDefinitionByPredicate(e,t){return Array.isArray(e.columns)?(e.columns||[]).filter(t):[]}_getComboboxesViewConfigsFromDataGridViewConfig(e){return this._getDataGridComboBoxColumnDefinitions(e).map(t=>t.editingCellView)}_getDataGridComboBoxColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>Boolean(t.dataValueType===A.DataValueType.Lookup&&t.editingCellView))}_getDataGridNumberInputColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>Boolean(t.editingCellView?.type==="crt.DataTableEditNumericCell"))}_getDataGridItemsAttributeConfig(e,t){const r=(0,N.getViewModelItemsAttributeName)(e);return r?t.viewModelConfig.attributes[r]?.viewModelConfig?.attributes:void 0}_addEditableFeature(e,t){const r=e.features;if((0,I.isBindingExpression)(r))return;const i=(0,f.fullInDataTableEditingFeatures)(r?.editable,!t);if(!r)return this._metadataModifierService.addProperty(e,"features",{editable:i});const a=r.editable;if(a==null)return this._metadataModifierService.addProperty(r,"editable",i);typeof a!="boolean"&&(a.enable==null&&this._metadataModifierService.addProperty(a,"enable",i.enable),a.itemsCreation==null&&this._metadataModifierService.addProperty(a,"itemsCreation",a.enable&&i.itemsCreation),a.lookupItemsCreation==null&&this._metadataModifierService.addProperty(a,"lookupItemsCreation",a.enable&&i.lookupItemsCreation))}_comboboxesOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getComboboxesViewConfigsForOnViewModelInit(e,t);yield i._comboboxPreprocessorService.crtOnViewModelInit(a,t,r)})()}_getComboboxesViewConfigsForOnViewModelInit(e,t){return e.map(r=>{const i=this._getComboboxesViewConfigsFromDataGridViewConfig(r);return this._addActionAddRecordToListActionsIfNeed(i,t,r),i}).flat(1)}_addActionAddRecordToListActionsIfNeed(e,t,r){const i=this._getLookupItemsCreationFeatureValue(r);!(!(0,b.isBoolean)(i)||i)||e.forEach(o=>this._addActionAddRecordToListActions(o,t))}_getLookupItemsCreationFeatureValue(e){return e.features?.editable?.lookupItemsCreation}_addActionAddRecordToListActions(e,t){const r=t[`${e.attributeName}_List`],i=r&&"embeddedModel"in r&&r.embeddedModel?.config?.config?.entitySchemaName;if(!i)return;const a=e.control.split(".").pop(),o={...f.defaultAddRecordActionConfig,clicked:{request:"crt.CreateRecordFromEditLookupCellRequest",params:{schemaName:i,attributeName:a,detail:"@event.detail"},useRelativeContext:!0},name:T.NameGenerator.generateUnique("ListAction")};this._addComboboxActionIfNotExist(e,f.ComboboxActionCodeEnum.AddRecord,o)}_addComboboxActionIfNotExist(e,t,r){e.listActions||(e.listActions=[]),!e.listActions.some(a=>a.code===t)&&e.listActions.push(r)}_numbersOnViewModelInit(e){this._getDataGridNumberInputColumnDefinitions(e).forEach(r=>{const i=r.dataValueType,a=r.editingCellView;this._numberInputPreprocessorService.process(a,i)})}_updateCellPropertiesOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e.items,o=i._getColumnDefinitionByPredicate(e,n=>Boolean(n.editingCellView?.type===r));for(const n of o){const d=yield i._editingCellViewConfigCreatorFactory.create({dataValueType:n.dataValueType,columnName:n.code}).getViewElementConfig({column:n,itemsAttributeName:a,context:t});i._metadataModifierService.addProperty(n,"editingCellView",d)}})()}_phoneOnViewModelInit(e,t){var r=this;return(0,u.Z)(function*(){yield r._updateCellPropertiesOnViewModelInit(e,t,"crt.DataTableEditPhoneCell")})()}_emailOnViewModelInit(e,t){var r=this;return(0,u.Z)(function*(){yield r._updateCellPropertiesOnViewModelInit(e,t,"crt.DataTableEditEmailCell")})()}_isDataGridEditingEnabled(e){const t=e.features;return(0,I.isBindingExpression)(t)?!0:(0,f.fullInDataTableEditingFeatures)(t?.editable).enable}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=yield t._isEditingModeDisabled(),a=(0,N.getDataGridViewConfigs)(e);for(const o of a){if(t._addEditableFeature(o,i),!t._isDataGridEditingEnabled(o)||i)continue;yield t._addColumnsEditingCellViewConfigs(o,null,r,!0);const n=t._getDataGridItemsAttributeConfig(o,e);if(!n)continue;const l=t._getComboboxesViewConfigsFromDataGridViewConfig(o);t._comboboxPreprocessorService.crtOnMetaDataInit(l,n)}return e})()}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r._isEditingModeDisabled())return e;const i=(0,N.getDataGridViewConfigs)(e);for(const a of i){if(!r._isDataGridEditingEnabled(a))continue;const o=r._getDataGridItemsAttributeConfig(a,e);if(!o)continue;const n=r._getComboboxesViewConfigsFromDataGridViewConfig(a);yield r._comboboxPreprocessorService.crtOnModelInit(n,o,t)}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield i._isEditingModeDisabled())return e;const a=e,o=(0,N.getDataGridViewConfigs)(e);let n={};const l=[];for(const d of o){if(!i._isDataGridEditingEnabled(d))continue;const p=i._getDataGridItemsAttributeConfig(d,e);!p||(n={...n,...p},l.push(d),yield i._addColumnsEditingCellViewConfigs(d,r,a),i._numbersOnViewModelInit(d),yield i._phoneOnViewModelInit(d,r),yield i._emailOnViewModelInit(d,r))}return yield i._comboboxesOnViewModelInit(l,n,r),e})()}}ee.\u0275fac=function(e){return new(e||ee)(s.\u0275\u0275inject(N.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY),s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService),s.\u0275\u0275inject($),s.\u0275\u0275inject(j))},ee.\u0275prov=s.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac});var O=D(27049);class B{constructor(e,t,r){this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=r,this.featureName="DisableDataGridColumnsPreprocessing",this.viewItemTypes=["crt.DataGrid"]}_getColumnDefinitions(e,t){var r=this;return(0,u.Z)(function*(){const i=e.columns,a=yield r.getGenerateCellViewConfig(e,t);return a?(0,h.lastValueFrom)(r.dataGridColumnDefinitionService.processDataGridColumnDefinitions(a,i)):[]})()}_addColumnsCellViewConfigs(e,t){var r=this;return(0,u.Z)(function*(){const i=e.columns;if(!Array.isArray(i)||i.length===0)return;const a=yield r._getColumnDefinitions(e,t);r._addColumnProperty(i,a,"cellView"),r._addColumnProperty(i,a,"readonly"),i.forEach(o=>{delete o.path,delete o.referenceSchemaName})})()}_addColumnProperty(e,t,r){e.filter(i=>!i[r]).map(i=>[i,t.find(a=>a.code===i.code)]).forEach(([i,a])=>this.metadataModifierService.addProperty(i,r,a?.[r]))}getGenerateCellViewConfig(e,t){const r=(0,h.of)(t),i=(0,N.getViewModelItemsAttributeName)(e);if(!i)return Promise.resolve(null);const a=r.pipe((0,O.map)(l=>l?.getBoundDataSourceNameByAttributePath(i))),o=r.pipe((0,O.map)(l=>l?.getBoundDataSchemaByAttributePath(i))),n=e.items;return(0,h.lastValueFrom)((0,h.forkJoin)([a,o]).pipe((0,O.switchMap)(([l,d])=>l&&d?(0,h.of)({dataSchema:d,dataSourceName:l,itemsAttributeName:n,viewModel:t,features:e.features,dataGridName:e.name}):(0,h.of)(null))))}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield(0,h.lastValueFrom)(i.featureService.getFeatureState(i.featureName),{defaultValue:null}))return e;const o=m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",i.viewItemTypes,e.viewConfig);for(const n of o)yield i._addColumnsCellViewConfigs(n.viewConfig,r);return e})()}}B.\u0275fac=function(e){return new(e||B)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService),s.\u0275\u0275inject(N.DataGridColumnDefinitionService))},B.\u0275prov=s.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac});class te{constructor(e){this._filterOptionsBackwardCompatibilityModifier=e}_isEmptyExposeFilters(e){const t=e?._filterOptions;return t?!t.expose?.length:!1}crtOnMetaDataInit(e){return(0,N.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(t=>this._isEmptyExposeFilters(t)).forEach(t=>this._filterOptionsBackwardCompatibilityModifier.modify(t)),Promise.resolve(e)}}te.\u0275fac=function(e){return new(e||te)(s.\u0275\u0275inject(f.DataGridFilterOptionsBackwardCompatibilityModifier))},te.\u0275prov=s.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac});class re{_setInitialFilterOptions(e){e.items??(e.items=`$${(0,f.createDataGridItemsAttributeName)(e)}`),e.activeRow??(e.activeRow=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`);const t=(0,f.createDataGridInitialFilterOptions)(e);t&&(e._filterOptions=t)}_canSetInitialFilterOptions(e){return(0,b.isEmpty)(e?._filterOptions)&&(0,f.canDataGridContainsFilterOptions)(e)}crtOnMetaDataInit(e){return(0,N.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(this._canSetInitialFilterOptions).forEach(t=>this._setInitialFilterOptions(t)),Promise.resolve(e)}}re.\u0275fac=function(e){return new(e||re)},re.\u0275prov=s.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac});class tt{}tt.\u0275fac=function(e){return new(e||tt)},tt.\u0275mod=s.\u0275\u0275defineNgModule({type:tt}),tt.\u0275inj=s.\u0275\u0275defineInjector({providers:[f.DataGridFilterOptionsBackwardCompatibilityModifier,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:re,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:te,multi:!0}]});class rt{_cleanupDefaultFilterOptionsMetadata(e){const t=e._filterOptions;if(!t)return this._cleanupDefaultActiveRow(e);const r=(0,b.cloneDeep)(e),i=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`;r.activeRow??(r.activeRow=i);const a=(0,f.createDataGridInitialFilterOptions)(r);!(0,b.isEqual)(t,a)||(delete e._filterOptions,this._cleanupDefaultActiveRow(e))}_cleanupDefaultActiveRow(e){const t=e.activeRow,r=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`;(0,b.isEqual)(t,r)&&delete e.activeRow}crtOnMetaDataChanged(e){return(0,N.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultFilterOptionsMetadata(t)),Promise.resolve(e)}}rt.\u0275fac=function(e){return new(e||rt)},rt.\u0275prov=s.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac});class it{}it.\u0275fac=function(e){return new(e||it)},it.\u0275mod=s.\u0275\u0275defineNgModule({type:it}),it.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_POSTPROCESSOR,useClass:rt,multi:!0}]});class ie{constructor(e,t,r,i,a){this._defaultFeatures=e,this._featureValues=t,this._translateService=r,this._dataGridFolderTreeRelationsProvider=i,this._licenseOperationValues=a}_createGeneralListSettingsMenuItems(e,t){const r=`$${t} | crt.ToBoolean | crt.InvertBooleanValue`,i=this._defaultFeatures?.operations?.canCreateDefaultGridSettings,a={type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.ActionsToolbar.SaveForAll"),icon:"save",visible:r,clicked:{request:"crt.DataGridSaveConfigsForAllRequest",params:{dataGridName:e.name}}};return[{type:"crt.MenuLabel",caption:this._translateService.instant("DataGrid.ActionsToolbar.GeneralListSettingsLabel"),visible:r},...i?[a]:[],{type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.ActionsToolbar.ResetToDefault"),icon:"reset",visible:r,clicked:{request:"crt.DataGridResetConfigsToDefaultRequest",params:{dataGridName:e.name}}}]}_setupSaveConfigsForActiveFolderActionVisibleAttribute(e,t,r,i){const a=`${t}_Exist`,o=`${r}_NotExist`;i.viewModelConfig??(i.viewModelConfig={}),i.viewModelConfig.attributes={...i.viewModelConfig.attributes,[a]:{from:t,converter:"crt.ToBoolean"},[o]:{from:r,converter:"crt.ToBoolean | crt.InvertBooleanValue"},[e]:{from:[a,o],converter:"crt.IsEveryEqualTo : true"}}}_createFolderListSettingsMenuItems(e,t,r){const i=this._licenseOperationValues[f.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridSettingsByFolders||!i)return[];const a=this._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(e,r);if(!a?.name)return[];const o=this._translateService.instant("DataGrid.ActionsToolbar.SaveListSettingsForFolder"),n=this._translateService.instant("DataGrid.ActionsToolbar.ClearListSettingsForFolder"),l=`$${t} | crt.ToBoolean`,{activeFolderFolderTreeIdAttrName:d,activeFolderNameAttrName:p}=(0,m.buildFolderTreeAttributeNames)(a.name),_=`$${p} | crt.InterpolateString : '${o}'`,S=e.name+"_SaveConfigsForActiveFolderAction_Visible";return this._setupSaveConfigsForActiveFolderActionVisibleAttribute(S,d,t,r),[{type:"crt.MenuLabel",caption:this._translateService.instant("DataGrid.ActionsToolbar.FolderListSettingsLabel"),visible:`$${d} | crt.ToBoolean`},{type:"crt.MenuItem",caption:_,icon:"save-for-folder-icon",visible:`$${S}`,clicked:{request:"crt.DataGridSaveConfigsForActiveFolderRequest",params:{folderTreeName:a.name,dataGridName:e.name}}},{type:"crt.MenuItem",caption:_,icon:"save-for-folder-icon",visible:l,clicked:{request:"crt.DataGridUpdateConfigsForActiveFolderRequest",params:{folderTreeName:a.name,dataGridName:e.name}}},{type:"crt.MenuItem",caption:`$${p} | crt.InterpolateString : '${n}'`,icon:"discard-for-folder-icon",visible:l,clicked:{request:"crt.DataGridClearConfigsForActiveFolderRequest",params:{dataGridName:e.name,folderTreeName:a.name}}}]}crtOnMetaDataInit(e){return(0,N.getDataGridViewConfigs)(e).filter(r=>!r.headerToolbarItems).forEach(r=>{const i=(0,f.createDataGridActiveFolderSettingsAttributeName)(r),a=this._createGeneralListSettingsMenuItems(r,i),o=this._createFolderListSettingsMenuItems(r,i,e);r.headerToolbarItems=[...a,...o]}),Promise.resolve(e)}}ie.\u0275fac=function(e){return new(e||ie)(s.\u0275\u0275inject(f.DATA_GRID_FEATURES,8),s.\u0275\u0275inject(m.FEATURE_VALUES),s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(f.DataGridFolderTreeRelationsProvider),s.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))},ie.\u0275prov=s.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac});class ae{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,h.firstValueFrom)(this._featureService.getFeatureState(N.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setCancelItemsChangesOutput(e){const t=e.items.slice(1);e.cancelItemsChanges={request:"crt.DataGridCancelItemsChangesRequest",params:{itemsAttributeName:t,changedItems:"@event"}}}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){return(yield t._isEditingModeDisabled())||(0,N.getDataGridViewConfigsWithItemsBinding)(e).filter(r=>r.cancelItemsChanges==null).forEach(r=>t._setCancelItemsChangesOutput(r)),e})()}}ae.\u0275fac=function(e){return new(e||ae)(s.\u0275\u0275inject(y.FeatureService))},ae.\u0275prov=s.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac});class oe{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,h.firstValueFrom)(this._featureService.getFeatureState(N.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_isItemsCreationEnabled(e){const t=e.features;if((0,I.isBindingExpression)(t))return!0;const r=(0,f.fullInDataTableEditingFeatures)(t?.editable,!0);return Boolean(r.itemsCreation)}_bindEditingCellsInput(e,t){if(e.editingCells)return;const r=e.name&&`${e.name}_EditingCells`;!r||(t[r]||(t[r]={value:null}),e.editingCells=`$${r}`)}_bindItemCreatingOutput(e,t,r){if(e.createItem)return;const i=this._getDefaultValuesFromDependencies(e,t,r);e.createItem={request:"crt.DataGridCreateItemRequest",params:{dataGridName:e.name,insertionIndex:"@event.index",defaultValues:i.map(({attributeName:a,value:o})=>({attributeName:a,value:o}))}}}_getDefaultValuesFromDependencies(e,t,r){const i=r.dependencies,a=r.dataSources,o=r.primaryDataSourceName||"",n=e.items.slice(1),d=t[n]?.modelConfig?.path,p=d&&i?.[d];return p?p.filter(_=>this._isDependOnPageDataSource(_,a)).map(_=>this._getDependencyAttributeName(_,t,o)).map((_,S)=>_||`${e.name}_DependencyValue_${S}`).map((_,S)=>{const C=p[S];return this._setDependencyViewModelAttribute(_,C,t),this._getDefaultValue(_,C,a)}):[]}_getRelatedDataSourceName(e){return e.relationPath.split(".").shift()??""}_isDependOnPageDataSource(e,t){const r=this._getRelatedDataSourceName(e);return t?.[r]?.scope===A.DataSourceScope.Page}_getDefaultValue(e,t,r){const i=this._getRelatedDataSourceName(t),a=r?.[i]?.config||{},o=a.entitySchemaName?`$${e} | crt.ToLookup : '${a.entitySchemaName}'`:`$${e}`;return{attributeName:t.attributePath,value:o}}_setDependencyViewModelAttribute(e,t,r){r[e]||(r[e]={modelConfig:{path:t.relationPath}})}_getDependencyAttributeName(e,t,r){return Object.keys(t).find(i=>(t[i]?.modelConfig?.path||"").replace("#PrimaryDataSourceName()#",r)===e.relationPath)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t._isEditingModeDisabled())return e;const r=e;r.viewModelConfig=r.viewModelConfig??{};const i=r.viewModelConfig.attributes=r.viewModelConfig.attributes||{},a=r.modelConfig||{};return(0,N.getDataGridViewConfigsWithItemsBinding)(r).filter(o=>t._isItemsCreationEnabled(o)).forEach(o=>{t._bindEditingCellsInput(o,i),t._bindItemCreatingOutput(o,i,a)}),e})()}}oe.\u0275fac=function(e){return new(e||oe)(s.\u0275\u0275inject(y.FeatureService))},oe.\u0275prov=s.\u0275\u0275defineInjectable({token:oe,factory:oe.\u0275fac});class ne{_bindItemDeletionOutput(e){const t=e.items.slice(1);e.deleteItem||!t||(e.deleteItem={request:"crt.DeleteRecordRequest",params:{itemsAttributeName:t,recordId:"@event.rowId"}})}crtOnMetaDataInit(e){const t=e;return t.viewModelConfig=t.viewModelConfig??{},(0,N.getDataGridViewConfigsWithItemsBinding)(t).forEach(r=>{this._bindItemDeletionOutput(r)}),Promise.resolve(e)}}ne.\u0275fac=function(e){return new(e||ne)},ne.\u0275prov=s.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac});class se{constructor(e){this._featureService=e,this._featureName="DisableDataGridEditingMode"}_isEditingModeDisabled(){return(0,h.firstValueFrom)(this._featureService.getFeatureState(N.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setSaveItemsChangesOutput(e){const t=e.items.slice(1);e.saveItemsChanges={request:"crt.SaveRecordsRequest",params:{itemsAttributeName:t}}}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){return(yield t._isEditingModeDisabled())||(0,N.getDataGridViewConfigsWithItemsBinding)(e).filter(r=>r.saveItemsChanges==null).forEach(r=>t._setSaveItemsChangesOutput(r)),e})()}}se.\u0275fac=function(e){return new(e||se)(s.\u0275\u0275inject(y.FeatureService))},se.\u0275prov=s.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac});class ce{constructor(e){this._featureValues=e}_createActivateRowBusinessRulesRequest(e,t){return{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:e,dataGridViewElementName:t.name}}}_getActiveRowAttributeName(e){let t=e.activeRow;return t==null&&(t=`$${(0,f.createDataGridActiveRowAttributeName)(e)}`),(0,I.isBindingExpression)(t)?(0,I.parseExpression)(t).attributePath:""}crtOnMetaDataInit(e){if(this._featureValues.DisableActivateGridRowOnReload)return Promise.resolve(e);const t=e;return(0,N.getDataGridViewConfigsWithItemsBinding)(e).forEach(r=>{const i=this._getActiveRowAttributeName(r);if(i){const a=(0,f.getDataGridItemsAttributeName)(r);m.MetadataSchemaUtils.addViewModelAttributeChangeRequest(t,{attributeName:a,requests:[this._createActivateRowBusinessRulesRequest(i,r)]})}}),Promise.resolve(e)}}ce.\u0275fac=function(e){return new(e||ce)(s.\u0275\u0275inject(m.FEATURE_VALUES))},ce.\u0275prov=s.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac});class le{constructor(e){this._featureService=e,this._featureName="DisableDataGridPagingPreprocessing"}_setPaginationChange(e,t){if(e.paginationChange)return;const r=e.items?.slice(1),i=t.getBoundDataSourceNameByAttributePath(r);e.paginationChange=zt(i)}_setPagingConfig(e,t){const r=e.items?.slice(1),i=(t?.viewModelConfig?.attributes)[r]??{};if(!(0,g.isModelAttributeConfig)(i))return;const a=i.modelConfig;!a||a?.pagingConfig||(a.pagingConfig=Jt())}get _isFeatureDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._featureName))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t._isFeatureDisabled)return e;const r=e,i=(0,N.getDataGridViewConfigsWithItemsBinding)(e);for(const a of i)t._setPagingConfig(a,r);return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield i._isFeatureDisabled)return e;const a=(0,N.getDataGridViewConfigsWithItemsBinding)(e);for(const o of a)i._setPaginationChange(o,r);return e})()}}le.\u0275fac=function(e){return new(e||le)(s.\u0275\u0275inject(y.FeatureService))},le.\u0275prov=s.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac});class ue{constructor(e){this._featureService=e,this._featureName="DisableDataGridPlaceholderPreprocessing"}_setNoConfiguredPlaceholder(e){e.skeleton==null&&(e.skeleton=[{type:"crt.Placeholder",image:{type:"icon",icon:"data-table",width:null,height:null,padding:null},title:"",subhead:""}])}_setNoItemsPlaceholders(e,t,r){const i=t.placeholder,a=t.items?.split("$")?.pop(),o=this._getSearchFilterAttributesNames(r,a),l=[...this._getFilterAttributesNames(e,a),...o];if(!i?.length||!l.length)return;i.map(p=>p.visible).map(p=>(p??"")?.split("$")?.pop()).filter(Boolean).map(p=>e[p]).filter(Boolean).forEach(p=>p.from=(0,b.uniq)([...p.from,...l]))}_getFilterAttributesNames(e,t){const i=e[t]?.modelConfig?.filterAttributes??[];return Object.values(i).filter(a=>a.loadOnChange).filter(a=>!a.name.endsWith("_PredefinedFilter")).map(a=>a.name)}_getSearchFilterAttributesNames(e,t){return e.filter(r=>r.targetAttributes?.includes(t)).map(({name:r})=>nr(r,t))}_getSearchFilterViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield(0,h.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const i=e;i.viewModelConfig.attributes=i.viewModelConfig.attributes??{};const a=i.viewModelConfig.attributes,o=t._getSearchFilterViewConfigs(i);return(0,N.getDataGridViewConfigs)(e).forEach(n=>{(0,R.isBindToViewModelAttribute)(n.items,a)?t._setNoItemsPlaceholders(a,n,o):t._setNoConfiguredPlaceholder(n)}),e})()}}ue.\u0275fac=function(e){return new(e||ue)(s.\u0275\u0275inject(y.FeatureService))},ue.\u0275prov=s.\u0275\u0275defineInjectable({token:ue,factory:ue.\u0275fac});class de{_bindActiveRow(e,t,r){if(t.activeRow===void 0&&(t.activeRow=`$${(0,f.createDataGridActiveRowAttributeName)(t)}`),!(0,I.isBindingExpression)(t.activeRow))return;const i=(0,I.parseExpression)(t.activeRow).attributePath;r[i]??(r[i]={value:null}),m.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:i,requests:[{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:i,dataGridViewElementName:t.name}}]})}crtOnMetaDataInit(e){var t;const r=e,i=(t=r.viewModelConfig).attributes??(t.attributes={});return(0,N.getDataGridViewConfigs)(e).forEach(a=>this._bindActiveRow(r,a,i)),Promise.resolve(e)}}de.\u0275fac=function(e){return new(e||de)},de.\u0275prov=s.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac});class me{constructor(e){this._featureService=e,this._featureName="DisableDataGridRowDoubleClickPreprocessing"}_hasSectionEditPage(e,t){return(0,u.Z)(function*(){const r={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return yield A.HandlerChainService.instance.process(r)})()}_getReferenceSchemaName(e,t){return(0,u.Z)(function*(){return(yield(0,g.getEntitySchemaAttribute)(t,e))?.referenceSchemaName})()}_getPrimaryAttributeName(e,t){const r=(0,N.getViewModelItemsAttributeName)(e),i=t.getBoundDataSourceNameByAttributePath(r),a=t.getBoundDataSchemaByAttributePath(r),{primaryAttributeName:o}=a??{};return o?`${i}_${o}`:""}_isPageExists(e,t){var r=this;return(0,u.Z)(function*(){const i=r._getPrimaryAttributeName(e,t),a=yield r._getReferenceSchemaName(i,t);return r._hasSectionEditPage(a,t)})()}_getDataGridViewConfigs(e,t){var r=this;return(0,u.Z)(function*(){const i=(0,N.getDataGridViewConfigsWithItemsBinding)(e);return(yield Promise.all(i.map(o=>r._isPageExists(o,t)))).reduce((o,n,l)=>(n&&!i[l].rowDoubleClick&&o.push(i[l]),o),[])})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){if(yield(0,h.lastValueFrom)(i._featureService.getFeatureState(i._featureName),{defaultValue:null}))return e;const o=yield i._getDataGridViewConfigs(e,r);for(const n of o)n.rowDoubleClick={request:"crt.DataGridRowDoubleClickRequest",params:{itemsAttributeName:(0,N.getViewModelItemsAttributeName)(n),rowId:"@event.rowId"}};return e})()}}me.\u0275fac=function(e){return new(e||me)(s.\u0275\u0275inject(y.FeatureService))},me.\u0275prov=s.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac});class pe{constructor(e){this._featureService=e}_isSelectionPreprocessingDisabled(){const e=this._featureService.getFeatureState("DisableDataGridRowsSelectionPreprocessing");return(0,h.lastValueFrom)(e,{defaultValue:!1})}_bindSelectedRows(e,t){if(e.selectedRows??(e.selectedRows=`$${(0,f.createDataGridSelectedRowsAttributeName)(e)}`),!(0,I.isBindingExpression)(e.selectedRows))return;const r=(0,I.parseExpression)(e.selectedRows).attributePath;t[r]||(t[r]={value:null})}_bindSelectionState(e,t,r){if(t.selectionState??(t.selectionState=`$${(0,f.createDataGridSelectionStateAttributeName)(t)}`),!(0,I.isBindingExpression)(t.selectionState))return;const i=(0,I.parseExpression)(t.selectionState).attributePath;if(r[i]??(r[i]={value:null}),!(0,I.isBindingExpression)(t.items))return;const a=(0,I.parseExpression)(t.items).attributePath;if(t.totalItemsCount??(t.totalItemsCount=`$${a}_TotalItemsCount`),!(0,I.isBindingExpression)(t.totalItemsCount))return;const o=(0,I.parseExpression)(t.totalItemsCount).attributePath,n=`${a}_SelectedItemsCount`;if(this._createTotalItemsCountAttribute(o,{itemsAttributeName:a,selectionStateAttributeName:i},r),this._createSelectedItemsCountAttribute(n,{itemsAttributeName:a,selectionStateAttributeName:i,totalItemsCountAttributeName:o},r),m.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:i,requests:[{request:"crt.DataGridCleanupCachedItemsCountLoadParametersRequest",params:{itemsAttributeName:a,selectionStateAttributeName:i}},{request:"crt.DataGridRunSelectedItemsCountAttributeCalculationRequest",params:{selectionStateAttributeName:i,selectedItemsCountAttributeName:n}}]}),!(0,I.isBindingExpression)(t.selectedRows))return;const l=(0,I.parseExpression)(t.selectedRows).attributePath;m.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:i,requests:[{request:"crt.DataGridSetSelectedRowsFromSelectionStateRequest",params:{selectedRowsAttributeName:l,selectionStateAttributeName:i}}]})}_createTotalItemsCountAttribute(e,t,r){const{itemsAttributeName:i,selectionStateAttributeName:a}=t,o=`${e}_Actualization`;r[e]??(r[e]={from:[i,o],converter:`crt.ToCollectionItemsCount : '${i}' : '${e}'`}),r[o]??(r[o]={from:a,converter:"crt.IsAnySelected"})}_createSelectedItemsCountAttribute(e,t,r){const{itemsAttributeName:i,selectionStateAttributeName:a,totalItemsCountAttributeName:o}=t;r[e]??(r[e]={from:[i,a,o],converter:`crt.ToCollectionSelectedItemsCount : '${i}' : '${e}'`,change:{request:"crt.DataGridSetSelectedCountToRowsSelectionStateRequest",params:{selectionStateAttributeName:a,selectedItemsCountAttributeName:e}}})}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){var r;if(yield t._isSelectionPreprocessingDisabled())return e;const i=e,a=(r=i.viewModelConfig).attributes??(r.attributes={});return(0,N.getDataGridViewConfigs)(e).forEach(o=>{t._bindSelectedRows(o,a),t._bindSelectionState(i,o,a)}),e})()}}pe.\u0275fac=function(e){return new(e||pe)(s.\u0275\u0275inject(y.FeatureService))},pe.\u0275prov=s.\u0275\u0275defineInjectable({token:pe,factory:pe.\u0275fac});class fe{constructor(e=!1){this._isDesignTime=e}_setInitialSelectionOptions(e){(0,N.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(t=>this._canSetSelectionOptions(t)).forEach(t=>this._setSelectionOptions(t))}_canSetSelectionOptions(e){return(0,b.isEmpty)(e?._selectionOptions)&&(0,f.canDataGridContainsSelectionOptions)(e)}_setSelectionOptions(e){e.selectionState??(e.selectionState=`$${(0,f.createDataGridSelectionStateAttributeName)(e)}`);const t=(0,f.createDataGridInitialSelectionOptions)(e);t&&(e._selectionOptions=t)}_setExportToExcelRequestFiltersParameter(e){(0,R.getRequestBindingConfigs)(e.viewConfig,"crt.ExportDataGridToExcelRequest",this._canSetExportToExcelRequestFiltersParameter).forEach(t=>{const r=t.params.viewName,i=this._getExportToExcelRequestFiltersParameter(e,r);!i||(t.params={...t.params,filters:i})})}_canSetExportToExcelRequestFiltersParameter(e){const{viewName:t,filters:r}=e?.params??{};return Boolean(t)&&r===void 0}_getExportToExcelRequestFiltersParameter(e,t){const r=m.MetadataSchemaUtils.getViewConfigInfoByName(e,t);if(!r?.viewConfig)return null;const{items:i,_selectionOptions:a}=r.viewConfig,o=(0,I.isBindingExpression)(i)&&(0,I.parseExpression)(i).attributePath,n=(0,I.getSelectionStateAttributeName)(a);return!o||!n?null:(0,I.createCollectionFiltersBindingExpression)(o,n,{supportEmptySelection:!0})}crtOnMetaDataInit(e){const t=e;return this._setInitialSelectionOptions(t),this._isDesignTime||this._setExportToExcelRequestFiltersParameter(t),Promise.resolve(e)}}fe.\u0275fac=function(e){return new(e||fe)(s.\u0275\u0275inject(m.IS_DESIGN_TIME,8))},fe.\u0275prov=s.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac});class q{}q.\u0275fac=function(e){return new(e||q)},q.\u0275mod=s.\u0275\u0275defineNgModule({type:q}),q.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:fe,multi:!0}]});class at{_isSelectionStateAttributeBound(e,t,r){const i=(0,b.cloneDeep)(r),o=m.MetadataSchemaUtils.getViewConfigInfoByName(i,e).viewConfig;return delete o._selectionOptions,delete o.selectionState,m.MetadataSchemaUtils.isViewModelAttributeBound(i,t)}_cleanupDefaultSelectionOptionsMetadata(e,t){const r=e._selectionOptions;if(!r)return this._cleanupDefaultSelectionState(e,t);const i=(0,b.cloneDeep)(e),a=`$${(0,f.createDataGridSelectionStateAttributeName)(e)}`;i.selectionState??(i.selectionState=a);const o=(0,f.createDataGridInitialSelectionOptions)(i);if(!(0,b.isEqual)(r,o))return;const n=(0,I.getSelectionStateAttributeName)(r);e.name&&this._isSelectionStateAttributeBound(e.name,n,t)||(delete e._selectionOptions,this._cleanupDefaultSelectionState(e,t))}_cleanupDefaultSelectionState(e,t){const r=e.selectionState,i=`$${(0,f.createDataGridSelectionStateAttributeName)(e)}`;if(!(0,b.isEqual)(r,i))return;const a=(0,I.parseExpression)(r).attributePath;e.name&&this._isSelectionStateAttributeBound(e.name,a,t)||delete e.selectionState}crtOnMetaDataChanged(e){return(0,N.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultSelectionOptionsMetadata(t,e)),Promise.resolve(e)}}at.\u0275fac=function(e){return new(e||at)},at.\u0275prov=s.\u0275\u0275defineInjectable({token:at,factory:at.\u0275fac});class ot{}ot.\u0275fac=function(e){return new(e||ot)},ot.\u0275mod=s.\u0275\u0275defineNgModule({type:ot}),ot.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_POSTPROCESSOR,useClass:at,multi:!0}]});class ge{constructor(e,t,r){this._featureService=e,this._dcmSchemaManagerService=t,this._entitySchemaRepository=r,this._dcmDataAttributePostfix="_DCMData",this._dcmSchemas=[],this._dataGridToDataSourceMap=[],this._dataSourceSchemas=[]}_getDataGridToDataSourceMap(e,t){return e.map(r=>{const i=r.primaryColumnName?.split("_");i?.pop();const a=i?.join("_")||"",o=t[a];return{dataGridName:r.name,dataSource:o,dataSourceName:a}}).filter(({dataSource:r})=>r!=null)}_getEntitySchemaFromDataSourceSchemas(e){return this._dataSourceSchemas.find(t=>t.name===e?.config?.entitySchemaName)}_getFilterColumnPath(e){const t=e.find(i=>i.filters)?.filters;let r="";if(t){const i=JSON.parse(t);r=`${Object.values(i.items)[0].leftExpression.columnPath}`}return r}_fillDataGridModelConfig(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=a._dcmSchemas.filter(C=>C.entitySchemaUId===e);if(!o?.length)return;const n=a._getFilterColumnPath(o),l=a._dcmSchemaManagerService.getDcmSchemaDataItems(e),d=yield(0,h.firstValueFrom)(l),p=`${t.name}${a._dcmDataAttributePostfix}`;i[p]={value:{schemas:o,schemasData:d,filterColumnAttributePath:`${r?.dataSourceName}_${n}`}};const _=t.items.substring(1),S=i[_].viewModelConfig;n&&_&&!S.attributes[n]&&(S.attributes[`${r?.dataSourceName}_${n}`]={modelConfig:{path:`${r?.dataSourceName}.${n}`}})})()}_initDataGridViewConfigAttributes(e,t){var r=this;return(0,u.Z)(function*(){const i=r._dataGridToDataSourceMap.find(o=>o.dataGridName===e.name);if(!i)return;const a=r._getEntitySchemaFromDataSourceSchemas(i.dataSource);!a||(yield r._fillDataGridModelConfig(a?.uId,e,i,t))})()}_getDataSourceSchemas(){var e=this;return(0,u.Z)(function*(){const t=e._dataGridToDataSourceMap.map(r=>({name:r?.dataSource?.config?.entitySchemaName,loadLookupColumns:!0}));return yield(0,h.firstValueFrom)(e._entitySchemaRepository.getSchemes(t))})()}get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState("DisableDataGridProgressBarStageCell"))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=(0,N.getDataGridViewConfigs)(e);if(!r?.length)return e;const i=e.modelConfig.dataSources||{};t._dcmSchemas=yield(0,h.firstValueFrom)(t._dcmSchemaManagerService.getDcmSchemaDataCollection()),t._dataGridToDataSourceMap=t._getDataGridToDataSourceMap(r,i),t._dataSourceSchemas=yield t._getDataSourceSchemas();const a=e,o=a.viewModelConfig.attributes=a.viewModelConfig.attributes||{};for(const n of r)yield t._initDataGridViewConfigAttributes(n,o);return e})()}}ge.\u0275fac=function(e){return new(e||ge)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(y.DcmSchemaManagerService),s.\u0275\u0275inject(m.EntitySchemaRepository))},ge.\u0275prov=s.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac});class _e{constructor(e,t){this._featureValues=e,this._licenseOperationValues=t}crtOnMetaDataInit(e){const t=this._licenseOperationValues[f.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridRestrictionsPreprocessing||t)return Promise.resolve(e);const r={columns:{editing:!1,adding:!1}};return(0,N.getDataGridViewConfigs)(e).filter(i=>typeof i.features!="string").forEach(i=>{i.features??(i.features={}),(0,b.merge)(i.features,r)}),Promise.resolve(e)}}_e.\u0275fac=function(e){return new(e||_e)(s.\u0275\u0275inject(m.FEATURE_VALUES),s.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))},_e.\u0275prov=s.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac});const sr=new s.InjectionToken("Represents a handler to process data grid metadata on metadata init");class cr{getViewConfigsByType(e,t){return(m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",[e],t.viewConfig)||[]).map(r=>r?.viewConfig).filter(Boolean)}processElementsOnMetadataInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i.getViewConfigsByType(e,r);yield Promise.all(a.map(o=>t?.handle({metadata:r,viewConfig:o})))})()}processElementsOnModelInit(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=a.getViewConfigsByType(e,r);yield Promise.all(o.map(n=>t?.handle({metadata:r,viewConfig:n,models:i})))})()}}class nt extends cr{constructor(e){super(),this._dataGridOnMetadataInitHandler=e}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e;return t._dataGridOnMetadataInitHandler&&(yield t.processElementsOnMetadataInit("crt.DataGrid",t._dataGridOnMetadataInitHandler,r)),Promise.resolve(e)})()}}nt.\u0275fac=function(e){return new(e||nt)(s.\u0275\u0275inject(sr,8))},nt.\u0275prov=s.\u0275\u0275defineInjectable({token:nt,factory:nt.\u0275fac});class st{constructor(e,t){this._userInfo=e,this._entityDataSourceAttributeConfigConverterFactory=t}_applyResources(e,t){var r;(0,b.isEmpty)(e?.localizableStrings)||(t.resources??(t.resources={strings:{}}),(r=t.resources).strings??(r.strings={}),(0,b.merge)(t.resources.strings,e?.localizableStrings),this._fullResourcesForCurrentCulture(t.resources.strings))}_fullResourcesForCurrentCulture(e){const t=this._userInfo.cultureInfo.sysCultureName;Object.values(e).filter(r=>!(t in r)).forEach(r=>{const i=Object.values(r).find(Boolean);i&&(r[t]=i)})}_applyDataGridColumns(e,t,r){if(!t)return;const i=(0,f.getDataGridItemsAttributeConfig)(e,r);if(!i)return;const a=i.modelConfig?.path;if(!a)return;const o=(0,f.getDataGridItemsDataSourceConfig)(a,r);if(!o)return;const n=e.columns=[],l=i.viewModelConfig.attributes={},d=o.attributes={};t.forEach(({viewMetadata:p,viewModelMetadata:_,modelMetadata:S})=>{if(p&&n.push(p),!S)return;const C=this._createEntityDataSourceAttribute(S),v=_?.attributeName||p?.code;!v||!C||(l[v]={modelConfig:{path:`${a}.${C.name}`}},d[C.name]=C.config)})}_createEntityDataSourceAttribute(e){const t=e.name,r=this._entityDataSourceAttributeConfigConverterFactory.create(e?.type).toEntityDataSourceAttribute(e);return!t||!r?null:{name:t,config:r}}_applyDataGridSortingConfig(e,t,r){if(!t)return;const i=(0,f.getDataGridItemsAttributeConfig)(e,r);if(!i)return;const a=i.modelConfig?.sortingConfig;a&&delete a.default;const o=a?.attributeName??(0,f.createDataGridSortingAttributeName)(e),n=r.viewModelConfig.attributes,l=n[o]??(n[o]={});"from"in l||(l.value=(0,f.toSortColumnsOptions)(t,i))}apply(e,t,r){const{resources:i,columns:a,sorting:o}=t;this._applyResources(i,r),this._applyDataGridColumns(e,a,r),this._applyDataGridSortingConfig(e,o,r)}}st.\u0275fac=function(e){return new(e||st)(s.\u0275\u0275inject(m.UserInfo),s.\u0275\u0275inject(m.ENTITY_DATA_SOURCE_ATTRIBUTE_CONFIG_CONVERTER_FACTORY))},st.\u0275prov=s.\u0275\u0275defineInjectable({token:st,factory:st.\u0275fac,providedIn:"root"});class he extends T.AbstractHandler{constructor(e,t,r,i,a){super(),this._dataGridDesignSettingsApplier=e,this._dataGridFolderTreeRelationsProvider=t,this._folderTreeRelatedElementConfigsProvider=r,this._folderTreeIdResolver=i,this._featureValues=a}_setDataGridActiveFolderSettingsAttribute(e,t,r){const i=r.viewModelConfig.attributes,a=(0,f.createDataGridActiveFolderSettingsAttributeName)(e);i[a]={value:t}}handle(e){var t=()=>super.handle,r=this;return(0,u.Z)(function*(){if(r._featureValues.DisableDataGridSettingsByFolders)return t().call(r,e);const{metadata:i,viewConfig:a}=e??{};if(!i?.name||!a?.name)return t().call(r,e);const o=r._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(a,i);if(!o)return t().call(r,e);const n=yield r._folderTreeIdResolver.getActiveFolderFolderTreeId(o,i);if(!n)return t().call(r,e);const l={folderId:n,schemaName:i.name,elementName:a.name},d=yield(0,h.firstValueFrom)(r._folderTreeRelatedElementConfigsProvider.get(l));return d&&r._dataGridDesignSettingsApplier.apply(a,(0,b.cloneDeep)(d),i),r._setDataGridActiveFolderSettingsAttribute(a,d,i),t().call(r,e)})()}}he.\u0275fac=function(e){return new(e||he)(s.\u0275\u0275inject(st),s.\u0275\u0275inject(f.DataGridFolderTreeRelationsProvider),s.\u0275\u0275inject(y.FolderTreeRelatedElementConfigsProvider),s.\u0275\u0275inject(f.FolderTreeIdResolver),s.\u0275\u0275inject(m.FEATURE_VALUES))},he.\u0275prov=s.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac});const Nr="DisableDataGridSortingPreprocessing";class Ae extends T.AbstractHandler{constructor(e){super(),this._isSortingPreprocessingDisabled=Boolean(e[Nr])}_getSortingAttributeName(e,t){const r=(0,f.getDataGridItemsAttributeName)(e);if(!r)return null;const i=t.viewModelConfig?.attributes?.[r];if(!i||!("modelConfig"in i))return null;let a=i.modelConfig?.sortingConfig?.attributeName;if(a)return a;a=(0,f.createDataGridSortingAttributeName)(e);const o={modelConfig:{sortingConfig:{attributeName:a}}};return(0,b.merge)(i,o),a}_setSorting(e,t,r){var i,a;if(t.sorting)return;(i=r.viewModelConfig).attributes||(i.attributes={}),(a=r.viewModelConfig.attributes)[e]||(a[e]={});const o=(0,f.getDataGridItemsAttributeName)(t);t.sorting=`$${e} | crt.ToDataTableSortingConfig: '${o}'`}_setSortingChange(e){e.sortingChange||(e.sortingChange={request:"crt.DataGridSortDataRequest",params:{itemsAttributeName:(0,f.getDataGridItemsAttributeName)(e),sorting:"@event"}})}handle(e){const{metadata:t,viewConfig:r}=e??{};if(!t||!r||this._isSortingPreprocessingDisabled)return super.handle(e);const i=this._getSortingAttributeName(r,t);return i?(this._setSorting(i,r,t),this._setSortingChange(r),super.handle(e)):super.handle(e)}}Ae.\u0275fac=function(e){return new(e||Ae)(s.\u0275\u0275inject(m.FEATURE_VALUES,8))},Ae.\u0275prov=s.\u0275\u0275defineInjectable({token:Ae,factory:Ae.\u0275fac});class U{}U.\u0275fac=function(e){return new(e||U)},U.\u0275mod=s.\u0275\u0275defineNgModule({type:U}),U.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:nt,multi:!0},{provide:sr,useFactory:c=>{const e=c.get(he);return e.setNext(c.get(Ae)),e},deps:[s.Injector]},he,Ae]});class be extends B{constructor(){super(...arguments),this.viewItemTypes=["crt.ApprovalList"]}}be.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(be)))(t||be)}}(),be.\u0275prov=s.\u0275\u0275defineInjectable({token:be,factory:be.\u0275fac});var ct=D(34617);class lt{_getMenuItem(e,t,r){return{type:"crt.MenuItem",caption:e.caption||e.captionLcz,clicked:{request:"crt.CreateRecordRequest",params:{entityName:t,defaultValues:r}}}}_getDefaultValues(e,t,r){const i=r?[{attributeName:r,value:e.UId}]:[];return t.length&&i.splice(0,0,...t),i}_getEntityName(e,t){const r=e.viewConfig.clicked.params;let i=r.entityName||"";if(!i){const a=r.itemsAttributeName;if(a){const o=t.getBoundDataSourceNameByAttributePath(a);i=t.dataSchemas[o]?.name}}return i}_getButtonsWithCreateRecordRequest(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(r=>{const i=r.viewConfig.clicked;return i?.params&&i.request==="crt.CreateRecordRequest"})}_fillMenuItems(e,t){var r;const i=this._getEntityName(e,t);if(!i)return;const a=ct.NavigationUtils.getEntityStructure(i,ct.UITypePriority.PreferFreedomUI);if(!a)return;const o=ct.NavigationUtils.getPagesForAddAction(a.pages);if(!o?.length)return;const n=a.attribute,l=e.viewConfig.clicked.params?.defaultValues||[];if(!l.find(p=>p.attributeName===n)?.value){if(o.length>1){e.viewConfig.clickMode="menu";const p=o.map(_=>{const S=this._getDefaultValues(_,l,n);return this._getMenuItem(_,i,S)});(r=e.viewConfig).menuItems??(r.menuItems=[]),e.viewConfig.menuItems.splice(0,0,...p)}else if(n){const p=this._getDefaultValues(o[0],l,n);e.viewConfig.clicked.params.defaultValues=p}}}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){return i._getButtonsWithCreateRecordRequest(e).forEach(a=>{i._fillMenuItems(a,r)}),e})()}}lt.\u0275fac=function(e){return new(e||lt)},lt.\u0275prov=s.\u0275\u0275defineInjectable({token:lt,factory:lt.\u0275fac});class ut{constructor(e){this.crtRoute=e}_getButtonsWithDefaultPageRequest(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(r=>r?.viewConfig?.clicked?.request==="crt.ContinueInOtherPageRequest")}_prepareButton(e,t){const r=e.viewConfig;(0,b.isString)(r.visible)||(r.visible=t)}_getEntityNavigationOptions(e){const t=(0,I.resolveSchemaPrimaryEntityName)(e),r=this.crtRoute.getState(),i=(0,b.last)(r?.children),a=(0,b.last)(i?.modelInitConfigs),o=(0,b.last)(r?.modelInitConfigs);return{defaultValues:a?.defaultValues||o?.defaultValues||[],entityName:t,recordId:a?.recordId}}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getEntityNavigationOptions(r);if(!i.entityName)return Promise.resolve(e);const a=t._getButtonsWithDefaultPageRequest(r),o=yield ct.NavigationUtils.getPageForActionAsync({action:A.ModelInPageAction.Edit,...i}),n=yield ct.NavigationUtils.getPageForActionAsync({action:A.ModelInPageAction.Add,...i}),l=o?.cardSchema===n?.cardSchema,d=o?.cardSchema===r.name,p=Boolean(!l&&!d&&n&&o?.cardSchema);return a.forEach(_=>{t._prepareButton(_,p)}),Promise.resolve(e)})()}}ut.\u0275fac=function(e){return new(e||ut)(s.\u0275\u0275inject(ct.LocationStrategy))},ut.\u0275prov=s.\u0275\u0275defineInjectable({token:ut,factory:ut.\u0275fac});const lr="Telephony.Use",ur="MailboxSynchronization.Use",dr="Chats.Use",Dr="SelectedItem";class dt{constructor(e,t,r){this._userInfo=e,this._profileAttributeService=t,this._licenseOperationValues=r}_getButtonToggleGroups(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ButtonToggleGroup",e.viewConfig).filter(r=>r.viewConfig.for)}_getDefaultSelectedTabValue(e){return e.selectedTab?{value:e.selectedTab}:{}}_removeTab(e,t){const r=e.findIndex(i=>i.name===t);r!==-1&&e.splice(r,1)}_isRemoveTab(e){return!this._licenseOperationValues[e]}_getLicenseOperations(){const e=new Map;return e.set(lr,"CtiTab"),e.set(ur,"EmailsTab"),e.set(dr,"ChatsTab"),e}_filterTabs(e){return this._userInfo.isSSP?e.filter(r=>r.name==="FeedsTab"):(this._getLicenseOperations().forEach((r,i)=>{this._isRemoveTab(i)&&this._removeTab(e,r)}),e)}crtOnModelInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=r?.viewModelConfig?.attributes,a=t._getButtonToggleGroups(r);for(const o of a){const n=o.viewConfig,l=n.for,p=m.MetadataSchemaUtils.getViewConfigInfoByFilter(P=>P.name===l,r.viewConfig)?.[0]?.viewConfig,_=`${l}_Items`;n.items=`$${_}`;let S=p?.items??[];p.name==="CommunicationsPanelItemsTabPanel"&&(S=t._filterTabs(S));const C=(0,f.mapTabItemsToToggleValues)(S);i[_]={value:C};const v=`${l}_${Dr}`;i[v]=i[v]||t._getDefaultSelectedTabValue(p),n.value=`$${v}`,p.selectedTab=`$${v}`,p.visible=`$${v} | crt.ToBoolean`,yield t._profileAttributeService.prepareAttributeWithFeatureCheck(r,p,"selectedTab",v,"DisableSaveToProfileToggleGroupSelectedTab"),p?.allowToggleClose!==void 0&&(n.allowUntoggle=p?.allowToggleClose)}return Promise.resolve(e)})()}}dt.\u0275fac=function(e){return new(e||dt)(s.\u0275\u0275inject(m.UserInfo),s.\u0275\u0275inject(f.ProfileAttributeService),s.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))},dt.\u0275prov=s.\u0275\u0275defineInjectable({token:dt,factory:dt.\u0275fac});class Zt{constructor(e){this.translateService=e,this.translatePrefix="CommunicationOptions"}translate(e){return this.translateService.instant(`${this.translatePrefix}.${e}`)}}var Fr=D(72856),Pr=D(54514),Tr=D(6523);class Se extends Zt{constructor(e,t,r,i,a){super(e),this.translateService=e,this._queryExecutor=t,this._domSanitizer=r,this._matIconRegistry=i,this._rightsService=a,this._addCommunicationOptionsRequestName="crt.AddCommunicationOptionsRequest"}_getMenuItemClickRequest(e,t,r,i,a,o){return{request:"crt.CreateCommunicationOptionRequest",params:{componentName:e,indexToInsert:"@event.index",masterRecordColumnName:a,values:{CommunicationType:t,[a]:i,CommunicationTypeName:o,CommunicationTypeDisplayFormat:r}},useRelativeContext:!0}}_getSubMenuItem(e,t,r,i,a,o,n){return{type:"crt.MenuItem",caption:e,clicked:this._getMenuItemClickRequest(t,r,i,a,o,e),...n&&{icon:`${n}`}}}_getMenuItem(e,t){return{type:"crt.MenuItem",caption:t,items:[],...e&&{icon:`${e}`}}}_registerIcon(e){if(!e)return;const t=this._domSanitizer.bypassSecurityTrustResourceUrl(window.location.origin+(0,m.getImageFullUrlById)(e));this._matIconRegistry.addSvgIcon(e,t)}_getAddOptionItems(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=[],n=yield a.getCommTypes(i),l=[...new Set(n.map(d=>d.typeOrGroupId))];for(const d of l){const p=n.filter(C=>C.typeOrGroupId===d),_=p[0],S=_?.groupIcon?.value;if(p.length>1){const C=a._getMenuItem(S,_.groupName);C.items=p.map(v=>a._getSubMenuItemFromType(v,e,t,r)),o.push(C)}else{const C=a._getSubMenuItemFromType(_,e,t,r);o.push(C)}}return o})()}_getSubMenuItemFromType(e,t,r,i){const a=this._getSubMenuItem(e.displayValue,t,e.value,e.displayFormat,r,i,e.typeIcon?.value);return this._registerIcon(e?.typeIcon?.value),this._registerIcon(e?.groupIcon?.value),a}_getValidationResult(e,t=""){return{success:e,errorMessage:t}}_validateComponentState(e,t){var r=this;return(0,u.Z)(function*(){const i=r._getValidationResult(!0);if(!e.masterRecordColumnName||!e.masterRecordColumnValue)return r._getValidationResult(!1,r.translate("Validations.IncorrectSetupComponentMessage"));if(e.readonly)return r._getValidationResult(!1,r.translate("Validations.ReadOnlyStateMessage"));const a={isNew:!0,schemaName:t},o=yield(0,h.lastValueFrom)(r._rightsService.getCanEdit(a));return o&&!o.result?r._getValidationResult(!1,o.message):i})()}_applyAddButtonState(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=yield a._validateComponentState(t,i);if(!o.success){e.forEach(n=>{n.clicked={request:"crt.NotificationRequest",params:{message:o.errorMessage,duration:1e4}},n.clickMode="default",n.menuItems=[]});return}e.forEach(n=>{n.clickMode="menu",n.menuItems=[...r,...n.menuItems||[]]})})()}_selectCommTypesFromDB(e){const t=new A.EntitySchemaQuery("CommunicationType");return t.addMacrosFunctionColumn(A.QueryMacrosType.PrimaryColumn,"typeId"),t.addMacrosFunctionColumn(A.QueryMacrosType.PrimaryDisplayColumn,"typeName"),t.addSchemaColumn("ImageLink","typeIcon"),t.addSchemaColumn("DisplayFormat","displayFormat"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Id","groupId"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Name","groupName"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.ImageLink","groupIcon"),t.filters.addSchemaColumnFilterWithParameter(A.ComparisonType.Not_equal,"[ComTypebyCommunication:CommunicationType:Id].Communication",f.CommunicationEnum.SMS),e==="ContactCommunication"&&t.filters.addSchemaColumnFilterWithParameter(A.ComparisonType.Equal,"UseforContacts",!0),e==="AccountCommunication"&&t.filters.addSchemaColumnFilterWithParameter(A.ComparisonType.Equal,"UseforAccounts",!0),this._queryExecutor.executeSelectQuery(t).pipe((0,h.share)(),(0,h.map)(r=>r.map(i=>({typeOrGroupId:i.groupId||i.typeId,value:i.typeId,displayValue:i.typeName,groupName:i.groupName,typeIcon:i.typeIcon,groupIcon:i.groupIcon,displayFormat:i.displayFormat}))),(0,h.catchError)(r=>(0,h.of)([])))}_getAddCommOptionsButtonsConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>t.viewConfig.clicked?.request===this._addCommunicationOptionsRequestName).map(t=>t.viewConfig)}getCommTypes(e){return(0,h.lastValueFrom)(this._selectCommTypesFromDB(e))}processAddButton(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getAddCommOptionsButtonsConfigs(t),o=t?.modelConfig?.dataSources,n=o&&o[r]?.config?.entitySchemaName||"",l=yield i._getAddOptionItems(e.name,e.masterRecordColumnValue,e.masterRecordColumnName,n),d=a.filter(p=>e.name===p.clicked?.params?.viewElementName);yield i._applyAddButtonState(d,e,l,n)})()}}Se.\u0275fac=function(e){return new(e||Se)(s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(Tr.QueryExecutor),s.\u0275\u0275inject(Pr.DomSanitizer),s.\u0275\u0275inject(Fr.MatIconRegistry),s.\u0275\u0275inject(y.RightsService))},Se.\u0275prov=s.\u0275\u0275defineInjectable({token:Se,factory:Se.\u0275fac});class Ce extends Zt{constructor(e){super(e),this.translateService=e}_setSortingConfig(e,t){const r=e.items.slice(1),i=`${r}_Sorting`,a=t.viewModelConfig.attributes;a[i]={isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}};const o=a[r];o.modelConfig={...o.modelConfig,sortingConfig:{...o.modelConfig?.sortingConfig,attributeName:i,default:[{columnName:"CreatedOn",direction:"asc"}]}}}_initTypeNameAttribute(e,t){const r=`${t}_CommunicationTypeName`,i=`${t}_Primary`,a=`${t}_NonActual`,o=" \u2022 "+this.translate("Primary"),n=" \u2022 "+this.translate("Invalid"),l=`${r}_Extended`,d=e?.viewModelConfig.attributes??{};d[l]={from:[r,i,a],converter:`crt.AppendConditionalParts : '${o}' : '${n}'`}}_prepareAttributes(e,t,r,i){(0,g.isModelAttributeConfig)(r)&&!r.modelConfig?.sortingConfig?.attributeName&&this._setSortingConfig(e,t),this._initTypeNameAttribute(r,i)}processAttributes(e,t,r,i){this._prepareAttributes(e,t,r,i)}}Ce.\u0275fac=function(e){return new(e||Ce)(s.\u0275\u0275inject(M.TranslateService))},Ce.\u0275prov=s.\u0275\u0275defineInjectable({token:Ce,factory:Ce.\u0275fac});class ye extends Zt{constructor(e){super(e),this.translateService=e}_getActionClickedRequest(e,t,r){return{request:e,params:{recordId:`$${t}.${r}_Id`,collectionAttributeName:t}}}_getDefaultOptionActions(e,t){const r=`${e}.${t}_Primary`,i=`${e}.${t}_NonActual`,a=this.translate("MarkAsPrimary"),o=this.translate("MarkAsValid"),n=this.translate("MarkAsInvalid"),l=this.translate("DeleteOption");return[{type:"crt.MenuItem",caption:a,icon:"flag-button-icon",visible:`$${r} | crt.NorCondition : $${i}`,clicked:this._getActionClickedRequest("crt.MakeCommunicationOptionPrimaryRequest",e,t)},{type:"crt.MenuItem",caption:`$${i}
					| crt.BooleanToStringValue : '${o}' : '${n}'`,icon:`$${i}
					| crt.BooleanToStringValue : 'valid-circle' : 'invalid-circle'`,clicked:this._getActionClickedRequest("crt.ChangeCommunicationInvalidStateRequest",e,t)},{type:"crt.MenuItem",caption:l,icon:"delete-button-icon",clicked:this._getActionClickedRequest("crt.RemoveCommunicationOptionRequest",e,t)}]}_getOptionActions(e,t,r){const i=this._getDefaultOptionActions(t,r),a=e.optionActions??[];return[...i,...a]}_extendViewConfig(e,t,r){e.primaryColumnName=`${r}_Id`,e.numberColumnName=`${r}_Number`,e.typeColumnName=`${r}_CommunicationType`,e.displayFormatColumnName=`${r}_CommunicationTypeDisplayFormat`,e.optionActions=this._getOptionActions(e,t,r)}_getDefaultOptionConfig(e,t,r){return{label:`$${`${`${e}.${t}_CommunicationTypeName`}_Extended`}`,control:`$${e}.${t}_Number`,labelPosition:r}}_applyReadonlyState(e,t){Object.entries(e).forEach(([,r])=>{t.readonly&&(r.readonly=t.readonly),r.bindTo=`$${(0,m.generatePropertiesAttributeName)(t.name)}`})}_getToolsTemplate(e){return[{type:"crt.Button",icon:"actions-button-icon",iconPosition:"only-icon",color:"default",size:"none",clickMode:"menu",displayType:"text",classes:["actions-btn"],menuItems:e.optionActions}]}_extendWithProperties(e,t){Object.keys(e).forEach(r=>{e[r]={...t,...e[r]}})}_initTemplates(e,t,r){const i=this._getDefaultOptionConfig(t,r,e.labelPosition??"auto"),a=e.templates??{},o=this._getToolsTemplate(e),n={[f.CommunicationOptionTypeEnum.Email]:{type:"crt.EmailInput"},[f.CommunicationOptionTypeEnum.Phone]:{type:"crt.PhoneInput",phoneAsLink:!0,displayAsPhone:!1,displayPhoneMask:!1},[f.CommunicationOptionTypeEnum.Web]:{type:"crt.WebInput"},[f.CommunicationOptionTypeEnum.Google]:{type:"crt.WebInput",icon:"google-web-icon"},[f.CommunicationOptionTypeEnum.Facebook]:{type:"crt.WebInput",icon:"facebook-web-icon"},[f.CommunicationOptionTypeEnum.LinkedIn]:{type:"crt.WebInput",icon:"linkedin-web-icon"},[f.CommunicationOptionTypeEnum.Twitter]:{type:"crt.WebInput",icon:"twitter-web-icon"},[f.CommunicationOptionTypeEnum.Skype]:{type:"crt.WebInput",icon:"skype-web-icon"},[f.CommunicationOptionTypeEnum.Text]:{type:"crt.Input"}};this._extendWithProperties(n,{tools:o});const l={...n,...a};this._extendWithProperties(l,i),this._applyReadonlyState(l,e),e.templates=l}processViewConfig(e,t,r){this._extendViewConfig(e,t,r),this._initTemplates(e,t,r)}}ye.\u0275fac=function(e){return new(e||ye)(s.\u0275\u0275inject(M.TranslateService))},ye.\u0275prov=s.\u0275\u0275defineInjectable({token:ye,factory:ye.\u0275fac});class ve{}ve.\u0275fac=function(e){return new(e||ve)},ve.\u0275mod=s.\u0275\u0275defineNgModule({type:ve}),ve.\u0275inj=s.\u0275\u0275defineInjector({providers:[Se,ye,Ce]});class mt extends Zt{constructor(e,t,r,i,a){super(t),this._featureService=e,this.translateService=t,this._addButtonService=r,this._viewConfigService=i,this._attributesService=a,this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this.translatePrefix="CommunicationOptions"}get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_isValidItemsBinding(e,t){return(0,R.isBindToViewModelAttribute)(e.items,t.viewModelConfig?.attributes)?!0:(console.warn(`The setup property [items] for component [${e.name}] is incorrect.Only binding to the ViewModel collection attribute is allowed for this property.`),!1)}processItem(e,t){var r=this;return(0,u.Z)(function*(){if(r._isValidItemsBinding(e,t)){const i=e.items.split("$")[1],a=t.viewModelConfig?.attributes?.[i]??{},o=a?.modelConfig?.path||"";r._viewConfigService.processViewConfig(e,i,o),r._attributesService.processAttributes(e,t,a,o),E.addDependencies(t,e,o),yield r._addButtonService.processAddButton(e,t,o)}})()}processItemsAsync(e,t){var r=this;return(0,u.Z)(function*(){const i=e.map(function(){var a=(0,u.Z)(function*(o){yield r.processItem(o.viewConfig,t)});return function(o){return a.apply(this,arguments)}}());yield Promise.all(i)})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e,i=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.CommunicationOptions",r.viewConfig);return yield t.processItemsAsync(i,r),e})()}}mt.\u0275fac=function(e){return new(e||mt)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(Se),s.\u0275\u0275inject(ye),s.\u0275\u0275inject(Ce))},mt.\u0275prov=s.\u0275\u0275defineInjectable({token:mt,factory:mt.\u0275fac});class pt{constructor(e){this._featureService=e,this._commonCommunicationsBehaviorFeature="CommonCommunicationsBehavior",this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this._replacementConfig={ContactCommunicationOptions:{replaceData:[{type:"crt.EmailInput",label:"Email",labelPosition:"above",control:"$Email",visible:!0,placeholder:"",tooltip:"",name:"Email"},{type:"crt.PhoneInput",label:"Mobile phone",labelPosition:"above",control:"$MobilePhone",visible:!0,placeholder:"",tooltip:"",name:"MobilePhone"}],additionalAttributesConfig:{MobilePhone:{modelConfig:{path:"PDS.MobilePhone"}},Email:{modelConfig:{path:"PDS.Email"}}}},AccountCommunicationOptions:{replaceData:[{type:"crt.WebInput",label:"Web",labelPosition:"above",control:"$Web",visible:!0,placeholder:"",tooltip:"",name:"Web"},{type:"crt.PhoneInput",label:"Primary phone",labelPosition:"above",control:"$Phone",visible:!0,placeholder:"",tooltip:"",name:"Phone"}],additionalAttributesConfig:{Phone:{modelConfig:{path:"PDS.Phone"}},Web:{modelConfig:{path:"PDS.Web"}}}}},this._namesToDelete=[...Object.keys(this._replacementConfig),"ContactCommunicationOptionsAddButton","AccountCommunicationOptionsAddButton"]}get isCommonCommunicationsBehaviorEnabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._commonCommunicationsBehaviorFeature))}get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_prepareAttibutesBeforeReplacement(e,t){const r=e?.additionalAttributesConfig||{};for(const[i,a]of Object.entries(r)){const o=Wt(t,a.modelConfig?.path);o&&o!==i&&(r[o]=t[o],delete r[i],e.replaceData=[...e.replaceData].map(n=>n.control===`$${i}`?{...n,control:`$${o}`}:n))}Object.assign(t,r)}_replaceCommOptionsWithFields(e){e.viewModelConfig={attributes:{},...e.viewModelConfig},m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("name",this._namesToDelete,e.viewConfig).forEach(r=>{const a=m.MetadataSchemaUtils.getViewConfigInfoByProperty("name",r.parentName,e.viewConfig)[0].viewConfig,o=r.viewConfig.name,n=a[r.parentPropertyName],l=n.indexOf(r.viewConfig);this._prepareAttibutesBeforeReplacement(this._replacementConfig[r.viewConfig.name],e.viewModelConfig.attributes);const d=this._replacementConfig[o]?.replaceData||[];n.splice(l,1,...d)})}_makeOtherCommOptionsComponentsReadonly(e){e.filter(r=>!this._namesToDelete.includes(r.viewConfig.name)).forEach(r=>r.viewConfig.readonly=!0)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if((yield t.isProcessingDisabled)||(yield t.isCommonCommunicationsBehaviorEnabled))return e;const r=e,i=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.CommunicationOptions",r.viewConfig);return t._replaceCommOptionsWithFields(r),t._makeOtherCommOptionsComponentsReadonly(i),e})()}}pt.\u0275fac=function(e){return new(e||pt)(s.\u0275\u0275inject(y.FeatureService))},pt.\u0275prov=s.\u0275\u0275defineInjectable({token:pt,factory:pt.\u0275fac});var Xt=D(16710);class W{get isProcessingDisabled(){return(0,h.lastValueFrom)(this.featureService.getFeatureState(this.preprocessingFeature))}constructor(e,t,r,i,a){this.featureService=e,this.metadataModifierService=t,this.comboboxPreprocessorService=r,this.attributeConfigProvider=i,this.translateService=a,this.preprocessingFeature="",this.translatePrefix="",this.viewItemTypes=[],this.profileConfig={},this.editColumns=[],this.viewColumns=[]}_addImageSelectedRequest(e,t){e.imageSelected||this.metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this.metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_getDataSourceAttributeByPath(e,t){return t?.find(r=>r.path===e)}_getViewModelAttributeByDataSourcePath(e,t,r){const i=Object.keys(t).find(o=>{const n=t[o]??{};return(0,g.isModelAttributeConfig)(n)&&n?.modelConfig?.path===e}),a=e.split(".");if(!i&&a.length>2){const o=a[0],n=a.slice(1).join("."),l=this._getDataSourceAttributeByPath(n,r?.attributes);return l&&this._getViewModelAttributeByDataSourcePath(`${o}.${l.name}`,t,r)}return i}_createViewModelAttribute(e,t,r){r[e]||(r[e]={modelConfig:{path:t}})}_findOrCreateViewModelAttribute(e,t,r,i){let a=this._getViewModelAttributeByDataSourcePath(e,t,r);if(!a){const o=e.split(".").slice(1).join("");a=`${this.profileConfig.name}_${o}`,this._createViewModelAttribute(a,e,t)}return i&&(t[a].validators={required:{type:"crt.Required"}}),a}_createFormField(e,t){const{columnName:r,propertyName:i,...a}=e;a.name=`${this.profileConfig.name}_${r.replace(".","")}Field`,a.control=this.profileConfig[i];const o=t?.attributes&&this._getDataSourceAttributeByPath(r,t.attributes);return o?(a.label=a.label||o.caption,a.type=a.type||this.attributeConfigProvider.getConfigByType(o.dataValueType).controlType):a.type=a.type||Xt.ControlTypes.Input,a.readonly||(a.readonly=r.split(".").length>1),a}_getComboboxesViewConfigs(e){return(e.dialogItems||[]).filter(r=>r.type===Xt.ControlTypes.Combobox&&!r.readonly)}_processComboboxes(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getComboboxesViewConfigs(e);i.comboboxPreprocessorService.crtOnMetaDataInit(a,t),yield i.comboboxPreprocessorService.crtOnModelInit(a,t,r)})()}_getReferenceColumnPath(e,t,r){let o=(t[e].modelConfig?.path||"").split(".");const n=o.shift()||"";if(o.slice(-1)[0]==="Id"&&o.pop(),!o.length)return n;if(o.length===1){const d=o[0];o=(r.findAttributeByName(d)?.path||"").split(".")}return o.unshift(n),o.join(".")}_initProfileConfig(e,t,r,i){this.profileConfig={name:e.name},this.viewColumns.forEach(a=>{if(!a.propertyName)return;const o=t+"."+a.columnName,n=a.isRequired&&!e.readonly,l=this._findOrCreateViewModelAttribute(o,r,i,n);this.profileConfig[a.propertyName]=`$${l}`}),this.profileConfig.photo+=this.profileConfig.photo?" | crt.ToImageLink":"",Object.assign(this.profileConfig,e),Object.assign(e,this.profileConfig)}_initDialogItems(e,t){e.dialogItems||(e.dialogItems=[]),e.dialogTitle=this.translateService.instant(this.translatePrefix+".DialogTitle"),this.editColumns.forEach(r=>{const i=this._createFormField(r,t);e.dialogItems.findIndex(o=>o.name===i.name)===-1&&e.dialogItems.push(i)})}addProfileChangeHandlers(e){if(e.photo){const r=e.photo.split("|").map(i=>i.trim())[0].slice(1);this._addImageSelectedRequest(e,r),this._addimageClearRequest(e,r)}}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e,a=m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",r.viewItemTypes,i.viewConfig);for(const o of a){const n=o.viewConfig.referenceColumn||"",l=n.slice(1).split(".").pop()||"",p=e.viewModelConfig.attributes;if((0,R.isBindToViewModelAttribute)(n,p)){const _=p[l]??{};let S="";(0,g.isModelAttributeConfig)(_)&&(S=_.modelConfig?.path.split(".")[0]);const C=t.find(qt=>qt.name===S),v=yield(0,h.lastValueFrom)(C.getSchema()),P=r._getReferenceColumnPath(l,p,v);o.viewConfig.readonly=P.split(".").length>1||o.viewConfig.readonly,r._initProfileConfig(o.viewConfig,P,p,v),o.viewConfig.readonly||(r.addProfileChangeHandlers(o.viewConfig),r._initDialogItems(o.viewConfig,v),yield r._processComboboxes(o.viewConfig,p,t))}else o.viewConfig.readonly=!0}return e})()}}W.\u0275fac=function(e){return new(e||W)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService),s.\u0275\u0275inject($),s.\u0275\u0275inject(Xt.AttributeConfigProvider),s.\u0275\u0275inject(M.TranslateService))},W.\u0275prov=s.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac});class Ie extends W{constructor(){super(...arguments),this.preprocessingFeature="DisableAccountCompactProfilePreprocessing",this.translatePrefix="AccountCompactProfile",this.viewItemTypes=["crt.AccountCompactProfile"],this.editColumns=[{columnName:"Name",propertyName:"accountName"},{columnName:"AlternativeName",propertyName:"alternativeName",label:this.translateService.instant(this.translatePrefix+".AlternativeNameFieldLabel")}],this.viewColumns=[...this.editColumns,{columnName:"Country",propertyName:"country"},{columnName:"City",propertyName:"city"},{columnName:"AccountLogo",propertyName:"photo"},{columnName:"City.TimeZone",propertyName:"timeZone"}]}}Ie.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Ie)))(t||Ie)}}(),Ie.\u0275prov=s.\u0275\u0275defineInjectable({token:Ie,factory:Ie.\u0275fac});class Ne extends W{constructor(){super(...arguments),this.preprocessingFeature="DisableContactCompactProfilePreprocessing",this.translatePrefix="ContactCompactProfile",this.viewItemTypes=["crt.ContactCompactProfile"],this.editColumns=[{columnName:"GivenName",propertyName:"firstName",isRequired:!0},{columnName:"Surname",propertyName:"lastName"},{columnName:"MiddleName",propertyName:"middleName"},{columnName:"BirthDate",propertyName:"birthDate",pickerType:"date"}],this.viewColumns=[...this.editColumns,{columnName:"Country",propertyName:"country"},{columnName:"City",propertyName:"city"},{columnName:"Photo",propertyName:"photo"},{columnName:"City.TimeZone",propertyName:"timeZone"},{columnName:"Name",propertyName:"displayName"}]}_addChangeHandler(e,t,r){if(e[t]&&!e[r]){const i=e[t];this.metadataModifierService.addProperty(e,r,{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:i.slice(1),attributeValue:"@event"}})}}addProfileChangeHandlers(e){super.addProfileChangeHandlers(e),this._addChangeHandler(e,"displayName","fullNameChange"),this._addChangeHandler(e,"firstName","firstNameChange"),this._addChangeHandler(e,"lastName","lastNameChange"),this._addChangeHandler(e,"middleName","middleNameChange")}}Ne.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Ne)))(t||Ne)}}(),Ne.\u0275prov=s.\u0275\u0275defineInjectable({token:Ne,factory:Ne.\u0275fac});class De extends W{constructor(){super(...arguments),this.preprocessingFeature="DisableUserCompactProfilePreprocessing",this.translatePrefix="UserCompactProfile",this.viewItemTypes=["crt.UserCompactProfile"],this.editColumns=[{columnName:"FirstName",propertyName:"firstName",isRequired:!0},{columnName:"MiddleName",propertyName:"middleName"},{columnName:"LastName",propertyName:"lastName"}],this.viewColumns=[...this.editColumns,{columnName:"Photo",propertyName:"photo"}]}}De.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(De)))(t||De)}}(),De.\u0275prov=s.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac});class ft{crtOnMetaDataInit(e){return(0,u.Z)(function*(){const t=e;return t.name==="Playbooks_FormPage"&&(t.viewModelConfig.attributes.DcmStages={from:"CrtPlaybookDS_DcmCase",converter:"crt.ToDcmStageValue"}),Promise.resolve(e)})()}}ft.\u0275fac=function(e){return new(e||ft)},ft.\u0275prov=s.\u0275\u0275defineInjectable({token:ft,factory:ft.\u0275fac});class Er{_getDetailViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Angular7XDetail",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processDetail(e){this._processDetailOutputs(e)}_processDetailOutputs(e){this._processDetailChangedOutput(e)}_processDetailChangedOutput(e){e.detailChanged||(e.detailChanged={request:"crt.DetailChangedRequest",params:{detailId:"@event.detail.detailId",saveChanges:"@event.detail.saveChanges",discardChanges:"@event.detail.discardChanges",destroyed:"@event.detail.destroyed"}})}_processSchema(e){this._processViewModelAttributes(e),this._changeViewConfigsBindings(e)}_processViewModelAttributes(e){this._processUnSaveDetailsDataViewModelAttributes(e),this._processHasUnsavedDataAndDetailsViewModelAttributes(e)}_processUnSaveDetailsDataViewModelAttributes(e){const t=this._getSchemaViewModelAttributes(e);t[g.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]||(t[g.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]={value:[]})}_processHasUnsavedDataAndDetailsViewModelAttributes(e){const t=this._getSchemaViewModelAttributes(e);t[g.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME]||(t[g.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME]={from:[g.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME,g.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME],converter:"crt.HasUnsavedDataOr7XDetails"})}_getSchemaViewModelAttributes(e){const t=e.viewModelConfig=e.viewModelConfig||{};return t.attributes=t.attributes||{}}_changeViewConfigsBindings(e){const t=e.viewConfig||[],r=`(^|\\W)(${g.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME})($|\\W)`,i=`$1${g.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME}$3`;t.forEach(a=>this._replaceStringsRecursive(a,r,i))}_replaceStringsRecursive(e,t,r){(0,b.forOwn)(e,(i,a)=>{if((0,b.isObject)(i))this._replaceStringsRecursive(i,t,r);else if((0,b.isString)(i)){const o=new RegExp(t,"g");if(!i.match(o))return;e[a]=i.replace(o,r)}})}crtOnMetaDataInit(e){const t=e,r=this._getDetailViewConfigs(t);return r.forEach(i=>this._processDetail(i)),r.length&&this._processSchema(t),Promise.resolve(e)}}class gt{constructor(){this._pageSize=150}_getViewConfigs(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(r=>r?.viewConfig).filter(Boolean)}_setCrudEventsBindings(e){e.emailComposerSaved={request:"crt.EmailComposerSavedRequest",params:{emailWithParams:"@event"}},e.refreshRecipients={request:"crt.RefreshEmailRecipientsRequest",params:{event:"@event"}}}_setAttributes(e,t){t.from=`$${this._createAttribute(e,`${t.name}_From`,"")}`,t.to=`$${this._createAttribute(e,`${t.name}_To`,[])}`,t.cc=`$${this._createAttribute(e,`${t.name}_Cc`,[])}`,t.bcc=`$${this._createAttribute(e,`${t.name}_Bcc`,[])}`,t.subject=`$${this._createAttribute(e,`${t.name}_Subject`,"")}`,t.headerExpanded=`$${this._createAttribute(e,`${t.name}_HeaderExpanded`,"")}`,t.visibleCc=`$${this._createAttribute(e,`${t.name}_VisibleCc`,"")}`,t.visibleBcc=`$${this._createAttribute(e,`${t.name}_VisibleBcc`,"")}`}_setCalculatedAttributes(e,t){t.sendersMailboxes=`$${this._getOrAddEmailSendersAttribute(e,t,t.recordId)}`,t.recipientsMailboxes=`$${this._getOrAddEmailRecipientsAttribute(e,t,t.recordId)}`}_findCalculatedAttribute(e,t,r){const i=e.viewModelConfig.attributes,a=Object.keys(i).find(o=>{const n=i[o]??{};return n.from===t&&n.converter===r});return(0,b.isEmpty)(a)?void 0:a}_createAttribute(e,t,r){const i=e.viewModelConfig.attributes;return i[t]={value:r},t}_createCalculatedAttribute(e,t,r,i){const a=e.viewModelConfig.attributes;return a[t]={from:r,converter:i},t}_getOrAddEmailSendersAttribute(e,t,r){return this._findCalculatedAttribute(e,r,"crt.ToSendersMailboxes")||this._createCalculatedAttribute(e,`${t.name}_SendersMailboxes`,r,"crt.ToSendersMailboxes")}_getOrAddEmailRecipientsAttribute(e,t,r){return this._findCalculatedAttribute(e,r,"crt.ToRecipientsMailboxes")||this._createCalculatedAttribute(e,`${t.name}_RecipientsMailboxes`,"crt.RefreshEmailRecipientsRequest","crt.ToRecipientsMailboxes")}crtOnMetaDataInit(e){const t=e;return this._getViewConfigs(t,"crt.EmailComposer").forEach(i=>{this._setCrudEventsBindings(i),this._setAttributes(t,i),this._setCalculatedAttributes(t,i)}),Promise.resolve(e)}}gt.\u0275fac=function(e){return new(e||gt)},gt.\u0275prov=s.\u0275\u0275defineInjectable({token:gt,factory:gt.\u0275fac});class _t{_modifyInputType(e,t,r){const i=e.control.replace("$",""),a=t.attributes[i]?.modelConfig?.path;if(a){const o=this._getDataSchemaAttributeByPath(a,r);A.DataValueType.EMAIL_TEXT&&o?.dataValueType===A.DataValueType.EMAIL_TEXT&&(e.type="crt.EmailInput",e.isFormatValidated=o.isFormatValidated)}}_getDataSchemaAttributeByPath(e,t){const[r,i]=e.split("."),a=t.dataSchemas[r]?.attributes;let o;for(const n in a)if(a[n].path===i){o=a[n];break}return o}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),n=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.EmailInput",a.viewConfig);return o.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),n.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),e})()}}_t.\u0275fac=function(e){return new(e||_t)},_t.\u0275prov=s.\u0275\u0275defineInjectable({token:_t,factory:_t.\u0275fac});class ht{constructor(e){this._profileAttributeService=e,this._componentName="crt.EntityHierarchyFilter",this._expandedItemsAttributeNameSuffix="_ExpandedItems"}_getComponents(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig).map(t=>t.viewConfig)}_getComponentName(e){return e.name.replace(/\./g,"_")}_setExpandedItemsAttrValue(e,t){if(t.expandedItems)return;const r=`${t.name}${this._expandedItemsAttributeNameSuffix}`;this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"expandedItems",r)}_setAttributeWithChangeRequestForSelectedNodeId(e,t){this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"selectedNodeId","")}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getComponents(r),a=r.viewModelConfig.attributes;for(const o of i){const n=t._getComponentName(o),{nodesConfigAttributeName:l,selectedNodeAttributeName:d,filterAttributeName:p,nodesAttributeName:_,filterConverter:S}=(0,f.buildHierarchyAttributeNames)(n);a[l]={value:o.nodesConfig},a[p]={from:d,converter:S,filter:`crt.ToBoolean : $${d}`},a[_]={from:l,converter:`crt.ToHierarchyNodesConverter : '${o.schemaName}'`},o.nodes=`$${_}`,o.nodeClick={request:"crt.EntityHierarchyFilterNodeChangeRequest",params:{selectedNodeAttributeName:d,node:"@event"}},t._setExpandedItemsAttrValue(r,o),t._setAttributeWithChangeRequestForSelectedNodeId(r,o)}return e})()}}ht.\u0275fac=function(e){return new(e||ht)(s.\u0275\u0275inject(f.ProfileAttributeService))},ht.\u0275prov=s.\u0275\u0275defineInjectable({token:ht,factory:ht.\u0275fac});class At{get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState("DisableEntityStageProgressBarPreprocessing"))}constructor(e,t,r,i){this._featureService=e,this._dcmSettingsService=t,this._dcmSchemaManagerService=r,this._configurationDataService=i,this._componentName="crt.EntityStageProgressBar",this._stagesAttributeSuffix="_StagesList",this._stageConnectionsAttributeSuffix="_StageConnections",this._allowedStagesAttributeSuffix="_AllowedStages",this._valueAttributeSuffix="_CurrentStage",this._stageFilteredByAttributeSuffix="_StageFilteredBy",this._stageRunningProcessUIdAttributeSuffix="_RunningProcessUId",this._entityStageSchemasAttributeSuffix="_EntityStageSchemas",this._isAppropriateEntityStageSchemaAttributeSuffix="_IsAppropriateEntityStageSchema",this._filteredByValueAttributeName="",this._primaryDataSourceName=""}_getComponents(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getComponentName(e){return e.name.replace(/\./g,"_")}_getStageColumnName(e){return(0,h.lastValueFrom)(this._dcmSettingsService.getStageColumnName(e),{defaultValue:null})}_getEntityStagesSchemas(e){return(0,h.lastValueFrom)(this._dcmSchemaManagerService.getDcmSchemaDataCollection().pipe((0,O.map)(t=>t.filter(r=>r.entitySchemaUId===e))))}_getEntitySchemaUid(e){return(0,h.lastValueFrom)(this._configurationDataService.getEntityUId(e).pipe((0,O.map)(t=>t?.data?.entityUIds?.filter(r=>r.entitySchemaName===e)[0].entitySchemaUId)))}_findAttributeKeyByPath(e,t){let r=null;return Object.keys(e).forEach(i=>{e[i]?.modelConfig?.path===t&&(r=i)}),r}_generateAttributes(e){return{listAttributeName:`${e}${this._stagesAttributeSuffix}`,stageConnectionsAttributeName:`${e}${this._stageConnectionsAttributeSuffix}`,allowedStagesAttributeName:`${e}${this._allowedStagesAttributeSuffix}`,stageRunningProcessUIdAttributeName:`${e}${this._stageRunningProcessUIdAttributeSuffix}`,entityStageSchemasAttribute:`${e}${this._entityStageSchemasAttributeSuffix}`,isAppropriateEntityStageSchemaAttribute:`${e}${this._isAppropriateEntityStageSchemaAttributeSuffix}`,currentStageAttributeName:""}}_loadEntityStageSchemas(e,t,r){var i=this;return(0,u.Z)(function*(){const a=yield i._getEntitySchemaUid(t),o=(yield i._getEntityStagesSchemas(a)).filter(n=>n.isActive&&n.isActiveVersion);if(o){e[`${r}${i._entityStageSchemasAttributeSuffix}`]={value:o};const n=o.find(C=>C.filters)?.filters;if(!n)return;const l=JSON.parse(n),p=Object.values(l.items)[0].leftExpression.columnPath,_=`${i._primaryDataSourceName}.${p}`,S=i._findAttributeKeyByPath(e,_);S&&(i._filteredByValueAttributeName=S),i._filteredByValueAttributeName||(i._filteredByValueAttributeName=`${r}${i._stageFilteredByAttributeSuffix}`,e[i._filteredByValueAttributeName]={modelConfig:{path:_}})}})()}_loadEntityAttributes(e,t){var r=this;return(0,u.Z)(function*(){const i=`ProgressBarComponent_${t}`,a=r._generateAttributes(i);let o=e.viewModelConfig.attributes;o||(o=e.viewModelConfig.attributes={}),o[a.entityStageSchemasAttribute]={value:null},yield r._loadEntityStageSchemas(o,t,i),a.filterValueAttributeName=r._filteredByValueAttributeName||"";const n=yield r._getStageColumnName(t);return n&&(a.currentStageAttributeName=r.setupColumnAttribute(n,o,i,r._valueAttributeSuffix)),a.idAttributeName=r.setupColumnAttribute("Id",o,i,"_RecordId"),o[a.listAttributeName]={value:null},o[a.stageConnectionsAttributeName]={value:null},o[a.allowedStagesAttributeName]={value:null},o[a.stageRunningProcessUIdAttributeName]={value:null},o[a.isAppropriateEntityStageSchemaAttribute]={value:!0},a})()}setupColumnAttribute(e,t,r,i){const a=`${this._primaryDataSourceName}.${e}`;let o=this._findAttributeKeyByPath(t,a);return o||(o=`${r}${i}`,t[o]={modelConfig:{path:a}}),o}_setupComponentConfig(e,t){this._setupComponentFields(e,t),this._setupComponentHandlers(e,t)}_setupComponentFields(e,t){const r=e?.viewConfig;r.recordId=`$${t.idAttributeName}`,r.stages=`$${t.listAttributeName}`,r.stageConnections=`$${t.stageConnectionsAttributeName}`,r.allowedStages=`$${t.allowedStagesAttributeName}`,r.stageSchemaFilterByValue=`$${t.filterValueAttributeName}`,r.value=`$${t.currentStageAttributeName}`,r.isAppropriateEntityStageSchema=`$${t.isAppropriateEntityStageSchemaAttribute}`,r.stageRunningProcessUId=`$${t.stageRunningProcessUIdAttributeName}`}_setupComponentHandlers(e,t){const r=e?.viewConfig;r.stageChanged={request:"crt.EntityStageProgressBarStageChangedHandlerRequest",params:{stageAttribute:t.currentStageAttributeName,stagesAttribute:t.listAttributeName,config:"@event"}},r.setAllowedStages={request:"crt.EntityStageProgressBarProcessStagePermissionsHandlerRequest",params:{stagesAttribute:t.listAttributeName,config:"@event"}},r.loadData={request:"crt.EntityStageProgressBarLoadDataHandlerRequest",params:{stagesAttribute:t.listAttributeName,stageConnectionsAttribute:t.stageConnectionsAttributeName,allowedStagesAttribute:t.allowedStagesAttributeName,stageRunningProcessUIdAttribute:t.stageRunningProcessUIdAttributeName,stageSchemaFilterByValueName:t.filterValueAttributeName,config:"@event"}},r.checkIsAnAppropriateProcessSchema={request:"crt.EntityStageProcessAppropriateCheckHandlerRequest",params:{entityStageSchemas:`$${t.entityStageSchemasAttribute}`,stageRunningProcessUId:`$${t.stageRunningProcessUIdAttributeName}`,filterColumnAttributeName:t.filterValueAttributeName,isAppropriateEntityStageSchemaAttribute:t.isAppropriateEntityStageSchemaAttribute,config:"@event"}},r.changeToAppropriateEntityStageSchema={request:"crt.EntityStageProgressBarChangeStageProcessHandlerRequest",params:{entityName:e?.viewConfig.entityName,entityId:`$${t.idAttributeName}`,currentStage:`$${t.currentStageAttributeName}`,stageRunningProcessUIdAttribute:t.stageRunningProcessUIdAttributeName,isAppropriateEntityStageSchemaAttribute:t.isAppropriateEntityStageSchemaAttribute,loadDataRequest:r.loadData}}}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e;r._primaryDataSourceName=(0,I.resolveSchemaPrimaryDataSource)(i);const a=r._getComponents(i),o=a.map(n=>n.viewConfig.entityName).filter((n,l,d)=>d.indexOf(n)===l);for(const n of o){r._filteredByValueAttributeName="";const l=yield r._loadEntityAttributes(i,n);for(const d of a.filter(p=>p.viewConfig.entityName===n))r._setupComponentConfig(d,l)}return e})()}}At.\u0275fac=function(e){return new(e||At)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(y.DcmSettingsService),s.\u0275\u0275inject(y.DcmSchemaManagerService),s.\u0275\u0275inject(y.ConfigurationDataService))},At.\u0275prov=s.\u0275\u0275defineInjectable({token:At,factory:At.\u0275fac});var Fe=D(96923);const Mr=32,Rr=81;class Pe{_getDataGridViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.DataGrid",e?.items)}_setDataGridMaxHeight(e){if(!e.layoutConfig?.rowSpan||e?.styles?.["max-height"]!=null)return;const r=e.layoutConfig.rowSpan*Mr,i=Math.max(r,Rr);e.layoutConfig.rowSpan=1,e.styles=(0,b.merge)(e.styles,{["max-height"]:`${i}px`})}_replaceLegacyGridContainerRowsConfig(e){const t=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.GridContainer",e).shift();t?.viewConfig?.rows?.replace(/\s/g,"")==="minmax(32px,32px)"&&(t.viewConfig.rows="minmax(max-content, 32px)")}setDataGridMaxHeight(e){const t=this._getDataGridViewConfigs(e);t.forEach(r=>{this._setDataGridMaxHeight(r.viewConfig)}),t.length&&this._replaceLegacyGridContainerRowsConfig(e?.items)}}Pe.\u0275fac=function(e){return new(e||Pe)},Pe.\u0275prov=s.\u0275\u0275defineInjectable({token:Pe,factory:Pe.\u0275fac});class bt{constructor(e,t,r){this._featureService=e,this._expandedListLayoutService=t,this._profileAttributeService=r,this._expPanelActionsProcessingDisableFeature="DisableExpansionPanelPreprocessing"}_filterItemsByGridType(e){if(!e.items||e.items.length===0)return;const t=e?.tools??[],r=e.items.filter(i=>i.gridContainerType===f.ExpansionPanelGridContainerType.TOOLS);t?.length===0&&r?.length>0&&(e.items=e.items.filter(i=>i.gridContainerType!==f.ExpansionPanelGridContainerType.TOOLS),e.tools=r)}_processPaddings(e){e.padding||(e.padding={top:Fe.SizeEnum.Small,bottom:Fe.SizeEnum.Small,left:Fe.SizeEnum.Medium,right:Fe.SizeEnum.Medium})}get _isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._expPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ExpansionPanel",r.viewConfig).forEach(function(){var a=(0,u.Z)(function*(o){t._expandedListLayoutService.setDataGridMaxHeight(o.viewConfig),t._filterItemsByGridType(o.viewConfig),t._processPaddings(o.viewConfig),yield t._profileAttributeService.prepareAttributeWithFeatureCheck(r,o.viewConfig,"expanded","","DisableSaveToProfileExpPanelExpanded")});return function(o){return a.apply(this,arguments)}}()),e})()}}bt.\u0275fac=function(e){return new(e||bt)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(Pe),s.\u0275\u0275inject(f.ProfileAttributeService))},bt.\u0275prov=s.\u0275\u0275defineInjectable({token:bt,factory:bt.\u0275fac});class St{_getFeedViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Feed",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_fixFeedByRecordBindings(e,t){t.feedType!==f.FeedSourceType.Record||this._validateRecordFeedConfig(e,t)||!(0,I.resolveSchemaPrimaryDataSource)(e)||(t.primaryColumnValue=`$${this._getOrAddRecordIdAttribute(e,t)}`,t.entitySchemaName=this._getEntitySchemaName(e))}_validateRecordFeedConfig(e,t){const r=e.viewModelConfig.attributes,i=t.primaryColumnValue?.split("$")[1],a=r[i];return!(0,b.isEmpty)(t.entitySchemaName)&&!!a}_getOrAddRecordIdAttribute(e,t){return this._findRecordIdAttribute(e,t)||this._createRecordIdAttribute(e,t)}_findRecordIdAttribute(e,t){const i=`${(0,I.resolveSchemaPrimaryDataSource)(e)}.Id`,a="#PrimaryDataSourceName()#.Id",o=e.viewModelConfig.attributes,n=Object.keys(o).find(d=>{const _=(o[d]??{}).modelConfig?.path;return _===i||_===a});if(!(0,b.isEmpty)(n))return n;const l=`${t.name}_RecordId`;return l in o?l:void 0}_createRecordIdAttribute(e,t){const r=(0,I.resolveSchemaPrimaryDataSource)(e),i=e.viewModelConfig.attributes,a=`${t.name}_RecordId`;return i[a]={modelConfig:{path:`${r}.Id`}},a}_getEntitySchemaName(e){const t=(0,I.resolveSchemaPrimaryDataSource)(e);return(e.modelConfig?.dataSources||{})[t]?.config?.entitySchemaName}_addMessagesBindings(e,t){if(t.feedMessages)return;const r=e.viewModelConfig.attributes,i=`${t.name}_FeedMessagesPage`,a=this._createEmptyAttribute("OffsetDate",r,t),o=this._createEmptyAttribute("SortColumn",r,t);t.feedMessages=`$${this._createEmptyAttribute("FeedMessages",r,t)}`,t.offsetDate=`$${a}`,t.sortColumn=`$${o}`,t.feedMessagesPage=`$${i}`;const n=[a];t.feedType===f.FeedSourceType.Record&&n.push(t.primaryColumnValue.replace("$","")),r[i]={from:n,converter:`crt.LoadFeedMessages: '${t.feedType}' : '${t.entitySchemaName}' : '${o}'`}}_createEmptyAttribute(e,t,r){const i=`${r.name}_${e}`;return t[i]={value:null},i}crtOnMetaDataInit(e){const t=e;return this._getFeedViewConfigs(t).forEach(i=>{this._fixFeedByRecordBindings(t,i),this._addMessagesBindings(t,i)}),Promise.resolve(e)}}St.\u0275fac=function(e){return new(e||St)},St.\u0275prov=s.\u0275\u0275defineInjectable({token:St,factory:St.\u0275fac});class Ct{get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._fileInputPreprocessingDisableFeature))}constructor(e){this._featureService=e,this._fileInputPreprocessingDisableFeature="DisableFileInputPreprocessing"}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileInput",r.viewConfig).forEach(a=>{if(!a.viewConfig.upload){const n=a.viewConfig.control.slice(1);a.viewConfig.upload={request:"crt.UploadDataAttributeFileRequest",params:{fileAttributeName:n,detail:"@event.detail"}}}a.viewConfig.download||(a.viewConfig.download={request:"crt.DownloadEntityFileRequest",params:{detail:"@event.detail"}})}),e})()}}Ct.\u0275fac=function(e){return new(e||Ct)(s.\u0275\u0275inject(y.FeatureService))},Ct.\u0275prov=s.\u0275\u0275defineInjectable({token:Ct,factory:Ct.\u0275fac});class yt extends Ht{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.FileList"]}setRowToolbarMenuItems(e,t){var r=this;return(0,u.Z)(function*(){const i=e.items.slice(1),a=t.getBoundDataSourceNameByAttributePath(i);e.rowToolbarItems=[{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${a}_Id`},useRelativeContext:!1}}]})()}}yt.\u0275fac=function(e){return new(e||yt)(s.\u0275\u0275inject(M.TranslateService))},yt.\u0275prov=s.\u0275\u0275defineInjectable({token:yt,factory:yt.\u0275fac});class vt extends B{constructor(e,t,r,i){super(e,t,r),this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=r,this._cellViewConfigCreatorFactory=i,this._predefinedColumns={},this.viewItemTypes=["crt.FileList"]}_setPredefinedColumnDefinitions(e){for(const t of e){const r=t.viewConfig,i=r.name,a=r.columns,o=[];for(const n of a)n.cellView&&o.push(n.code);this._predefinedColumns[i]=o}}_processFileListColumnDefinitions(e,t,r){var i=this;return(0,u.Z)(function*(){const{dataSourceName:a,dataSchema:o,itemsAttributeName:n,viewModel:l}=t,{primaryAttributeName:d,primaryDisplayAttributeName:p}=o??{},_=o.name,S=d&&`${a}_${d}`;for(const C of r){const v=o.attributes.find(yi=>(0,m.removeSpecialSymbols)(`${a}_${yi.name}`)===C.code);if(!v)continue;const P=v.name,qt={columnName:P,dataValueType:v.dataValueType,primaryDisplayAttributeName:p},Ci={column:C,context:l,itemsAttributeName:n,primaryAttributeName:S,dataSchemaName:_,columnName:P},yr=yield i._cellViewConfigCreatorFactory.create(qt)?.getViewElementConfig(Ci);yr&&!i._predefinedColumns[e]?.includes(C.code)&&i.metadataModifierService.addProperty(C,"cellView",yr)}})()}crtOnViewModelInit(e,t,r){var i=()=>super.crtOnViewModelInit,a=this;return(0,u.Z)(function*(){if(yield(0,h.lastValueFrom)(a.featureService.getFeatureState(a.featureName),{defaultValue:null}))return e;const n=m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",a.viewItemTypes,e.viewConfig);a._setPredefinedColumnDefinitions(n),e=yield i().call(a,e,t,r);for(const l of n){const d=l.viewConfig.columns,p=l.viewConfig.name,_=yield a.getGenerateCellViewConfig(l.viewConfig,r);_&&(yield a._processFileListColumnDefinitions(p,_,d))}return e})()}}vt.\u0275fac=function(e){return new(e||vt)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService),s.\u0275\u0275inject(N.DataGridColumnDefinitionService),s.\u0275\u0275inject(N.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY))},vt.\u0275prov=s.\u0275\u0275defineInjectable({token:vt,factory:vt.\u0275fac});class H{get order(){return this.index||0}constructor(e){this.featureService=e,this.componentTypes=[]}getComponentsToProcess(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this.componentTypes,e.viewConfig)}process(e,t){var r=this;return(0,u.Z)(function*(){const i=r.getComponentsToProcess(e);return yield r.innerProcess(i,e,t)})()}}H.\u0275fac=function(e){return new(e||H)(s.\u0275\u0275inject(y.FeatureService))},H.\u0275prov=s.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac});class Te extends H{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=2,this.defaultFilesEntitySchemaName="SysFile",this._galleryColumnNames=["Name","CreatedOn","Size"]}_addDataSourceAttributes(e,t){let r=e[t];r||(r=E.createDataSourceConfig(this.defaultFilesEntitySchemaName),e[t]=r);const i=r.config||{attributes:{}};i.attributes=i.attributes||{},this._galleryColumnNames.forEach(a=>{i?.attributes[a]||(i.attributes[a]={path:a})}),r.config=i}_addViewModelAttributes(e,t,r){if(!e?.attributes)return;const a=e.attributes[t]?.viewModelConfig?.attributes;!a||this._galleryColumnNames.forEach(o=>{const n=`${r}_${o}`;a[n]||(a[n]={modelConfig:{path:`${r}.${o}`}})})}_applyGalleryConfig(e,t){t.viewConfig.galleryItemConfig||(t.viewConfig.galleryItemConfig={templateValuesMapping:{fileId:`${e}_Id`,fileName:`${e}_Name`,fileCreatedOn:`${e}_CreatedOn`,fileSize:`${e}_Size`}}),t.viewConfig.galleryItemConfig.defaultSize=t.viewConfig.tileSize||Fe.SizeEnum.Medium}_getAttributeDSName(e){return`${e}${g.DATA_SOURCE_PREFIX}`}innerProcess(e,t,r){var i=this;return(0,u.Z)(function*(){return e.forEach(a=>{const o=a.viewConfig.items;if(typeof o!="string")return;const n=o.split("$")[1];if(!n)return;const l=i._getAttributeDSName(n);i._addDataSourceAttributes(t.modelConfig?.dataSources||{},l),i._addViewModelAttributes(t.viewModelConfig,n,l),i._applyGalleryConfig(l,a)}),yield Promise.resolve(t)})()}}Te.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Te)))(t||Te)}}(),Te.\u0275prov=s.\u0275\u0275defineInjectable({token:Te,factory:Te.\u0275fac});class Ee extends H{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=1,this.defaultPrimaryColumnName="Id",this.defaultFilesEntitySchemaName="SysFile",this.defaultRecordColumnName="RecordId",this._fileDropDisableFeature="DisableFileListDropPreprocessing"}_getAdditionalFilterName(e){return`${e}_PredefinedFilter`}_createViewModelAttribute(e){return{isCollection:!0,modelConfig:{path:e},viewModelConfig:{attributes:{}}}}_getUploadFileRequest(e){return{request:"crt.UploadFileRequest",params:{viewElementName:e}}}_setFileListDropZoneParameters(e,t){t&&(e.viewConfig.droppable=!1,e.viewConfig.fileDropped=void 0),e.viewConfig.droppable!==!1&&(e.viewConfig.droppable=!0,e.viewConfig.fileDropped||(e.viewConfig.fileDropped=this._getUploadFileRequest(e.viewConfig.name??"")))}_setFileListUploadButtonParameters(e){e.viewConfig.uploadClicked||(e.viewConfig.uploadClicked=this._getUploadFileRequest(e.viewConfig.name??""))}_tryAddFileListProperties(e){if(e.viewConfig.items||(e.viewConfig.items=`$${e.viewConfig.name}`),!e.viewConfig.primaryColumnName){const t=e.viewConfig.name??"",i=`${E.getAttributeDSName(t)}_${this.defaultPrimaryColumnName}`;e.viewConfig.primaryColumnName=i}}_linkFilterToAttribute(e,t){if(e=e??{},!(0,g.isModelAttributeConfig)(e)||!e.modelConfig)return;const r=e.modelConfig.filterAttributes??[];r.find(i=>i.name===t)||r.push({loadOnChange:!0,name:t}),e.modelConfig.filterAttributes=r}tryAddAttributeAndDataSource(e,t,r){var i=this;return(0,u.Z)(function*(){const a=r.viewConfig.items;if(typeof a!="string")return;const o=a.split("$")[1];if(!o)return;const n=E.getAttributeDSName(o),l=i._getAdditionalFilterName(o);e.modelConfig||(e.modelConfig={});const d=e.modelConfig.dataSources??{},p=e.viewModelConfig.attributes??{};if(d[n]||(d[n]=E.createDataSourceConfig(i.defaultFilesEntitySchemaName),e.modelConfig.dataSources=d),E.addDependencies(e,r.viewConfig,n),p[o]||(p[o]=i._createViewModelAttribute(n),e.viewModelConfig.attributes=p),!p[l]){const _=r.viewConfig.fileGroups,S=r.viewConfig.tag??"",C=d[n].config?.entitySchemaName,v=yield E.getRecordEntitySchemaName(r.viewConfig.items,r.viewConfig?.masterRecordColumnValue,e,t),P=or(_,S,C,v);P&&(p[l]=P,i._linkFilterToAttribute(p[o],l),e.viewModelConfig.attributes=p)}})()}innerProcess(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i.featureService.getFeatureState(i._fileDropDisableFeature),o=yield(0,h.lastValueFrom)(a);for(const n of e)i._tryAddFileListProperties(n),i._setFileListDropZoneParameters(n,o),i._setFileListUploadButtonParameters(n),yield i.tryAddAttributeAndDataSource(t,r,n);return t})()}}Ee.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Ee)))(t||Ee)}}(),Ee.\u0275prov=s.\u0275\u0275defineInjectable({token:Ee,factory:Ee.\u0275fac});const Qt=new s.InjectionToken("FILE_UPLOAD_METADATA_WORKER");class It{constructor(e){this._workers=e??[]}run(e,t){var r=this;return(0,u.Z)(function*(){const i=[...r._workers].sort((a,o)=>a.order-o.order);for(const a of i)yield a.process(e,t)})()}}It.\u0275fac=function(e){return new(e||It)(s.\u0275\u0275inject(Qt,8))},It.\u0275prov=s.\u0275\u0275defineInjectable({token:It,factory:It.\u0275fac,providedIn:"root"});class Me extends H{constructor(){super(...arguments),this.index=3,this._uploadFileRequestName="crt.UploadFileRequest",this._defaultFilesEntitySchemaName="SysFile",this._defaultRecordColumnName="RecordId"}_getUploadFileRequestConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>t.viewConfig.clicked?.request===this._uploadFileRequestName).map(t=>t.viewConfig.clicked)}_getFileLists(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileList",e.viewConfig)}_getFileDropRequestConfigs(e){const t=this._getFileLists(e);return t.filter(r=>r.viewConfig.fileDropped?.request===this._uploadFileRequestName).map(r=>r.viewConfig.fileDropped).concat(t.filter(r=>r.viewConfig.uploadClicked?.request===this._uploadFileRequestName).map(r=>r.viewConfig.uploadClicked))}getFilesEntitySchemaName(e,t,r){const i=E.getDataSourceNameByAttribute(e);return i?E.getDataSchemaName({models:r,schema:t,dataSourceName:i}):Promise.resolve(null)}setRequestParam(e,t,r){!e[t]&&r&&(e[t]=r)}getBaseRequestParams(){return{fileGroup:g.FileGroupEnum.Attachments,tag:"",files:"@event.files"}}getDefaultRequestParams(e){const t=E.getDataSourcePrimaryAttribute(e);return{...this.getBaseRequestParams(),recordId:`$${t}`,fileEntitySchemaName:this._defaultFilesEntitySchemaName,recordColumnName:this._defaultRecordColumnName}}getRequestParams(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i.getBaseRequestParams(),o=e.items,n=(yield i.getFilesEntitySchemaName(o,t,r))||i._defaultFilesEntitySchemaName,l=e?.masterRecordColumnValue,d=yield E.getRecordEntitySchemaName(o,l,t,r);return{...a,fileGroup:e?.fileGroups?.[0],tag:e?.tag,recordId:l,itemsAttributeName:e.name,fileEntitySchemaName:n,recordEntitySchemaName:d,recordColumnName:e.recordColumnName||i._defaultRecordColumnName}})()}_setRequestParams(e,t){for(const r in t)t[r]&&this.setRequestParam(e.params,r,t[r])}_extendRequestParams(e,t,r,i){var a=this;return(0,u.Z)(function*(){e.params=e.params||{};const o=t.find(l=>l.viewConfig.name===e.params.viewElementName),n=o?yield a.getRequestParams(o.viewConfig,r,i):a.getDefaultRequestParams(r);a._setRequestParams(e,n)})()}getComponentsToProcess(e){return[...this._getUploadFileRequestConfigs(e),...this._getFileDropRequestConfigs(e)]}innerProcess(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getFileLists(t);for(const o of e)yield i._extendRequestParams(o,a,t,r);return t})()}}Me.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Me)))(t||Me)}}(),Me.\u0275prov=s.\u0275\u0275defineInjectable({token:Me,factory:Me.\u0275fac});class Z{}Z.\u0275fac=function(e){return new(e||Z)},Z.\u0275mod=s.\u0275\u0275defineNgModule({type:Z}),Z.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:Qt,useClass:Te,multi:!0},{provide:Qt,useClass:Ee,multi:!0},{provide:Qt,useClass:Me,multi:!0}],imports:[Ut.CommonModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Z,{imports:[Ut.CommonModule]})}();class Nt{get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._fileListPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._workersService=t,this._fileListPreprocessingDisableFeature="DisableFileListPreprocessing"}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e;return yield r._workersService.run(i,t),e})()}}Nt.\u0275fac=function(e){return new(e||Nt)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(It))},Nt.\u0275prov=s.\u0275\u0275defineInjectable({token:Nt,factory:Nt.\u0275fac});const Ii={fileLists:{A:"FileListA",B:"FileListB",C:"FileListC",D:"FileListD",E:"FileListE",F:"FileListF",G:"FileListG",H:"FileListH",I:"FileListI",WithDeepMasterRecordColumn:"FileListWithDeepMasterRecordColumn",WithAttributeWoPath:"FileListWithAttributeWoPath",WithUploadButton:"FileListWithCustomUploadButton",WoMasterRecordColumn:"FileListWoMasterRecordColumn",WoRecordSchemaName:"FileListWoRecordSchemaName",WithRecordSchemaName:"FileListWithRecordSchemaName",WoDropZone:"FileListWoDropZone"},recordColumnNameA:"ColumnA",testFileEntity:"TestFile",testEntityName:"TestEntity",testTag:"TestTag"};function Ni(){return{viewConfig:[{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.WithUploadButton,uploadClicked:{request:"crt.UploadFileRequest",params:{viewElementName:"custom"}}},{type:"crt.FileList",droppable:!1,name:TEST_SCHEMA_DATA.fileLists.WoDropZone},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerId",recordColumnName:TEST_SCHEMA_DATA.recordColumnNameA,primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.A,tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListRecordSchemaName",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName},{type:"crt.FileList",items:"$FileListE",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.E,fileGroups:[FileGroupEnum.Attachments]},{type:"crt.FileList",items:"$FileListF",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.F,fileGroups:[FileGroupEnum.Attachments],tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListG",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.G},{type:"crt.FileList",items:TEST_SCHEMA_DATA.fileLists.H,masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.H},{type:"crt.FileList",items:"$FileListI",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.I},{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.B,droppable:!0}],name:"InnerContainer"},{type:"crt.Button",name:"ButtonA",clicked:{request:"crt.UploadFileRequest",params:{maximumAllowedFileSize:null,allowedFileTypes:"",viewElementName:TEST_SCHEMA_DATA.fileLists.A}}},{type:"crt.Button",name:"ButtonB",clicked:{request:"crt.UploadFileRequest",params:{}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName}}},{type:"crt.Button",name:"ButtonC",menuItems:[{type:"crt.MenuItem",name:"MenuItemA",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.B}}},{type:"crt.MenuItem",name:"MenuItemB",clicked:{request:"crt.UpdateRecordRequest",params:{}}},{type:"crt.MenuItem",name:"MenuItemC"}]},{type:"crt.Button",name:"ButtonD",clicked:"$onClick"},{type:"crt.Button",name:"ButtonE"},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountId",name:TEST_SCHEMA_DATA.fileLists.C,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoColumn",name:TEST_SCHEMA_DATA.fileLists.D,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoPath",name:TEST_SCHEMA_DATA.fileLists.WithAttributeWoPath},{type:"crt.FileList",masterRecordColumnValue:"not a master record attribute",name:TEST_SCHEMA_DATA.fileLists.WoMasterRecordColumn},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn,recordColumnName:"RecordId"},{type:"crt.Button",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn}}}],name:"MainContainer"}],viewModelConfig:{attributes:{OwnerId:{modelConfig:{path:"PDS.Id"}},OwnerAccountId:{modelConfig:{path:"PDS.OwnerAccountId"}},FileListA:{isCollection:!0,modelConfig:{path:"FileListADS",filterAttributes:[{loadOnChange:!0,name:"FileListA_PredefinedFilter"}]},viewModelConfig:{attributes:{FileListADS_Name:{modelConfig:{path:"FileListADS.NamePredefined"}},FileListADS_CreatedOn:{modelConfig:{path:"FileListADS.CreatedOnPredefined"}},FileListADS_Size:{modelConfig:{path:"FileListADS.SizePredefined"}}}}},FileListRecordSchemaName:{isCollection:!0,modelConfig:{path:"FileListRecordSchemaNameDS"}},FileListE:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListF:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListG:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListI:{isCollection:!0,modelConfig:null,viewModelConfig:{attributes:{}}},AttributeWoColumn:{modelConfig:{path:"AttributeWoColumn"}},AttributeWoPath:{modelConfig:{path:""}},AttributeWoModelConfig:{modelConfig:void 0},OwnerAccountCreatedBy:{modelConfig:{path:"PDS.OwnerAccountCreatedBy"}}}},modelConfig:{dataSources:{PDS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testEntityName,attributes:{OwnerAccountId:{path:"Owner.Account.Id"},OwnerAccountCreatedBy:{path:"Owner.Account.CreatedBy"}}}},FileListADS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testFileEntity}},FileListRecordSchemaNameDS:{type:"crt.EntityDataSource",config:{entitySchemaName:"ObjectWithoutRecordSchemaName"}}},primaryDataSourceName:"PDS",dependencies:{FileListADS:[{attributePath:"RecordId",relationPath:"PDS.Id"}]}}}}class Dt{constructor(e,t){this._filterViewElementOptionsModifierFactory=e,this._exposeAttributeConverterMetadataGenerator=t}_getFilterViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>Boolean(t?._filterOptions),e).map(t=>t.viewConfig)}_modifyFilterViewConfig(e){return this._filterViewElementOptionsModifierFactory?.create(e?.type)?.modify(e)||e}_generateFiltersAttributes(e){const{from:t,converters:r,expose:i}=e._filterOptions||{};return(0,b.isEmpty)(t)||(0,b.isEmpty)(i)?{}:i.filter(a=>Boolean(a?.attribute)).map(a=>({from:t,converters:r,expose:a})).map(a=>this._generateFilterAttributes(a)).reduce((a,o)=>({...a,...o}),{})}_generateFilterAttributes(e){const{from:t,expose:r}=e,i=r.attribute;if(!i)return{};const a=this._exposeAttributeConverterMetadataGenerator.generate({...r,converters:this._getFilterConverters(r.converters,e.converters)});return a?{[i]:{from:t,converter:a.converterExpression},...a.converterArgsAttributes}:{}}_getFilterConverters(e,t){const r=e?.filter(({converter:a})=>Boolean(a))??[],i=t?.filter(({converter:a})=>Boolean(a))??[];return r.length===0?i:r.map(({converter:a,args:o})=>{const n=i.find(l=>l.converter===a);return{converter:a,args:o??n?.args}})}crtOnMetaDataInit(e){const t=e;return this._getFilterViewConfigs(t.viewConfig).map(r=>this._modifyFilterViewConfig(r)).map(r=>this._generateFiltersAttributes(r)).forEach(r=>{t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},...r}}),Promise.resolve(e)}}Dt.\u0275fac=function(e){return new(e||Dt)(s.\u0275\u0275inject(I.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,8),s.\u0275\u0275inject(I.ExposeAttributeConverterMetadataGenerator))},Dt.\u0275prov=s.\u0275\u0275defineInjectable({token:Dt,factory:Dt.\u0275fac});function Or(c,e){const t=new Map(e.map(([r,i])=>[r,{injectable:i}]));return new T.Factory(c,t)}class V{static withModifiers(e){return{ngModule:V,providers:e.map(t=>({provide:I.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS,useValue:t,multi:!0}))}}}V.\u0275fac=function(e){return new(e||V)},V.\u0275mod=s.\u0275\u0275defineNgModule({type:V}),V.\u0275inj=s.\u0275\u0275defineInjector({providers:[I.ExposeAttributeConverterMetadataGenerator,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Dt,multi:!0},{provide:I.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,useFactory:Or,deps:[s.Injector,I.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS]}]});class Ft{constructor(){this._folderTreeItemsFilterName="folderTreeItemsFilter",this._featureValues=(0,s.inject)(m.FEATURE_VALUES),this._userInfo=(0,s.inject)(m.UserInfo),this._folderTreeUseStaticFolderService=(0,s.inject)(f.FolderTreeUseStaticFolderService),this._dataSchemaRepository=(0,s.inject)(g.DataSchemaRepositoryService),this._folderTreeIdResolver=(0,s.inject)(f.FolderTreeIdResolver),this._folderTreeDataProvider=(0,s.inject)(f.FolderTreeDataProvider),this._folderTreeAdminUnitRoleSourcesService=(0,s.inject)(f.FolderTreeAdminUnitRoleSourcesService)}_initializeAdminUnitRoleSources(){var e=this;return(0,u.Z)(function*(){e._adminUnitRoleSources=yield e._folderTreeAdminUnitRoleSourcesService.getAsArray()})()}_getFolderTreeViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FolderTree",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processFolderTree(e,t){var r=this;return(0,u.Z)(function*(){!t.rootSchemaName||(yield r._prepareActiveFolderIdAttributeValue(e,t),yield r._setUseStaticFoldersAttributeValue(t),yield r._setItemsConfig(e,t),r._setFolderTreeInputs(e,t),r._setFolderTreeOutputs(e,t),r._setFavoriteItemsConfig(e,t))})()}_setFolderTreeInputs(e,t){this._setExpandedItemsAttrValue(e,t),this._setVisibleAttrValue(e,t),this._setActiveFolderAttributes(e,t),this._setShowMaskAttrValue(e,t)}_setFolderTreeOutputs(e,t){this._setActiveFolderChanged(t),this._setFolderTreeVisibleChanged(t),this._setAddFolderRequest(t),this._setCopyFolderRequest(t),this._setFolderRenameRequest(t),this._setFolderFiltersUpdatedRequest(t),this._setDeleteFolderRequest(e,t),this._setFolderTreeExpandedItemsChanged(t),this._setConvertToStaticFolder(t),this._setFolderChangeRights(t),this._setToggleFolderFavoriteRequest(t)}_isOldSourceSchema(e){return(0,f.isOldSourceSchema)(e.sourceSchemaName)}_getFolderFilterColumnName(e){return(0,f.getFolderFilterColumnName)(e.sourceSchemaName)}_setActiveFolderChanged(e){e.activeFolderChanged||(e.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:e.name,id:"@event.id",name:"@event.name",folderTreeId:"@event.folderTreeId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId",rootSchemaName:"@event.rootSchemaName",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChanged(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.name,visible:"@event.visible"}})}_setAddFolderRequest(e){e.addFolder||(e.addFolder={request:"crt.AddFolderDataRequest",params:this._getAddFolderRequestParameters(e)})}_getAddFolderRequestParameters(e){return{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId"}}_setCopyFolderRequest(e){e.copyFolder||(e.copyFolder={request:"crt.CopyFolderDataRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",sourceId:"@event.sourceId",copyRights:"@event.copyRights",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setFolderRenameRequest(e){e.folderRenamed||(e.folderRenamed={request:"crt.FolderTreeRenameRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setToggleFolderFavoriteRequest(e){e.toggleFolderFavorite||(e.toggleFolderFavorite={request:"crt.ToggleFolderFavoriteRequest",params:{folderTreeName:e.name,id:"@event.id",favoriteId:"@event.favoriteId",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",status:"@event.status",reloadFavorites:!0}})}_setFolderFiltersUpdatedRequest(e){e.folderFiltersUpdated||(e.folderFiltersUpdated={request:"crt.FolderTreeUpdateFiltersRequest",params:{folderTreeName:e.name,filterData:"@event.filterData",sourceSchemaName:"@event.sourceSchemaName",folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}})}_setDeleteFolderRequest(e,t){if(t.deleteFolder)return;const{itemsAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name);t.deleteFolder={request:"crt.DeleteFolderDataRequest",params:{dataSourceName:this._getDataSourceNameByItems(e,r),sourceSchemaName:"@event.sourceSchemaName",folderTreeName:t.name,folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}}}_getDataSourceNameByItems(e,t){const r=this._getViewModelConfigAttribute(e,t)??{};return"embeddedModel"in r?r?.embeddedModel?.name??"":""}_setItemsConfig(e,t){var r=this;return(0,u.Z)(function*(){r._setItemsAttrValue(t),yield r._addItemsViewModelAttribute(e,t),r._setItemsFilterAttrValue(e,t)})()}_setItemsAttrValue(e){if(e.items)return;const{itemsAttrName:t}=(0,m.buildFolderTreeAttributeNames)(e.name);e.items=`$${t}`}_updateItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:r}=(0,m.buildFolderTreeAttributeNames)(t.name),i=this._getFolderFilterColumnName(t);if(!this._isOldSourceSchema(t)){e.attributes.FilterData={modelConfig:{path:`${r}.${i}`}};return}e.attributes.FolderTypeId={modelConfig:{path:`${r}.FolderType.Id`}},e.attributes.FilterData={modelConfig:{path:`${r}.${i}`}}}_addItemsViewModelAttribute(e,t){var r=this;return(0,u.Z)(function*(){const{itemsAttrName:i,itemsModelName:a,itemsFilterAttrName:o}=(0,m.buildFolderTreeAttributeNames)(t.name),n=t.sourceSchemaName,l=yield r._getDataSchema(n),d={isCollection:!0,viewModelConfig:r._createItemsViewModelAttributeViewModelConfig(t,l),modelConfig:r._createItemsViewModelAttributeModelConfig(a,o),embeddedModel:r._createItemsViewModelAttributeEmbeddedModel(a,n)};r._isOldItemsCollectionViewModelAttribute(e,t)&&r._addViewModelConfigAttribute(e,i,d,!0),r._mergeViewModelConfigAttribute(e,i,d)})()}_getDataSchema(e){return(0,h.lastValueFrom)(this._dataSchemaRepository.get(e))}_createItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:r}=(0,m.buildFolderTreeAttributeNames)(e.name),i=this._getFolderFilterColumnName(e),a={attributes:{Id:{modelConfig:{path:`${r}.${t.primaryAttributeName}`}},Name:{modelConfig:{path:`${r}.${t.primaryDisplayAttributeName}`}},ParentId:{modelConfig:{path:`${r}.${t.hierarchyAttributeName}.${t.primaryAttributeName}`}},FilterData:{modelConfig:{path:`${r}.${i}`}}}};return this._updateItemsViewModelAttributeViewModelConfig(a,e),a}_createItemsViewModelAttributeModelConfig(e,t){return{path:e,filterAttributes:[{name:t,loadOnChange:!0}]}}_createItemsViewModelAttributeEmbeddedModel(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t,adminUnitRoleSources:this._adminUnitRoleSources}}}}_isOldItemsCollectionViewModelAttribute(e,t){const{itemsAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name),i=this._getViewModelConfigAttribute(e,r);return this._isOldCollectionViewModelAttribute(i)}_isOldCollectionViewModelAttribute(e){return!!e&&!!e.isCollection&&!!e.viewModelConfig&&!!e.embeddedModel&&!!e.modelConfig}_setItemsFilterAttrValue(e,t){if(!this._getViewModelConfigAttributes(e))return;const{itemsFilterAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name),i=this._createItemsFilterGroup(t);this._addViewModelConfigAttribute(e,r,{value:i},!0)}_createItemsFilterGroup(e){return this._isOldSourceSchema(e)?this._createOldStructureItemsFilterGroup(e):this._createNewStructureItemsFilterGroup(e)}_createOldStructureItemsFilterGroup(e){const t=new A.FilterGroup(A.LogicalOperatorType.Or),r=[f.DYNAMIC_FOLDER_TYPE_ID];return e.useStaticFolders&&r.push(f.STATIC_FOLDER_TYPE_ID),t.addSchemaColumnInFilterWithParameters(A.ComparisonType.Equal,"FolderType",r,this._folderTreeItemsFilterName),t}_createNewStructureItemsFilterGroup(e){const t=new A.FilterGroup(A.LogicalOperatorType.Or);return t.addSchemaColumnFilterWithParameter(A.ComparisonType.Equal,"EntitySchemaName",e.rootSchemaName,this._folderTreeItemsFilterName),t}_isAllowUseStaticFolders(e){var t=this;return(0,u.Z)(function*(){return t._featureValues.IsAllowUseStaticFolders&&(yield(0,h.lastValueFrom)(t._folderTreeUseStaticFolderService.isEnabled(e.rootSchemaName)))})()}_setVisibleAttrValue(e,t){if(t.visible)return;const{visibleAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name);t.visible=`$${r}`,this._addViewModelConfigAttribute(e,r,{value:!0})}_setShowMaskAttrValue(e,t){if(t.showMask)return;const{showMaskAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name);t.showMask=`$${r}`,this._addViewModelConfigAttribute(e,r,{value:!1})}_setActiveFolderAttributes(e,t){t.activeFolderId||(this._setActiveFolderIdAttribute(t),this._setActiveFolderFilterAttribute(e,t),this._addActiveFolderNameAttribute(e,t))}_setActiveFolderIdAttribute(e){const{activeFolderIdAttrName:t}=(0,m.buildFolderTreeAttributeNames)(e.name);e.activeFolderId=`$${t}`}_addActiveFolderNameAttribute(e,t){const{activeFolderNameAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name);this._addViewModelConfigAttribute(e,r,{})}_setActiveFolderFilterAttribute(e,t){if(!this._isNeedToSetFolderFilterAttribute(e,t))return;const{activeFolderFolderTreeIdAttrName:r,activeFolderFilterAttrName:i,activeFolderFilterDataAttrName:a}=(0,m.buildFolderTreeAttributeNames)(t.name);this._addViewModelConfigAttribute(e,i,{from:[r,a],converter:"crt.FolderTreeActiveFilterAttributeConverter"},!0)}_isNeedToSetFolderFilterAttribute(e,t){const{activeFolderFilterAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name),i=this._getViewModelConfigAttribute(e,r);return!(i&&(0,g.isCalculatedAttributeConfig)(i))}_setFavoriteItemsConfig(e,t){const{favoriteItemsAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name);t.favoriteItems=`$${r}`;const i=`${r}_DS`,a=`${i}_filter`;this._setFavoriteItemsFilterAttr(a,e,t);const o={isCollection:!0,modelConfig:{path:i,filterAttributes:[{name:a,loadOnChange:!0}]}};this._addFavoriteItemsViewModelConfig(o,t,i),this._addFavoriteItemsEmbeddedModel(o,t,i),this._isOldFavoriteItemsCollectionViewModelAttribute(e,t)&&this._addViewModelConfigAttribute(e,r,o,!0),this._mergeViewModelConfigAttribute(e,r,o)}_addFavoriteItemsViewModelConfig(e,t,r){const i=this._isOldSourceSchema(t),a=i?"":".FolderTree",o=i?"FolderId":"Id",n={Id:{modelConfig:{path:`${r}.Id`}},Name:{modelConfig:{path:`${r}${a}.Name`}},FolderTreeId:{modelConfig:{path:`${r}${a}.${o}`}},FilterData:{modelConfig:{path:`${r}${a}.FilterData`}}};i&&(n.FolderTypeId={modelConfig:{path:`${r}${a}.FolderTypeId`}}),e.viewModelConfig={attributes:n}}_addFavoriteItemsEmbeddedModel(e,t,r){const i=this._isOldSourceSchema(t),a=i?f.SECURED_OLD_FOLDER_TREE_FAVORITE_SCHEMA_NAME:f.SECURED_DEFAULT_FOLDER_TREE_FAVORITE_SCHEMA_NAME,o={name:r,config:{type:"crt.EntityDataSource",config:{entitySchemaName:a,adminUnitRoleSources:this._adminUnitRoleSources},hiddenInPageDesigner:!1}};if(i){const n=t.sourceSchemaName,l=this._getFolderFilterColumnName(t);o.config.config.attributes={Name:{path:`[${n}:Id:FolderId].Name`,type:A.DataSchemaAttributeType.ForwardReferenceAttribute},FilterData:{path:`[${n}:Id:FolderId].${l}`,type:A.DataSchemaAttributeType.ForwardReferenceAttribute},FolderTypeId:{path:`[${n}:Id:FolderId].FolderType.Id`,type:A.DataSchemaAttributeType.ForwardReferenceAttribute}}}e.embeddedModel=o}_isOldFavoriteItemsCollectionViewModelAttribute(e,t){const{favoriteItemsAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name),i=this._getViewModelConfigAttribute(e,r);return this._isOldCollectionViewModelAttribute(i)}_setFavoriteItemsFilterAttr(e,t,r){const i=this._getViewModelConfigAttributes(t);if(i?.[e]||!i)return;const a=this._isOldSourceSchema(r),o=new A.FilterGroup(A.LogicalOperatorType.And),n=new A.CompareFilter(A.ComparisonType.Equal,new A.ColumnExpression({columnPath:"SysAdminUnit"}),new A.ParameterExpression({value:this._userInfo?.id,dataValueType:A.DataValueType.Guid}));if(o.add(n,"adminUnitFilter"),a){const l=r.sourceSchemaName,d=new A.CompareFilter(A.ComparisonType.Equal,new A.ColumnExpression({columnPath:"FolderEntitySchemaName"}),new A.ParameterExpression({value:l}));o.add(d,"folderEntitySchemaNameFilter")}else{const l=new A.CompareFilter(A.ComparisonType.Equal,new A.ColumnExpression({columnPath:"EntitySchemaName"}),new A.ParameterExpression({value:r.rootSchemaName}));o.add(l,"schemaFilter")}i[e]={value:o}}_setExpandedItemsAttrValue(e,t){if(t.expandedItems)return;const{expandedItemsAttrName:r}=(0,m.buildFolderTreeAttributeNames)(t.name);t.expandedItems=`$${r}`,this._addViewModelConfigAttribute(e,r,{})}_getViewModelConfigAttribute(e,t){return(this._getViewModelConfigAttributes(e)||{})[t]}_getViewModelConfigAttributes(e){return e?.viewModelConfig?.attributes}_mergeViewModelConfigAttribute(e,t,r){const i=this._getViewModelConfigAttribute(e,t);i&&(r=(0,b.mergeWith)(r,i,(a,o)=>(0,b.isArray)(o)?o:void 0)),this._addViewModelConfigAttribute(e,t,r,!0)}_addViewModelConfigAttribute(e,t,r,i=!1){const a=this._getViewModelConfigAttribute(e,t);if(!i&&a)return;const o=this._getViewModelConfigAttributes(e)||{};o[t]=r}_setFolderTreeExpandedItemsChanged(e){e.folderTreeExpandedItemsChanged||(e.folderTreeExpandedItemsChanged={request:"crt.FolderTreeExpandedItemsRequest",params:{folderTreeName:e.name,expandedItems:"@event.expandedItems"}})}_setFolderChangeRights(e){e.folderChangeRights||(e.folderChangeRights={request:"crt.LoadRightsModuleRequest",params:{payload:{entitySchemaName:"@event.entitySchemaName",entitySchemaCaption:"@event.entitySchemaCaption",primaryColumnValue:"@event.primaryColumnValue",primaryDisplayColumnValue:"@event.primaryDisplayColumnValue"}}})}_setConvertToStaticFolder(e){e.convertToStaticFolder||!this._isOldSourceSchema(e)||(e.convertToStaticFolder={request:"crt.ConvertToStaticFolderRequest",params:this._getAddFolderRequestParameters(e)})}_prepareActiveFolderIdAttributeValue(e,t){var r=this;return(0,u.Z)(function*(){const i=yield r._folderTreeIdResolver.getActiveFolderFolderTreeId(t,e);if((0,b.isEmpty)(i)){r._resetActiveFolderIdAttributesValue(e,t);return}yield r._updateActiveFolderIdAttributesValue(i,e,t)})()}_resetActiveFolderIdAttributesValue(e,t){const{activeFolderFolderTreeIdAttrName:r,activeFolderIdAttrName:i,activeFolderNameAttrName:a,activeFolderFilterDataAttrName:o}=(0,m.buildFolderTreeAttributeNames)(t.name);[r,i,a,o].forEach(l=>{this._addViewModelConfigAttribute(e,l,{value:null},!0)})}_updateActiveFolderIdAttributesValue(e,t,r){var i=this;return(0,u.Z)(function*(){const a=yield i._folderTreeDataProvider.getFolderData(e,r.sourceSchemaName);if(!a)return;const{activeFolderNameAttrName:o,activeFolderFilterDataAttrName:n}=(0,m.buildFolderTreeAttributeNames)(r.name),l=yield i._getFolderFilterFromFolderData(a,r);i._addViewModelConfigAttribute(t,o,{value:a.name},!0),i._addViewModelConfigAttribute(t,n,{value:l},!0)})()}_getFolderFilterFromFolderData(e,t){return(0,f.isStaticFolder)(e.folderTypeId)?(0,f.createStaticFolderFilter)(e.id,t.rootSchemaName):Promise.resolve(e.filter)}_setUseStaticFoldersAttributeValue(e){var t=this;return(0,u.Z)(function*(){!t._isOldSourceSchema(e)||(e.useStaticFolders=yield t._isAllowUseStaticFolders(e))})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getFolderTreeViewConfigs(r);return(0,b.isEmpty)(i)?e:(yield t._initializeAdminUnitRoleSources(),yield Promise.all(i.map(a=>t._processFolderTree(r,a))),r)})()}}Ft.\u0275fac=function(e){return new(e||Ft)},Ft.\u0275prov=s.\u0275\u0275defineInjectable({token:Ft,factory:Ft.\u0275fac});class Pt{_getFolderTreeActionViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FolderTreeActions",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_setProperties(e){const t=e.folderTree,{activeFolderIdAttrName:r,activeFolderNameAttrName:i,activeFolderFavoriteStateAttrName:a,favoriteItemsAttrName:o}=(0,m.buildFolderTreeAttributeNames)(t);e.activeFolderId||(e.activeFolderId=t?`$${r}`:null),e.activeFolderName||(e.activeFolderName=t?`$${i}`:null),e.activeFolderFavoriteState||(e.activeFolderFavoriteState=t?`$${a}`:null),e.favoriteItems||(e.favoriteItems=t?`$${o}`:null)}_setActiveFolderChangedRequest(e,t){if(t.activeFolderChanged)return;const r=t.folderTree??null;if(!r)return;const i=this._getFolderTreeRootSchemaName(e,r);t.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:r,id:"@event.id",name:"@event.name",folderTreeId:"@event.folderTreeId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId",rootSchemaName:i,isFavorite:"@event.isFavorite"}}}_setFolderTreeVisibleChangedRequest(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.folderTree??null,togglePanel:"@event.togglePanel"}})}_getFolderTreeRootSchemaName(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByName(e,t)?.viewConfig?.rootSchemaName}crtOnMetaDataInit(e){const t=e,r=this._getFolderTreeActionViewConfigs(t);for(const i of r)this._setProperties(i),this._setActiveFolderChangedRequest(t,i),this._setFolderTreeVisibleChangedRequest(i);return Promise.resolve(e)}}Pt.\u0275fac=function(e){return new(e||Pt)},Pt.\u0275prov=s.\u0275\u0275defineInjectable({token:Pt,factory:Pt.\u0275fac});class Vr{_setCollectionsAttributesPagingConfig(e){const t=e.viewModelConfig.attributes,r=this._getCollectionsViewConfigs(e),i=this._getCollectionsItemsAttributeNames(r);this._setCollectionsItemsAttributesPagingConfig(i,t)}_getCollectionsViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this.viewType,e.viewConfig).map(t=>t.viewConfig)}_getCollectionsItemsAttributeNames(e){return e.map(t=>this._getCollectionItemsAttributeName(t))}_setCollectionsItemsAttributesPagingConfig(e,t){const r="modelConfig.pagingConfig";e.forEach(i=>{(0,b.has)(t[i],r)||(0,b.set)(t[i],r,this.pagingConfig)})}_setCollectionsViewsPaginationChange(e,t){const r=this._getCollectionsViewConfigs(e);this._setCollectionsViewConfigsPaginationChange(r,t)}_setCollectionsViewConfigsPaginationChange(e,t){e.forEach(r=>{const i=this._getCollectionItemsAttributeName(r);if(!(0,b.has)(r,"paginationChange")&&i){const a=t.getBoundDataSourceNameByAttributePath(i);r.paginationChange=this.getPaginationChangeRequest(a)}})}_getCollectionItemsAttributeName(e){return e.items?.split("$")?.pop()}crtOnMetaDataInit(e){const t=e;return this._setCollectionsAttributesPagingConfig(t),Promise.resolve(e)}crtOnViewModelInit(e,t,r){const i=e;return this._setCollectionsViewsPaginationChange(i,r),Promise.resolve(e)}}class Re extends Vr{constructor(){super(...arguments),this.viewType="crt.Gallery",this.pagingConfig={rowCount:24,rowsOffset:null}}getPaginationChangeRequest(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,parameters:[]}}}}Re.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(Re)))(t||Re)}}(),Re.\u0275prov=s.\u0275\u0275defineInjectable({token:Re,factory:Re.\u0275fac});class Tt{get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._imageInputPreprocessingDisableFeature))}get isAutobindDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._autoBindToDisabled))}constructor(e,t){this._featureService=e,this._metadataModifierService=t,this._imageInputPreprocessingDisableFeature="DisableImageInputPreprocessing",this._autoBindToDisabled="AutoBindToDisabled"}_addToImageLinkConverter(e,t){const r=t.indexOf("|");if(t.startsWith("$")&&r===-1){const i=t+" | crt.ToImageLink";this._metadataModifierService.updateProperty({source:e,keys:["value"],value:i})}}_addBusinessRulesBinding(e,t,r,i,a){if(i.startsWith("$")&&!e.bindTo&&!a){this._metadataModifierService.addProperty(e,"bindTo",`$${r}`);const o=t.attributes||{};o[r]={...o[r],viewItemName:e.name},t.attributes=o}}_addImageSelectedRequest(e,t){e.imageSelected||this._metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this._metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_setReadonlyByType(e,t,r){var i=this;return(0,u.Z)(function*(){const a=t.viewModelConfig.attributes,o=i._getBindingAttributeWoConverters(e.value);if((0,R.isBindToViewModelAttribute)(o,a)){const n=o.slice(1).split(".").pop(),l=a[n]??{};let d="";(0,g.isModelAttributeConfig)(l)&&(d=l.modelConfig?.path.split(".")[0]);let p="";(0,g.isModelAttributeConfig)(l)&&(p=l.modelConfig?.path.split(".").pop());const _=r.find(v=>v.name===d),C=(_?yield(0,h.lastValueFrom)(_.getSchema(),{defaultValue:null}):null)?.findAttributeByName(p);C&&C.dataValueType!==A.DataValueType.IMAGELOOKUP&&(e.readonly||i._metadataModifierService.updateProperty({source:e,keys:["readonly"],value:!0}),i._metadataModifierService.removeProperty(e,"bindTo"))}})()}_getBindingAttributeWoConverters(e){const t=e?.indexOf("|");return t&&t!==-1&&(e=e.substring(0,t-1).trimEnd()),e}_getBindAttributeName(e){return this._getBindingAttributeWoConverters(e).replace("$","")}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t.isProcessingDisabled)return e;const r=e,i=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",r.viewConfig),a=yield t.isAutobindDisabled;return i.forEach(o=>{const n=o.viewConfig.value,l=t._getBindAttributeName(n);t._addToImageLinkConverter(o.viewConfig,n),t._addBusinessRulesBinding(o.viewConfig,r.viewModelConfig,l,n,a),t._addImageSelectedRequest(o.viewConfig,l),t._addimageClearRequest(o.viewConfig,l)}),e})()}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){if(yield r.isProcessingDisabled)return e;const i=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",i.viewConfig).forEach(function(){var o=(0,u.Z)(function*(n){yield r._setReadonlyByType(n.viewConfig,i,t)});return function(n){return o.apply(this,arguments)}}()),e})()}}Tt.\u0275fac=function(e){return new(e||Tt)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(g.MetadataModifierService))},Tt.\u0275prov=s.\u0275\u0275defineInjectable({token:Tt,factory:Tt.\u0275fac});class Et{constructor(e){this._featureService=e,this._labelProcessingDisableFeature="DisableLabelPreprocessing"}_actualizeLabelType(e){const t=f.LABEL_TYPE_MAPPING[e.labelType];t&&(e.labelType=t)}get _isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._labelProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield t._isProcessingDisabled)return e;const r=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Label",r.viewConfig).forEach(a=>{t._actualizeLabelType(a.viewConfig)}),e})()}}Et.\u0275fac=function(e){return new(e||Et)(s.\u0275\u0275inject(y.FeatureService))},Et.\u0275prov=s.\u0275\u0275defineInjectable({token:Et,factory:Et.\u0275fac});class Mt{constructor(e){this._featureValues=e,this._selectedChannelAttributeName="SelectedComposerChannelIndex",this._channelsAttributeName="ComposerChannels",this._selectedChannelAttributeDefValue=0,this._channelSelectorItemName="ChannelSelector",this._channelSelectorTypeName="crt.ChannelSelector",this._parentComposerType="crt.MessageComposerSelector"}_getViewConfigs(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(r=>r?.viewConfig).filter(Boolean)}_createAndBindExtendableComposerAttributes(e,t){t.forEach((r,i)=>{if(!Array.isArray(r.items)||!r.items.length)return;let a;(0,b.isEmpty)(r.selectedComposerChannelIndex)?(a=`${this._selectedChannelAttributeName}_${i}`,e[a]={value:this._selectedChannelAttributeDefValue},r.selectedComposerChannelIndex=`$${a}`):a=r.selectedComposerChannelIndex;const o=`${this._channelsAttributeName}_${i}`,n=[];r.items.forEach(l=>{this._createChannelSelector(l,a,o,n)}),e[o]={value:n}})}_createChannelSelector(e,t,r,i){const a=e.data;if(!(!a||(0,b.isEmpty)(a.schemaType))&&(i.push({visible:e.visible,data:{icon:a.icon,schemaType:a.schemaType,caption:a.caption}}),(0,b.isEmpty)(e.channelsPanel))){const o={name:`${this._channelSelectorItemName}_${e.name}`,type:this._channelSelectorTypeName,selectedChannelIndex:`$${t}`,channels:`$${r}`};e.channelsPanel=[o]}}_createAndBindComposerEventAttribute(e,t){t.forEach((r,i)=>{if(!Array.isArray(r.items)||!r.items.length)return;const a=`${m.COMPOSER_EVENT_ATTRIBUTE_PREFIX}_${i}`;e[a]={value:[]},r.composerEvent="$"+a,r.items.forEach(o=>{o.composerEvent="$"+a})})}_createAndBindComposerAttributes(e){const t=this._getViewConfigs(e,this._parentComposerType),r=e.viewModelConfig.attributes;this._createAndBindComposerEventAttribute(r,t),this._featureValues.ExtendableMessageComposer&&this._createAndBindExtendableComposerAttributes(r,t)}crtOnMetaDataInit(e){const t=e;return this._createAndBindComposerAttributes(t),Promise.resolve(e)}}Mt.\u0275fac=function(e){return new(e||Mt)(s.\u0275\u0275inject(m.FEATURE_VALUES))},Mt.\u0275prov=s.\u0275\u0275defineInjectable({token:Mt,factory:Mt.\u0275fac});class Rt{_getViewConfigs(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(r=>r?.viewConfig).filter(Boolean)}_setAddNextStepBtnAdditionalProperties(e){Object.keys(e).includes("visible")||(e.visible="$CardState | crt.IsEqual : 'edit'")}_setNextStepsComponentAdditionalProperties(e,t){if(!!e&&(Object.keys(e).includes("cardState")||(e.cardState="$CardState"),!Object.keys(e).includes("nextSteps"))){const r=t.viewModelConfig.attributes;this._createNextStepsAttribute(e,r)}}_createNextStepsAttribute(e,t){const r=`NextSteps_${e.name}`,i=`ReloadNextSteps_${e.name}`;t[r]={from:[this._getOrCreatePropertyAttribute(e.masterSchemaId||"",`MasterSchemaId_${e.name}`,t),this._getOrCreatePropertyAttribute(f.RELOAD_NEXT_STEPS_PREFIX,i,t)],converter:`crt.LoadNextSteps : '${e.masterSchemaName}'`},e.nextSteps=`$${r}`,e.reloadNextSteps=`$${i}`}_getOrCreatePropertyAttribute(e,t,r){return e.startsWith("$")?e.replace("$",""):(r[t]={value:e},t)}_handleNextStepsComponent(e){this._getViewConfigs(e,"crt.NextSteps").forEach(r=>{this._setNextStepsComponentAdditionalProperties(r,e)})}_handleNextStepsAddButtons(e){this._getViewConfigs(e,"crt.Button").forEach(r=>{if(r&&r.clickMode==="menu"){const i=r.menuItems||[];Array.isArray(i)&&i.some(a=>{const o=a.clicked;return o&&(o.request==="crt.AddNextStepRequest"||o.request==="crt.CreateEmailRequest")})&&this._setAddNextStepBtnAdditionalProperties(r)}})}_getNextStepRelatedConfigs(e){const t=m.MetadataSchemaUtils.getViewConfigInfoByFilter(r=>r.type==="crt.NextSteps"&&r.bindingColumns||r.type==="crt.MenuItem"&&r.clicked?.request==="crt.CreateEmailRequest"&&!r.clicked?.params?.bindingColumns,[e]).map(r=>r?.viewConfig).filter(Boolean);return t?.length!==2?null:{nextStep:t.find(r=>r.type==="crt.NextSteps"),addEmailBtn:t.find(r=>r.type==="crt.MenuItem")}}_getConfigsToFix(e){const t=new Array;return m.MetadataSchemaUtils.getViewConfigInfoByFilter(r=>{if(r.type!=="crt.ExpansionPanel")return!1;const i=this._getNextStepRelatedConfigs(r);return i&&t.push(i),Boolean(i)},e.viewConfig),t}_fixBindingColumns(e){this._getConfigsToFix(e).forEach(r=>{const i=r.addEmailBtn.clicked;i.params=i.params||{},i.params.bindingColumns=(0,b.cloneDeep)(r.nextStep.bindingColumns)})}crtOnMetaDataInit(e){const t=e;return this._fixBindingColumns(t),this._handleNextStepsAddButtons(t),this._handleNextStepsComponent(t),Promise.resolve(e)}}Rt.\u0275fac=function(e){return new(e||Rt)},Rt.\u0275prov=s.\u0275\u0275defineInjectable({token:Rt,factory:Rt.\u0275fac});class Ot{_modifyInputType(e,t,r){const i=e.control.replace("$",""),a=t.attributes[i]?.modelConfig?.path;if(a){const o=this._getDataSchemaAttributeByPath(a,r);o?.dataValueType===A.DataValueType.PHONE_TEXT&&(e.type="crt.PhoneInput",e.phoneAsLink=!0,e.displayAsPhone=o.isMasked)}else e.type==="crt.PhoneInput"&&(e.phoneAsLink=!0,e.displayAsPhone=!0)}_getDataSchemaAttributeByPath(e,t){const[r,i]=e.split("."),a=t.dataSchemas[r]?.attributes;let o;for(const n in a)if(a[n].path===i||a[n].name===i){o=a[n];break}return o}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),n=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.PhoneInput",a.viewConfig);return o.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),n.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),e})()}}Ot.\u0275fac=function(e){return new(e||Ot)},Ot.\u0275prov=s.\u0275\u0275defineInjectable({token:Ot,factory:Ot.\u0275fac});class Vt{constructor(e,t,r){this._translateService=e,this._printablesService=t,this._rightsService=r,this._translatePrefix="PrintablesMenuItemsPreprocessor",this._canManageReports=!1}_generateMenuItems(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e.viewConfig.clicked.params,o=t.modelConfig?.dataSources;if((0,b.isEmpty)(o))return console.warn("There is no datasources in modelConfig."),[];const n=o?.[a.dataSourceName];if(!n)return console.warn(`Datasource '${a.dataSourceName}' specified in the request is not found in the modelConfig.`),[];const l=n.scope===A.DataSourceScope.Page,d=n.config?.entitySchemaName;return(yield i._printablesService.getPrintablesForEntity(d)).filter(_=>l?_.ShowInCard:_.ShowInSection).map(_=>({type:"crt.MenuItem",caption:_.Caption,clicked:{request:"crt.PrintablesRequest",params:{convertInPDF:_.ConvertInPDF===!0,printableCaption:_.Caption,templateId:_.Id,dataSourceName:a.dataSourceName,filters:a?.filters}}}))})()}_getItemsWithPrintablesRequest(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",e,t.viewConfig).filter(i=>{const{clicked:a,menuItems:o}=i.viewConfig||{};return!o?.length&&a?.request==="crt.PrintablesRequest"&&a.params?.dataSourceName&&!a.params.templateId})}_noAvailablePrintablesMenuItem(){return{type:"crt.MenuLabel",caption:this._translateService.instant(this._translatePrefix+".NoAvailablePrintablesCaption")}}_goToPrintablesSetupMenuItems(){return this._canManageReports?[{type:"crt.MenuDivider"},{type:"crt.MenuItem",caption:this._translateService.instant(this._translatePrefix+".GoToPrintablesSetupCaption"),icon:"open-button-icon",handleItemClick:()=>{this._goToPrintables()}}]:[]}_goToPrintables(){const e=(0,m.getWorkspaceBaseUrl)();window.open(`${e}ClientApp#/Printables`,"_blank")}_generateInfoMenuItems(){return[this._noAvailablePrintablesMenuItem(),...this._goToPrintablesSetupMenuItems()]}_prepareItemMenu(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=a._getItemsWithPrintablesRequest(e,r);for(const n of o){let l=yield a._generateMenuItems(n,r,i);l.length===0?l=a._generateInfoMenuItems():l.push(...a._goToPrintablesSetupMenuItems()),n.viewConfig[t]=l,n.viewConfig.clickMode="menu",delete n.viewConfig.clicked}})()}_initCanManageReports(){var e=this;return(0,u.Z)(function*(){e._canManageReports=yield(0,h.firstValueFrom)(e._rightsService.getCanExecuteOperation("CanManageReports"))})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e;return yield i._initCanManageReports(),yield i._prepareItemMenu("crt.MenuItem","items",a,r),yield i._prepareItemMenu("crt.Button","menuItems",a,r),e})()}}Vt.\u0275fac=function(e){return new(e||Vt)(s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(y.PrintablesService),s.\u0275\u0275inject(y.RightsService))},Vt.\u0275prov=s.\u0275\u0275defineInjectable({token:Vt,factory:Vt.\u0275fac});class mr{constructor(e){this.injector=e,this.isNewStructure=t=>!!t._filterOptions,this.initializeDependencies()}initializeDependencies(){}crtOnMetaDataInit(e,t){return Promise.resolve(t)}}class pr extends mr{_getDependencyFilterConfigsFromViewConfig(e){const t=e._filterOptions.expose?.map(i=>i.converters),r=[];return t?.forEach(i=>{i?.forEach(a=>this._addDependencyFilterConfigsFromConverterConfig(a,r))}),r}_addDependencyFilterConfigsFromConverterConfig(e,t){e?.args?.map(a=>a.target)?.map(a=>{const o=a.dependencyFilters?.filter(n=>n.attributeName);o?.length>0&&t.push(...o)})}_createAttributesForDependencyFilterConfigs(e,t){this._getDependencyFilterConfigsFromViewConfig(e).forEach(i=>this._createViewModelAttributeIfNeed(i,t))}_createViewModelAttributeIfNeed(e,t){t[e.attributeName]||(t[e.attributeName]={modelConfig:{path:e.relationPath}})}crtOnMetaDataInit(e,t){var r;if(!this.isNewStructure(e))return Promise.resolve(t);const i=t;(r=i.viewModelConfig).attributes??(r.attributes={});const a=i.viewModelConfig.attributes;return this._createAttributesForDependencyFilterConfigs(e,a),Promise.resolve(t)}}class wr extends mr{constructor(e){super(e),this.injector=e}_isAllowToSetupComboboxViewConfig(e){const t=e.config;return!this._isShowRecordsInWindows(e)&&!("comboboxViewElementConfig"in t)&&!!t.entitySchemaName}_isShowRecordsInWindows(e){return e.config.showRecordsInWindows}_getEntitySchemaName(e){const t=e.entitySchemaName;return t===f.TAG_VIRTUAL_COLUMN_SCHEMA_NAME?f.DEFAULT_TAG_SOURCE_SCHEMA_NAME:t}_getComboboxFilter(e,t,r){const i=new A.FilterGroup;return this._addTagSchemaNameComboboxFilterIfNeed(i,e,t,r),this._addRecordsComboboxFilterIfNeed(i,e),i.toJson()}_addTagSchemaNameComboboxFilterIfNeed(e,t,r,i){if(t.entitySchemaName===f.TAG_VIRTUAL_COLUMN_SCHEMA_NAME){const o=this._getBindedListsEntitySchemaNames(r,i);o.length&&e.add((0,f.createTagLookupFilter)(o),"TagFilter")}}_addRecordsComboboxFilterIfNeed(e,t){const r=t.recordsFilter;if(r){const i=A.FilterGroup.fromJson(r,A.FilterParser);e.add(i,"RecordsFilter")}}_getBindedListsEntitySchemaNames(e,t){const r=[];return this._getBindedViewAttributeNames(e).forEach(a=>{const o=this._getDataSourceEntitySchemaNameByViewAttribute(a,t);o&&r.push(o)}),[...new Set(r)]}_getBindedViewAttributeNames(e){const t=[];return e._filterOptions?.expose?.forEach(r=>{r.converters?.forEach(i=>{i.args?.forEach(a=>{const o=a.target?.viewAttributeName;o&&t.push(o)})})}),[...new Set(t)]}_getDataSourceEntitySchemaNameByViewAttribute(e,t){const i=(m.MetadataSchemaUtils.getViewModelAttribute(t,e)||{}).modelConfig?.path||"";return(t.modelConfig?.dataSources||{})[i]?.config?.entitySchemaName}initializeDependencies(){super.initializeDependencies(),this._comboboxPreprocessorService=this.injector.get($)}crtOnMetaDataInit(e,t){var r=this;return(0,u.Z)(function*(){if(!r._isAllowToSetupComboboxViewConfig(e))return Promise.resolve(t);const a=t.viewModelConfig.attributes,o={name:`${e.name}_ComboBox`},n=e.config;return yield r._comboboxPreprocessorService.setupComboboxMetadataByEntitySchema(o,a,r._getEntitySchemaName(n),r._getComboboxFilter(n,e,t)),n.comboboxViewElementConfig={type:"crt.ComboBox",labelPosition:"hidden",useMultiChoice:!0,...o},Promise.resolve(t)})()}}class Q{constructor(e){this._injector=e}_getQuickFilterAdditionalPreprocessingService(e){switch(e){case f.QuickFilterType.Custom:return new pr(this._injector);case f.QuickFilterType.Lookup:return new wr(this._injector);default:return null}}crtOnMetaDataInit(e,t){return this._getQuickFilterAdditionalPreprocessingService(e.filterType)?.crtOnMetaDataInit(e,t)||Promise.resolve(t)}}Q.\u0275fac=function(e){return new(e||Q)(s.\u0275\u0275inject(s.Injector))},Q.\u0275prov=s.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac});class fr{constructor(e){this.injector=e,this.initializeDependencies()}initializeDependencies(){}getAttributeValue(e,t){return this.getViewModelConfigAttributes(e)[t]?.value||[]}setAttributeValue(e,t,r){const i=this.getViewModelConfigAttributes(e);i[t]={value:r}}getViewModelConfigAttributes(e){return e.viewModelConfig.attributes}update(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i.getAttributeValue(t,r);if(i.isNotNeedUpdateValue(a))return;const o=yield i.createNewAttributeValue(e,a);i.setAttributeValue(t,r,o)})()}}class $r extends fr{_createDateRangeQuickFilterValue(e){return this._dateRangeMacrosConverter.convert(e)}_isMacrosEnum(e){return typeof e=="string"}initializeDependencies(){super.initializeDependencies(),this._dateRangeMacrosConverter=this.injector.get(f.DateRangeMacrosConverter)}isNotNeedUpdateValue(e){return(0,b.isEmpty)(e)||!this._isMacrosEnum(e)&&!e.macros}createNewAttributeValue(e,t){const r=this._isMacrosEnum(t)?t:t.macros;return Promise.resolve(this._createDateRangeQuickFilterValue(r))}}class Br extends fr{_createLookupQuickFilterValue(e,t){var r=this;return(0,u.Z)(function*(){const i=t.filter(o=>r._isMacrosValueItem(o)),a=t.filter(o=>!r._isMacrosValueItem(o));return[...r._createMacrosLookupQuickFilterValue(i),...yield r._createNotMacrosLookupQuickFilterValue(a,e)]})()}_isMacrosValueItem(e){return Object.values(f.LookupDefaultValueMacros).includes(this._getValueFromValueItem(e))}_createMacrosLookupQuickFilterValue(e){return e.map(t=>this._createMacrosLookupQuickFilterValueItem(t)).filter(Boolean)}_createMacrosLookupQuickFilterValueItem(e){switch(this._getValueFromValueItem(e)){case f.LookupDefaultValueMacros.CurrentUserContact:return this._createLookupQuickFilterValueItemFromPreviousItem(e,this._userInfo.contactId,this._userInfo.contactName);case f.LookupDefaultValueMacros.CurrentUserAccount:return this._createLookupQuickFilterValueItemFromPreviousItem(e,this._userInfo.accountId,this._userInfo.accountName);default:return null}}_createNotMacrosLookupQuickFilterValue(e,t){var r=this;return(0,u.Z)(function*(){return(0,b.isEmpty)(e)?Promise.resolve([]):(yield r._lookupQuickFilterValueRepository.getActualData(e,t)).map(i=>r._mapActualValueItem(e,i)).filter(Boolean)})()}_mapActualValueItem(e,t){const r=e.find(i=>i.value===t.value);return r?this._createLookupQuickFilterValueItemFromPreviousItem(r,t.value,t.displayValue):null}_createLookupQuickFilterValueItemFromPreviousItem(e,t,r){return!this._isValidValue(t)||(0,b.isEmpty)(r)?null:{...e,value:t,displayValue:r,originalValue:this._getValueFromValueItem(e),checkedState:"checkedState"in e?e.checkedState:!1}}_getValueFromValueItem(e){return"originalValue"in e?e.originalValue:e.value}_isValidValue(e){return(0,A.isGuid)(e)&&!(0,A.isEmptyGuid)(e)}initializeDependencies(){super.initializeDependencies(),this._userInfo=this.injector.get(m.UserInfo),this._lookupQuickFilterValueRepository=this.injector.get(f.LookupQuickFilterValueRepositoryService)}isNotNeedUpdateValue(e){return(0,b.isEmpty)(e)}createNewAttributeValue(e,t){return this._createLookupQuickFilterValue(e.config,t)}}class z{constructor(e){this._injector=e}_getQuickFilterValueAttributeUpdater(e){switch(e){case f.QuickFilterType.Lookup:return new Br(this._injector);case f.QuickFilterType.DateRange:return new $r(this._injector);default:return null}}update(e,t,r){return this._getQuickFilterValueAttributeUpdater(e.filterType)?.update(e,t,r)||Promise.resolve()}}z.\u0275fac=function(e){return new(e||z)(s.\u0275\u0275inject(s.Injector))},z.\u0275prov=s.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac});class Kt{constructor(){this.isNewStructure=e=>!!e._filterOptions}_getOrCreateModelFilters(e){const t=e.modelConfig;return t.filterAttributes||(t.filterAttributes=[]),t.filterAttributes}_setFilterToModelFilters(e,t,r){const i=this.getAttributeModelFilters(e,t);i.some(o=>o.name===r)||i.push({name:r,loadOnChange:!0})}getFilterAttributeName(e,t){return`${e}_${t}`}getAttributeModelFilters(e,t){const r=e[t];return r?.modelConfig?this._getOrCreateModelFilters(r):[]}createAttributeIfNeed(e,t,r){t in e||(e[t]=r)}setFilterAttribute(e,t,r){const i=this.getFilterAttributeName(t,r),a=e.viewModelConfig.attributes;this.createAttributeIfNeed(a,i,{value:{}}),this._setFilterToModelFilters(a,r,i)}}class L extends Kt{constructor(e,t){super(),this._quickFilterValueAttributeUpdater=e,this._quickFilterAdditionalPreprocessingService=t,this._isTargetExists=r=>!!r.targets?.length}_setValueAttribute(e,t){const r=t?.config;if("value"in t||!r)return;const i=this._getQuickFilterValueAttributeName(t.name);t.value=`$${i}`;const a="defaultValue"in t.config?t.config.defaultValue:null;this._createValueAttributeIfNeed(e,i,a)}_createValueAttributeIfNeed(e,t,r){const i=e.viewModelConfig.attributes;this.createAttributeIfNeed(i,t,{value:r})}_updateValueAttribute(e,t){const r=this._getQuickFilterValueAttributeName(t.name);return this._quickFilterValueAttributeUpdater.update(t,e,r)}_setFilterAttribute(e,t){this.isNewStructure(t)||!this._isTargetExists(t)||t.targets?.forEach(r=>{this._setFilterConverterAttribute(e,t,r),this.setFilterAttribute(e,t.name,r.viewAttributeName),r.filterAttributeName=this.getFilterAttributeName(t.name,r.viewAttributeName)})}_setFilterConverterAttribute(e,t,r){const i=e.viewModelConfig.attributes,a=this.getFilterAttributeName(t.name,r.viewAttributeName),o=`${a}_Target`,n={from:this._getQuickFilterValueAttributeName(t.name),converter:`crt.QuickFilterAttributeConverter: $${o}`};this.createAttributeIfNeed(i,o,{value:this._createQuickFilterConverterParameters(r,t)}),this.createAttributeIfNeed(i,a,n)}_createQuickFilterConverterParameters(e,t){const r={target:e,quickFilterType:t.filterType};return this._allowAddConfigToConverterParameters(t)&&(r.config=t.config),r}_allowAddConfigToConverterParameters(e){return e.filterType===f.QuickFilterType.Custom}_setValueChangeRequest(e){if(e.valueChange||!e.filterType)return;const t=this._getQuickFilterValueAttributeName(e.name);e.valueChange={request:"crt.QuickFilterRequest",params:{valueAttributeName:t,value:"@event"}}}_getQuickFilterValueAttributeName(e){return`${e}_Value`}crtOnMetaDataInit(e,t){var r=this;return(0,u.Z)(function*(){const i=t;return r._setValueAttribute(i,e),yield r._updateValueAttribute(i,e),r._setFilterAttribute(i,e),r._setValueChangeRequest(e),yield r._quickFilterAdditionalPreprocessingService.crtOnMetaDataInit(e,t),Promise.resolve(t)})()}}L.\u0275fac=function(e){return new(e||L)(s.\u0275\u0275inject(z),s.\u0275\u0275inject(Q))},L.\u0275prov=s.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac});class Oe extends Kt{constructor(e){super(),this._quickFilterPreprocessorService=e}_getQuickFilterViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.QuickFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getQuickFilterViewConfigs(r);return yield Promise.all(i.map(function(){var a=(0,u.Z)(function*(o){yield t._quickFilterPreprocessorService.crtOnMetaDataInit(o,e)});return function(o){return a.apply(this,arguments)}}())),Promise.resolve(e)})()}}Oe.\u0275fac=function(e){return new(e||Oe)(s.\u0275\u0275inject(L))},Oe.\u0275prov=s.\u0275\u0275defineInjectable({token:Oe,factory:Oe.\u0275fac});class wt{constructor(e){this.featureService=e,this.featureName="DisableDataGridMoveSelectedItemsProcessing"}_getMoveItemsButtons(e){return(0,R.getRequestBindingConfigs)(e.viewConfig,"crt.MoveSelectedItemsRequest")}_generateViewModelAttribute(e,t,r){const i=e?.viewModelConfig?.attributes||{},a=t?.replace(r+"_","");i[t]||(i[t]={modelConfig:{path:`${r}.${a}`}})}_generateDataSourceAttribute(e,t,r){const o=(e?.modelConfig?.dataSources??{})[r]?.config?.attributes,n=t.replace(r+"_","");o[n]||(o[n]={path:n})}_generateMissingAttributes(e,t){const r=e?.params,i=r?.sourceAttribute,a=r?.targetAttribute,o=r.defaultValues,n=t?.viewModelConfig?.attributes??{},l=n[i],d=n[a],p=l?.modelConfig?.path,_=d?.modelConfig?.path;o?.forEach(S=>{const C=S.attributeName,v=S.value;if(S.type===g.MoveSelectedItemDefaultValueType.Item){const P=typeof S.value=="object"?v.value:v;typeof P=="string"&&this._generateViewModelAttribute(l,P,p),this._generateDataSourceAttribute(t,P,p)}this._generateViewModelAttribute(d,C,_),this._generateDataSourceAttribute(t,C,_)})}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(yield(0,h.lastValueFrom)(t.featureService.getFeatureState(t.featureName),{defaultValue:null}))return e;const i=e;if(!i.viewModelConfig?.attributes)return e;const a=t._getMoveItemsButtons(i);for(const o of a)t._generateMissingAttributes(o,i);return e})()}}wt.\u0275fac=function(e){return new(e||wt)(s.\u0275\u0275inject(y.FeatureService))},wt.\u0275prov=s.\u0275\u0275defineInjectable({token:wt,factory:wt.\u0275fac});var gr=D(70806);class J{constructor(e){this._resourceFinderService=e,this._dataGridType="crt.DataGrid",this._galleryType="crt.Gallery",this._findAttributeInDataSchema=(t,r)=>t?.attributes?.find(i=>i.name===r)}_getBindedViewElementConfigsByAttributeNames(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByFilter(r=>this._isViewConfigInfoBindedByPropertyValues(r,t.map(i=>`$${i}`)),e.viewConfig).map(r=>r.viewConfig)}_isViewConfigInfoBindedByPropertyValues(e,t){const r=Object.values(e);for(const i of r)if(t.includes(i))return!0;return!1}_getColumnByViewType(e,t,r,i){switch(i.type){case this._dataGridType:return this._getColumnsFromDataGridViewConfig(e,t,r,i);case this._galleryType:return Promise.resolve(this._getColumnsFromGalleryViewConfig(e,t,r,i));default:return Promise.resolve(this._getColumnsFromViewModelConfig(e,t,r))}}_getColumnsFromDataGridViewConfig(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=[],n=a._getDataSchema(t,r);if(!n)return Promise.resolve(null);const l=i;if(!l.columns)return a._getColumnsFromViewModelConfig(e,t,r);const d=a._getColumnAttributes(e,r);for(const p of l.columns){const _=p.code,S=d?.[_];yield a._addColumnByResourcesIfNeed(n,t,o,p,S)}return{columns:o,viewName:i.name||r,primaryDisplayName:n.primaryDisplayAttributeName}})()}_addColumnByResourcesIfNeed(e,t,r,i,a){var o=this;return(0,u.Z)(function*(){const n=o._getColumnNameFromAttributeConfigPath(a),l=o._findAttributeInDataSchema(e,n);o._isAllowedToAddColumn(l,r,n)&&r.push(yield o._createColumnByResources(t[m.SchemaResourcesSuffix],i.caption,n,l?.path))})()}_getColumnsFromGalleryViewConfig(e,t,r,i){const a=[],o=this._getDataSchema(t,r);if(!o)return null;const n=i?.itemConfig,l=this._getColumnAttributes(e,r);return(0,b.forEach)(n?.templateValuesMapping,(d,p)=>{const _=l?.[d];this._addColumnByDataSchemaIfNeed(o,a,_)}),{columns:a,viewName:i.name||r,primaryDisplayName:o.primaryDisplayAttributeName}}_getColumnsFromViewModelConfig(e,t,r){const i=[],a=this._getDataSchema(t,r);if(!a)return null;const o=this._getColumnAttributes(e,r);return(0,b.forEach)(o,(n,l)=>{this._addColumnByDataSchemaIfNeed(a,i,n)}),{columns:i,viewName:r,primaryDisplayName:a.primaryDisplayAttributeName}}_getDataSchema(e,t){return e.getBoundDataSchemaByAttributePath(t)}_getColumnAttributes(e,t){const r=e.viewModelConfig.attributes;return Object.prototype.hasOwnProperty.call(r,t)?r[t].viewModelConfig?.attributes||{}:{}}_addColumnByDataSchemaIfNeed(e,t,r){const i=this._getColumnNameFromAttributeConfigPath(r),a=this._findAttributeInDataSchema(e,i);this._isAllowedToAddColumn(a,t,i)&&t.push(this._createColumnByDataSchema(a,i))}_getColumnNameFromAttributeConfigPath(e){if(e&&(0,g.isModelAttributeConfig)(e))return e?.modelConfig?.path?.split(".").slice(1).shift()}_isAllowedToAddColumn(e,t,r){return(0,m.isAllowedTypeSearchColumn)(e)&&!!r&&!t.some(i=>i.name===r)}_createColumnByResources(e,t,r,i){var a=this;return(0,u.Z)(function*(){return{caption:(yield a._resourceFinderService.findViewModelResourceValue(t,e,t))||r,name:r,path:i||r}})()}_createColumnByDataSchema(e,t){return{caption:e?.caption||t,name:t,path:e?.path||t}}_getUniqueColumns(e){if(!e.length)return null;const t=[];return e.forEach(r=>{r.columns.forEach(i=>{this._isSearchFilterColumnExist(t,i)||t.push(i)})}),{columns:t,viewName:e.slice().shift()?.viewName||"",primaryDisplayName:e.slice().shift()?.primaryDisplayName}}_isSearchFilterColumnExist(e,t){return e.some(r=>r.caption===t.caption&&r.name===t.name)}getColumnsModelByAttributeName(e,t,r){var i=this;return(0,u.Z)(function*(){const a=i._getBindedViewElementConfigsByAttributeNames(e,[r]);if(a.length===0)return i._getColumnsFromViewModelConfig(e,t,r);const o=(yield Promise.all(a.map(n=>i._getColumnByViewType(e,t,r,n)))).filter(Boolean);return i._getUniqueColumns(o)})()}}J.\u0275fac=function(e){return new(e||J)(s.\u0275\u0275inject(m.ResourceFinderService))},J.\u0275prov=s.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac});class Ve extends Kt{constructor(e,t,r,i){super(),this._featureService=e,this._searchFilterPreprocessorService=t,this._searchFilterQueryAnalyzerService=r,this._translateService=i,this._isTargetAttributesExist=(a,o)=>this._getAvailableTargetAttributes(a,o)?.length>0}_getSearchFilterViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getAvailableTargetAttributes(e,t){return this.isNewStructure(t)?this._getAvailableTargetFromFilterOptions(e,t):this._getAvailableTargetFromTargetAttributes(e,t)}_getAvailableTargetFromTargetAttributes(e,t){return t?.targetAttributes?.map(r=>(0,b.get)(e.viewModelConfig?.attributes||{},r)?r:null).filter(Boolean)||[]}_getAvailableTargetFromFilterOptions(e,t){return t?._filterOptions?.expose?.map(r=>this._getTargetAttributeNameFromConverter(r.converters||[])).filter(Boolean)}_getTargetAttributeNameFromConverter(e){return e.find(r=>r?.args?.length>0)?.args?.find(r=>!!r)??""}_getSearchValueViewModelAttributeName(e){return`${e}_SearchValue`}_getSearchFilteredColumnViewModelAttributeName(e){return`${e}_SearchFilteredColumn`}_getSearchFilteredColumnsGroupsAttributeName(e){return`${e}_FilteredColumnsGroups`}_getSearchMinifySearchAttributeName(e){return`${e}_MinifySearch`}_setDisabledAttribute(e,t){this._isTargetAttributesExist(e,t)||(t.disabled=!0)}_setTooltipAttribute(e){e.tooltip||(e.tooltip=this._translateService.instant("Components.SearchFilter.Tooltip"))}_setSearchValueAttribute(e,t){const r=this._getSearchValueViewModelAttributeName(t.name);this._createViewModelAttribute(e,r),t.value=`$${r}`}_setSearchFilteredColumnAttribute(e,t){const r=this._getSearchFilteredColumnViewModelAttributeName(t.name);this._createViewModelAttribute(e,r),t.filteredColumn=`$${r}`}_setSearchMinifySearchAttribute(e,t){const r=this._getSearchMinifySearchAttributeName(t.name);this._createViewModelAttribute(e,r,t.iconOnly||!1),t.minifySearch=`$${r}`}_setSearchFilteredColumnsGroupsAttribute(e,t){const r=this._getSearchFilteredColumnsGroupsAttributeName(t.name);this._createViewModelAttribute(e,r),t.selectedColumnsGroups=`$${r}`}_createViewModelAttribute(e,t,r=""){const i=e.viewModelConfig.attributes;Object.prototype.hasOwnProperty.call(i,t)||(i[t]={value:r})}_setFilterAttribute(e,t){this.isNewStructure(t)||!this._isTargetAttributesExist(e,t)||this._getAvailableTargetAttributes(e,t).forEach(r=>{this._setFilterConverterAttribute(e,t,r),this.setFilterAttribute(e,t.name,r)})}_setFilterConverterAttribute(e,t,r){const i=e.viewModelConfig.attributes,a=this.getFilterAttributeName(t.name,r),o=this._getSearchFilteredColumnsGroupsAttributeName(t.name),n={from:[this._getSearchValueViewModelAttributeName(t.name),o],converter:`crt.SearchFilterAttributeConverter: '${r}'`};this.createAttributeIfNeed(i,o,{value:[]}),this.createAttributeIfNeed(i,a,n)}_setSearchFilterColumnsGroupsRequest(e,t,r){var i=this;return(0,u.Z)(function*(){if(r.valueChange||!i._isTargetAttributesExist(e,r))return;const a=(yield i._createSearchFilterTargets(e,t,r)).filter(Boolean);if((0,b.isEmpty)(a))return;const n=(yield i._getIsSearchFilterQueryAnalyzerEnabled())?yield i._getIsNeedShowAllOptionForTargets(e,t,a):!0;i._setSearchFilterConfigIntoView(r,a,n),r.valueChange={request:"crt.SearchFilterColumnsGroupsRequest",params:{value:"@event.value",searchFilterColumnsGroups:"@event.columnsGroups",searchFilterGroups:a.map(l=>({filterAttributeName:l.filterAttributeName,viewAttributeName:l.viewAttribute.name})),searchValueAttributeName:i._getSearchValueViewModelAttributeName(r.name),searchFilteredColumnAttributeName:i._getSearchFilteredColumnViewModelAttributeName(r.name),searchFilteredColumnsGroupsAttributeName:i._getSearchFilteredColumnsGroupsAttributeName(r.name)}}})()}_getIsSearchFilterQueryAnalyzerEnabled(){return this._featureService.getFeatureState("SearchFilterQueryAnalyzerEnabled")}_getIsNeedShowAllOptionForTargets(e,t,r){var i=this;return(0,u.Z)(function*(){for(const a of r)if(yield i._getIsNeedOptimization(e,t,a.viewAttribute.name,a.columnsModel.columns))return!1;return!0})()}_getIsNeedOptimization(e,t,r,i){var a=this;return(0,u.Z)(function*(){if(a._isCollectionAttributeHasFixedFilter(e,t,r))return!1;const o=t.getBoundDataSchemaByAttributePath(r)?.name,n=i.map(d=>d.path);return!(0,gr.isNotEmpty)(o)||i.length===0?!1:(yield(0,h.firstValueFrom)(a._searchFilterQueryAnalyzerService.analyze(o,n))).isNeedOptimization})()}_isCollectionAttributeHasFixedFilter(e,t,r){let i=!1;const a=e.viewModelConfig.attributes;if(this._isDataSourceHasDependencies(e,t,r))return!0;const o=this.getAttributeModelFilters(a,r);return(0,b.each)(o,n=>(i=this._isPredefineFilterAttribute(a,n.name),!i)),i}_isPredefineFilterAttribute(e,t){const i=e[t]?.value?.filterType;return!!i||i===0}_isDataSourceHasDependencies(e,t,r){const i=t.getBoundDataSourceNameByAttributePath(r);return((e.modelConfig?.dependencies||{})[i]||[]).length>0}_createSearchFilterTargets(e,t,r){return Promise.all(this._getAvailableTargetAttributes(e,r).map(i=>this._createSearchFilterTarget(e,t,r.name,i)))}_createSearchFilterTarget(e,t,r,i){var a=this;return(0,u.Z)(function*(){const o=yield a._getColumnsModel(e,t,i);if(!o)return Promise.resolve(null);const n=`${r}_${i}`,l=a._getDisplayValueForViewAttributeName(t,i,o.viewName);return{columnsModel:o,filterAttributeName:n,viewAttribute:{caption:l,name:i}}})()}_getColumnsModel(e,t,r){return this._searchFilterPreprocessorService.getColumnsModelByAttributeName(e,t,r)}_getDisplayValueForViewAttributeName(e,t,r){const i=e.getBoundDataSchemaByAttributePath(t);return i?`${i.name}${(0,gr.isNotEmpty)(r)?" | "+r:""}`:r}_setSearchFilterConfigIntoView(e,t,r){e.columnsGroupsConfig={showAllOption:r,columnsGroups:t.map(i=>({group:i.viewAttribute,columns:i.columnsModel.columns})),primaryColumnName:t.slice().shift()?.columnsModel.primaryDisplayName}}crtOnMetaDataInit(e){const t=e;return this._getSearchFilterViewConfigs(t).forEach(i=>{this._setDisabledAttribute(t,i),this._setTooltipAttribute(i),this._setSearchValueAttribute(t,i),this._setSearchFilteredColumnAttribute(t,i),this._setFilterAttribute(t,i),this._setSearchMinifySearchAttribute(t,i),this._setSearchFilteredColumnsGroupsAttribute(t,i)}),Promise.resolve(e)}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=r,n=i._getSearchFilterViewConfigs(a);for(const l of n)yield i._setSearchFilterColumnsGroupsRequest(a,o,l);return e})()}}Ve.\u0275fac=function(e){return new(e||Ve)(s.\u0275\u0275inject(A.FeatureService),s.\u0275\u0275inject(J),s.\u0275\u0275inject(f.SearchFilterQueryAnalyzerService),s.\u0275\u0275inject(M.TranslateService))},Ve.\u0275prov=s.\u0275\u0275defineInjectable({token:Ve,factory:Ve.\u0275fac});class $t{constructor(e){this._exposeAttributeConverterMetadataGenerator=e}_getSelectionElementViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>Boolean(t?._selectionOptions),e).map(t=>t.viewConfig)}_generateSelectionAttributes(e){const t=e._selectionOptions.attribute;if(typeof t=="string")return{};const{from:r,expose:i}=t??{};if((0,b.isEmpty)(r)||(0,b.isEmpty)(i))return{};const a=i.attribute;if(!a)return{};const o=this._exposeAttributeConverterMetadataGenerator.generate(i);return o?{[a]:{from:r,converter:o.converterExpression},...o.converterArgsAttributes}:{[a]:{from:r}}}crtOnMetaDataInit(e){const t=e;return this._getSelectionElementViewConfigs(t.viewConfig).map(r=>this._generateSelectionAttributes(r)).forEach(r=>{t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},...r}}),Promise.resolve(e)}}$t.\u0275fac=function(e){return new(e||$t)(s.\u0275\u0275inject(I.ExposeAttributeConverterMetadataGenerator))},$t.\u0275prov=s.\u0275\u0275defineInjectable({token:$t,factory:$t.\u0275fac});class we{}we.\u0275fac=function(e){return new(e||we)},we.\u0275mod=s.\u0275\u0275defineNgModule({type:we}),we.\u0275inj=s.\u0275\u0275defineInjector({providers:[I.ExposeAttributeConverterMetadataGenerator,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:$t,multi:!0}]});class Bt extends Ht{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var r=this;return(0,u.Z)(function*(){const i=e.items.slice(1),a=t.getBoundDataSchemaByAttributePath(i)?.name;if(a!=="SimilarLead")return;const o=t.getBoundDataSourceNameByAttributePath(i),n=yield r.hasEntityEditPage(t,a),l=`$${i}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:r._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:n,disabled:l,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${o}_Id`},useRelativeContext:!0}}]})()}}Bt.\u0275fac=function(e){return new(e||Bt)(s.\u0275\u0275inject(M.TranslateService))},Bt.\u0275prov=s.\u0275\u0275defineInjectable({token:Bt,factory:Bt.\u0275fac});class $e extends T.AbstractHandler{constructor(e){super(),this._profileAttributeService=e}handle(e){const{metadata:t,viewConfig:r}=e??{};return!t||!r?.name?super.handle(e):typeof r.expanded=="boolean"?super.handle(e):(this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(t,r,"expanded",(0,f.createSummariesExpandedAttributeName)(r)),super.handle(e))}}$e.\u0275fac=function(e){return new(e||$e)(s.\u0275\u0275inject(f.ProfileAttributeService))},$e.\u0275prov=s.\u0275\u0275defineInjectable({token:$e,factory:$e.\u0275fac});const Lr={type:"crt.MenuDivider"},xr="CanCreateDefaultSummariesSettings";class Be extends T.AbstractHandler{constructor(e,t,r,i){super(),this._translateService=e,this._summaryItemMetaSettingsCreator=t,this._quickSummaryItemCreationActionsProvider=r,this._rightsService=i}_getDataSourceInfo(e,t,r){return g.DataSourceInfo.getFromViewModelConfig(e.viewModelConfig,t).get(r)}_createQuickSummaryItemMenuItems(e,t,r){return t?.length?t.map(i=>this._createQuickSummaryItemMenuItem(e,i,r)).filter(Boolean):[]}_createQuickSummaryItemMenuItem(e,t,r){return t?.actions?.length?this._createQuickSummaryItemMenuSubMenuItem(e,t,r):this._createQuickSummaryItemMenuActionItem(e,t,r)}_createQuickSummaryItemMenuSubMenuItem(e,t,r){const{name:i,icon:a,caption:o,actions:n}=t;return{type:"crt.MenuItem",name:`${e}_Create_${i}`,icon:a,caption:o,items:this._createQuickSummaryItemMenuItems(e,n,r)}}_createQuickSummaryItemMenuActionItem(e,t,r){const{name:i,icon:a,caption:o,summaryItemOptions:{label:n,expression:l}={}}=t,d=this._summaryItemMetaSettingsCreator.create({label:n,valueExpression:l,modelName:r});return{type:"crt.MenuItem",name:`${e}_Create_${i}`,icon:a,caption:o,clicked:{request:"crt.CreateSummaryItemRequest",params:{resources:d?.resources,summariesName:e,summaryItemViewConfig:d?.viewConfig}}}}_createQuickSummaryItemMenuItemsSection(e){var t=this;return(0,u.Z)(function*(){const{metadata:r,models:i,viewConfig:a}=e,o=a?.name,n=a?._designOptions?.modelName;if(!r||!n||!o)return[];const l=i?.find(v=>v.name===n),d=t._getDataSourceInfo(r,i,n);if(!l||!d)return[];const p=yield(0,h.lastValueFrom)(l.getSchema()),_=t._quickSummaryItemCreationActionsProvider.getActionsGroups(p,d),S=_?.flat()?.length,C=_.map(v=>t._createQuickSummaryItemMenuItems(o,v,n)).filter(v=>v?.length).map((v,P,qt)=>P===qt.length-1?v:[...v,Lr]).flat();return S?[{type:"crt.MenuLabel",caption:t._translateService.instant("Summaries.QuickSummaries.QuickSetup")},...C,{type:"crt.MenuDivider"}]:[]})()}_createAdvancedSetupActions(e){const{name:t}=e;return[{type:"crt.MenuLabel",caption:this._translateService.instant("Summaries.AdvancedSetup.Title")},{type:"crt.MenuItem",name:`${t}_AddCustomSummary`,icon:"add-button-icon",caption:this._translateService.instant("Summaries.AdvancedSetup.Actions.AddCustomSummary"),clicked:{request:"crt.AddSummaryItemRequest",params:{summariesName:t}}},{type:"crt.MenuDivider"}]}_getProfileActions(e){var t=this;return(0,u.Z)(function*(){if(!e)return[];const r=[{type:"crt.MenuItem",caption:t._translateService.instant("Summaries.ProfileActions.ResetToDefault"),icon:"reset-summaries",clicked:{request:"crt.ResetSummariesRequest",params:{summariesName:e}}}];return(yield t._rightsService.getCanExecuteOperation(xr))&&r.unshift({type:"crt.MenuItem",caption:t._translateService.instant("Summaries.ProfileActions.SaveForAll"),icon:"save",clicked:{request:"crt.SaveSummariesForAllRequest",params:{summariesName:e}}}),r})()}handle(e){var t=()=>super.handle,r=this;return(0,u.Z)(function*(){const i=e.viewConfig;if(!i?.name||i.actions||i.readonly===!0)return t().call(r,e);const a=yield r._getProfileActions(i.name),o=yield r._createQuickSummaryItemMenuItemsSection(e),n=r._createAdvancedSetupActions(i);return i.actions=[...o,...n,...a],t().call(r,e)})()}}Be.\u0275fac=function(e){return new(e||Be)(s.\u0275\u0275inject(M.TranslateService),s.\u0275\u0275inject(f.SummaryItemMetaSettingsCreator),s.\u0275\u0275inject(f.QuickSummaryItemCreationActionsProvider),s.\u0275\u0275inject(A.RightsService))},Be.\u0275prov=s.\u0275\u0275defineInjectable({token:Be,factory:Be.\u0275fac});class Le extends T.AbstractHandler{constructor(e){super(),this._translateService=e}handle(e){const t=e?.viewConfig;return t?Boolean(t._designOptions?.modelName)?super.handle(e):(typeof t.title=="string"||(t.title=this._translateService.instant("Summaries.Hints.NoDataSource")),typeof t.disabled=="boolean"||(0,I.isBindingExpression)(t.disabled)||(t.disabled=!0),super.handle(e)):super.handle(e)}}Le.\u0275fac=function(e){return new(e||Le)(s.\u0275\u0275inject(M.TranslateService))},Le.\u0275prov=s.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac});class xe extends T.AbstractHandler{constructor(e,t){super(),this._featureValues=e,this._licenseOperationValues=t}handle(e){const t=e?.viewConfig,r=this._licenseOperationValues[f.CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE];return this._featureValues.DisableSummariesRestrictionsPreprocessing||r||!t?super.handle(e):(t.readonly=!0,super.handle(e))}}xe.\u0275fac=function(e){return new(e||xe)(s.\u0275\u0275inject(m.FEATURE_VALUES),s.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))},xe.\u0275prov=s.\u0275\u0275defineInjectable({token:xe,factory:xe.\u0275fac});class Ge extends T.AbstractHandler{constructor(e){super(),this._translateService=e}handle(e){const t=e?.viewConfig;return!t?.name||t.actions||t.readonly===!0?super.handle(e):(t.actions=[{type:"crt.MenuItem",name:`${t.name}_DeleteAction`,caption:this._translateService.instant("SummaryItem.Actions.Delete"),icon:"delete-button-icon",clicked:{request:"crt.RemoveViewElementRequest",params:{name:t.name}}}],super.handle(e))}}Ge.\u0275fac=function(e){return new(e||Ge)(s.\u0275\u0275inject(M.TranslateService))},Ge.\u0275prov=s.\u0275\u0275defineInjectable({token:Ge,factory:Ge.\u0275fac});const _r=new s.InjectionToken("Represents a handler to process summaries metadata on metadata init"),hr=new s.InjectionToken("Represents a handler to process summaries metadata on model init"),Ar=new s.InjectionToken("Represents a handler to process summary item metadata on metadata init"),br=new s.InjectionToken("Represents a factory for creating summary item value format");class ke extends T.AbstractHandler{constructor(e){super(),this._valueFormatFactory=e}_isValidValueOptions(e){return Boolean(e&&e.attribute&&e.modelName&&e.expression&&e.expression.function&&e.expression.columns)}handle(e){const{metadata:t,viewConfig:r}=e??{};if(!t||!r?.name||r.value!==void 0)return super.handle(e);const i=r._designOptions?.value;if(!this._isValidValueOptions(i))return super.handle(e);const{attribute:a,expression:o,modelName:n}=i,l=(0,f.createSummaryItemTargetAttributeName)(r),d=o.resultDataValueType??A.DataValueType.Text,p=`${i.attribute}_Format`,_=`${i.attribute}_ExpressionOptions`;return r.value=`$${a}`,t.viewModelConfig??(t.viewModelConfig={}),t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},[a]:{from:"crt.UpdateSummaryItemValueRequest",filter:`crt.ToObjectProp : 'target' | crt.IsTargetSummaryItem : $${l}`,converter:`crt.ToObjectProp : 'target' | crt.SummaryItemTargetToModelName | crt.SummaryItemToExpressionMetadata : $${_} | crt.ExecuteExpression | crt.FormatValue : $${p} | crt.ToEmptyPlaceholder : ${d}`},[p]:{value:this._valueFormatFactory.create(d)},[_]:{value:{...o,resultDataValueType:d}},[l]:{value:{modelName:n,viewElementName:r.name}}},super.handle(e)}}ke.\u0275fac=function(e){return new(e||ke)(s.\u0275\u0275inject(br))},ke.\u0275prov=s.\u0275\u0275defineInjectable({token:ke,factory:ke.\u0275fac});class je extends T.AbstractHandler{constructor(e,t){super(),this._featureValues=e,this._licenseOperationValues=t}handle(e){const t=e?.viewConfig,r=this._licenseOperationValues[f.CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE];return this._featureValues.DisableSummariesRestrictionsPreprocessing||r||!t?super.handle(e):(t.readonly=!0,super.handle(e))}}je.\u0275fac=function(e){return new(e||je)(s.\u0275\u0275inject(m.FEATURE_VALUES),s.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))},je.\u0275prov=s.\u0275\u0275defineInjectable({token:je,factory:je.\u0275fac});class Lt extends cr{constructor(e,t,r){super(),this._summariesOnMetadataInitHandler=e,this._summariesOnModelInitHandler=t,this._summaryItemOnMetadataInitHandler=r}_removeSummaryItemsWithoutParent(e){e.viewConfig=(e?.viewConfig||[]).filter(t=>t.type!=="crt.SummaryItem")}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e;return t._removeSummaryItemsWithoutParent(r),t._summariesOnMetadataInitHandler&&(yield t.processElementsOnMetadataInit("crt.Summaries",t._summariesOnMetadataInitHandler,r)),t._summaryItemOnMetadataInitHandler&&(yield t.processElementsOnMetadataInit("crt.SummaryItem",t._summaryItemOnMetadataInitHandler,r)),Promise.resolve(e)})()}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e;return r._summariesOnModelInitHandler&&(yield r.processElementsOnModelInit("crt.Summaries",r._summariesOnModelInitHandler,i,t)),Promise.resolve(e)})()}}Lt.\u0275fac=function(e){return new(e||Lt)(s.\u0275\u0275inject(_r,8),s.\u0275\u0275inject(hr,8),s.\u0275\u0275inject(Ar,8))},Lt.\u0275prov=s.\u0275\u0275defineInjectable({token:Lt,factory:Lt.\u0275fac});const Gr=T.FactoryProvider.create({token:br,mappings:[{predicate:c=>(0,b.without)(m.NUMERIC_DATA_VALUE_TYPES,A.DataValueType.Money).includes(c),useFactory:c=>({dataType:c,trimTrailingZeros:!0})}],default:{useFactory:c=>({dataType:c})}});class Y{}Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275mod=s.\u0275\u0275defineNgModule({type:Y}),Y.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Lt,multi:!0},{provide:_r,useFactory:c=>{const e=c.get(Le);return e.setNext(c.get($e)).setNext(c.get(xe)),e},deps:[s.Injector]},{provide:hr,useFactory:c=>c.get(Be),deps:[s.Injector]},{provide:Ar,useFactory:c=>{const e=c.get(je);return e.setNext(c.get(ke)).setNext(c.get(Ge)),e},deps:[s.Injector]},$e,Le,Be,Ge,ke,xe,je,Gr],imports:[f.QuickSummaryItemCreationActionsModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Y,{imports:[f.QuickSummaryItemCreationActionsModule]})}();class xt{constructor(e,t){this._featureService=e,this._profileAttributeService=t,this._tabPanelActionsProcessingDisableFeature="DisableTabPanelPreprocessing"}_updateIconPosition(e){if(e.iconPosition)return;const t=!!e.icon;e.iconPosition=t?Fe.IconPositionEnum.LeftIcon:Fe.IconPositionEnum.OnlyText}_updateTabIconSource(e){f.TabItem.updateTabIconSource(e)}_updateTabHint(e){e.hint=e.caption}_getTabContainerHeader(e){const t=this._getTabPanelHeaderItemInputs();return{type:"crt.TabPanelHeader",tabs:e.items?.map(r=>({...Object.fromEntries(t.filter(i=>typeof r[i]<"u").map(i=>[i,r[i]])),type:"crt.TabPanelHeaderItem",name:r.name,titleColor:e.tabTitleColor,selectedTitleColor:e.selectedTabTitleColor,undrelineColor:e.underlineSelectedTabColor,styleType:e.styleType}))}}_getTabContainerBody(e){const t=e.allowToggleClose??!0,r=e.mode==="tab"?!1:t;return{type:"crt.ToggleContainer",preserveContent:e.preserveContent??!0,items:e.items?.map(i=>({...i,type:"crt.ToggleContainerItem",backgroundColor:e.bodyBackgroundColor,isToggleTabHeaderVisible:i.isToggleTabHeaderVisible??!1,allowToggleClose:r})),visibilityStrategyMode:e.visibilityStrategyMode}}_getTabPanelHeaderItemInputs(){return Object.keys(A.ViewElementRegistry.viewElements.get("crt.TabPanelHeaderItem")?.inputs??{})}get isProcessingDisabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(this._tabPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e;if(!(yield t.isProcessingDisabled)){m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabContainer",r.viewConfig).forEach(o=>{t._updateIconPosition(o.viewConfig),t._updateTabIconSource(o.viewConfig),t._updateTabHint(o.viewConfig)});const a=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabPanel",r.viewConfig);for(const o of a){const n=o.viewConfig;yield t._profileAttributeService.prepareAttributeWithFeatureCheck(r,n,"selectedTabIndex","","DisableSaveToProfileSelectedTabIndex");const l=t._getTabContainerBody(n),d=t._getTabContainerHeader(n);if(n.mode==="toggle"){const p={...l,name:n.name,visible:n.visible,selectedTab:n.selectedTab,layoutConfig:n.layoutConfig||{},stretch:n.stretch,classes:n.classes,fitContent:n.fitContent},_=n.isToggleTabHeaderVisible??!0;p.items?.forEach(S=>{S.isToggleTabHeaderVisible=_}),Object.keys(n).forEach(S=>delete n[S]),Object.assign(n,p)}else n.items=[d,l]}}return e})()}}xt.\u0275fac=function(e){return new(e||xt)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(f.ProfileAttributeService))},xt.\u0275prov=s.\u0275\u0275defineInjectable({token:xt,factory:xt.\u0275fac});class kr{constructor(){this._dataSchemaRepository=(0,s.inject)(g.DataSchemaRepositoryService)}setupSelect(e,t){var r=this;return(0,u.Z)(function*(){!r.isCanSetupSelect(e,t)||(yield r.initializeSchemasNames(t),r.isCanRunSetupSelectData(t)&&(yield r.setupDataViewModel(e,t),yield r.setupInputs(t),yield r.setupRequests(t)))})()}isCanSetupSelect(e,t){return!!t.selectSchemaName&&!!t.selectColumnName&&this.isViewModelAttributeExist(e,t.recordId)}isViewModelAttributeExist(e,t){if(!t)return!1;const r=Object.keys(e.viewModelConfig?.attributes||{}),i=this.getAttributeName(t);return r.includes(i)}getAttributeName(e){return(0,I.isBindingExpression)(e)?e.slice(1):e}initializeSchemasNames(e){var t=this;return(0,u.Z)(function*(){yield t.initializeSelectSchemaName(e),yield t.initializeListSchemaName(e)})()}initializeSelectSchemaName(e){}initializeListSchemaName(e){var t=this;return(0,u.Z)(function*(){if(!e.selectColumnName)return;const i=(yield t.getSelectDataSchema(e)).findAttributeByName(e.selectColumnName);e.listSchemaName=i?.referenceSchemaName})()}isCanRunSetupSelectData(e){return!!e.selectSchemaName&&!!e.listSchemaName}setupDataViewModel(e,t){var r=this;return(0,u.Z)(function*(){yield r.createAndAddItemsViewModelAttributeData(e,t),yield r.createAndAddListItemsViewModelAttributeData(e,t)})()}createAndAddItemsViewModelAttributeData(e,t){var r=this;return(0,u.Z)(function*(){yield r.createAndAddItemsViewModelAttribute(e,t),r.createAndAddItemsViewModelSortingAttribute(e,t),r.createAndAddItemsViewModelFilterAttribute(e,t),r.createAndAddItemsViewModelFilterConfigAttribute(e,t)})()}createAndAddItemsViewModelAttribute(e,t){var r=this;return(0,u.Z)(function*(){const i=yield r.getSelectDataSchema(t),a=yield r.getListDataSchema(t),o=r.createItemsAttribute(t,i);r.addItemsAttributeViewModelConfig(o,t,i,a),r.addItemsEmbeddedDataSource(o,t),r.addItemsAttributeToViewModelConfig(e,t,o)})()}createItemsAttribute(e,t){const r=this.getItemsDataSourceName(e),i=this.getItemsFilterAttributeName(e);return(0,b.merge)(this.createCollectionAttribute(r),{modelConfig:{sortingConfig:this.getItemsSortingConfig(e,t),filterAttributes:[{name:i,loadOnChange:!0}]}})}createCollectionAttribute(e){return{isCollection:!0,modelConfig:{path:e}}}getItemsSortingConfig(e,t){return{default:[{columnName:"CreatedOn",direction:"desc"}],attributeName:this.getItemsSortingAttributeName(e)}}addItemsAttributeViewModelConfig(e,t,r,i){const a=this.getItemsDataSourceName(t),o=t.selectColumnName,n=i.primaryAttributeName,l=i.primaryDisplayAttributeName,d=i.primaryColorAttributeName,p={RelationRecordId:{modelConfig:{path:`${a}.${r.primaryAttributeName}`}},[n]:{modelConfig:{path:`${a}.${o}.${n}`}},[l]:{modelConfig:{path:`${a}.${o}.${l}`}}};d&&(p[d]={modelConfig:{path:`${a}.${o}.${d}`}}),e.viewModelConfig={attributes:p}}addItemsEmbeddedDataSource(e,t){const r=this.getItemsDataSourceName(t),i=t.selectSchemaName;e.embeddedModel=this.createEmbeddedDataSource(r,i)}createEmbeddedDataSource(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t},hiddenInPageDesigner:!1}}}addItemsAttributeToViewModelConfig(e,t,r){this.addViewModelConfigAttribute(e,this.getItemsAttributeName(t),r)}addViewModelConfigAttribute(e,t,r){!e?.viewModelConfig?.attributes||e.viewModelConfig.attributes[t]||(e.viewModelConfig.attributes[t]=r)}createAndAddItemsViewModelSortingAttribute(e,t){const r=this.createSortingAttributeConfig(),i=this.getItemsSortingAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createAndAddItemsViewModelFilterAttribute(e,t){const r=this.createItemsViewModelFilterAttribute(t),i=this.getItemsFilterAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createItemsViewModelFilterAttribute(e){const t=this.getAttributeName(e.recordId),r=this.getItemsFilterConfigAttributeName(e);return{from:t,converter:`crt.BaseSelectFilterAttributeConverter: $${r}`}}createAndAddItemsViewModelFilterConfigAttribute(e,t){const r={value:{selectSchemaName:t.selectSchemaName,selectColumnName:t.selectColumnName,recordRelationColumnName:t.recordRelationColumnName}},i=this.getItemsFilterConfigAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createAndAddListItemsViewModelAttributeData(e,t){var r=this;return(0,u.Z)(function*(){yield r.createAndAddListItemsViewModelAttribute(e,t),r.createAndAddListItemsViewModelSortingAttribute(e,t),r.createAndAddListItemsViewModelFilterAttribute(e,t)})()}createAndAddListItemsViewModelAttribute(e,t){var r=this;return(0,u.Z)(function*(){const i=yield r.getListDataSchema(t),a=r.createListItemsAttribute(t,i);r.addListItemsAttributeViewModelConfig(a,t,i),r.addListItemsEmbeddedDataSource(a,t),r.addListItemsAttributeToViewModelConfig(e,t,a)})()}getSelectDataSchema(e){const t=e.selectSchemaName;return this.getDataSchema(t)}getListDataSchema(e){const t=e.listSchemaName;return this.getDataSchema(t)}getDataSchema(e){return(0,h.lastValueFrom)(this._dataSchemaRepository.get(e))}createListItemsAttribute(e,t){const r=this.getListItemsDataSourceName(e),i=this.getListItemsFilterAttributeName(e),a={sortingConfig:this.getListItemsSortingConfig(e,t),filterAttributes:[{name:i,loadOnChange:!0}],pagingConfig:{rowCount:30}};return(0,b.merge)(this.createCollectionAttribute(r),{isLookup:!0,modelConfig:a})}getListItemsSortingConfig(e,t){return{default:[this.getDefaultSortingColumn(t)],attributeName:this.getListItemsSortingAttributeName(e)}}getDefaultSortingColumn(e){return{columnName:e.primaryDisplayAttributeName,direction:"asc"}}addListItemsAttributeViewModelConfig(e,t,r){const i=this.getListItemsDataSourceName(t),a={value:{modelConfig:{path:`${i}.${r.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${i}.${r.primaryDisplayAttributeName}`}}};r.primaryColorAttributeName&&(a.primaryColorValue={modelConfig:{path:`${i}.${r.primaryColorAttributeName}`}}),e.viewModelConfig={attributes:a}}addListItemsEmbeddedDataSource(e,t){const r=this.getListItemsDataSourceName(t),i=t.listSchemaName;e.embeddedModel=this.createEmbeddedDataSource(r,i)}addListItemsAttributeToViewModelConfig(e,t,r){this.addViewModelConfigAttribute(e,this.getListItemsAttributeName(t),r)}createAndAddListItemsViewModelSortingAttribute(e,t){const r=this.createSortingAttributeConfig(),i=this.getListItemsSortingAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createSortingAttributeConfig(){return{isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}createAndAddListItemsViewModelFilterAttribute(e,t){const r=this.createListItemsViewModelFilterAttribute(t),i=this.getListItemsFilterAttributeName(t);this.addViewModelConfigAttribute(e,i,r)}createListItemsViewModelFilterAttribute(e){return{value:null}}setupInputs(e){this.setItemsAttributeValue(e),this.setListItemsAttributeValue(e)}setItemsAttributeValue(e){if(e.items)return;const t=this.getItemsAttributeName(e);e.items=`$${t}`}setListItemsAttributeValue(e){if(e.listItems)return;const t=this.getListItemsAttributeName(e);e.listItems=`$${t}`}setupRequests(e){this.setShowListRequest(e),this.setPaginationChangeRequest(e)}setShowListRequest(e){if(e.showList)return;const t=this.getListItemsDataSourceName(e),r=this.createLoadDataRequestConfig(t);r.params={...r.params,config:{loadType:A.DataSourceLoadType.Reload}},e.showList=r}setPaginationChangeRequest(e){if(e.paginationChange)return;const t=this.getListItemsDataSourceName(e);e.paginationChange=this.createLoadDataRequestConfig(t)}createLoadDataRequestConfig(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,primaryDisplayFilterValue:"@event.primaryDisplayFilterValue",parameters:[]},useRelativeContext:!0}}getItemsAttributeName(e){return`${e.name}_Items`}getItemsSortingAttributeName(e){return`${this.getItemsAttributeName(e)}_Sorting`}getItemsFilterAttributeName(e){return`${this.getItemsAttributeName(e)}_Filter`}getItemsFilterConfigAttributeName(e){return`${this.getItemsAttributeName(e)}_Filter_Config`}getItemsDataSourceName(e){return`${this.getItemsAttributeName(e)}_DS`}getListItemsAttributeName(e){return`${e.name}_List_Items`}getListItemsSortingAttributeName(e){return`${this.getListItemsAttributeName(e)}_Sorting`}getListItemsFilterAttributeName(e){return`${this.getListItemsAttributeName(e)}_Filter`}getListItemsDataSourceName(e){return`${this.getListItemsAttributeName(e)}_DS`}}class qe extends kr{constructor(){super(...arguments),this._userInfo=(0,s.inject)(m.UserInfo),this._tagRightsService=(0,s.inject)(f.TagRightsService),this._allowedTagAccessesForTaggingIds=[]}_getTagSelectViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TagSelect",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_prepareDataForTagSelects(e){var t=this;return(0,u.Z)(function*(){let r=!1;e.forEach(i=>(0,f.isOldStructure)(i)?null:r=!0),r&&(yield t._prepareAllowedTagAccessesForTagging())})()}_processTagSelect(e,t,r){var i=this;return(0,u.Z)(function*(){if(!i._isRecordIdViewModelAttributeExist(e,t)){i._setTagSelectDisabled(t);return}yield i._setTagSelectRecordSchemaName(e,t,r),i._setTagSelectDisabledAttribute(e,t),yield i.setupSelect(e,t)})()}_setTagSelectDisabledAttribute(e,t){if(!this._isTagSelectDisabledAttributeFilled(t)){if(!this._isTagSelectRecordSchemaNameFilled(t)){this._setTagSelectDisabled(t);return}this._createAndAddTagSelectViewModelDisabledAttribute(e,t),t.disabled=`$${this._getTagSelectDisabledAttributeName(t)}`}}_setTagSelectDisabled(e){e.disabled=!0}_isTagSelectDisabledAttributeFilled(e){return"disabled"in e}_createAndAddTagSelectViewModelDisabledAttribute(e,t){const r=this.getAttributeName(t.recordId),i={from:r,converter:`crt.TagSelectDisabledAttributeConverter: '${r}'`},a=this._getTagSelectDisabledAttributeName(t);this.addViewModelConfigAttribute(e,a,i)}_isRecordIdViewModelAttributeExist(e,t){return this.isViewModelAttributeExist(e,t.recordId)}_setCreateTagRequest(e){var t=this;return(0,u.Z)(function*(){if(e.createTag)return;const r=yield t.getListDataSchema(e),i=t.getListItemsAttributeName(e);e.createTag=(0,f.isOldStructure)(e)?t._getCreateTagRequestForOldtructure(e,r):t._getCreateTagRequestForNewStructure(e,r,i)})()}_getCreateTagRequestForOldtructure(e,t){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:A.ModelInPageAction.Add,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"}]}}}_getCreateTagRequestForNewStructure(e,t,r){return{request:"crt.CreateRecordRequest",params:{itemsAttributeName:r,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"},{attributeName:f.TAG_ENTITY_SCHEMA_NAME_PAGE_ATTRIBUTE_NAME,value:e.recordSchemaName}],skipUnsavedData:!0}}}_setEditTagRequest(e){e.editTag||(e.editTag=(0,f.isOldStructure)(e)?this._getEditTagRequestForOldStructure(e):this._getEditTagRequestForNewStructure(e))}_getEditTagRequestForOldStructure(e){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:A.ModelInPageAction.Edit,recordId:"@event.id"}}}_getEditTagRequestForNewStructure(e){return{request:"crt.UpdateRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e),trackUnsavedData:!1}}}_setDeleteTagRequest(e){e.deleteTag||(e.deleteTag={request:(0,f.isOldStructure)(e)?"crt.DeleteOldTagRecordRequest":"crt.DeleteRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e)}})}_setAddTagsInRecordRequest(e){if(e.addTagsInRecord)return;const t=this.getItemsDataSourceName(e);e.addTagsInRecord={request:"crt.AddTagsInRecordRequest",params:{dataSourceName:t,tagIds:"@event.tagIds",recordId:e.recordId,recordSchemaName:e.recordSchemaName,tagInRecordSourceSchemaName:e.tagInRecordSourceSchemaName}}}_setDeleteTagInRecordRequest(e){if(e.deleteTagInRecord)return;const t=this.getItemsDataSourceName(e);e.deleteTagInRecord={request:"crt.DeleteTagInRecordRequest",params:{dataSourceName:t,id:"@event.id"}}}_setTagSelectRecordSchemaName(e,t,r){var i=this;return(0,u.Z)(function*(){if(i._isTagSelectRecordSchemaNameFilled(t))return;const a=yield i._getRecordSchemaName(e,t,r);!a||(t.recordSchemaName=a)})()}_isTagSelectRecordSchemaNameFilled(e){return!!e.recordSchemaName}_getRecordSchemaName(e,t,r){if(!e?.viewModelConfig?.attributes||!r?.length)return Promise.resolve(null);const[i,a]=this._getRecordIdAttributeModelPaths(e.viewModelConfig.attributes,t.recordId);return this._getRecordSchemaNameFromModel(i,a,r)}_getRecordIdAttributeModelPaths(e,t){const r=this.getAttributeName(t),o=e[r]?.modelConfig?.path?.split(".");return!o||o.length<2?["",""]:[o[0],o[1]]}_getRecordSchemaNameFromModel(e,t,r){var i=this;return(0,u.Z)(function*(){if(!e||!t)return null;const a=r.find(p=>p.name===e);if(!a)return null;const o=yield(0,h.lastValueFrom)(a.getSchema()),n=o.findAttributeByName(t);if(!n)return null;const l=n.referenceSchemaName??null,d=o.dataSourceConfig?.config?.entitySchemaName;return l||i._getEntitySchemaNameFromDataSchema(d,n)})()}_getEntitySchemaNameFromDataSchema(e,t){if(t.attributeType===A.DataSchemaAttributeType.OwnAttribute)return Promise.resolve(e);const r=t.path.split(".");return this._findEntitySchemaNameByColumnPath(e,r)}_findEntitySchemaNameByColumnPath(e,t){var r=this;return(0,u.Z)(function*(){if(!e)return null;const i=t.shift();if(!i)return e;const o=(yield r.getDataSchema(e)).attributes.find(n=>n.name===i);return o?.referenceSchemaName?r._findEntitySchemaNameByColumnPath(o.referenceSchemaName,t):e})()}_getTagSelectDisabledAttributeName(e){return`${e.name}_Disabled`}_prepareViewConfig(e){e.selectSchemaName=this._getSelectSchemaName(e),e.selectColumnName=f.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA,e.recordRelationColumnName=this._getRecordRelationColumnName(e)}_getSelectSchemaName(e){return(0,f.isOldStructure)(e)?e.tagInRecordSourceSchemaName:f.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME}_getRecordRelationColumnName(e){return(0,f.isOldStructure)(e)?f.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA:f.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA}_prepareAllowedTagAccessesForTagging(){var e=this;return(0,u.Z)(function*(){e._allowedTagAccessesForTaggingIds=yield(0,f.getAllowedTagAccessesForTagging)(e._tagRightsService)})()}setupSelect(e,t){var r=()=>super.setupSelect,i=this;return(0,u.Z)(function*(){!i._isTagSelectRecordSchemaNameFilled(t)||(i._prepareViewConfig(t),yield r().call(i,e,t))})()}setupRequests(e){var t=()=>super.setupRequests,r=this;return(0,u.Z)(function*(){yield t().call(r,e),yield r._setCreateTagRequest(e),r._setEditTagRequest(e),r._setDeleteTagRequest(e),r._setAddTagsInRecordRequest(e),r._setDeleteTagInRecordRequest(e)})()}createItemsViewModelFilterAttribute(e){return{from:this.getAttributeName(e.recordId),converter:`crt.TagSelectFilterAttributeConverter: '${e.recordSchemaName}' : ${(0,f.isOldStructure)(e)}`}}createListItemsViewModelFilterAttribute(e){return{value:(0,f.isOldStructure)(e)?(0,f.createOldTagListFilter)(this._userInfo):(0,f.createTagListFilter)([e.recordSchemaName],this._allowedTagAccessesForTaggingIds)}}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e,a=r._getTagSelectViewConfigs(i);return yield r._prepareDataForTagSelects(a),yield Promise.all(a.map(o=>r._processTagSelect(i,o,t))),e})()}}qe.\u0275fac=function(){let c;return function(t){return(c||(c=s.\u0275\u0275getInheritedFactory(qe)))(t||qe)}}(),qe.\u0275prov=s.\u0275\u0275defineInjectable({token:qe,factory:qe.\u0275fac});class Gt{constructor(e,t){this._quickFilterPreprocessorService=e,this._translateService=t}_getTimelineViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Timeline",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getFilterByOwnerConfig(e){const t={caption:this._translateService.instant("Timeline.OwnerFilterCaption"),hint:this._translateService.instant("Timeline.OwnerFilterHint"),icon:"person-button-icon",iconPosition:"left-icon",entitySchemaName:"Contact"};return{filterType:"lookup",name:"ByOwnerQuickFilterIn"+e,type:"crt.QuickFilter",config:t}}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){const r=e,i=t._getTimelineViewConfigs(r);return yield Promise.all(i.map(function(){var a=(0,u.Z)(function*(o){const n=t._getFilterByOwnerConfig(o.name);yield t._quickFilterPreprocessorService.crtOnMetaDataInit(n,e),o.quickFilterByOwnerConfig=n});return function(o){return a.apply(this,arguments)}}())),Promise.resolve(e)})()}}Gt.\u0275fac=function(e){return new(e||Gt)(s.\u0275\u0275inject(L),s.\u0275\u0275inject(M.TranslateService))},Gt.\u0275prov=s.\u0275\u0275defineInjectable({token:Gt,factory:Gt.\u0275fac});class kt{_modifyInputType(e,t,r){const i=e.control.replace("$",""),a=t.attributes[i]?.modelConfig?.path;if(a){const o=this._getDataSchemaAttributeByPath(a,r);A.DataValueType.WEB_TEXT&&o?.dataValueType===A.DataValueType.WEB_TEXT&&(e.type="crt.WebInput")}}_getDataSchemaAttributeByPath(e,t){const[r,i]=e.split("."),a=t.dataSchemas[r]?.attributes;let o;for(const n in a)if(a[n].path===i){o=a[n];break}return o}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),n=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.WebInput",a.viewConfig);return o.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),n.forEach(l=>{i._modifyInputType(l.viewConfig,a.viewModelConfig,r)}),e})()}}kt.\u0275fac=function(e){return new(e||kt)},kt.\u0275prov=s.\u0275\u0275defineInjectable({token:kt,factory:kt.\u0275fac});var F=D(78094);const jr={type:"string",maxLinesCount:2,maxLineLength:10},qr={type:"number",thousandAbbreviation:{enabled:!0}},Sr="DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION";class Ue{constructor(e,t,r){this._entitySchemaService=t,this._entitySchemaProvider=r,this._isAdaptionDisabled=Boolean(e[Sr])}_getWidgetViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.ChartWidget"],e).map(t=>t?.viewConfig)}_adaptAxesFormatting(e){var t=this;return(0,u.Z)(function*(){const{scales:r,series:i}=e?.config??{},a=r?.xAxis??{};!t._isDefaultXAxisFormat(a)||!(yield t._isAllSeriesGroupingByNumericColumn(i))||(a.formatting=qr)})()}_isDefaultXAxisFormat(e){return(0,b.isEqual)(e?.formatting,jr)}_isAllSeriesGroupingByNumericColumn(e){var t=this;return(0,u.Z)(function*(){if(!e?.length)return!1;for(const r of e)if(!(yield t._isSeriesGroupingByNumericColumn(r)))return!1;return!0})()}_isSeriesGroupingByNumericColumn(e){var t=this;return(0,u.Z)(function*(){const{schemaName:r,grouping:i}=e?.data?.providing??{};if(i?.type!==F.ChartGroupingType.ByValue)return!1;const a=i.column?.expression?.columnPath;if(!r||!a)return!1;const o=yield(0,h.firstValueFrom)(t._entitySchemaProvider.getSchemaByName(r)),n=yield(0,h.firstValueFrom)(t._entitySchemaService.getEntitySchemaColumnsInformationByPath(o.uId,a));return m.NUMERIC_DATA_VALUE_TYPES.includes(n?.dataValueType)})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(t._isAdaptionDisabled)return e;const r=e,i=t._getWidgetViewConfigs(r.viewConfig).map(a=>t._adaptAxesFormatting(a));return yield Promise.all(i),e})()}}Ue.\u0275fac=function(e){return new(e||Ue)(s.\u0275\u0275inject(m.FEATURE_VALUES),s.\u0275\u0275inject(m.EntitySchemaService),s.\u0275\u0275inject(m.EntitySchemaProvider))},Ue.\u0275prov=s.\u0275\u0275defineInjectable({token:Ue,factory:Ue.\u0275fac});const er=new s.InjectionToken("Represents a factory of widget data providing metadata compressors"),Cr=new s.InjectionToken("Represents a list of widget element types that support data source");class We{constructor(e,t,r){this._featureService=e,this._widgetDataProvidingMetadataCompressorFactory=r,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(F.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,O.first)(),(0,O.map)(Boolean),(0,O.map)(t=>!t));return(0,h.lastValueFrom)(e)}_getWidgetViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>Boolean(t?.name)&&Boolean(t?.config))}_compressWidgetDataProvidingMetadata(e,t){this._widgetDataProvidingMetadataCompressorFactory.create(e.type)?.compress(e.name,t)}crtOnMetaDataChanged(e){var t=this;return(0,u.Z)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const r=e;return t._getWidgetViewConfigs(r.viewConfig).forEach(i=>t._compressWidgetDataProvidingMetadata(i,r)),e})()}}We.\u0275fac=function(e){return new(e||We)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(Cr,8),s.\u0275\u0275inject(er))},We.\u0275prov=s.\u0275\u0275defineInjectable({token:We,factory:We.\u0275fac});function Ur(){return T.FactoryProvider.create({token:er,mappings:[{predicate:F.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:F.ChartWidgetDataProvidingMetadataCompressor},{predicate:F.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:F.IndicatorWidgetDataProvidingMetadataCompressor},{predicate:F.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:F.IndicatorWidgetDataProvidingMetadataCompressor}]})}class x{static for(...e){return{ngModule:x,providers:[{provide:g.CRT_METADATA_POSTPROCESSOR,useFactory:(t,r)=>new We(t,e,r),deps:[y.FeatureService,er],multi:!0}]}}}x.\u0275fac=function(e){return new(e||x)},x.\u0275mod=s.\u0275\u0275defineNgModule({type:x}),x.\u0275inj=s.\u0275\u0275defineInjector({providers:[Ur()],imports:[F.ChartWidgetDataProvidingMetadataCompressorModule,F.IndicatorWidgetDataProvidingMetadataCompressorModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(x,{imports:[F.ChartWidgetDataProvidingMetadataCompressorModule,F.IndicatorWidgetDataProvidingMetadataCompressorModule]})}();const tr=new s.InjectionToken("Represents a factory of widget data providing metadata generators");class He{constructor(e,t,r){this._featureService=e,this._widgetDataProvidingMetadataGeneratorFactory=r,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(F.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,O.first)(),(0,O.map)(Boolean),(0,O.map)(t=>!t));return(0,h.lastValueFrom)(e)}_getWidgetViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>Boolean(t?.name)&&Boolean(t?.config))}_generateWidgetDataProvidingMetadata(e,t){return this._widgetDataProvidingMetadataGeneratorFactory.create(e.type).generate(e,t)}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const r=e;return t._getWidgetViewConfigs(r.viewConfig).map(i=>t._generateWidgetDataProvidingMetadata(i,r)).forEach(i=>(0,b.defaultsDeep)(r,i)),e})()}}He.\u0275fac=function(e){return new(e||He)(s.\u0275\u0275inject(y.FeatureService),s.\u0275\u0275inject(Cr,8),s.\u0275\u0275inject(tr))},He.\u0275prov=s.\u0275\u0275defineInjectable({token:He,factory:He.\u0275fac});function Wr(){return T.FactoryProvider.create({token:tr,mappings:[{predicate:F.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:F.ChartWidgetDataProvidingMetadataGenerator},{predicate:F.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:F.IndicatorWidgetDataProvidingMetadataGenerator},{predicate:F.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:F.IndicatorWidgetDataProvidingMetadataGenerator}]})}class w{static for(...e){return{ngModule:w,providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useFactory:(t,r)=>new He(t,e,r),deps:[y.FeatureService,tr],multi:!0}]}}}w.\u0275fac=function(e){return new(e||w)},w.\u0275mod=s.\u0275\u0275defineNgModule({type:w}),w.\u0275inj=s.\u0275\u0275defineInjector({providers:[Wr()],imports:[F.ChartWidgetDataProvidingMetadataGeneratorModule,F.IndicatorWidgetDataProvidingMetadataGeneratorModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(w,{imports:[F.ChartWidgetDataProvidingMetadataGeneratorModule,F.IndicatorWidgetDataProvidingMetadataGeneratorModule]})}();class Ze{constructor(e){this._featureService=e,this._chartWidgetName="crt.ChartWidget",this._indicatorWidgetName="crt.IndicatorWidget",this._gaugeWidgetName="crt.GaugeWidget"}_getWidgetsArray(e){const t=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._chartWidgetName,e.viewConfig),r=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._indicatorWidgetName,e.viewConfig),i=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._gaugeWidgetName,e.viewConfig);return[...t,...r,...i]}_getWidgetName(e){return e.name.replace(/\./g,"_")}_getDataSetSortinAttributeName(e){return`${e.split(" ").join("").replace(/\./g,"_")}_ListDataDSSorting`}get _isDrillDownFeatureEnabled(){return(0,h.lastValueFrom)(this._featureService.getFeatureState(F.CHART_WIDGET_DRILLDOWN_FEATURE_NAME))}crtOnModelInit(e,t){var r=this;return(0,u.Z)(function*(){const i=e,a=r._getWidgetsArray(i);for(const o of a){const n=o?.viewConfig;let l=i.viewModelConfig.attributes;l||(l=i.viewModelConfig.attributes={});const d=r._getWidgetName(n),p=`${g.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,_=r._getDataSetSortinAttributeName(p),S=`${p}_ListConfig`,C=`${p}_ListData`,v=`${C}_SearchValue`,P=`${C}_SearchFilter`;l[S]={value:[]},l[`${p}_UserProfileData`]={value:[]},l[C]={isCollection:!0,modelConfig:{path:`${p}_ListDataDS`,sortingConfig:{attributeName:_},filterAttributes:[{name:P,loadOnChange:!0}]},viewModelConfig:{attributes:{}}},_&&(l[_]={value:[]}),l[v]={value:""},l[P]={from:v,converter:`crt.WidgetSearchFilterAttributeConverter: '${C}' : '${S}'`}}return e})()}crtOnViewModelInit(e,t,r){var i=this;return(0,u.Z)(function*(){const a=e,o=i._getWidgetsArray(a);for(const n of o){const l=n?.viewConfig,d=i._getWidgetName(l),p=`${g.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,_=`${p}_ListDataDS`,S=`${p}_ListConfig`,C=`${p}_ListData`,v=`${p}_UserProfileData`,P=`${C}_SearchValue`;l.listData=`$${C}`,l.listConfig=`$${S}`,l.userProfileData=`$${v}`,l.searchValue=`$${P}`,l.drillDown={request:"crt.WidgetDrilldownRequest",params:{dataSourceName:_,listConfigAttributeName:S,listDataAttributeName:C,parameters:[],config:{schemaName:"@event.schemaName",groupByValue:"@event.groupByValue",pagingConfig:"@event.pagingConfig",sortingConfig:"@event.sortingConfig",groupBy:"@event.groupBy",aggregateBy:"@event.aggregateBy",columns:"@event.columns",filters:"@event.filters",dependencies:"@event.dependencies"}}},l.paginationChange=zt(_),l.getProfileColumns={request:"crt.AnalyticsDataGridGetColumnsRequest",params:{userProfileDataAttributeName:v,widgetAttributePrefix:p,drilldownConfig:"@event.drilldownConfig",schemaName:"@event.schemaName",isDefault:!1}},l.columnsChange={request:"crt.AnalyticsDataGridSaveToProfileRequest",params:{schemaName:"@event.schemaName",isDefault:!1,dataTableData:"@event.dataTableData",listConfigAttributeName:S}},l.searchFilterChange={request:"crt.SearchFilterRequest",params:{value:"@event.value",searchValueAttributeName:P}}}return e})()}crtOnMetaDataInit(e){var t=this;return(0,u.Z)(function*(){var r;if(!(yield t._isDrillDownFeatureEnabled))return e;const i=e,a=t._getWidgetsArray(i);for(const o of a)!o.viewConfig||o.viewConfig?.pagingConfig||(o.viewConfig.pagingConfig=Jt(),(r=o.viewConfig).fullScreenStateChanged??(r.fullScreenStateChanged={request:"crt.WidgetFullScreenStateChangesRequest",params:{widgetName:o.viewConfig.name,fullScreenState:"@event"}}));return e})()}}Ze.\u0275fac=function(e){return new(e||Ze)(s.\u0275\u0275inject(y.FeatureService))},Ze.\u0275prov=s.\u0275\u0275defineInjectable({token:Ze,factory:Ze.\u0275fac});class G{}G.\u0275fac=function(e){return new(e||G)},G.\u0275mod=s.\u0275\u0275defineNgModule({type:G}),G.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ze,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ue,multi:!0}],imports:[w.for(F.CHART_WIDGET_VIEW_ELEMENT_TYPE,F.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,F.GAUGE_WIDGET_VIEW_ELEMENT_TYPE)]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(G,{imports:[w]})}();const Hr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nema dostupnih izvje\u0161taja","GoToPrintablesSetupCaption":"Idi na postavke izvje\u0161taja"}}'),Zr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u044F\u043C\u0430 \u043D\u0430\u043B\u0438\u0447\u043D\u0438 \u043E\u0442\u0447\u0435\u0442\u0438","GoToPrintablesSetupCaption":"\u041E\u0442\u0438\u0434\u0438 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u043D\u0430 \u043E\u0442\u0447\u0435\u0442\u0430"}}'),Qr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),zr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Jr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Es gibt keine verf\xFCgbaren Berichte","GoToPrintablesSetupCaption":"Zum Berichts-Setup"}}'),Yr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Xr=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"No hay informes disponibles","GoToPrintablesSetupCaption":"Ir a la configuraci\xF3n de reportes"}}'),Kr=JSON.parse(`{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Il n'y a aucun rapport disponible","GoToPrintablesSetupCaption":"Aller \xE0 la configuration du rapport"}}`),ei=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),ti=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nincsenek el\xE9rhet\u0151 jelent\xE9sek","GoToPrintablesSetupCaption":"L\xE9pjen a jelent\xE9s be\xE1ll\xEDt\xE1s\xE1hoz"}}'),ri=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),ii=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Non ci sono report disponibili","GoToPrintablesSetupCaption":"Vai alla configurazione del report"}}'),ai=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u5229\u7528\u53EF\u80FD\u306A\u30EC\u30DD\u30FC\u30C8\u306F\u3042\u308A\u307E\u305B\u3093","GoToPrintablesSetupCaption":"\u30EC\u30DD\u30FC\u30C8\u306E\u8A2D\u5B9A\u306B\u79FB\u52D5"}}'),oi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uBCF4\uACE0\uC11C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4","GoToPrintablesSetupCaption":"\uBCF4\uACE0\uC11C \uC124\uC815\uC73C\uB85C \uC774\uB3D9"}}'),ni=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),si=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),ci=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),li=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"N\xE3o existem relat\xF3rios dispon\xEDveis","GoToPrintablesSetupCaption":"Ir para as configura\xE7\xF5es de relat\xF3rios"}}'),ui=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),di=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nu exist\u0103 rapoarte disponibile","GoToPrintablesSetupCaption":"Merge\u021Bi la configurarea raportului"}}'),mi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \u043E\u0442\u0447\u0435\u0442\u044B \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0435 \u0434\u043B\u044F \u043F\u0435\u0447\u0430\u0442\u0438","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0435 \u043E\u0442\u0447\u0435\u0442\u043E\u0432"}}'),pi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),fi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),gi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),_i=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),hi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u0435\u043C\u0430\u0454 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0438\u0445 \u0437\u0432\u0456\u0442\u0456\u0432","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0434\u043E \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u0437\u0432\u0456\u0442\u0443"}}'),Ai=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),bi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Si={"hr-HR":Hr,"bg-BG":Zr,"zh-CN":bi,"vi-VN":Ai,"uk-UA":hi,"tr-TR":_i,"th-TH":gi,"sv-SE":fi,"sq-AL":pi,"ro-RO":di,"pt-PT":ui,"pt-BR":li,"pl-PL":ci,"nl-NL":si,"lv-LV":ni,"ko-KR":oi,"ja-JP":ai,"it-IT":ii,"id-ID":ri,"hu-HU":ti,"he-IL":ei,"fr-FR":Kr,"es-ES":Xr,"de-DE":Jr,"cs-CZ":zr,"ar-SA":Qr,"en-US":Yr,"ru-RU":mi};class Qe{}Qe.\u0275fac=function(e){return new(e||Qe)},Qe.\u0275mod=s.\u0275\u0275defineNgModule({type:Qe}),Qe.\u0275inj=s.\u0275\u0275defineInjector({providers:[f.DataGridFilterOptionsBackwardCompatibilityModifier,f.FolderTreeFilterOptionsBackwardCompatibilityModifier,N.DATA_GRID_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,N.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,N.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:B,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:oe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ne,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:le,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ue,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ie,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:se,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ce,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ae,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ft,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Pt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Re,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:pe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:de,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ne,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ie,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:De,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:pt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:mt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ke,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:bt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:xt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ze,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ee,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ge,multi:!0},y.DcmSettingsService,$,Pe,j,f.LookupQuickFilterValueRepositoryService,Q,z,J,L,y.PrintablesService,m.FileDownloaderService,{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Je,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ye,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:lt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:me,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Et,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ct,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Nt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Tt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ot,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:kt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:et,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:_t,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Bt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:X,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:yt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:vt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:dt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ut,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Oe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Gt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Ve,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:At,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:be,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:St,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:qe,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Rt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:gt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Vt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Er,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:Mt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:_e,multi:!0},{provide:y.LICENSE_RESTRICTION_OPERATION_CODES,useValue:lr,multi:!0},{provide:y.LICENSE_RESTRICTION_OPERATION_CODES,useValue:ur,multi:!0},{provide:y.LICENSE_RESTRICTION_OPERATION_CODES,useValue:dr,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ft,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:wt,multi:!0},{provide:g.CRT_METADATA_PREPROCESSOR,useClass:ht,multi:!0}],imports:[Ut.CommonModule,Z,V.withModifiers([["crt.DataGrid",f.DataGridFilterOptionsBackwardCompatibilityModifier]]),V.withModifiers([["crt.FolderTree",f.FolderTreeFilterOptionsBackwardCompatibilityModifier]]),G,ve,U,q,we,k,T.CrtLibTranslateModule.forRoot({i18n:Si}),Y]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Qe,{imports:[Ut.CommonModule,Z,V,V,G,ve,U,q,we,k,T.CrtLibTranslateModule,Y]})}();class jt{_getHeaders(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.HeaderContainer",e.viewConfig)}crtOnModelInit(e,t){const r=e,i=r?.viewModelConfig?.attributes,a=this._getHeaders(r)[0];if(a){const o="HeaderCaption";i[o]={value:""},a.viewConfig.title=`$${o}`,a.viewConfig.styles={"border-top-left-radius":"8px","border-top-right-radius":"8px"},r.tag?.includes("BaseGridSectionTemplate")&&(a.viewConfig.styles["margin-bottom"]="0px")}return Promise.resolve(e)}}jt.\u0275fac=function(e){return new(e||jt)},jt.\u0275prov=s.\u0275\u0275defineInjectable({token:jt,factory:jt.\u0275fac})}}]);
