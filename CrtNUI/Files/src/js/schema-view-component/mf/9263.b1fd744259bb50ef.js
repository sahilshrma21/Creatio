(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[9263,8239,5036,6118,7344,8160,1034,8056,1906,4501,1216,9256,9795,1006,7571,6025,9424,885,7709,3771],{98160:(C,c,o)=>{o.r(c),o.d(c,{CommonDiagramElementFactory:()=>i.Bu,CommonDiagramEventHandlerServerController:()=>i.pW,CommonDiagramEventService:()=>g.e,CommonDiagramLoader:()=>i.OD,CommonElementToolsConfig:()=>i.wK});var i=o(83221),g=o(86841),l=o(29450),d=o.n(l),a={};for(const r in l)["default","CommonDiagramElementFactory","CommonDiagramEventHandlerServerController","CommonDiagramLoader","CommonElementToolsConfig","CommonDiagramEventService"].indexOf(r)<0&&(a[r]=()=>l[r]);o.d(c,a)},83221:(C,c,o)=>{o.d(c,{Bu:()=>l,pW:()=>r,OD:()=>d,wK:()=>u});var i=o(29450),g=o(33177);class l extends i.DiagramElementFactory{generateId(t){return g.IdGenerator.generateUUID()}}class d extends i.DiagramLoader{getConnectionAttributes(t,e){return{...super.getConnectionAttributes(t,e),itemName:e.itemName,order:this.elements.items.connection.order}}}var a=o(74742);let r=class extends i.CommonDiagramEventHandlerController{constructor(t,e,n,s,h,v){super(t,v),this.eventBus=t,this.graphicsFactory=e,this.elementRegistry=n,this.modeling=s,this.selection=h,this.diagramUtils=v}onItemNameChanged({id:t,name:e}){const n=this.elementRegistry.getGraphics(t),s=this.elementRegistry.get(t);s.itemName=e,this.graphicsFactory.update(this.diagramUtils.isConnection(s)?"connection":"shape",s,n)}onElementCaptionChanged({id:t,caption:e}){const n=this.elementRegistry.get(t);if(n){const s=n.caption,h=e&&e.trim();s!==h&&this.modeling.updateLabel(n,e)}}getPasteElementConfig(t){const e=this.getFlowElementConfigFromShape(t);return Object.assign(e,{sourceId:t.sourceId})}findElements(t){const e=[];return t.forEach(n=>{const s=this.elementRegistry.get(n);s&&e.push(s)}),e}getFlowElementConfigFromShape(t){return{itemName:t.itemName,id:t.id,caption:t.caption,parentId:t.parent.id,position:{x:t.rx,y:t.ry}}}addElement(t){const e=t.context,n=e.shape||e.element||e.connection;e.hints.isElementCopyPaste?this.service.pasteElement(this.getPasteElementConfig(n)):super.addElement(t)}subscribeServerDiagramChanges(){const t=this.service;this.eventBus.on([i.Handlers.elements.removing],e=>{const n=e.elements.map(s=>s.id);return t.removing(n)}),this.eventBus.on([i.Handlers.element.doubleClick],e=>{t.elementDoubleClick(e.element.itemName)}),this.eventBus.on(["diagram.item.selected"],e=>{const n=e.id,s=n&&this.elementRegistry.get(n);t.selectionChanged(s&&this.getFlowElementConfigFromShape(s))})}getShape(t){const e=super.getShape(t),n=t.context.shape||t.context.element;return e.type=n.userTaskType||n.type,e}subscribeServerChanges(){this.subscribeServerDiagramChanges();const t=this.service;return[t.elementIsValidChanged$.subscribe(e=>this.eventBus.fire(i.Handlers.element.validation,e)),t.elementNameChanged$.subscribe(({id:e,name:n})=>{this.onItemNameChanged({id:e,name:n})}),t.elementCaptionChanged$.subscribe(({id:e,caption:n})=>{this.onElementCaptionChanged({id:e,caption:n})}),t.elementRemoved$.subscribe(e=>{const n=this.findElements(e);this.modeling.removeElements(n,!0)}),t.elementUpdateType$.subscribe(({id:e,config:n})=>{const s=this.elementRegistry.get(e);this.diagramUtils.isConnection(s)||this.modeling.updateElementType({id:e,config:n,force:!0})}),t.elementSelected$.subscribe(({id:e})=>{const n=this.elementRegistry.get(e);n?this.selection.select(n,!1):this.selection.select([],!1)}),t.elementCenterViewBox$.subscribe(({id:e})=>{const n=this.elementRegistry.get(e);n&&this.modeling.centerViewbox(n)}),t.elementMarkersChanged$.subscribe(({id:e,markers:n})=>{const s=this.elementRegistry.get(e);this.modeling.updateElementMarkers(s,n)})]}};r=(0,a.__decorate)([(0,a.__param)(0,(0,i.Inject)("eventBus")),(0,a.__param)(1,(0,i.Inject)("graphicsFactory")),(0,a.__param)(2,(0,i.Inject)("elementRegistry")),(0,a.__param)(3,(0,i.Inject)("modeling")),(0,a.__param)(4,(0,i.Inject)("selection")),(0,a.__param)(5,(0,i.Inject)("diagramUtils")),(0,a.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],r);class u extends i.DiagramElementToolsConfig{getAddItems(){const t=this.config.customElementToolsConfig?this.config.customElementToolsConfig.addItems||[]:[];return[...super.getAddItems(),...t]}getTools(){const t=this.config.customElementToolsConfig?this.config.customElementToolsConfig.tools||[]:[];return{...super.getTools(),...t}}}},86841:(C,c,o)=>{o.d(c,{e:()=>m});var i=o(8239),g=o(29450),l=o(33177),d=o(97600),a=o(21322),r=o(27049),u=o(94450);class m extends g.BaseDiagramEventService{constructor(e){super(),this.customEventClient=e,this.changeBuffer=[],this.elementNameChanged$=this.customEventClient.subscribe("updateElementName"),this.elementCaptionChanged$=this.customEventClient.subscribe("elementCaptionChanged"),this.elementRemoved$=this.customEventClient.subscribe("elementRemoved"),this.removeCancelled$=this.customEventClient.subscribe("removeCancelled"),this.elementUpdateType$=this.customEventClient.subscribe("elementUpdateType"),this.elementIsValidChanged$=this.customEventClient.subscribe("setIsElementValid"),this.elementSelected$=this.customEventClient.subscribe("elementSelected"),this.elementCenterViewBox$=this.customEventClient.subscribe("elementCenterViewBox"),this.elementMarkersChanged$=this.customEventClient.subscribe("updateElementMarkers"),this.init()}init(){super.init(),this.customEventClient.subscribe("diagramDataLoaded").subscribe(e=>this.endLoading$.next(e))}bufferiseOps(e,n,s){this.changeBuffer.push({commandType:e,path:n,newValues:s})}commit(){var e=this;return(0,i.Z)(function*(){if(e.changeBuffer.length){const n=d.cloneDeep(e.changeBuffer);e.changeBuffer=[],e.customEventClient.createOutboundChannel("diagramChanged").next(n)}})()}getDiagramConfig(){var e=this;return(0,i.Z)(function*(){const n=(0,a.lastValueFrom)(e.customEventClient.subscribe("setDiagramConfig").pipe((0,r.first)()),{defaultValue:null});return e.customEventClient.createOutboundChannel("getDiagramConfig").next({}),n})()}diagramInitialized(){this.customEventClient.createOutboundChannel("diagramInitialized").next({})}removing(e){return this.customEventClient.createOutboundChannel("diagramElementRemoving").next(e),!1}updatingTypeValidate({id:e,config:n}){return this.customEventClient.createOutboundChannel("diagramElementValidateUpdatingType").next({id:e,config:n}),!1}typeUpdated(e){this.customEventClient.createOutboundChannel("diagramElementTypeUpdated").next(e)}selectionChanged(e){this.customEventClient.createOutboundChannel("diagramElementClick").next(e)}elementDoubleClick(e){this.customEventClient.createOutboundChannel("diagramElementDoubleClick").next(e)}pasteElement(e){this.customEventClient.createOutboundChannel("pasteDiagramElement").next(e)}canCopy(e){var n=this;return(0,i.Z)(function*(){const s=(0,a.lastValueFrom)(n.customEventClient.subscribe("setCanCopy").pipe((0,r.first)()),{defaultValue:null});return n.customEventClient.createOutboundChannel("getCanCopy").next(e),s})()}}m.\u0275fac=function(e){return new(e||m)(u.\u0275\u0275inject(l.CustomEventService))},m.\u0275prov=u.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})},8239:(C,c,o)=>{o.d(c,{Z:()=>g});function i(l,d,a,r,u,m,t){try{var e=l[m](t),n=e.value}catch(s){a(s);return}e.done?d(n):Promise.resolve(n).then(r,u)}function g(l){return function(){var d=this,a=arguments;return new Promise(function(r,u){var m=l.apply(d,a);function t(n){i(m,r,u,t,e,"next",n)}function e(n){i(m,r,u,t,e,"throw",n)}t(void 0)})}}}}]);
