(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[7427],{7427:(A,P,l)=>{l.r(P),l.d(P,{AnnotationBracketOffset:()=>d.Gt,AnnotationOutlineMargin:()=>d.SN,BaseAccountProfileService:()=>m.Zb,BaseDiagramEventHandlerController:()=>m.SZ,BaseDiagramEventService:()=>m.Cy,BaseDiagramRules:()=>d.UO,BaseDiagramSnapping:()=>d.CE,BaseDrawConnection:()=>d.rj,BaseElementTools:()=>d.xA,BaseFeatureService:()=>d.hp,CommandType:()=>y.wI,CommonDiagramDeleteShapeHandler:()=>d.Cs,CommonDiagramEventHandlerController:()=>d.QA,ConnectionClasses:()=>y.$d,ConnectionProperties:()=>d.QT,DefaultOutlineOffset:()=>d.Km,DiagramBaseOutline:()=>d.UF,DiagramBendpoints:()=>d.Cx,DiagramCanvas:()=>d.pn,DiagramCircleOutline:()=>d.EQ,DiagramCommandStack:()=>d.Sl,DiagramComponent:()=>x.M,DiagramConnectionHighlight:()=>d.UR,DiagramConnectionOutline:()=>d.zP,DiagramConnectionPreview:()=>d.SZ,DiagramConnectionSegmentMove:()=>d.tY,DiagramContextPad:()=>d.GY,DiagramCopyPaste:()=>d.Gc,DiagramCreateElementsHandler:()=>d.M8,DiagramCreateLabelHandler:()=>d.Nt,DiagramCreatePopupMenu:()=>d.yh,DiagramCreateShapeHandler:()=>d.Zj,DiagramDataService:()=>m.Oq,DiagramEditorActions:()=>d.Xk,DiagramElementFactory:()=>d.J8,DiagramElementOutline:()=>d.rp,DiagramElementRegistry:()=>d.hG,DiagramElementToolsConfig:()=>d.Jb,DiagramFeatures:()=>d.QB,DiagramFeaturesToken:()=>d.Yv,DiagramKeyboardBindings:()=>d.IH,DiagramLabelEdit:()=>d.B5,DiagramLabelOutline:()=>d.k_,DiagramLabelSupport:()=>d.M5,DiagramLassoTool:()=>d.jX,DiagramLoader:()=>d.mj,DiagramLocalStorage:()=>d.Du,DiagramModeling:()=>d.p7,DiagramModule:()=>S.C,DiagramMoveElementsHandler:()=>d.nj,DiagramMoveHelper:()=>d.UK,DiagramOutline:()=>d.EX,DiagramPalette:()=>d.Y_,DiagramPaletteProvider:()=>d.OC,DiagramPaletteTools:()=>d.lw,DiagramPopupMenu:()=>d._n,DiagramPreviewSupport:()=>d.wx,DiagramReconnectHandler:()=>d.yT,DiagramRenderer:()=>d.FL,DiagramRhombOutline:()=>d.dA,DiagramShapeOutline:()=>d.n7,DiagramSpaceTool:()=>d.ev,DiagramSpaceToolHandler:()=>d.x5,DiagramSpaceToolPreview:()=>d.HS,DiagramSplitConnectionHelper:()=>d.gR,DiagramTextUtils:()=>d.WH,DiagramValidationOutline:()=>d.oD,DiagramZoomScroll:()=>d.wc,DirectEditing:()=>d.oC,DrawConnection:()=>d.tp,ElementTools:()=>d.vb,ElementToolsFactory:()=>d.yz,EventPriority:()=>y.aN,FeatureExecutionOrder:()=>D.I2,FeatureProvider:()=>d.sN,KeysEnum:()=>y.Ys,LabelTools:()=>d.Kq,Layouter:()=>d.pw,Minimap:()=>d.N5,OutlineFactory:()=>d.t7,ProcessConvertUtils:()=>m.Bb,RenderingBaseShape:()=>d.FY,RenderingLabel:()=>d.JV,RenderingShape:()=>d.gL,RenderingShapeFactory:()=>d.E6,ReplaceMenuProvider:()=>d.Xo,ShapeResizerMarginBottom:()=>d.iv,Size:()=>d.$u,Styles:()=>d.z0,SvgUtils:()=>M.F,TextAreaBorder:()=>d.Zi,TextAreaOffset:()=>d.Ys,TextBox:()=>d.zC,UniqueNameService:()=>m.gz,UpdateLabelHandler:()=>d.vz,featureImplementation:()=>D.Xu,featureImplementationExtension:()=>D.mi,getKeyCode:()=>d.HL,handleEnterKey:()=>d.qx,ifNotReadonly:()=>D.jZ,isEnterKey:()=>d.r$,isKey:()=>d.ot,isPrintableKey:()=>d.J2});var s=l(65418),o=l.n(s),v={};for(const O in s)O!=="default"&&(v[O]=()=>s[O]);l.d(P,v);var D=l(77506),x=l(60865),S=l(23939),y=l(69265),d=l(63477),m=l(68567),M=l(94082)},25222:(A,P,l)=>{l.d(P,{j:()=>s});function s(){return function(o,v,D){const x=D.value;D.value=function(){return this.isReadOnly?!1:x.apply(this,arguments)}}}},77506:(A,P,l)=>{l.d(P,{I2:()=>s,Xu:()=>v,mi:()=>o,jZ:()=>D.j});var s;(function(x){x[x.before=0]="before",x[x.after=1]="after",x[x.instead=2]="instead"})(s||(s={}));function o(x,S,y=s.instead){return(d,m,M)=>{M===void 0&&(M=Object.getOwnPropertyDescriptor(d,m));const O=M.value;return S.__instance__ instanceof S||(S.__instance__=new S),M.value=function(){const L=[].slice.call(arguments),k=[...L];let R;if(this.createFeatureContext instanceof Function&&k.unshift(this.createFeatureContext.call(this)),x(...L)){const f=S.__instance__;switch(y){case s.before:return R=f[m].apply(f,[...k]),O.apply(this,[...L,R]);case s.after:return R=O.apply(this,L),f[m].apply(f,[...k,R]);default:return f[m].apply(f,[...k])}}return O.apply(this,[...L,R])},M}}function v(x,S=s.before){return o(()=>!0,x,S)}var D=l(25222)},90411:(A,P,l)=>{l.d(P,{M:()=>H});var s=l(8239),o=l(94450),v=l.n(o),D=l(77207),x=l.n(D),S=l(99293),y=l.n(S),d=l(65418),m=l.n(d),M=l(33177),O=l.n(M),L=l(97600),k=l.n(L),R=l(27974),f=l(21322),U=l.n(f),B=l(27049),Q=l.n(B),G=l(27717),re=l(80507),j=l(68567);const J=["diagramContainer"],Ve=["resetZoomButton"];class H{set _isReadOnly(g){this.isReadOnly=g==="true"}set _isStraightConnection(g){this.isStraightConnection=g==="true"}set _isRtl(g){this.isRtl=g==="rtl"}get diagramEventHandlerController(){return this.get("diagramEventHandlerController")}get _diagramLoader(){return this.get("diagramLoader")}get modeling(){return this.get("modeling")}constructor(g){this.injector=g,this._initScale=1,this._unloaded$=new f.Subject,this._defaultTool="arrow",this.isRtl=!1,this.destroyed$=new f.Subject,this.initScroll={x:0,y:0},this.loaded=new f.Subject,this.loading=!0,this.elementDblClick=new o.EventEmitter,this.elementSelected=new o.EventEmitter,this.diagramInitialized=new o.EventEmitter,this.afterViewInit=new o.EventEmitter,this.loadProgress$=new f.Subject,this.isReadOnly=!1,this.isStraightConnection=!1,this.injectDependencies()}_initDiagram(g){this.diagramContainer=new o.ElementRef(document.querySelector(".diagram-container")),this.diagram=new R.Z({canvas:{container:this.diagramContainer.nativeElement},keyboard:{bindTo:window},modules:[this.features,{loggerService:["value",this.loggerService]}],isReadOnly:this.isReadOnly,isStraightConnection:this.isStraightConnection,isRtl:this.isRtl,popupMenu:{scale:{min:1,max:1}},contextPad:{scale:{min:1,max:1}},initScroll:this.initScroll,initScale:this._initScale,...g}),this.diagramDataService.diagram=this.diagram,this.diagramEventHandlerController.service=this.service;const b=this.get("canvas"),w=this.get("editorActions"),C=this.get("elementFactory"),u=this.get("eventBus");u.fire("attach",{}),u.fire("editorActions.init",{editorActions:w});const ee=C.createRoot({id:d.Roots.root.id});b.setRootElement(ee),this.tool=this._defaultTool,this._serviceSubscriptions=this._subscribeService(),this.get("featureProvider").featureService=this.featureService}_setSelectedElement(g){if(g){const b=this.get("eventBus"),C=this.get("elementRegistry").get(g);C&&b.fire("element.click",{element:C})}}_subscribeLoadingData(){var g=this;const b=this.service.startLoading$.subscribe(C=>{this.dataId!==C&&(this.loading=!0)}),w=this.service.endLoading$.pipe((0,B.filter)(C=>C&&this.dataId!==C.id)).subscribe(function(){var C=(0,s.Z)(function*(u){g._unloaded$.next(),yield g.loadDiagramData(u)});return function(u){return C.apply(this,arguments)}}());this._serviceSubscriptions.push(b,w),this.diagramInitialized.emit(),this.get("eventBus").fire(d.Handlers.diagram.initialized)}_getCancellationToken(){const g=new f.Subject;return(0,f.merge)(this.destroyed$,this._unloaded$).subscribe(()=>{g.next(),g.complete()}),g}_subscribeService(){var g=this;const b=this.diagramEventHandlerController.subscribeServerChanges();return b.push(this.service.error$.pipe((0,B.takeUntil)(this.destroyed$),(0,B.debounceTime)(1e3)).subscribe(function(){var w=(0,s.Z)(function*(C){yield g.notifyService.error({message:C,translate:!1});const u=g.diagramDataService.getDiagramDataId();g.loggerService.exception(C,{loggerName:"DiagramService"},{diagramDataId:u})});return function(C){return w.apply(this,arguments)}}()),this.service.updateCaption$.subscribe(w=>this._changeCaption(w))),b}_unsubscribeService(){this._serviceSubscriptions&&this._serviceSubscriptions.forEach(g=>g.unsubscribe())}unloadDiagramData(){this.diagram&&(this.get("directEditing").complete(),this._clearDiagram())}initDiagramData(g){var b=this;return(0,s.Z)(function*(){b._initLocalStorage(),b._initZoomScroll(),b.diagramEventHandlerController.stopSync(),b.unloadDiagramData();const w=yield b._diagramLoader.load(b.diagramDataService.data,g,b.loadProgress$);if(g.isStopped)return;const C=w&&w[0];C&&(yield b.notifyService.show({message:C,translate:!1})),b.diagramEventHandlerController.startSync()})()}_changeCaption(g){this.caption=g.value}_initLocalStorage(){const g=this.get("localStorage");g.diagramId=this.diagramDataService.getDiagramDataId()}_initZoomScroll(){this.get("zoomScroll").initZoomScroll()}_subscribeDiagramChanges(){const g=this.get("eventBus");g.on(["create.end","connect.end","element.click","shape.move.end"],b=>{this._onSelectedElementChanged(b.element||b.context.shape||b.context.connection)}),g.on(["shape.replaced"],b=>L.defer(()=>this._onSelectedElementChanged(b))),g.on(["selection.changed"],b=>{const w=b.newSelection,C=w.length===1&&w[0];C&&!this.loading&&this._onSelectedElementChanged(C)}),g.on(["tool-manager.update"],b=>this._onToolChanged(b.tool)),g.on(["element.dblclick"],()=>this._elementDblClick())}_elementDblClick(){this.elementDblClick.emit()}_onSelectedElementChanged(g){let b=null;const w={source:this,id:b};g&&g.type!==d.Roots.root.type&&(b=(g.labelTarget||g).id,w.id=b),this.elementSelected.emit(w),this.get("eventBus").fire("diagram.item.selected",{id:b})}_onToolChanged(g){this.tool=g||this._defaultTool}_getLocalizationObject(g){return{get:b=>{const w=b.split(".");let C=g;for(const u of w){if(!C||!C.hasOwnProperty(u))return b;C=C[u]}return C??b}}}_getDiagramLocalizableStrings(g){var b=this;return(0,s.Z)(function*(){const w=b.translateService,C=w.getDefaultLang(),u=w.currentLang;let ee,F;C===u?F=w.translations[u]?(0,f.of)({...w.translations[u],...w.translations[u]?.diagram}):w.getTranslation(u).pipe((0,B.map)(({diagram:ce})=>ce)):(ee=w.translations?(0,f.zip)((0,f.of)(w.translations[C]),(0,f.of)(w.translations[u])):(0,f.zip)(w.getTranslation(C),w.getTranslation(u)),F=ee.pipe((0,B.map)(([ce,le])=>L.merge(ce?.diagram,le?.diagram))));const te=yield(0,f.lastValueFrom)(F.pipe((0,B.first)()),{defaultValue:null});return b._getLocalizationObject({...te,...g})})()}_reloadDiagram(){var g=this;return(0,s.Z)(function*(){const b=yield g._getDiagramConfig();g.diagramDataService.hasDiagramData()&&g._clearDiagram(),g._destroyDiagram(),g._unsubscribeService(),g._initDiagram(b),g._subscribeLoadingData(),g._subscribeDiagramChanges(),g.diagramDataService.hasDiagramData()&&(yield g.initDiagramData(g._getCancellationToken()))})()}_clearDiagram(){this.diagramEventHandlerController.stopSync(),this.diagram.clear()}_destroyDiagram(){this.diagram&&(this.get("eventBus").fire("detach",{}),this.diagram.destroy())}_getDiagramConfig(){var g=this;return(0,s.Z)(function*(){const b=yield g.service.getDiagramConfig();return{localizableStrings:yield g._getDiagramLocalizableStrings(b&&b.customLocalizableStrings),...b}})()}injectDependencies(){this.diagramDataService=this.injector.get(j.Oq),this.service=this.injector.get(j.Cy),this.translateService=this.injector.get(D.TranslateService),this.notifyService=this.injector.get(S.NotifyService),this.featureService=this.injector.get(G.h),this.loggerService=this.injector.get(M.LoggerService),this.features=this.injector.get(re.Y)}loadDiagramData(g){var b=this;return(0,s.Z)(function*(){const w=b._getCancellationToken();if(!(b.destroyed$.isStopped||b._unloaded$.isStopped))if(b.diagramDataService.data=g,b.diagramDataService.hasDiagramData()){if(yield b.initDiagramData(w),w.isStopped)return;b.caption=b.diagramDataService.getDiagramDataCaption(),b.loading=!1,b.loaded.next(g.id),b._setSelectedElement(b.elementSelect)}else{b.loading=!1;const C=`Error. Diagram with id = "${g.id}" does not exists`;b.loaded.error(C)}})()}ngOnInit(){this.translateService.onLangChange.pipe((0,B.takeUntil)(this.destroyed$)).subscribe(()=>{this.loading?this.service.endLoading$.pipe((0,B.first)()).subscribe(()=>this._reloadDiagram()):this._reloadDiagram()})}ngAfterViewInit(){var g=this;return(0,s.Z)(function*(){const b=yield g._getDiagramConfig();g._initDiagram(b),g._subscribeLoadingData(),g._subscribeDiagramChanges(),g._initZoomScroll(),g.afterViewInit.emit()})()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this._unsubscribeService(),this.diagramDataService.hasDiagramData()&&this.unloadDiagramData(),this._destroyDiagram()}get(g){return this.diagram.get(g)}onHandClick(){this.get("toolManager").setActive(null),this.get("dragging").cancel()}onLassoClick(){this.get("lassoTool").toggle()}onSpaceClick(){this.get("spaceTool").toggle()}onUndoClick(){this.service.undo()}onRedoClick(){this.service.redo()}update(g){this.modeling.updateLabel(g.id,g.value)}}H.\u0275fac=function(g){return new(g||H)(o.\u0275\u0275directiveInject(o.Injector))},H.\u0275cmp=o.\u0275\u0275defineComponent({type:H,selectors:[["ts-app-diagram"]],viewQuery:function(g,b){if(g&1&&(o.\u0275\u0275viewQuery(J,7,o.ElementRef),o.\u0275\u0275viewQuery(Ve,7,o.ElementRef)),g&2){let w;o.\u0275\u0275queryRefresh(w=o.\u0275\u0275loadQuery())&&(b.diagramContainer=w.first),o.\u0275\u0275queryRefresh(w=o.\u0275\u0275loadQuery())&&(b.resetZoomButton=w.first)}},hostVars:1,hostBindings:function(g,b){g&2&&o.\u0275\u0275attribute("data-qa",b.caption)},inputs:{_isReadOnly:["readonly","_isReadOnly"],_isStraightConnection:["straightconnection","_isStraightConnection"],_isRtl:["dir","_isRtl"],elementSelect:"elementSelect"},outputs:{elementDblClick:"elementDblClick",elementSelected:"elementSelected",diagramInitialized:"diagramInitialized",afterViewInit:"afterViewInit"},decls:2,vars:0,consts:[[1,"diagram-container"],["diagramContainer",""]],template:function(g,b){g&1&&o.\u0275\u0275element(0,"div",0,1)},styles:[`.diagram-container{position:relative;height:100%;width:100%;margin:0}.diagram-container svg{display:block}.djs-container{direction:ltr}.djs-tooltip{border-radius:4px;padding:8px;width:150px;opacity:.9;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:1010}.djs-palette{left:10px;top:10px;border-radius:4px;overflow:hidden;padding-top:6px;padding-bottom:6px}.djs-palette.open,.djs-palette.two-column.open{width:46px}.djs-palette .group{padding:0!important;width:100%}.djs-palette .entry{width:32px;height:32px;line-height:32px;margin-left:6px;cursor:pointer}.djs-palette .entry.active{border-radius:7px}.djs-palette .entry.create-menu:after{content:"";position:absolute;width:0;height:0;border-top:3px solid transparent;border-bottom:3px solid transparent;border-left:3px solid #006ce0;margin-top:13px;margin-left:-4px}.djs-context-pad.open{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;border-radius:4px;pointer-events:auto}.djs-context-pad.open .group{display:grid;grid-template-columns:auto auto;padding:3px}.djs-context-pad.open .group:not(:first-child){padding-left:0}.djs-context-pad.open.one-column-grid .group{grid-template-columns:auto}.djs-context-pad.open .entry{height:32px;width:32px;background:transparent;margin:0;box-shadow:none;border-radius:3px}.djs-context-pad.open .entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}.djs-context-pad.open .entry.noop-entry:hover{background:inherit!important}.djs-context-pad.open .entry img{padding:4px}.entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}@supports ((-webkit-backdrop-filter: none) or (backdrop-filter: none)){.djs-context-pad.open{-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background:rgba(255,255,255,.7803921569)}.djs-context-pad.open .entry{background:transparent}}.djs-context-pad{max-width:72px}.djs-element.djs-connection.djs-updating path,.djs-element.djs-connection.selected path,.djs-element.djs-connection.animated path{stroke:#1186d8!important}.djs-element.djs-connection.djs-updating path.connection-end-marker,.djs-element.djs-connection.selected path.connection-end-marker,.djs-element.djs-connection.animated path.connection-end-marker{fill:#1186d8!important}.djs-element.djs-connection.animated path.connection{stroke-width:3!important;stroke-dasharray:20,3;animation:dash 5s linear infinite}@keyframes dash{0%{stroke-dashoffset:115}}.djs-bendpoint .djs-visual{fill:#fff;stroke-width:1px;stroke:#1186d8}.djs-bendpoint.floating .djs-visual{display:none}.djs-bendpoints.hover .djs-visual{stroke:#8095b3}.djs-element.hover .djs-outline{stroke:#a7c6ff}.laneSet.hover .djs-visual,.lane.hover .djs-visual{opacity:initial}.djs-element.selected .djs-outline{stroke:#3168cc}.djs-segment-dragger .djs-visual{fill:transparent;stroke:transparent}.djs-snap-line{stroke-width:1px}.djs-popup{overflow-y:auto;overflow-x:hidden;max-height:calc(100% - 20px);opacity:0;transition:opacity .2s ease-out}.djs-popup .entry{display:flex;flex-direction:row-reverse;justify-content:flex-end;align-items:stretch;padding:5px 7px}.djs-popup .entry img{height:24px;width:24px}.djs-popup .djs-popup-header{display:flex;margin:0 9px}.djs-popup .djs-popup-header .entry.active{border:none}.djs-popup .djs-popup-header .entry:first-child{margin-left:0}.djs-popup .djs-popup-header .entry{height:34px;width:34px;padding:4px;margin:2px 1px 2px 4px}.djs-dragger .djs-visual rect{fill:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border){display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;pointer-events:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border) .djs-direct-editing-content{margin:0 auto;pointer-events:auto;text-align:center}.djs-direct-editing-content{-webkit-user-select:text!important;user-select:text!important;overflow:hidden;outline:none;resize:none}.djs-direct-editing-parent-no-border .djs-direct-editing-content{border:0}.djs-direct-editing-rotate-90{transform:rotate(-90deg);transition:transform .1s ease}.djs-direct-editing-rotate-90 .djs-direct-editing-content{border:none;transition:border .1s ease}.djs-direct-editing-rotate-0{transform:rotate(0)}.djs-text-hidden text{display:none}.djs-text-hidden foreignObject{display:none}.djs-direct-editing-resize-handle{display:none}.djs-shape.connect-ok.textAnnotation .djs-visual>:nth-child(1):not(path),.djs-shape.connect-not-ok.textAnnotation .djs-visual>:nth-child(1):not(path){fill:inherit!important}.djs-element.lane.hover:not(.selected) .djs-outline{stroke:none}.djs-element.laneSet.hover:not(.selected) .djs-outline{stroke:none}foreignObject.djs-label{overflow:visible}.foreign-text-container{display:flex;justify-content:center;height:100%}.laneSet .foreign-text-container,.lane .foreign-text-container{align-items:center}.eventSubProcessExpanded .foreign-text-container{height:initial;padding:5px}.foreign-text{text-align:center;box-sizing:border-box;outline:none;font-family:Open Sans,sans-serif;font-size:12px;font-weight:400;line-height:1.2;overflow-wrap:break-word;white-space:pre-line}.label .foreign-text{max-width:130px;-webkit-user-select:text;user-select:text}.textAnnotation .foreign-text{padding:12px;max-width:none;text-align:left;line-height:1.41667;word-wrap:break-word}.textAnnotation foreignObject{height:100%}.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}@supports (-webkit-line-clamp: 2){.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{vertical-align:center;overflow:hidden;text-overflow:ellipsis;white-space:initial;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}}.foreign-text-helper{max-width:128px;min-height:14.39px;width:-moz-fit-content;width:fit-content;margin:0 auto;overflow-wrap:break-word}.diagram-create-popup-menu{border-top:none!important}.diagram-create-popup-menu .entry{cursor:move}.djs-minimap{position:absolute;right:8px;bottom:11px;width:248px;height:33px;border-radius:4px;opacity:1;overflow:hidden;box-sizing:border-box;-webkit-user-select:none;user-select:none;transition:height .2s cubic-bezier(0,0,.2,1)}.djs-minimap .map-buttons{position:absolute;bottom:0;left:0;right:0;height:32px;display:flex;padding:0 5px;z-index:1}.djs-minimap .map-buttons .map-button{min-width:32px;height:32px;cursor:pointer;line-height:32px;font-size:16px;padding:0 8px;background-position:center;transition:background .8s}.djs-minimap .map-buttons .map-button:active{background-size:100%;transition:background 0s}.djs-minimap .map-buttons .map-button.preview-button{padding:0 12px 0 10px;margin:0 4px 0 0;min-width:40px}.djs-minimap .map-buttons .map-button.zoom-button{width:100%;height:100%;padding:0 16px 0 0;text-align:right}.djs-minimap .map-buttons .map-button.zoom-button:after{content:"";position:absolute;width:0;height:0;right:9px;top:16px}.djs-minimap .map{width:248px;height:148px;margin-bottom:32px;cursor:crosshair}.djs-minimap.open{transition:height .2s cubic-bezier(.18,.89,.32,1.28);height:180px}.djs-minimap.open .overlay{position:absolute;inset:0;pointer-events:none}.djs-minimap .viewport{fill:none;stroke:none}.djs-minimap .viewport-dom{position:absolute;border-radius:2px;box-sizing:border-box;cursor:move}.djs-minimap .cursor-crosshair{cursor:crosshair}.djs-minimap .cursor-move{cursor:move}.djs-popup.zoom{right:8px;bottom:47px;top:inherit!important;left:inherit!important}.djs-popup.zoom .entry{display:flex;flex-direction:row;justify-content:space-between;align-items:stretch}.djs-popup.zoom .entry.entry-separator{padding:0!important;margin:4px 10px!important}#canvas_svg_export{position:absolute;left:50px;top:50px;box-shadow:0 0 9px 2px #0000007a}#canvas_svg_export .close-button{position:absolute;right:8px;width:16px;height:16px;cursor:pointer}
`,`.djs-outline{fill:none;visibility:hidden}.djs-element.hover .djs-outline,.djs-element.selected .djs-outline{visibility:visible;shape-rendering:crispEdges;stroke-dasharray:3,3}.djs-element.selected .djs-outline{stroke:#88f;stroke-width:1px}.djs-element.hover .djs-outline{stroke:#f88;stroke-width:1px}svg.drop-not-ok{background:#f9dee5!important}.djs-connection.connect-ok .djs-visual>:nth-child(1),.djs-connection.drop-ok .djs-visual>:nth-child(1){stroke:#90dd5f!important}.djs-connection.connect-not-ok .djs-visual>:nth-child(1),.djs-connection.drop-not-ok .djs-visual>:nth-child(1){stroke:#e56283!important}.drop-not-ok,.connect-not-ok{cursor:not-allowed}.djs-element.attach-ok .djs-visual>:nth-child(1){stroke-width:5px!important;stroke:#ff7400b3!important}.djs-frame.connect-not-ok .djs-visual>:nth-child(1),.djs-frame.drop-not-ok .djs-visual>:nth-child(1){stroke-width:3px!important;stroke:#e56283!important;fill:none!important}.djs-lasso-overlay{fill:#ff7400;fill-opacity:.1;stroke-dasharray:5 1 3 1;stroke:#ff7400;shape-rendering:crispEdges;pointer-events:none}.djs-resize-overlay{fill:none;stroke-dasharray:5 1 3 1;stroke:#ff7400;pointer-events:none}.djs-resizer-hit{fill:none;pointer-events:all}.djs-resizer-visual{fill:#fff;stroke-width:1px;stroke:#000;shape-rendering:crispEdges;stroke-opacity:.2}.djs-cursor-resize-ns,.djs-resizer-n,.djs-resizer-s{cursor:ns-resize}.djs-cursor-resize-ew,.djs-resizer-e,.djs-resizer-w{cursor:ew-resize}.djs-cursor-resize-nwse,.djs-resizer-nw,.djs-resizer-se{cursor:nwse-resize}.djs-cursor-resize-nesw,.djs-resizer-ne,.djs-resizer-sw{cursor:nesw-resize}.djs-shape.djs-resizing>.djs-outline{visibility:hidden!important}.djs-shape.djs-resizing>.djs-resizer{visibility:hidden}.djs-dragger>.djs-resizer{visibility:hidden}marker.djs-dragger circle,marker.djs-dragger path,marker.djs-dragger polygon,marker.djs-dragger polyline,marker.djs-dragger rect{fill:#ff7400!important;stroke:none!important}marker.djs-dragger text,marker.djs-dragger tspan{fill:none!important;stroke:#ff7400!important}.djs-dragging{opacity:.3}.djs-dragging,.djs-dragging>*{pointer-events:none!important}.djs-dragging .djs-context-pad,.djs-dragging .djs-outline{display:none!important}.djs-visual,.djs-outline{pointer-events:none}.djs-element.attach-ok .djs-hit{stroke-width:60px!important}.djs-element>.djs-hit-all{pointer-events:all}.djs-element>.djs-hit-stroke,.djs-element>.djs-hit-click-stroke{pointer-events:stroke}.djs-drag-active .djs-element>.djs-hit-click-stroke{pointer-events:all}.djs-connection .djs-visual{stroke-width:2px;fill:none}.djs-cursor-grab{cursor:grab}.djs-cursor-grabbing{cursor:grabbing}.djs-cursor-crosshair{cursor:crosshair}.djs-cursor-move{cursor:move}.djs-cursor-resize-ns{cursor:ns-resize}.djs-cursor-resize-ew{cursor:ew-resize}.djs-snap-line{stroke:#ffc342;stroke:#ffc34280;stroke-linecap:round;stroke-width:2px;pointer-events:none}.djs-crosshair{stroke:#555;stroke-linecap:round;stroke-width:1px;pointer-events:none;shape-rendering:crispEdges;stroke-dasharray:5,5}.djs-palette{position:absolute;left:20px;top:20px;box-sizing:border-box;width:48px}.djs-palette .separator{margin:0 5px;padding-top:5px;border:none;border-bottom:solid 1px #DDD;clear:both}.djs-palette .entry:before{vertical-align:text-bottom}.djs-palette .djs-palette-toggle{cursor:pointer}.djs-palette .entry,.djs-palette .djs-palette-toggle{color:#333;font-size:30px;text-align:center}.djs-palette .entry{float:left}.djs-palette .entry img{max-width:100%}.djs-palette .djs-palette-entries:after{content:"";display:table;clear:both}.djs-palette .djs-palette-toggle:hover{background:#666}.djs-palette .entry:hover{color:#ff7400}.djs-palette .highlighted-entry{color:#ff7400!important}.djs-palette .entry,.djs-palette .djs-palette-toggle{width:46px;height:46px;line-height:46px;cursor:default}.djs-palette.two-column.open{width:94px}.djs-palette:not(.open) .djs-palette-entries{display:none}.djs-palette:not(.open){overflow:hidden}.djs-palette.open .djs-palette-toggle{display:none}.djs-overlay-context-pad{width:72px}.djs-context-pad{position:absolute;display:none;pointer-events:none}.djs-context-pad .entry{width:22px;height:22px;text-align:center;display:inline-block;font-size:22px;margin:0 2px 2px 0;border-radius:3px;cursor:default;background-color:#fefefe;box-shadow:0 0 2px 1px #fefefe;pointer-events:all}.djs-context-pad .entry:before{vertical-align:top}.djs-context-pad .entry:hover{background:rgb(255,252,176)}.djs-context-pad.open{display:block}.djs-popup .entry{line-height:20px;white-space:nowrap;cursor:default}.djs-popup .entry:before{vertical-align:middle;font-size:20px}.djs-popup .entry>span{vertical-align:middle;font-size:14px}.djs-popup .entry:hover,.djs-popup .entry.active:hover{background:rgb(255,252,176)}.djs-popup .entry.disabled{background:inherit}.djs-popup .djs-popup-header .entry{display:inline-block;padding:2px 3px;border:solid 1px transparent;border-radius:3px}.djs-popup .djs-popup-header .entry.active{color:#ff7400;border:solid 1px rgb(255,116,0);background-color:#f6f6f6}.djs-popup-body .entry{padding:4px 10px 4px 5px}.djs-popup-body .entry>span{margin-left:5px}.djs-popup-body{background-color:#fefefe}.djs-popup-header{border-bottom:1px solid #DDD}.djs-popup-header .entry{margin:1px 1px 1px 3px}.djs-popup-header .entry:last-child{margin-right:3px}.djs-popup,.djs-palette{background:#FAFAFA;border:solid 1px #CCC;border-radius:2px}.djs-shape,.djs-connection{touch-action:none}.djs-segment-dragger,.djs-bendpoint{display:none}.djs-segment-dragger .djs-visual{fill:#ffff7933;stroke-width:1px;stroke-opacity:1;stroke:#ffff794d}.djs-bendpoint .djs-visual{fill:#ffff79cc;stroke-width:1px;stroke-opacity:.5;stroke:#000}.djs-segment-dragger:hover,.djs-bendpoints.hover .djs-segment-dragger,.djs-bendpoints.selected .djs-segment-dragger,.djs-bendpoint:hover,.djs-bendpoints.hover .djs-bendpoint,.djs-bendpoints.selected .djs-bendpoint{display:block}.djs-drag-active .djs-bendpoints *{display:none}.djs-bendpoints:not(.hover) .floating{display:none}.djs-segment-dragger:hover .djs-visual,.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint:hover .djs-visual,.djs-bendpoint.floating .djs-visual{fill:#ff0;stroke-opacity:.5;stroke:#000}.djs-bendpoint.floating .djs-hit{pointer-events:none}.djs-segment-dragger .djs-hit,.djs-bendpoint .djs-hit{pointer-events:all;fill:none}.djs-segment-dragger.horizontal .djs-hit{cursor:ns-resize}.djs-segment-dragger.vertical .djs-hit{cursor:ew-resize}.djs-segment-dragger.djs-dragging .djs-hit{pointer-events:none}.djs-updating,.djs-updating>*{pointer-events:none!important}.djs-updating .djs-context-pad,.djs-updating .djs-outline,.djs-updating .djs-bendpoint,.connect-ok .djs-bendpoint,.connect-not-ok .djs-bendpoint,.drop-ok .djs-bendpoint,.drop-not-ok .djs-bendpoint{display:none!important}.djs-segment-dragger.djs-dragging,.djs-bendpoint.djs-dragging{display:block;opacity:1}.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint.djs-dragging .djs-visual{fill:#ff0;stroke-opacity:.5}.djs-tooltip-error{font-size:11px;line-height:18px;text-align:left;padding:5px;opacity:.7}.djs-tooltip-error>*{width:160px;background:rgb(252,236,240);color:#9e4c4c;padding:3px 7px;border-radius:5px;border-left:solid 5px rgb(174,73,73)}.djs-tooltip-error:hover{opacity:1}.djs-search-container{position:absolute;top:20px;left:0;right:0;margin-left:auto;margin-right:auto;width:25%;min-width:300px;max-width:400px;z-index:10;font-size:1.05em;opacity:.9;background:#FAFAFA;border:solid 1px #CCC;border-radius:2px}.djs-search-container:not(.open){display:none}.djs-search-input input{font-size:1.05em;width:100%;padding:6px 10px;border:1px solid #ccc}.djs-search-input input:focus{outline:none;border-color:#52b415}.djs-search-results{position:relative;overflow-y:auto;max-height:200px}.djs-search-results:hover{cursor:pointer}.djs-search-result{width:100%;padding:6px 10px;background:white;border-bottom:solid 1px #AAA;border-radius:1px}.djs-search-highlight{color:#000}.djs-search-result-primary{margin:0 0 10px}.djs-search-result-secondary{font-family:monospace;margin:0}.djs-search-result:hover{background:#fdffd6}.djs-search-result-selected{background:#fffcb0}.djs-search-result-selected:hover{background:#f7f388}.djs-search-overlay{background:yellow;opacity:.3}.djs-element-hidden,.djs-element-hidden .djs-hit,.djs-element-hidden .djs-outline,.djs-label-hidden .djs-label{display:none!important}
`],encapsulation:2})},60865:(A,P,l)=>{l.d(P,{M:()=>s.M});var s=l(90411)},23939:(A,P,l)=>{l.d(P,{C:()=>U});var s=l(31134),o=l.n(s),v=l(77207),D=l.n(v),x=l(99293),S=l.n(x),y=l(33177),d=l.n(y),m=l(90411),M=l(63477),O=l(27717),L=l(80507),k=l(68567),R=l(94450),f=l.n(R);class U{}U.\u0275fac=function(Q){return new(Q||U)},U.\u0275mod=R.\u0275\u0275defineNgModule({type:U}),U.\u0275inj=R.\u0275\u0275defineInjector({providers:[k.Cy,O.h,{provide:L.Y,useValue:M.QB},y.LoggerService],imports:[s.CommonModule,v.TranslateModule.forRoot(),x.NotifyModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&R.\u0275\u0275setNgModuleScope(U,{declarations:[m.M],imports:[s.CommonModule,v.TranslateModule,x.NotifyModule],exports:[m.M]})}()},69265:(A,P,l)=>{l.d(P,{wI:()=>s,$d:()=>D,aN:()=>o,Ys:()=>v.Y});const s={Add:"add",Remove:"remove",Update:"update"},o={MIN:100,LOW:500,MEDIUM:1e3,HIGH:1500,MAX:5e3};var v=l(91459),D;(function(x){x.Connection="connection",x.ConnectionEndMarker="connection-end-marker"})(D||(D={}))},91459:(A,P,l)=>{l.d(P,{Y:()=>s});const s={Backspace:{code:"Backspace",keyCode:8},Tab:{code:"Tab",keyCode:9},Enter:{code:"Enter",keyCode:13},NumpadEnter:{code:"NumpadEnter",keyCode:13},Escape:{code:"Escape",keyCode:27},Space:{code:"Space",keyCode:32},PageUp:{code:"PageUp",keyCode:33},PageDown:{code:"PageDown",keyCode:34},End:{code:"End",keyCode:35},Home:{code:"Home",keyCode:36},ArrowLeft:{code:"ArrowLeft",keyCode:37},ArrowUp:{code:"ArrowUp",keyCode:38},ArrowRight:{code:"ArrowRight",keyCode:39},ArrowDown:{code:"ArrowDown",keyCode:40},Insert:{code:"Insert",keyCode:45},Delete:{code:"Delete",keyCode:46},ShiftLeft:{code:"ShiftLeft",keyCode:16},ShiftRight:{code:"ShiftRight",keyCode:16},ControlLeft:{code:"ControlLeft",keyCode:17},ControlRight:{code:"ControlRight",keyCode:17},AltLeft:{code:"AltLeft",keyCode:18},AltRight:{code:"AltRight",keyCode:18},CapsLock:{code:"CapsLock",keyCode:20},OSLeft:{code:"OSLeft",keyCode:91},OSRight:{code:"OSRight",keyCode:92},Digit0:{code:"Digit0",keyCode:48},Digit1:{code:"Digit1",keyCode:49},Digit2:{code:"Digit2",keyCode:50},Digit3:{code:"Digit3",keyCode:51},Digit4:{code:"Digit4",keyCode:52},Digit5:{code:"Digit5",keyCode:53},Digit6:{code:"Digit6",keyCode:54},Digit7:{code:"Digit7",keyCode:55},Digit8:{code:"Digit8",keyCode:56},Digit9:{code:"Digit9",keyCode:57},KeyA:{code:"KeyA",keyCode:65},KeyB:{code:"KeyB",keyCode:66},KeyC:{code:"KeyC",keyCode:67},KeyD:{code:"KeyD",keyCode:68},KeyE:{code:"KeyE",keyCode:69},KeyF:{code:"KeyF",keyCode:70},KeyG:{code:"KeyG",keyCode:71},KeyH:{code:"KeyH",keyCode:72},KeyI:{code:"KeyI",keyCode:73},KeyJ:{code:"KeyJ",keyCode:74},KeyK:{code:"KeyK",keyCode:75},KeyL:{code:"KeyL",keyCode:76},KeyM:{code:"KeyM",keyCode:77},KeyN:{code:"KeyN",keyCode:78},KeyO:{code:"KeyO",keyCode:79},KeyP:{code:"KeyP",keyCode:80},KeyQ:{code:"KeyQ",keyCode:81},KeyR:{code:"KeyR",keyCode:82},KeyS:{code:"KeyS",keyCode:83},KeyT:{code:"KeyT",keyCode:84},KeyU:{code:"KeyU",keyCode:85},KeyV:{code:"KeyV",keyCode:86},KeyW:{code:"KeyW",keyCode:87},KeyX:{code:"KeyX",keyCode:88},KeyY:{code:"KeyY",keyCode:89},KeyZ:{code:"KeyZ",keyCode:90},NumpadMultiply:{code:"NumpadMultiply",keyCode:106},NumpadAdd:{code:"NumpadAdd",keyCode:107},NumpadDecimal:{code:"NumpadDecimal",keyCode:108},NumpadSubtract:{code:"NumpadSubtract",keyCode:109},NumpadDivide:{code:"NumpadDivide",keyCode:111},F1:{code:"F1",keyCode:112},F2:{code:"F2",keyCode:113},F3:{code:"F3",keyCode:114},F4:{code:"F4",keyCode:115},F5:{code:"F5",keyCode:116},F6:{code:"F6",keyCode:117},F7:{code:"F7",keyCode:118},F8:{code:"F8",keyCode:119},F9:{code:"F9",keyCode:120},F10:{code:"F10",keyCode:121},F11:{code:"F11",keyCode:122},F12:{code:"F12",keyCode:123},F13:{code:"F13",keyCode:124},F14:{code:"F14",keyCode:125},F15:{code:"F15",keyCode:126},F16:{code:"F16",keyCode:127},F17:{code:"F17",keyCode:128},F18:{code:"F18",keyCode:129},F19:{code:"F19",keyCode:130},F20:{code:"F20",keyCode:131},F21:{code:"F21",keyCode:132},F22:{code:"F22",keyCode:133},F23:{code:"F23",keyCode:134},F24:{code:"F24",keyCode:135},NumLock:{code:"NumLock",keyCode:144},Semicolon:{code:"Semicolon",keyCode:186},Equal:{code:"Equal",keyCode:187},Comma:{code:"Comma",keyCode:188},Minus:{code:"Minus",keyCode:189},Period:{code:"Period",keyCode:190},Slash:{code:"Slash",keyCode:191},Backquote:{code:"Backquote",keyCode:192},IntlRo:{code:"IntlRo",keyCode:193},BracketLeft:{code:"BracketLeft",keyCode:219},Backslash:{code:"Backslash",keyCode:220},BracketRight:{code:"BracketRight",keyCode:221},Quote:{code:"Quote",keyCode:222},IntlYen:{code:"IntlYen",keyCode:255}}},27717:(A,P,l)=>{l.d(P,{h:()=>x});var s=l(21322),o=l.n(s),v=l(94450),D=l.n(v);class x{getFeatureValues(y){return(0,s.of)([]).subscribe(()=>y({}))}}x.\u0275fac=function(y){return new(y||x)},x.\u0275prov=v.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac})},80507:(A,P,l)=>{l.d(P,{Y:()=>v});var s=l(94450),o=l.n(s);const v=new s.InjectionToken("DiagramFeaturesToken")},63477:(A,P,l)=>{l.d(P,{Gt:()=>vn,SN:()=>yn,UO:()=>S,CE:()=>M,rj:()=>Qe,xA:()=>nt,hp:()=>O.h,Cs:()=>k,QA:()=>B,QT:()=>Y,Km:()=>Je,UF:()=>st,Cx:()=>G,pn:()=>J,EQ:()=>In,Sl:()=>H,UR:()=>ze,zP:()=>Tt,SZ:()=>g,tY:()=>he,GY:()=>_e,Gc:()=>xe,M8:()=>ve,Nt:()=>me,yh:()=>ne,Zj:()=>fe,Xk:()=>Ce,J8:()=>lt,rp:()=>Lt,hG:()=>je,Jb:()=>Ee,QB:()=>ii,Yv:()=>On.Y,IH:()=>ut,B5:()=>ke,k_:()=>Rt,M5:()=>Ae,jX:()=>De,mj:()=>Se,Du:()=>$,p7:()=>K,nj:()=>be,UK:()=>Ge,EX:()=>Ze,Y_:()=>Pe,OC:()=>Ie,lw:()=>Me,_n:()=>Te,wx:()=>ft,yT:()=>de,FL:()=>pe,dA:()=>Mn,n7:()=>ae,ev:()=>Fe,x5:()=>ye,HS:()=>jt,gR:()=>Mt,WH:()=>F,oD:()=>at,wc:()=>He,oC:()=>Ue,tp:()=>yt,vb:()=>Ke,yz:()=>Pt,sN:()=>It,Kq:()=>Ot,pw:()=>We,N5:()=>Oe,t7:()=>oe,FY:()=>se,JV:()=>qe,gL:()=>Bt,E6:()=>ge,Xo:()=>Ne,iv:()=>fn,$u:()=>Tn,z0:()=>Be,Zi:()=>bn,Ys:()=>_n,zC:()=>vt,vz:()=>te,HL:()=>ie,qx:()=>pt,r$:()=>gt,ot:()=>Z,J2:()=>ht});var s=l(74742),o=l(65418),v=l(33177),D=l(61788),x=l(25222);let S=class extends D.Z{constructor(e,t){super(e),this.isReadOnly=!1,this.isReadOnly=t.isReadOnly}canConnect(e,t){return e.type!==o.DiagramElementType.root&&e.type!==o.DiagramElementType.connection&&t.type!==o.DiagramElementType.root&&t.type!==o.DiagramElementType.connection}addRule(e,t){super.addRule(e,t)}init(){super.addRule("connection.create",this.canConnectionCreate.bind(this)),super.addRule("connection.reconnect",this.canReconnect.bind(this)),super.addRule("elements.move",this.canElementMove.bind(this)),super.addRule("shape.create",this.canElementMove.bind(this)),super.addRule("elements.create",this.canElementMove.bind(this)),super.addRule("shape.resize",this.canElementResize.bind(this)),super.addRule("element.copy",this.canElementCopy.bind(this)),super.addRule("element.paste",this.canElementPaste.bind(this)),super.addRule("elements.delete",this.canElementsDelete.bind(this)),super.addRule("canOpenContextPad",this.canOpenContextPad.bind(this)),super.addRule("canShowConnectionOutline",this.canShowConnectionOutline.bind(this)),super.addRule("canConnectionSegmentMove",this.canConnectionSegmentMove.bind(this)),super.addRule("canLabelEdit",this.canLabelEdit.bind(this)),super.addRule("canShowPalette",this.canShowPalette.bind(this)),super.addRule("canShowLabelOutline",this.canShowLabelOutline.bind(this)),super.addRule("canElementMarkerUpdate",this.canElementMarkerUpdate.bind(this)),super.addRule("element.canUpdateType",this.canElementUpdateType.bind(this)),super.addRule("connection.updateWaypoints",this.canConnectionUpdateWaypoints.bind(this))}canElementMarkerUpdate(){return!0}canShowLabelOutline(){return!0}canConnectionSegmentMove(){return!0}canShowPalette(){return!0}canLabelEdit(){return!0}canShowConnectionOutline(){return!0}canOpenContextPad(){return!0}canConnectionCreate(e){return this.canConnect(e.target,e.source)}canReconnect(e){if(o.DiagramUtils.isRoot(e.target)||o.DiagramUtils.isRoot(e.source))return!1;switch(e.type){case"reconnectEnd":return this.canReconnectEnd(e);case"reconnectStart":return this.canReconnectStart(e);default:return this.canReconnectEnd(e)||this.canReconnectStart(e)}}canReconnectStart(e){return this.canConnect(e.target,e.source)}canReconnectEnd(e){return this.canConnect(e.target,e.source)}canElementMove(e){return!0}canElementResize(e){return!1}canElementCopy(e){return!0}canElementPaste(e){return!0}canElementsDelete(e){return!0}canElementUpdateType(e){return!0}canConnectionUpdateWaypoints(){return!1}};(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementMarkerUpdate",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canConnectionSegmentMove",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canShowPalette",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canLabelEdit",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canShowConnectionOutline",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canOpenContextPad",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canConnectionCreate",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",Boolean)],S.prototype,"canReconnect",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementMove",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementResize",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementCopy",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementPaste",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementsDelete",null),(0,s.__decorate)([(0,x.j)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object]),(0,s.__metadata)("design:returntype",void 0)],S.prototype,"canElementUpdateType",null),S=(0,s.__decorate)([(0,s.__param)(0,(0,v.Inject)("eventBus")),(0,s.__param)(1,(0,v.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object])],S);var y=l(44610),d=l(28605),m=l(69265);let M=class extends d.Z{constructor(e,t,n){super(t),this.eventBus=e,this.canvas=t,this.diagramUtils=n,this._subscribeEvents()}_subscribeEvents(){this.eventBus.on([o.Handlers.connect.move,o.Handlers.connect.hover,o.Handlers.connect.end],m.aN.HIGH,e=>{this.onSnapping(e)})}canSetSnapping(e){const{source:t,target:n}=e;return n&&t&&!o.DiagramUtils.isRoot(n)&&!o.DiagramUtils.isRoot(t)&&!this.diagramUtils.isConnection(t)&&!this.diagramUtils.isConnection(n)&&!o.DiagramUtils.isLabel(t)&&!o.DiagramUtils.isLabel(n)}onSnapping(e){const t=e.context;this.canSetSnapping(t)&&this.setSnapping(e)}snapEvent(e,t){(0,y.U)(e,"x",t.x),(0,y.U)(e,"y",t.y)}};M=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,o.DiagramUtils])],M);var O=l(27717),L=l(1680);let k=class extends L.Z{constructor(e,t,n){super(e,t),this.canvas=e,this.modeling=t,this.diagramUtils=n}createSingleCrossConnection(e,t){const n=e.source,i=t.target;if(n.outgoing.some(c=>c.target.id===i.id)||n.incoming.some(c=>c.source.id===i.id)||i.incoming.some(c=>c.source.id===n.id)||i.outgoing.some(c=>c.target.id===n.id)||i.outgoing.some(c=>c.source.id===n.id))return;const r=(0,y.Pi)(i);this.modeling.reconnectEnd(e,i,r,{isUpdateConnectionType:!1})}createMultipleCrossConnections(e){const t=e.shape,n=[...t.incoming],i=[...t.outgoing];if(n.length<1||i.length<1)return;const a=i.filter(h=>this.isDiagramFlow(h)).sort((h,_)=>h.id>_.id?1:-1);if(a.length<1)return;const r=a[0];n.filter(h=>this.isDiagramFlow(h)).forEach(h=>this.createSingleCrossConnection(h,r))}isDiagramFlow(e){return this.diagramUtils.isFlow(e)}preExecute(e){const t=e.hints;t&&t.force||this.createMultipleCrossConnections(e),super.preExecute(e)}};k=(0,s.__decorate)([(0,s.__param)(0,(0,v.Inject)("canvas")),(0,s.__param)(1,(0,v.Inject)("modeling")),(0,s.__param)(2,(0,v.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object])],k);var R=l(54134),f=l(97600),U=l(84531);let B=class extends U.S{constructor(e,t){super(),this.eventBus=e,this.diagramUtils=t,this._stopSync=0,this.sourceId=R.Guid.create(),this.subscribeDiagramChanges()}getElement(e){const t=e.context.shape||e.context.element||e.context.connection;switch(!0){case o.DiagramUtils.isLabel(t):return this.getLabel(e);case this.diagramUtils.isConnection(t):return this.getConnection(e);default:return this.getShape(e)}}updateProperties(e,t){if(this._stopSync)return;const n=e.context,i=this.getElement(e),a={};if(t.forEach(r=>{const c=i[r],h=this.getOldValue(n,r);f.isEqual(h,c)||(a[r]=f.cloneDeep(c))}),!f.isEmpty(a))switch(!0){case o.DiagramUtils.isLabel(i):this.service.bufferiseOps(m.wI.Update,["labels",i.id],a);break;case this.diagramUtils.isConnection(i):this.service.bufferiseOps(m.wI.Update,["connections",i.id],a);break;default:this.service.bufferiseOps(m.wI.Update,["elements",i.id],a)}}getShape(e){const t=e.context.shape||e.context.element;return{caption:t.caption,height:t.height,id:t.id,parent:t.parent&&t.parent.id,type:t.type,width:t.width,rx:t.rx,ry:t.ry,defaultParamValues:t.defaultParamValues,source:t.source}}getConnection(e){const t=e.context,n=t.connection||t.element,i=n.source||t.source,a=n.target||t.target;return{caption:n.caption,id:n.id,source:i.id,target:a.id,type:n.type,waypoints:n.waypoints}}getLabel(e){const t=e.context,n=t.shape,i=n.labelTarget||t.labelTarget;return{height:n.height,id:n.id,parent:i&&i.id,type:n.type,width:n.width,rx:n.rx,ry:n.ry}}addElement(e){const t=this.getElement(e);this.service.bufferiseOps(m.wI.Add,["elements"],{[t.id]:t})}subscribeDiagramChanges(){const e=this.eventBus;e.on([o.Handlers.diagram.initialized],()=>{this.service.diagramInitialized()}),e.on([o.Handlers.shape.createExecuted],t=>{if(!this._stopSync){const n=this.getElement(t);o.DiagramUtils.isLabel(n)?this.service.bufferiseOps(m.wI.Add,["labels"],{[n.id]:n}):this.addElement(t)}}),e.on([o.Handlers.shape.deleteExecuted],t=>{if(!this._stopSync){const n=this.getElement(t);n.parent||(n.parent=t.context.oldParent.id),o.DiagramUtils.isLabel(n)?this.service.bufferiseOps(m.wI.Remove,["labels"],{[n.id]:n}):this.service.bufferiseOps(m.wI.Remove,["elements"],{[n.id]:n})}}),e.on([o.Handlers.shape.moveExecuted],t=>{this.updateProperties(t,["parent","rx","ry"])}),e.on([o.Handlers.shape.resizeExecuted],t=>{this.updateProperties(t,["rx","ry","width","height"])}),e.on([o.Handlers.element.updateLabelExecuted],t=>{if(this._stopSync)return;const n=this.getElement(t);let i;this.diagramUtils.isConnection(n)?(i=this.getConnection(t),this.service.bufferiseOps(m.wI.Update,["connections",i.id],{caption:i.caption})):(i=this.getShape(t),this.service.bufferiseOps(m.wI.Update,["elements",i.id],{caption:i.caption}))}),e.on([o.Handlers.element.updateExecuted],t=>{this.updateProperties(t,["width","height","type"])}),e.on([o.Handlers.label.createExecuted],t=>{if(!this._stopSync){const n=this.getLabel(t);this.service.bufferiseOps(m.wI.Add,["labels"],{[n.id]:n})}}),e.on([o.Handlers.connection.createExecuted],t=>{if(!this._stopSync){const n=this.getConnection(t);this.service.bufferiseOps(m.wI.Add,["connections"],{[n.id]:n})}}),e.on([o.Handlers.connection.deleteExecuted],t=>{if(!this._stopSync){const n=this.getConnection(t);this.service.bufferiseOps(m.wI.Remove,["connections"],{[n.id]:n})}}),e.on([o.Handlers.connection.reconnectExecuted],t=>{const n=t.context.hints.docking;this.updateProperties(t,[n,"type"])}),e.on([o.Handlers.connection.updateWaypointsExecuted],t=>{this.updateProperties(t,["waypoints"])}),e.on([o.Handlers.connection.layoutExecuted],t=>{this.updateProperties(t,["waypoints"])}),e.on([o.Handlers.connection.moveExecuted],t=>{this.updateProperties(t,["waypoints"])}),e.on([o.Handlers.connection.updateExecuted],t=>{this.updateProperties(t,["type"])}),e.on([o.Handlers.connection.changeDirectionExecuted],t=>{this.updateProperties(t,["source","target","waypoints"])}),e.on([o.Handlers.elements.changed],()=>{this.service.commit(this.sourceId).then()}),e.on(["undo"],()=>this.service.undo()),e.on(["redo"],()=>this.service.redo())}getOldValue(e,t){let n;switch(t){case"rx":case"ry":case"width":case"height":n=e.oldBounds[t];break;case"parent":n=f.get(e,"oldParent.id");break;case"waypoints":n=f.get(e,"oldWaypoints");break;case"source":n=f.get(e,"oldSource.id");break;case"target":n=f.get(e,"oldTarget.id");break;case"type":n=f.get(e,"oldType");break;default:console.warn(`Unknown element property ${t}`)}return n}startSync(){this._stopSync=0}stopSync(){this._stopSync++}};B=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object])],B);var Q=l(71878);let G=class extends Q.Z{constructor(e,t,n,i,a,r){super(e,t,n,i,a),this.eventBus=e,this.canvas=t,this.interactionEvents=n,this.bendpointMove=i,this.connectionSegmentMove=a,this.rules=r,e.on("element.marker.update",m.aN.HIGH,this.onElementMarkerUpdate.bind(this))}onElementMarkerUpdate(e){this.rules.allowed("canElementMarkerUpdate")||(e.element={})}getConnectionBendpointsFilter(e,t,n){return t===0||t===n.length-1}};G=(0,s.__decorate)([(0,s.__param)(0,(0,v.Inject)("eventBus")),(0,s.__param)(1,(0,v.Inject)("canvas")),(0,s.__param)(2,(0,v.Inject)("interactionEvents")),(0,s.__param)(3,(0,v.Inject)("bendpointMove")),(0,s.__param)(4,(0,v.Inject)("connectionSegmentMove")),(0,s.__param)(5,(0,v.Inject)("rules")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],G);var re=l(68302),j=l(66270);let J=class extends re.Z{constructor(e,t,n,i){super(e,t,n,i),this._canvas=e,this._eventBus=t,this._graphicsFactory=n,this._elementRegistry=i,t.on(["canvas.init"],a=>this.onInit(a))}onInit(e){const t=(0,j.Ue)("defs");(0,j.R3)(e.svg,t)}zoom(e,t){const n=super.zoom(e,t);return this._eventBus.fire("zoom.changed",n),n}bringToFrontElement(e){const n=this._elementRegistry.getGraphics(e).parentNode,i=n.parentNode;i.removeChild(n),i.appendChild(n)}};J=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config.canvas")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("graphicsFactory")),(0,s.__param)(3,(0,o.Inject)("elementRegistry")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object])],J);var Ve=l(26019);let H=class extends Ve.Z{constructor(e,t){super(e,t),this.eventBus=e}undo(){this.eventBus.fire("undo")}redo(){this.eventBus.fire("redo")}};H=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("injector")),(0,s.__metadata)("design:paramtypes",[Object,Object])],H);var q=l(9572);let g=class extends q.Z{constructor(e,t,n,i){super(e,t,n,i),this._injector=e,this._canvas=t,this._graphicsFactory=n,this._elementFactory=i}createNoopConnection(e,t){const n=(0,j.Ue)("polyline");return(0,j.Lj)(n,{stroke:"#8095b3",strokeWidth:2}),(0,j.Lj)(n,{points:[e.x,e.y,t.x,t.y]}),n}};g=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("graphicsFactory")),(0,s.__param)(3,(0,o.Inject)("elementFactory")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object])],g);var b=l(42508),w=l(8644),C=l(83612),u=l(24706),ee=l(23583);let F=class extends ee.Z{constructor(e,t,n){super({style:f.cloneDeep(o.Labels.label.editStyle)}),this.config=e,this.elements=t,this.diagramUtils=n,this.style=f.cloneDeep(o.Labels.label.editStyle)}getElementLabelPosition(e,t){return t.delta?{x:Math.round(e.x+t.delta.x+t.width/2),y:Math.round(e.y+t.delta.y+t.height/2)}:{x:Math.round(e.x+e.width/2),y:Math.round(e.y+e.height+o.Labels.label.height/2)}}layoutToFirstLine(e,t){const i=e[0].textContent,a=super.layoutText(i,t);return a.element.children[0].textContent=i.substring(0,i.length-3)+"...",a}layoutRtlText(e,t){const n=e.element.children||[];n.length>1&&(e=this.layoutToFirstLine(n,t)),e.element.style.direction="rtl";const i=e.element.children||[];for(const a of i)a.style.direction="ltr";return e}getLabelPaddingTop(e,t){return 7}isIEOrEdge(){return/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)}applySvgHelperContent(e,t){const n=this.isEmptyText(t)?"dummy":t;e.textContent=n}createForeignText(e,t,n){const i=document.createElement("div"),a=`color: ${f.get(n,"style.fill","initial")}`;return i.setAttribute("class","foreign-text"),i.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),i.setAttribute("style",`width: ${t}px; ${a}`),i.textContent=e,i}createForeignTextContainer(e,t,n){const i=document.createElement("div");i.setAttribute("class","foreign-text-container"),i.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const a=this.createForeignText(e,t,n);return i.append(a),i}createForeignObject(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),i=e.height,a=e.width;n.setAttribute("height",i.toString()),n.setAttribute("width",a.toString());const r=this.createForeignTextContainer(e.text,e.width,t);return n.append(r),n}getTextLayout(e,t){const n=(0,C.assign)({},{},t.box);let i={height:n.height,width:n.width,text:e};if(t.needRecalcDimensions){const a=i.height===void 0?i.width:null,r=this.getHelperSvg(a);i={...this.getTextBBox(e,r),text:e},(0,u.remove)(r)}return i}getLabelOptions(e){return{box:{x:Math.round(e.width/2+e.x),y:Math.round(e.height/2+e.y),width:e.width||o.Labels.label.width,height:e.height},style:{direction:"ltr",...this.style}}}getHelperSvg(e){let t=document.getElementById("helper-svg");return t||(t=document.createElement("div"),t.setAttribute("id","helper-svg"),t.setAttribute("class","foreign-text foreign-text-helper"),e&&t.setAttribute("style",`max-width: ${e}px`),document.body.appendChild(t)),t}getTextBBox(e,t){this.applySvgHelperContent(t,e);const n=t.getBoundingClientRect();return{width:this.isEmptyText(e)?0:n.width,height:n.height}}getDimensions(e,t){return t.needRecalcDimensions=!0,this.layoutText(e,t).dimensions}createText(e,t){return super.createText(e,t)}layoutText(e,t){if(this.isIEOrEdge()){const a=super.layoutText(e,t);return this.config.isRtl?this.layoutRtlText(a,t):a}const n=this.getTextLayout(e,t),i=this.createForeignObject(n,t);return{dimensions:{width:n.width,height:n.height},element:i}}getConnectionLabelPosition(e,t){const n=Math.floor(e.length/2-1),i=e[n],a=e[n+1],r={x:Math.round((a.x-i.x)/2),y:Math.round((a.y-i.y)/2)},c=i.x+r.x;let h=i.y+r.y;return i.y===a.y&&(h+=Math.round(t.height/2)+5),{x:c,y:h}}getLabelBounds(e,t){const n=this.getLabelOptions(e),i=this.getDimensions(t,n);return{height:i.height,width:i.width,x:Math.round(e.x+e.width/2-i.width/2),y:Math.round(e.y)}}isEmptyText(e){return!e||!e.trim()}resetLabelPosition(e){const{width:i,height:a}=this.getLabelBounds(e,e.labelTarget.caption);e.width=i,e.height=a;const r=e.parent;e.x=Math.round(r.x+r.width/2-e.width/2),e.y=Math.round(r.y+r.height+o.Labels.label.height/2)-1*2-1}addLabel(e,t,n,i=t.caption){if(!this.isEmptyText(i)){const a=this.getLabelPosition(t,n);a.y+=this.getLabelPaddingTop(t,n.delta);const r={id:R.Guid.create().toString(),getDimensions:!0,...f.pick(n,["type","width","height"])};e.createLabel(t,a,r)}}getLabelPosition(e,t=o.Labels.label){return this.diagramUtils.isConnection(e)?this.getConnectionLabelPosition(e.waypoints,t):this.getElementLabelPosition(e,t)}};F=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config")),(0,s.__param)(1,(0,o.Inject)("elements")),(0,s.__param)(2,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,o.DiagramElements,o.DiagramUtils])],F);let te=class{constructor(e,t){this.modeling=e,this.diagramText=t}setText(e,t){const n=e.label||e,i=e.labelTarget||e;return i.caption=t,[n,i]}preExecute(e){const t=e.element;t&&!t.label&&!o.DiagramUtils.isLabel(t)&&this.diagramText.addLabel(this.modeling,t,o.Labels.label,e.text)}execute(e){e.oldText=e.element.caption||"";const t=(e.text||"").trim();return this.setText(e.element,t)}revert(e){return this.setText(e.element,e.oldText)}resizeShape(e,t){this.modeling.resizeShape(e,t,{height:0,width:0})}postExecute(e){const t=e.element.label;if(!t)return;const n=this.diagramText;if(n.isEmptyText(e.text))this.modeling.removeShape(t,{unsetLabel:!1});else{const i=t.labelTarget.caption;if(i){const a=e.newBounds||n.getLabelBounds(t,i);this.resizeShape(t,a)}}}};te=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__param)(1,(0,o.Inject)("diagramText")),(0,s.__metadata)("design:paramtypes",[Object,F])],te);var ce=l(86534),le=l(66740);let me=class extends ce.Z{constructor(e,t){super(e),this.canvas=e,this.diagramUtils=t,this.convertUtils=new le.B(t)}execute(e){const t=super.execute(e);return this.convertUtils.setRelativePosition(t,e.labelTarget),t}};me=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("canvas")),(0,s.__param)(1,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object])],me);var Ut=l(28158);let fe=class extends Ut.Z{constructor(e,t){super(e),this.canvas=e,this.diagramUtils=t,this.convertUtils=new le.B(t)}execute(e){const t=super.execute(e);return this.convertUtils.setRelativePosition(t),t}};fe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("canvas")),(0,s.__param)(1,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object])],fe);var zt=l(39229),X=l(86463);let de=class extends zt.Z{constructor(e){super(e)}execute(e){super.execute(e)}postExecute(e){const{connection:t,hints:n}=e;n&&n.docking&&(e.dockingOrPoints=n.docking==="source"?(0,X.wS)(t.source):(0,X.wS)(t.target)),super.postExecute(e)}};de=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__metadata)("design:paramtypes",[Object])],de);var Ft=l(64053),Ht=l(26737);let ye=class extends Ft.Z{constructor(e){super(e),this.modeling=e,this.postExecute=function(t){const n=t.movingShapes,i=t.delta;this.modeling.moveElements(n,i,void 0,{autoResize:!1,attach:!1})},this.preExecute=function(t){const n=t.resizingShapes,i=t.delta,a=t.direction;n.forEach(r=>{const c=(0,Ht.zY)(r,a,i);this.modeling.resizeShape(r,c)})}}};ye=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__metadata)("design:paramtypes",[Object])],ye);var Kt=l(27879);let ve=class extends Kt.Z{constructor(e,t){super(e),this.modeling=e,this.canvas=t}getParent(e,t){const n=this.canvas.getRootElement();let i=super.getParent(e,t);return o.DiagramUtils.isLabel(i)&&(i=n),i}preExecute(e){super.preExecute(e)}};ve=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object])],ve);var Wt=l(60415);let be=class extends Wt.Z{constructor(e,t,n,i){super(e),this.modeling=e,this.elementRegistry=t,this.canvas=n,this.diagramUtils=i}setParent(e){const t=e.newParent;t&&(this.diagramUtils.isFlow(t)&&(e.targetConnection=t,e.newParent=this.getRealParent(e)),o.DiagramUtils.isLabel(t)&&(e.newParent=this.getRealParent(e)))}getRealParent(e){const t=this.diagramUtils.getAllContainers(this.elementRegistry.getAllElements()),n=this.canvas.getRootElement(),i=e.shapes[0];return this.diagramUtils.findRealElementParent({x:i.x,y:i.y},t,n)}postExecute(e){this.setParent(e),super.postExecute(e)}};be=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__param)(1,(0,o.Inject)("elementRegistry")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,o.DiagramUtils])],be);const Zt={CENTER:"center",RIGHT:"right",LEFT:"left"},Nt={TOP:"top",CENTER:"center",BOTTOM:"bottom"};let K=class extends w.Z{constructor(e,t,n,i,a,r,c,h,_){super(e,t,n,i),this.eventBus=e,this.elementFactory=t,this.commandStack=n,this.canvas=i,this.registry=a,this.diagramText=r,this.elements=c,this.rules=h,this.diagramUtils=_,this.convertUtils=new le.B(_)}addShapeHandlers(e){e[o.Handlers.shape.shapeCreate]=fe}addLabelHandlers(e){e[o.Handlers.label.create]=me}getLabelPositionByX(e,t){return e.horizontalAlignment===Zt.CENTER?e.x:e.x+t.width/2}getLabelPositionByY(e,t){return e.verticalAlignment===Nt.CENTER?e.y:e.y+t.height/2}getLabelPosition(e,t,n){let i,a;if(this.needResetLabelPosition(e,t)){const r=this.diagramText.getLabelPosition(t,n),c=this.getFixedLabelPosition(r,n,t);i=!f.isUndefined(e.x)&&f.isUndefined(e.y)?this.getLabelPositionByX(e,n):c.x,a=!f.isUndefined(e.y)&&f.isUndefined(e.x)?this.getLabelPositionByY(e,n):c.y}else i=this.getLabelPositionByX(e,n),a=this.getLabelPositionByY(e,n);return{x:Math.round(i),y:Math.round(a)}}getLabelSize(e,t){let n;if(e.width&&e.height)n={width:e.width,height:e.height};else{const i=e.caption||t.caption,a=this.diagramText.getLabelBounds(e,i);n={width:a.width,height:a.height}}return n}addElementHandlers(e){e[o.Handlers.element.updateLabel]=te}addConnectionHandlers(e){e[o.Handlers.connection.update]=de,e[o.Handlers.connection.reconnect]=de}getFixedLabelPosition(e,t,n){const r=e.x,c=this.diagramUtils.isConnection(n)?e.y:e.y+t.height/2-1*2-1;return{x:Math.round(r),y:Math.round(c)}}needResetLabelPosition(e,t){return f.isUndefined(e.x)||f.isUndefined(e.y)}getElement(e){return typeof e=="string"?this.registry.get(e):e}addElementsHandlers(e){e[o.Handlers.elements.create]=ve,e[o.Handlers.elements.move]=be}getLabelAttributes(e,t,n,i){return{id:t.id,type:e.type,width:n.width,height:n.height,caption:e.caption,backgroundStyle:e.backgroundStyle,style:e.style,hidden:i?.hidden,tooltip:e.tooltip,tooltipConfig:e.tooltipConfig}}getElementAttributes(e,t,n){const{caption:i,type:a}=t,r=t.width||n.width,c=t.height||n.height,h=t.largeImage||n.largeImage,_=t.name;return{id:e,type:a,width:r,height:c,largeImage:h,name:_,caption:i&&i.toString(),tooltip:t.tooltip,tooltipConfig:t.tooltipConfig}}centerViewbox(e){o.DiagramUtils.centerViewboxOnElement(e,this.canvas)}getElementPosition(e,t){const{x:n=0,y:i=0}=e,a=e.width||t.width,r=e.height||t.height;return{x:Math.round(n+a/2),y:Math.round(i+r/2)}}createDiagramLabel(e){const t=f.cloneDeep(e.value),n=this.registry.get(t.parent);if(n){this.convertUtils.setShapeAbsolutePosition(t,n);const i=this.getLabelSize(t,n);t.height=t.height||i.height;const a=this.getLabelPosition(t,n,i),r=this.getLabelAttributes(t,e,i,n);return this.createLabel(n,a,r,n)}}createDiagramElement(e,t){if(this.registry.get(e))return;const n=this.elements.items.root.id,i=f.cloneDeep(t[e]),a=i.parent||n;let r=this.registry.get(a);r||(this.createDiagramElement(a,t),r=this.registry.get(a)),this.convertUtils.setShapeAbsolutePosition(i,r);const c=this.elements.getConfig(i),h=this.getElementAttributes(e,i,c),_=this.getElementPosition(i,c);this.createShape(h,_,r,0,{generateUniqueCaption:!1})}getHandlers(){const e=super.getHandlers(this);return e.spaceTool=ye,this.addLabelHandlers(e),this.addShapeHandlers(e),this.addElementHandlers(e),this.addElementsHandlers(e),this.addConnectionHandlers(e),e}moveConnection(e,t,n,i){super.moveConnection(e,t,e.parent,n,i)}createShape(e,t,n,i,a){return super.createShape(e,t,n,i,a)}pasteElements(e,t,n){super.pasteElements(e,t,n)}moveShape(e,t,n=null,i=null,a=null){super.moveShape(e,t,n,i,a)}updateWaypoints(e,t,n={}){const i=this.getElement(e);i&&(f.defaults(n,{doUpdateLabelPosition:!0}),super.updateWaypoints(i,t,n))}reconnect(e,t,n,i,a){a&&a.docking==="target"&&f.defaults(a,{isUpdateConnectionType:!0});const r=this.getElement(e),c=this.getElement(t),h=this.getElement(n);r&&(c||h)&&super.reconnect(r,c,h,i,a)}reconnectStart(e,t,n,i={}){if(!n){const a=this.getElement(e),r=a.waypoints[0];n=r.original||o.DiagramUtils.getOriginalWaypoint(r,a.source)}super.reconnectStart(e,t,n,i)}reconnectEnd(e,t,n,i={}){if(!n){const a=this.getElement(e),r=a.waypoints,c=r[r.length-1];n=c.original||o.DiagramUtils.getOriginalWaypoint(c,a.target)}super.reconnectEnd(e,t,n,i)}createLabel(e,t,n,i){if(this.registry.get(n.id))return;const a=super.createLabel(e,t,n,i);return a.parent=e,a}removeConnection(e){const t=this.getElement(e);t&&super.removeConnection(t)}connect(e,t,n,i){const a=this.canvas.getRootElement();return n=n||{},this.createConnection(e,t,n,a,i)}createConnection(e,t,n,i,a,r){if(typeof n=="object"&&(r=a,a=i,i=n,n=void 0),!this.registry.get(i.id))return a=a||this.canvas.getRootElement(),super.createConnection(e,t,n,i,a,r)}updateLabel(e,t,n=null){const i=this.getElement(e);i&&this.commandStack.execute(o.Handlers.element.updateLabel,{element:i,text:t,newBounds:n})}moveConnectionLabel(e,t){const n={connection:e,hints:t};this.eventBus.fire(o.Handlers.connection.moveConnectionLabel,{context:n})}removeElementChildren(e){const t=e.children;for(t.length&&this.eventBus.fire(o.Handlers.elements.removing,{elements:t});t.length>0;){const n=t[0];this.removeShape(n,{force:!0})}}resizeShape(e,t,n,i){super.resizeShape(e,t,n,i)}removeShape(e,t){super.removeShape(e,t)}removeElements(e,t=!1){(t||this.rules.allowed(o.Handlers.elements.delete,{elements:e}))&&super.removeElements(e)}clearDiagram(){const e=this.registry.getAllElements();super.removeElements(e)}layoutConnection(e,t){super.layoutConnection(e,t)}};K=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("elementFactory")),(0,s.__param)(2,(0,o.Inject)("commandStack")),(0,s.__param)(3,(0,o.Inject)("canvas")),(0,s.__param)(4,(0,o.Inject)("elementRegistry")),(0,s.__param)(5,(0,o.Inject)("diagramText")),(0,s.__param)(6,(0,o.Inject)("elements")),(0,s.__param)(7,(0,o.Inject)("rules")),(0,s.__param)(8,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,o.DiagramElements,Object,o.DiagramUtils])],K);let he=class extends b.Z{constructor(e,t,n,i,a,r,c){super(e,t,n,i,c,r),this.rules=a;const h=this.start;this.start=(_,E,T)=>{this.rules.allowed("canConnectionSegmentMove")&&h.call(this,_,E,T)}}};he=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("dragging")),(0,s.__param)(4,(0,o.Inject)("rules")),(0,s.__param)(5,(0,o.Inject)("modeling")),(0,s.__param)(6,(0,o.Inject)("graphicsFactory")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,K,Object])],he);var $e=l(64960);const ct=".entry";let _e=class{constructor(e,t,n,i){this.eventBus=e,this.overlays=t,this.rules=n,this.canvas=i,this._providers=[],this.current=null,this.init()}init(){this.eventBus.on("selection.changed",e=>{const t=e.newSelection;t.length===1?this.open(t[0]):this.close()}),this.eventBus.on("elements.delete",e=>{const t=e.elements;(0,C.forEach)(t,n=>{this.isOpen(n)&&this.close()})}),this.eventBus.on("element.changed",e=>{const t=e.element,n=this.current;n&&n.element===t&&this.open(t,!0)}),this.eventBus.on("canvas.viewbox.changing",()=>{!this.isOpen()||(0,C.assign)(this.current.pad.html.style,{visibility:"hidden"})}),this.eventBus.on("canvas.viewbox.changed",()=>{const e=this.current&&this.current.element;e&&this.open(e,!0)}),this.eventBus.on("diagram.clear",()=>{this.close()})}canOpen(e){return this.rules.allowed("canOpenContextPad",{})}getSeparatorConfig(){return{className:"entry-separator"}}getNoopConfig(){return{noop:{className:"noop-entry"}}}sliceObj(e,t,n){return Object.keys(e).slice(t,n).reduce((i,a)=>(i[a]=e[a],i),{})}addNoopEntry(e){const t=Object.keys(e);return t.length<=2||t[1]==="setup"?e:{...this.sliceObj(e,0,1),...this.getNoopConfig(),...this.sliceObj(e,1,t.length)}}addSeparators(e){const t=Object.keys(e);return t.length<=1?e:t.length===2?t[1]==="setup"?e:(this.oneColumnMode=!0,{...this.sliceObj(e,0,1),separator1:this.getSeparatorConfig(),...this.sliceObj(e,1,t.length)}):{...this.sliceObj(e,0,2),separator1:this.getSeparatorConfig(),separator2:this.getSeparatorConfig(),...this.sliceObj(e,2,t.length)}}fixConnectToolPosition(e){const t=Object.keys(e);if(t.length<=2)return e;const n=t.indexOf("connect");if(n<0||n%2===0)return e;const i=t[n-1];return{...this.sliceObj(e,0,n-1),connect:e.connect,[i]:e[i],...this.sliceObj(e,n+1,t.length)}}fixEntries(e){return this.oneColumnMode=!1,e=this.addNoopEntry(e),e=this.addSeparators(e),e=this.fixConnectToolPosition(e),e}trigger(e,t,n=!1){const{entries:i,element:a}=this.current,r=t.delegateTarget||t.target;if(!r)return t.preventDefault();const c=(0,u.attr)(r,"data-action"),_=i[c].action,E=t.originalEvent||t;if((0,C.isFunction)(_)){if(e==="click")return _(E,a,n)}else if(_[e])return _[e](E,a,n);t.preventDefault()}getConnectionBBox(e){const t=(0,$e.jY)(e);return{x:t.x,y:t.y,width:t.width,height:t.height}}getElementBBox(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}getPadPosition(e){const t={left:9,top:-6},n=this.canvas.viewbox(),i=e.waypoints?this.getConnectionBBox(e):this.getElementBBox(e),a=i.x+i.width+t.left-n.x,r=i.y+t.top-n.y,c=n.scale;return{x:Math.round(a*c),y:Math.round(r*c)}}getEntryControl(e,t){const{className:n,title:i,imageUrl:a}=t,r=(0,u.domify)(`<div class="entry" draggable="true" data-action="${e}"></div>`);if(n){const c=(0,u.classes)(r);((0,C.isArray)(n)?n:n.split(/\s+/g)).forEach(_=>{c.add(_)})}return i&&(0,u.attr)(r,"title",i),a&&r.appendChild((0,u.domify)('<img src="'+a+'">')),r}addEntriesContainer(e){const t=(0,u.domify)('<div class="group"></div>');return(0,C.forEach)(e,(n,i)=>{const a=this.getEntryControl(i,n);t.appendChild(a)}),t}getPad(e){if(this.isOpen())return this.current.pad;const t=(0,u.domify)('<div class="djs-context-pad"></div>');u.delegate.bind(t,ct,"click",a=>{this.trigger("click",a)}),u.delegate.bind(t,ct,"dragstart",a=>{this.trigger("dragstart",a)}),u.event.bind(t,"mousedown",a=>{a.stopPropagation()});const n=this.getPadPosition(e);(0,C.assign)(t.style,{position:"absolute",left:n.x+"px",top:n.y+"px",visibility:"visible"});const i={html:t};return this.eventBus.fire("contextPad.create",{element:e,pad:i}),i}getEntries(e){const t={};return(0,C.forEach)(this._providers,n=>{const i=n.getContextPadEntries(e);(0,C.forEach)(i,(a,r)=>{t[r]=a})}),this.fixEntries(t)}registerProvider(e){this._providers.push(e)}open(e,t=!1){if(!t&&this.isOpen(e)||(this.close(),!this.canOpen(e)))return;const n=this.getEntries(e);if(f.isEmpty(n))return;const i=this.addEntriesContainer(n),a=this.getPad(e),r=a.html;r.appendChild(i),(0,u.classes)(r).add("open"),(0,u.classes)(r).toggle("one-column-grid",this.oneColumnMode),this.canvas.getContainer().appendChild(r),this.current={element:e,pad:a,entries:n},this.eventBus.fire("contextPad.open",{current:this.current})}isOpen(e){return this.current&&(!e||this.current.element===e)}close(){!this.isOpen()||((0,u.remove)(this.current.pad.html),this.eventBus.fire("contextPad.close",{current:this.current}),this.current.pad.html=null,this.current=null)}};_e=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("overlays")),(0,s.__param)(2,(0,o.Inject)("rules")),(0,s.__param)(3,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object])],_e);var Vt=l(26327);let xe=class extends Vt.Z{constructor(e,t,n,i,a,r,c,h,_,E){super(e,t,n,i,a,r,c,h),this.canvas=e,this.create=t,this.clipboard=n,this.elementFactory=i,this.eventBus=a,this.modeling=r,this.mouse=c,this.rules=h,this.diagramText=_,this.config=E,this.init()}_onPasteElement(e){Object.assign(e.hints,{generateUniqueCaption:!1,isElementCopyPaste:!0})}onCopyElement({element:e,descriptor:t}){this.copyProperties.forEach(n=>t[n]=(0,f.clone)(e[n]))}init(){this.copyProperties=["type","caption"],this.eventBus.on("copyPaste.pasteElements",e=>this._onPasteElement(e)),this.eventBus.on("copyPaste.copyElement",e=>this.onCopyElement(e))}resetLabelsPosition(e){const t=e.filter(n=>o.DiagramUtils.isLabel(n));t.length===1&&e.length===2&&this.diagramText.resetLabelPosition(t[0])}_createElements(e){const t=super._createElements(e);return this.resetLabelsPosition(t),t}createShape(e){const t=e.id,n=super.createShape(e);return n.sourceId=t,n}};xe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("canvas")),(0,s.__param)(1,(0,o.Inject)("create")),(0,s.__param)(2,(0,o.Inject)("clipboard")),(0,s.__param)(3,(0,o.Inject)("elementFactory")),(0,s.__param)(4,(0,o.Inject)("eventBus")),(0,s.__param)(5,(0,o.Inject)("modeling")),(0,s.__param)(6,(0,o.Inject)("mouse")),(0,s.__param)(7,(0,o.Inject)("rules")),(0,s.__param)(8,(0,o.Inject)("diagramText")),(0,s.__param)(9,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object,Object,Object])],xe);let ne=class{constructor(e,t){this.eventBus=e,this.canvas=t}getEntry(e,t){const n=(0,C.matchPattern)({id:t}),i=(0,C.find)(e,n);if(!i)throw new Error("entry not found");return i}createContainer(){const t=this.canvas.getContainer().getBoundingClientRect(),i=(0,u.query)(`[data-action="${this.paletteEntryId}"]`).getBoundingClientRect(),a={x:12,y:-5},r={x:i.left+i.width+a.x-t.left,y:i.top+a.y-t.top},c=(0,u.domify)('<div class="djs-popup diagram-create-popup-menu">');return(0,C.assign)(c.style,{position:"absolute",left:r.x+"px",top:r.y+"px",visibility:"hidden"}),c}alignPosition(e){const n=this.canvas.getContainer().getBoundingClientRect(),i=e.getBoundingClientRect(),a=10,r=i.top+i.height-(n.top+n.height)+a;if(r>0){let c=i.top-n.top-r;c=c>a?c:a,(0,C.assign)(e.style,{top:c+"px"})}}entryAction(e,t,n){n.preventDefault();const i=n.delegateTarget||n.target,a=(0,u.attr)(i,"data-id"),r=this.getEntry(e,a),c=r.action[t];c&&c.call(null,n,r)}attachContainer(e,t){const n=this.canvas.getContainer();u.delegate.bind(t,".entry","dragstart",this.entryAction.bind(this,e,"dragstart")),u.delegate.bind(t,".entry","click",this.entryAction.bind(this,e,"click")),n.appendChild(t),this.alignPosition(t),(0,C.assign)(t.style,{visibility:"visible","z-index":1e3,opacity:1}),this.subscribeEvents(),t.onwheel=i=>this.onWheel(i)}createEntriesContainer(e){const t=(0,u.domify)('<div class="djs-popup-body">');return(0,C.forEach)(e,n=>{const i=this.createEntry(n);t.appendChild(i)}),t}createEntry(e){if(!e.id)throw new Error("every entry must have the id property set");const t=(0,u.domify)('<div class="entry" draggable="true"></div>');(0,u.classes)(t).add("entry"),(0,u.attr)(t,"data-id",e.id);const i=(0,u.domify)("<span>");return i.textContent=e.label,t.appendChild(i),t.appendChild((0,u.domify)('<img src="'+e.imageUrl+'" />')),t}subscribeEvents(){const e=this.eventBus;e.once("contextPad.close",this.close.bind(this)),e.once("popupMenu.open",this.close.bind(this)),e.once("canvas.viewbox.changing",this.close.bind(this)),e.once("commandStack.changed",this.close.bind(this)),e.once("element.mousedown",m.aN.HIGH,this.close.bind(this)),e.once("keyboard.keydown",m.aN.HIGH,this.close.bind(this))}unsubscribeEvents(){const e=this.eventBus;e.off("contextPad.close",this.close.bind(this)),e.off("popupMenu.open",this.close.bind(this)),e.off("canvas.viewbox.changed",this.close.bind(this)),e.off("commandStack.changed",this.close.bind(this)),e.off("element.mousedown",this.close.bind(this)),e.off("keyboard.keydown",this.close.bind(this))}open(e,t,n){if(this.isOpen()&&(this.close(),e.type===this.currentElement.type))return;this.currentElement=e,this.paletteEntryId=t,this.eventBus.fire("createPopupMenu.open",{paletteEntryId:t});const i=this.createContainer(),a=this.createEntriesContainer(n);i.appendChild(a),this.attachContainer(n,i),this.container=i}close(){if(!this.isOpen())return;const e=this.paletteEntryId;this.eventBus.fire("createPopupMenu.close",{paletteEntryId:e}),this.unsubscribeEvents(),(0,u.remove)(this.container),this.container=null}isOpen(){return!!this.container}onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this.container.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}};ne=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object])],ne);var $t=l(73906);let Ce=class extends $t.Z{constructor(e,t){super(t,e),this.injector=e}_registerDefaultActions(){super._registerDefaultActions.call(this,this.injector);const e=this.injector.get("elementRegistry",!1),t=this.injector.get("selection",!1);e&&t&&super._registerAction("selectAll",()=>{const n=e.getAllElements();return t.select(n),n})}};Ce=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__metadata)("design:paramtypes",[Object,Object])],Ce);var Yt=l(62565),Gt=l(11685),Ye=l.n(Gt);class lt extends Yt.Z{constructor(){super(),Ye().config({disableDefaultAlphabetLength:!0}),Ye().characters("0123456789abcdefghijklmnopqrstuvwxyz")}generateId(e){return e+"_"+Ye().generate()}create(e,t){return t=Object.assign({},t),t.type||(t.type=e),t.id||(t.id=this.generateId(t.type)),super.create(e,t)}}var Xt=l(89817);let je=class extends Xt.Z{constructor(e){super(),this.injector=e}getAllElements(){const t=this.injector.get("canvas",!1).getRootElement();return super.filter(n=>n!==t)}getAll(){return this.getAllElements()}getGraphics(e,t){return super.getGraphics(e,t)}get(e){return super.get(e)}};je=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__metadata)("design:paramtypes",[Object])],je),(0,v.ngxTranslateExtract)("diagram.elementTools.connect.connect"),(0,v.ngxTranslateExtract)("diagram.elementTools.remove"),(0,v.ngxTranslateExtract)("diagram.elementTools.changeType");const Qt="assets/images/icon_tools_del.svg",Jt="assets/images/icon_tools_setup.svg",qt="assets/images/icon_tools_arrow.svg";let Ee=class{constructor(e,t){this.elements=e,this.config=t,this.addItems=this.getAddItems(),this.tools=this.getTools()}getAddItems(){return[]}getTools(){const e=this.config.localizableStrings;return{connect:{imageUrl:qt,title:e.get("elementTools.connect.connect")},setup:{imageUrl:Jt,title:e.get("elementTools.changeType")},delete:{imageUrl:Qt,title:e.get("elementTools.remove")}}}};Ee=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("elements")),(0,s.__param)(1,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[o.DiagramElements,Object])],Ee);var en=l(91112),dt=l(28229),W=l(91459);function ie(p){const e=W.Y[p.code];return e?e.keyCode:p.keyCode}function ht(p){if(p.ctrlKey||p.metaKey||p.altKey)return!1;const e=p.which||p.keyCode;return e>47&&e<58||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function Z(p,e,t={}){return!f.isUndefined(t.ctrl)&&t.ctrl!==(0,dt.JS)(p)||!f.isUndefined(t.shift)&&t.shift!==(0,dt.cY)(p)?!1:ie(p)===e.keyCode}function gt(p){return ie(p)===W.Y.Enter.keyCode}function pt(p,e){p.shiftKey||(p.stopPropagation(),p.preventDefault(),p.ctrlKey||p.altKey?document.execCommand("insertText",!1,`
`):e())}class ut extends en.Z{registerBindings(e,t){const a=(r,c)=>{t.isRegistered(r)&&e.addListener(c)};a("stepZoom",r=>{const c=r.keyEvent;if(Z(c,W.Y.Equal,{ctrl:!0})||Z(c,W.Y.NumpadAdd,{ctrl:!0}))return t.trigger("stepZoom",{value:1}),!0}),a("undo",r=>{const c=r.keyEvent;if(Z(c,W.Y.KeyZ,{ctrl:!0,shift:!1}))return t.trigger("undo"),!0}),a("redo",r=>{const c=r.keyEvent;if(Z(c,W.Y.KeyY,{ctrl:!0})||Z(c,W.Y.KeyZ,{ctrl:!0,shift:!0}))return t.trigger("redo"),!0}),a("copy",r=>{const c=r.keyEvent;if(Z(c,W.Y.KeyC,{ctrl:!0}))return t.trigger("copy"),!0}),a("paste",r=>{const c=r.keyEvent;if(Z(c,W.Y.KeyV,{ctrl:!0}))return t.trigger("paste"),!0}),a("selectAll",r=>{const c=r.keyEvent;if(Z(c,W.Y.KeyA,{ctrl:!0}))return t.trigger("selectAll"),!0}),super.registerBindings(e,t)}}var tn=l(43801);let De=class extends tn.Z{constructor(e,t,n,i,a,r){super(e,t,n,i,a,r),this.eventBus=e,this.canvas=t,this.dragging=n,this.elementRegistry=i,this.selection=a,this.toolManager=r}select(e,t){const n=(0,$e.RH)(e,t),i=(0,C.values)(n),a=i.filter(r=>o.DiagramUtils.isLabel(r)&&i.includes(r.parent)||!o.DiagramUtils.isLabel(r));this.selection.select(a)}};De=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("dragging")),(0,s.__param)(3,(0,o.Inject)("elementRegistry")),(0,s.__param)(4,(0,o.Inject)("selection")),(0,s.__param)(5,(0,o.Inject)("toolManager")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],De);var N=l(8239);let Se=class{constructor(e,t,n,i,a){this.elementRegistry=e,this.diagramModeling=t,this.elements=n,this.eventBus=i,this.logger=a,this.errors=[],this.loadRenderInterval=500}createElement(e,t){this.diagramModeling.createDiagramElement(e,t)}createLabel(e,t){this.diagramModeling.createDiagramLabel({value:e,id:t})}createConnection(e,t){const n=f.cloneDeep(e),{source:i,target:a}=n,r=this.elementRegistry,c=r.get(i),h=r.get(a),_=this.getConnectionAttributes(t,n);this.diagramModeling.connect(c,h,_,e.hints||{})}addOriginalToWaypoint(e,t){if(!e.original){const n=this.elementRegistry.get(t);n&&(e.original=o.DiagramUtils.getOriginalWaypoint(e,n))}}addOriginalToConnection(e){const t=e.waypoints;if(t&&t.length>1){const n=t[0];this.addOriginalToWaypoint(n,e.source);const i=t[t.length-1];this.addOriginalToWaypoint(i,e.target)}}getConnectionAttributes(e,t){const{waypoints:n,name:i,type:a=o.DiagramElementType.connection}=t;this.addOriginalToConnection(t);let{caption:r,documentation:c}=t;return r=r&&r.toString(),c=c&&c.toString(),{id:e,waypoints:n,name:i,caption:r,documentation:c,type:a}}load(e,t,n){var i=this;return(0,N.Z)(function*(){i.errors=[];const a=[...f.map(e.elements,(c,h)=>({handler:()=>i.createElement(h,e.elements),id:h})),...f.map(e.connections,(c,h)=>({handler:()=>i.createConnection(c,h),id:h})),...f.map(e.labels,(c,h)=>({handler:()=>i.createLabel(c,h),id:h}))];let r=Number(new Date);try{for(let c=0,h=a.length;c<h&&!t.isStopped;c++){try{a[c].handler()}catch(E){i.errors.push(a[c].id+" "+E.toString()),console.error(E)}if(Number(new Date)-r>i.loadRenderInterval){const E=Math.round(c/h*100);n.next(E),yield new Promise(T=>f.delay(T,0)),r=Number(new Date)}}return i.errors.length&&i.logger.exception(`Error when loading process with ID: ${e.id}`,{loggerName:"DiagramLoader"},i.errors),i.errors}finally{n.next(0),t.isStopped||i.eventBus.fire("diagram.loaded")}})()}};Se=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("elementRegistry")),(0,s.__param)(1,(0,o.Inject)("modeling")),(0,s.__param)(2,(0,o.Inject)("elements")),(0,s.__param)(3,(0,o.Inject)("eventBus")),(0,s.__param)(4,(0,o.Inject)("loggerService")),(0,s.__metadata)("design:paramtypes",[Object,K,o.DiagramElements,Object,v.LoggerService])],Se);var nn=l(74865),sn=l(94450);class $ extends nn.LocalStorageService{constructor(){super({prefix:"bpmonline-designer.diagram",storageType:"localStorage"}),this.diagramId=""}set(e,t,n=!0){return n&&(e+="."+this.diagramId),super.set(e,t)}get(e,t=!0){return t&&(e+="."+this.diagramId),super.get(e)}remove(...e){return e&&(e=e.map(t=>t+"."+this.diagramId)),super.remove(...e)}}$.\u0275fac=function(e){return new(e||$)},$.\u0275prov=sn.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac});var an=l(33185),mt=l.n(an),on=l(64790);const we=50,rn={min:.2,max:4},cn=10,ln=.1;let Oe=class{constructor(e,t,n,i,a,r,c,h){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.zoomScroll=i,this.localStorage=a,this.popupMenu=r,this.config=c,this.diagramUtils=h,this.openStateKey="minimap-state",this.loadMiniMapRenderInterval=50,this._onElementAdded=this.onElementAdded.bind(this),this._onElementRemoved=this.onElementRemoved.bind(this),this._onElementsChanged=this.onElementsChanged.bind(this),this._onElementUpdateId=this.onElementUpdateId.bind(this),this.init()}init(){const e=this.getOpenState();this._state={isOpen:e,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null,parentClientRect:null,zoomDelta:0,data:null},this.createComponent(),this.registerPopupMenu(),this.subscribeEvents()}getOpenState(){return this.localStorage.get(this.openStateKey,!1)}setOpenState(e){(0,C.assign)(this._state,{isOpen:e}),this.localStorage.set(this.openStateKey,e,!1),e?((0,u.classes)(this.parent).add("open"),(0,u.attr)(this.mapButtons.preview,"title",this.config.localizableStrings.get("miniMapClose"))):((0,u.classes)(this.parent).remove("open"),(0,u.attr)(this.mapButtons.preview,"title",this.config.localizableStrings.get("miniMapOpen")))}createComponent(){this.parent=document.createElement("div"),(0,u.classes)(this.parent).add("djs-minimap"),u.event.bind(this.parent,"mousedown",t=>t.stopPropagation());const e=this.canvas.getContainer();this.isOpen()&&(0,u.classes)(this.parent).add("open"),e.appendChild(this.parent),this.initButtons(),this.map=document.createElement("div"),(0,u.classes)(this.map).add("map"),this.parent.appendChild(this.map),this.svg=(0,j.Ue)("svg"),(0,j.Lj)(this.svg,{width:"100%",height:"100%"}),(0,j.R3)(this.map,this.svg),this.elementsGroup=(0,j.Ue)("g"),(0,j.R3)(this.svg,this.elementsGroup),this.viewportGroup=(0,j.Ue)("g"),(0,j.R3)(this.svg,this.viewportGroup),this.viewport=(0,j.Ue)("rect"),(0,j.Sh)(this.viewport).add("viewport"),(0,j.R3)(this.viewportGroup,this.viewport),this.viewportDom=document.createElement("div"),(0,u.classes)(this.viewportDom).add("viewport-dom"),this.parent.appendChild(this.viewportDom),this.overlay=document.createElement("div"),(0,u.classes)(this.overlay).add("overlay"),this.parent.appendChild(this.overlay)}initButtons(){const e=document.createElement("div");(0,u.classes)(e).add("map-buttons"),this.mapButtons={},this.getMapButtonsConfig().forEach(n=>{const i=document.createElement("div");if(["map-button",...n.classes].forEach(a=>(0,u.classes)(i).add(a)),n.title){let a=this.config.localizableStrings.get(n.title);n.shortcut&&(a+=` (${n.shortcut})`),(0,u.attr)(i,"title",a)}n.caption&&(i.textContent=n.caption),this.subscribeUserEvent(i,"click",n.click),this.mapButtons[n.id]=i,e.appendChild(i)}),this.parent.appendChild(e)}getMapButtonsConfig(){return[{id:"preview",classes:["material-icons","preview-button"],title:this.isOpen()?"miniMapClose":"miniMapOpen",caption:"icon_preview_16",click:()=>this.preview()},{id:"fitToView",classes:["material-icons","fit-to-view-button"],title:"fitToView",shortcut:"Ctrl+0",caption:"icon_fullscreen_16",click:()=>this.fitToView()},{id:"resetView",classes:["reset-view-button"],title:"resetView",caption:"1:1",click:()=>this.resetView()},{id:"zoomOut",classes:["material-icons","zoom-out-button"],title:"zoomOut",shortcut:"Ctrl+-",caption:"icon_zoom_out_16",click:()=>this.zoomScroll.zoomOut()},{id:"zoomIn",classes:["material-icons","zoom-in-button"],title:"zoomIn",shortcut:"Ctrl++",caption:"icon_zoom_in_16",click:()=>this.zoomScroll.zoomIn()},{id:"zoom",classes:["zoom-button"],caption:"100%",click:()=>this.togglePopupMenu()}]}subscribeEvents(){let e=!0;this.eventBus.on("diagram.loaded",()=>{e?(e=!1,this.isOpen()&&this.open().then(()=>{this.onDiagramLoaded().then()})):this.onDiagramLoaded().then()}),this.subscribeUserEvent(this.svg,"click",t=>this.onSvgClick(t)),u.event.bind(this.viewportDom,"mousedown",t=>this.onMousedown(!1,t)),u.event.bind(this.svg,"mousedown",t=>this.onMousedown(!0,t)),this.subscribeUserEvent(this.parent,"wheel",t=>this.onParentWheel(t)),this.eventBus.on("canvas.viewbox.changed",()=>this.onViewBoxChanged()),this.eventBus.on("canvas.resized",()=>this.onCanvasResized()),this.eventBus.on("zoom.changed",(t,n)=>this._onZoomChanged(n)),this.eventBus.on("keyboard.keydown",t=>this.onKeyDown(t)),this.eventBus.on("diagram.clear",()=>this.onClear())}onDiagramLoaded(){var e=this;return(0,N.Z)(function*(){e.isOpen()&&(yield e.loadData(),e.subscribeElementEvents())})()}onSvgClick(e){this.setViewboxCenteredAroundClickEvent(e)}onViewBoxChanged(){this._state.isDragging||this.update()}onCanvasResized(){document.body.contains(this.parent)&&(this._state.isDragging||this.update(),this._state._svgClientRect=this.svg.getBoundingClientRect())}onKeyDown({keyEvent:e}){if(e.ctrlKey&&ie(e)===m.Ys.Digit0.keyCode)return this.fitToView(),!1}onClear(){this.isOpen()&&this.unsubscribeElementEvents(),this.elementRegistry.getAllElements().forEach(e=>this.removeElement(e))}subscribeUserEvent(e,t,n){u.event.bind(e,t,i=>{i.preventDefault(),i.stopPropagation(),n.call(this,i)})}onParentWheel(e){if(!e.ctrlKey||(this.updateSvgClientRect(),!this.isPointInside(e,this._state._svgClientRect)))return;const{deltaMode:t,deltaX:n,deltaY:i}=e,a=t===0?.02:.32,r=Math.sqrt(Math.pow(i,2)+Math.pow(n,2))*Math.sign(i)*-a;if(this._state.zoomDelta+=r,Math.abs(this._state.zoomDelta)>ln){const c=r>0?1:-1,h=Math.log(this.canvas.zoom())/Math.log(10),_=this.getStepSize(rn,cn*2),E=Math.round(h/_)*_+_*c,T=Math.pow(10,E);this.zoomScroll.setZoom(T),this._state.zoomDelta=0;const I=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint(I),this.update()}}update(){if(!this.isOpen())return;const e=this.canvas.viewbox(),t=e.inner,n=e.outer;if(!this.validViewbox(e))return;let i,a,r,c;const h=n.width-t.width,_=n.height-t.height;t.width<n.width?(i=t.x-h/2,r=n.width,t.x+t.width<n.width&&(i=Math.min(0,t.x))):(i=t.x,r=t.width),t.height<n.height?(a=t.y-_/2,c=n.height,t.y+t.height<n.height&&(a=Math.min(0,t.y))):(a=t.y,c=t.height),i=i-we,a=a-we,r=r+we*2,c=c+we*2,this.lastViewbox={x:i,y:a,width:r,height:c},(0,j.Lj)(this.svg,{viewBox:i+", "+a+", "+r+", "+c}),(0,j.Lj)(this.viewport,{x:e.x,y:e.y,width:e.width,height:e.height});const E=this.map.getBoundingClientRect();this._state._parentClientRect=E;const T=this.viewport.getBoundingClientRect(),I={top:T.top-E.top,left:T.left-E.left,width:T.width,height:T.height};(0,C.assign)(this.viewportDom.style,{top:I.top+"px",left:I.left+"px",width:I.width+"px",height:I.height+"px"});const V=this.getOverlayClipPath(E,I);(0,C.assign)(this.overlay.style,{clipPath:V})}setViewboxCenteredAroundClickEvent(e){this.updateSvgClientRect();const t=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint(t),this.update()}onMousedown(e,t){if(t.button!==0)return;this.updateSvgClientRect(),e&&this.setViewboxCenteredAroundClickEvent(t);const n=this.mapMousePositionToDiagramPoint(t),i=this.canvas.viewbox(),a=this.getOffsetViewport(n,i),r=this.viewportDom.getBoundingClientRect(),c={x:t.clientX-r.left+1,y:t.clientY-r.top+1};(0,C.assign)(this._state,{cachedViewbox:i,initialDragPosition:{x:t.clientX,y:t.clientY},isDragging:!0,offsetViewport:a,offsetViewportDom:c,viewportClientRect:this.viewport.getBoundingClientRect(),parentClientRect:this.map.getBoundingClientRect()}),u.event.bind(document,"mousemove",this.onMousemove.bind(this)),u.event.bind(document,"mouseup",this.onMouseup.bind(this))}updateSvgClientRect(){(!this._state._svgClientRect||this.isZeroDimensional(this._state._svgClientRect))&&(this._state._svgClientRect=this.svg.getBoundingClientRect())}onMousemove(e){if(this._state.isDragging){this.updateSvgClientRect();const t=this._state.offsetViewportDom,n=this._state.viewportClientRect,i=this._state.parentClientRect;(0,C.assign)(this.viewportDom.style,{top:e.clientY-t.y-i.top+"px",left:e.clientX-t.x-i.left+"px"});const a=this.getOverlayClipPath(i,{top:e.clientY-t.y-i.top,left:e.clientX-t.x-i.left,width:n.width,height:n.height});(0,C.assign)(this.overlay.style,{clipPath:a});const r=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint({x:r.x-this._state.offsetViewport.x,y:r.y-this._state.offsetViewport.y})}}onMouseup(e){if(this._state.isDragging){const t=this._state.initialDragPosition;t.x===e.clientX&&t.y===e.clientY&&this.setViewboxCenteredAroundClickEvent(e),this.update(),(0,C.assign)(this._state,{cachedViewbox:null,initialDragPosition:null,isDragging:!1,offsetViewport:null,offsetViewportDom:null}),u.event.unbind(document,"mousemove",this.onMousemove.bind(this)),u.event.unbind(document,"mouseup",this.onMouseup.bind(this))}}_onZoomChanged(e){this.mapButtons.zoom.textContent=Math.round(e*100)+"%"}updateElement(e){try{e.parent!==void 0&&e.parent!==null&&(this.removeElement(e),this.addElement(e))}catch(t){console.warn(`Minimap#updateElement error: ${t}`)}}addElement(e){if(this.removeElement(e),e.hidden)return;let t,n,i;const a=this.createElement(e);if(a){const r=(0,u.query)("#"+mt()(e.parent.id),this.elementsGroup),c=this.elementRegistry.getGraphics(e),h=this.elementRegistry.getGraphics(e.parent),_=this.getIndexOfChildInParentChildren(c,h);return _!=="undefined"?r?r.childNodes.length>_?this.insertChildAtIndex(a,r,_):this.insertChildAtIndex(a,r,r.childNodes.length-1):this.elementsGroup.appendChild(a):this.elementsGroup.appendChild(a),this.diagramUtils.isConnection(e)?(t=e.parent,n=0,i=0,typeof t.x<"u"&&typeof t.y<"u"&&(n=-t.x,i=-t.y),(0,j.Lj)(a,{transform:"translate("+n+" "+i+")",strokeWidth:"4"})):(n=e.x,i=e.y,r&&(t=e.parent,typeof t.x<"u"&&typeof t.y<"u"&&(n-=t.x,i-=t.y)),(0,j.Lj)(a,{transform:"translate("+n+" "+i+")"})),e.children&&e.children.length&&e.children.forEach(E=>{this.addElement(E)}),a}}removeElement(e){const t=this.svg.getElementById(e.id);t&&(0,j.Od)(t)}createElement(e){const t=this.elementRegistry.getGraphics(e);if(t){const n=(0,on.s)(t);if(n){const i=(0,j.d9)(n);return(0,j.Lj)(i,{id:e.id}),i}}}getOffsetViewport(e,t){return{x:e.x-(t.x+t.width/2),y:e.y-(t.y+t.height/2)}}mapMousePositionToDiagramPoint({clientX:e,clientY:t}){const n={x:e-this._state._svgClientRect.left,y:t-this._state._svgClientRect.top},i=this.svg.getBoundingClientRect(),a=this.fitAspectRatio(this.lastViewbox,i.width/i.height),r=this.mapPosition(n.x,0,i.width,a.x,a.x+a.width),c=this.mapPosition(n.y,0,i.height,a.y,a.y+a.height);return{x:r,y:c}}setViewboxCenteredAroundPoint(e){const t=this.canvas.viewbox(),n=t.width,i=t.height;this.canvas.viewbox({x:e.x-n/2,y:e.y-i/2,width:n,height:i})}fitAspectRatio(e,t){const n=e.width/e.height,i=(0,C.assign)({},{x:e.x,y:e.y,width:e.width,height:e.height});if(n>t){const a=i.width*(1/t),r=i.y-(a-i.height)/2;(0,C.assign)(i,{y:r,height:a})}else if(n<t){const a=i.height*t,r=i.x-(a-i.width)/2;(0,C.assign)(i,{x:r,width:a})}return i}mapPosition(e,t,n,i,a){const r=n-t,c=a-i;return(e-t)*c/r+i}getIndexOfChildInParentChildren(e,t){const n=(0,u.query)(".djs-children",t.parentNode);if(!n)return;const i=[].slice.call(n.childNodes);let a=-1;return i.forEach(function(r,c){(0,u.query)(".djs-element",r)===e&&(a=c)}),a}insertChildAtIndex(e,t,n){const a=[].slice.call(t.childNodes)[n];t.insertBefore(e,a.nextSibling)}isZeroDimensional(e){return e.width===0&&e.height===0}isPointInside(e,t){return e.x>t.left&&e.x<t.left+t.width&&e.y>t.top&&e.y<t.top+t.height}getStepSize(e,t){const n=Math.log(e.min)/Math.log(10),i=Math.log(e.max)/Math.log(10);return(Math.abs(n)+Math.abs(i))/t}getOverlayClipPath(e,t){return`polygon(${[[t.left,t.top],[t.left+t.width,t.top],[t.left+t.width,t.top+t.height],[t.left,t.top+t.height],[t.left,e.height],[e.width,e.height],[e.width,0],[0,0],[0,e.height],[t.left,e.height]].map(([i,a])=>`${i}px ${a}px`).join(", ")})`}validViewbox(e){return(0,C.every)(e,t=>(0,C.isObject)(t)?this.validViewbox(t):(0,C.isNumber)(t)&&isFinite(t))}subscribeElementEvents(){this.eventBus.on(["shape.added","connection.added"],m.aN.MIN,this._onElementAdded),this.eventBus.on(["shape.removed","connection.removed"],m.aN.MIN,this._onElementRemoved),this.eventBus.on(["elements.changed"],m.aN.MIN,this._onElementsChanged),this.eventBus.on(["element.updateId"],m.aN.MIN,this._onElementUpdateId)}unsubscribeElementEvents(){this.eventBus.off(["shape.added","connection.added"],this._onElementAdded),this.eventBus.off(["shape.removed","connection.removed"],this._onElementRemoved),this.eventBus.off(["elements.changed"],this._onElementsChanged),this.eventBus.off(["element.updateId"],this._onElementUpdateId)}onElementAdded({element:e}){this.addElement(e),this.update()}onElementRemoved({element:e}){this.removeElement(e),this.update()}onElementsChanged({elements:e}){e.forEach(t=>this.updateElement(t)),this.update()}onElementUpdateId({element:e,newId:t}){try{const n=(0,u.query)("#"+mt()(e.id),this.elementsGroup);n&&(n.id=t)}catch(n){console.warn(`Minimap#updateElementId error: ${n}`)}}registerPopupMenu(){this.popupMenu.registerProvider("zoom",this),this.eventBus.on("minimap.open",()=>this.popupMenu.close()),this.eventBus.on("minimap.close",()=>this.popupMenu.close())}delay(e=0){return new Promise(t=>f.delay(t,e))}loadData(){var e=this;return(0,N.Z)(function*(){yield e.delay();let t=Number(new Date);const n=e.elementRegistry.getAllElements();for(let i=0,a=n.length;i<a;i++){try{e.addElement(n[i])}catch(c){console.error(c)}Number(new Date)-t>e.loadMiniMapRenderInterval&&(yield e.delay(),t=Number(new Date))}})()}open(){var e=this;return(0,N.Z)(function*(){e.setOpenState(!0),yield e.loadData(),e.update(),e.subscribeElementEvents(),e.eventBus.fire("minimap.open")})()}close(){!this.isOpen()||(this.setOpenState(!1),this.unsubscribeElementEvents(),this.eventBus.fire("minimap.close"))}isOpen(){return this._state.isOpen}resetView(){var e=this;return(0,N.Z)(function*(){yield e.zoomScroll.animateResetView()})()}fitToView(){this.zoomScroll.fitToView()}preview(){this.isOpen()?this.close():this.open()}togglePopupMenu(){if(this.popupMenu.isOpen()){this.popupMenu.close();return}this.popupMenu.open({},"zoom",{cursor:{}})}getEntries(){var e=this;return[...[25,50,75,100,200,300].map(n=>({id:`zoom-${n}`,label:`${n}%`,action:function(){var i=(0,N.Z)(function*(){yield e.zoomScroll.animateZoom(n/100)});return function(){return i.apply(this,arguments)}}()})),{id:"separator-1",className:"entry-separator",disabled:!0},{id:"reset-view",label:this.config.localizableStrings.get("resetView"),action:()=>this.resetView()},{id:"fit-into-view",label:this.config.localizableStrings.get("fitToView"),action:()=>this.fitToView()}]}};Oe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("elementRegistry")),(0,s.__param)(3,(0,o.Inject)("zoomScroll")),(0,s.__param)(4,(0,o.Inject)("localStorage")),(0,s.__param)(5,(0,o.Inject)("popupMenu")),(0,s.__param)(6,(0,o.Inject)("config")),(0,s.__param)(7,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,o.DiagramUtils])],Oe);var dn=l(64482);let Ge=class extends dn.Z{constructor(e){super(e),this.modeling=e}moveShape(e,t){const n=e.allShapes;Object.values(n).forEach(i=>{this.modeling.moveShape(i,t,!1,{recurse:!1,layout:!1},null),this.moveConnectionLabel(i,t)})}moveConnectionLabel(e,t){(e.outgoing||[]).forEach(i=>{this.modeling.moveConnectionLabel(i,{delta:t})})}moveRecursiveShape(e,t){const n=this.getClosure(e.children);this.moveShape(n,t),this.moveConnectionLabel(e,t)}};Ge=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("modeling")),(0,s.__metadata)("design:paramtypes",[K])],Ge);var hn=l(42890);let Pe=class extends hn.Z{constructor(e,t){super(e,t),this.eventBus=e,this.canvas=t,e.on("diagram.init",m.aN.LOW,()=>{this.updateEntries()})}updateEntries(){const e=this.getEntries();(0,C.forEach)(e,function(t,n){const i=(0,u.query)(`[data-action="${n}"]`);t.hasOwnProperty("menu")&&(0,u.classes)(i).add("create-menu")})}getEntries(){return super.getEntries()}};Pe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object])],Pe);let Ie=class{constructor(e,t,n,i,a,r,c,h,_,E,T){this.create=e,this.elementFactory=t,this.palette=n,this.featureProvider=i,this.canvas=a,this.elements=r,this.paletteElements=c,this.rules=h,this.eventBus=_,this.createPopupMenu=E,this.config=T,this.dataActionPrefix="create-",this.init()}init(){this.rules.allowed("canShowPalette")&&(this.palette.registerProvider(this),this.subscribeEvents())}subscribeEvents(){this.eventBus.on("createPopupMenu.open",e=>this.activateEntry(e)),this.eventBus.on("createPopupMenu.close",e=>this.deactivateEntry(e))}getCreateShapeConfig(e){const t=this.elements.getConfig(e),{type:n,width:i,height:a}=t;return{type:n,width:i,height:a}}createActionClick(e,t){const n=this.getCreateShapeConfig(e),i=this.elementFactory.createShape(n);this.create.start(t,i),this.createPopupMenu.close()}openCreateMenu(e,t,n){this.createPopupMenu.open(e,t,n)}getCreateMenuEntries(e){return e.menu.map(t=>this.elements.items[t]).filter(t=>t).map(t=>({action:{dragstart:this.createActionClick.bind(this,t)},id:t.userTaskType||t.type,imageUrl:t.smallImage,label:this.config.localizableStrings.get(t.caption)}))}activateEntry({paletteEntryId:e}){const t=(0,u.query)(`[data-action="${e}"]`);(0,u.classes)(t).add("active")}deactivateEntry({paletteEntryId:e}){const t=(0,u.query)(`[data-action="${e}"]`);(0,u.classes)(t).remove("active")}getPaletteEntries(){const e={};return Object.values(this.paletteElements.getElements()).forEach(t=>{const n=this.dataActionPrefix+t.type,i={group:"elements",action:{dragstart:this.createActionClick.bind(this,t)},...t};if(t.menu){const a=this.getCreateMenuEntries(t);a.length?i.action.click=this.openCreateMenu.bind(this,t,n,a):delete i.menu}e[n]=i}),e}};Ie=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("create")),(0,s.__param)(1,(0,o.Inject)("elementFactory")),(0,s.__param)(2,(0,o.Inject)("palette")),(0,s.__param)(3,(0,o.Inject)("featureProvider")),(0,s.__param)(4,(0,o.Inject)("canvas")),(0,s.__param)(5,(0,o.Inject)("elements")),(0,s.__param)(6,(0,o.Inject)("paletteElements")),(0,s.__param)(7,(0,o.Inject)("rules")),(0,s.__param)(8,(0,o.Inject)("eventBus")),(0,s.__param)(9,(0,o.Inject)("createPopupMenu")),(0,s.__param)(10,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,o.DiagramElements,o.DiagramPaletteElements,Object,Object,ne,Object])],Ie);let Me=class{constructor(e,t,n,i,a){this.config=e,this.toolManager=t,this.dragging=n,this.lassoTool=i,this.spaceTool=a}getPaletteToolsConfig(){return{arrow:{icon:"icon_arrow_select_24",title:"arrow",click:()=>{this.toolManager.setActive(null),this.dragging.cancel()}},lasso:{icon:"icon_sellect_24",title:"lasso",click:()=>{this.lassoTool.toggle()}},space:{icon:"icon_move_24",title:"space",click:()=>{this.spaceTool.toggle()}}}}getPaletteTools(e=!0){const t={},n=this.getPaletteToolsConfig();return Object.keys(n).forEach(i=>{const{icon:a,title:r,click:c}=n[i];t[i]={group:"tools",html:`<div class="entry material-icons">${a}</div>`,title:this.config.localizableStrings.get(r),action:{click:c}}}),e?{...t,separator:{separator:!0}}:t}};Me=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config")),(0,s.__param)(1,(0,o.Inject)("toolManager")),(0,s.__param)(2,(0,o.Inject)("dragging")),(0,s.__param)(3,(0,o.Inject)("lassoTool")),(0,s.__param)(4,(0,o.Inject)("spaceTool")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object])],Me);var gn=l(41525);let Te=class extends gn.Z{constructor(e,t,n){super(e,t,n),this.contextPadItemWidth=32,this.padding=10}subscribeEvents(){this.preventScrollParent(this.getContainer());const e=this._eventBus;e.once("createPopupMenu.open",this.close.bind(this)),e.once("element.mousedown",m.aN.HIGH,this.close.bind(this)),e.once("keyboard.keydown",m.aN.HIGH,this.close.bind(this))}unsubscribeEvents(){const e=this._eventBus;e.off("createPopupMenu.open",this.close.bind(this)),e.off("element.mousedown",this.close.bind(this)),e.off("keyboard.keydown",this.close.bind(this))}fixContainerPosition(e,t){const i=this._canvas.getContainer().getBoundingClientRect(),a=e.getBoundingClientRect(),r=i.y+this.padding;if(a.top<r){const c=this.padding,h=t.x-this.contextPadItemWidth-a.width-this.padding;(0,C.assign)(e.style,{top:`${c}px`,left:`${h}px`})}}getContainer(){return this._current.container}preventScrollParent(e){e.onwheel=t=>this.onWheel(t)}open(e,t,n){super.open(e,t,n);const i=this.getContainer();this.fixContainerPosition(i,n),this.subscribeEvents(),(0,C.assign)(i.style,{opacity:1})}close(){super.close(),this.unsubscribeEvents()}onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this._current.container.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}};Te=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config.popupMenu")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object])],Te);var pn=l(40222);class ft extends pn.Z{addDragger(e,t,n){const i=super.addDragger(e,t,n);return i.classList.add(e.type),i}}var Le=l(27147),un=l(47595),Re=l(33112);const Y={Connection:{Fill:"none",MarkerShape:"M-10,3 L2,0 L-10,-3 Z",MarkerfillOpacity:1,StrokeLinejoin:"round",StrokeWidth:1,PathStrokeWidth:2}},Be={arrowHoverStrokeColor:"#1186D8",arrowStrokeColor:"#8095b3",connectionMarkerFillColor:"#FFFF",connectionMarkerStrokeColor:"#60779F",connectionStrokeColor:"#8095B3"};class yt{get endMarker(){const e=(0,j.Ue)("path");return(0,j.Lj)(e,{d:Y.Connection.MarkerShape,"fill-opacity":Y.Connection.MarkerfillOpacity,fill:Be.arrowStrokeColor,stroke:Be.arrowStrokeColor,strokeLinejoin:Y.Connection.StrokeLinejoin,strokeWidth:Y.Connection.StrokeWidth,class:m.$d.ConnectionEndMarker}),e}_getLastSegment(e){const t=e.length;return{a:e[t-2],b:e[t-1]}}_getFirstSegment(e){return{a:e[1],b:e[0]}}_angle(e){const t=e.b.y-e.a.y,n=e.b.x-e.a.x;return Math.atan2(t,n)}_renderMarker(e,t,n,i){e&&(this._transformMarker(e,i,n),(0,j.R3)(t,e))}_transformMarker(e,t,n){(0,j.vs)(e,(0,j.wz)(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),n.x,n.y))}renderMarkers(e,t){const n=t.waypoints,i=this._getLastSegment(n),a=this._angle(i),r=this._getFirstSegment(n),c=this._angle(r),h=this.startMarker(t);this._renderMarker(h,e,r.b,c),this._renderMarker(this.endMarker,e,i.b,a)}startMarker(e){return null}getConnectionAttributes(e){return{class:m.$d.Connection,fill:Y.Connection.Fill,stroke:Be.connectionStrokeColor,strokeLinejoin:Y.Connection.StrokeLinejoin,strokeWidth:Y.Connection.PathStrokeWidth}}drawConnection(e,t,n){n.itemName&&(0,j.Lj)(t,{"data-item-marker":n.itemName});const i=(0,j.Ue)("g"),a=this.getConnectionAttributes(n.type),r=n.waypoints,c=["m"+r[0].x+","+r[0].y];for(let _=1;_<r.length;_++)c.push("L"+r[_].x+","+r[_].y);const h=(0,j.Ue)("path");return(0,j.Lj)(h,{d:c.join(" ")}),(0,j.Lj)(h,a),(0,j.R3)(i,h),this.renderMarkers(i,n),(0,j.R3)(t,i),i}}var Xe=l(77506);class Qe{drawConnection(e,t,n){}}(0,s.__decorate)([(0,Xe.mi)(()=>!0,yt),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object,Object,Object]),(0,s.__metadata)("design:returntype",Object)],Qe.prototype,"drawConnection",null);var mn=l(83962);const fn=4,yn=4,vn=5,Je=3.5,bn=1,_n=16.8699;let ke=class{constructor(e,t,n,i,a,r,c){this.eventBus=e,this.directEditing=t,this.canvas=n,this.modeling=i,this.diagramText=a,this.selection=r,this.rules=c,this.directEditing.registerProvider(this),this.rules.allowed("canLabelEdit")?this.subscribeEvents():this.subscribeSelectionEvents()}clearLabelTargetsCaption(e){const t=f.compact(f.map(e.elements,n=>n.labelTarget));f.forEach(t,n=>this.clearElementCaption(n))}clearElementCaption(e){e.caption="",this.eventBus.fire(o.Handlers.element.updateLabelExecuted,{context:{element:e,text:""}})}onKeyDown({keyEvent:e}){const t=this.selection.get(),n=t.length===1&&t[0];if(n){if(ie(e)===m.Ys.Enter.keyCode)return f.defer(()=>this.editElementLabel(n)),!1;if(ht(e))return n.needClearCaption=!0,this.editElementLabel(n),!1}}_copySelectedLabelText(){const e=this.selection.get(),t=e.length===1&&e[0];if(!t)return;const n=t.labelTarget.caption,i=a=>{(a.clipboardData||window.clipboardData).setData("text",n),a.preventDefault()};document.addEventListener("copy",i,!1),document.execCommand("copy"),document.removeEventListener("copy",i,!1)}_selectLabelText(e){const t=document.createRange(),n=document.querySelector(`[data-element-id="${e.id}"] .foreign-text`);t.selectNodeContents(n);const i=window.getSelection();i.removeAllRanges(),i.addRange(t)}showElementLabel(e){const t=e.active&&e.active.element.label;t&&this.canvas.removeMarker(t,"djs-element-hidden")}subscribeSelectionEvents(){this.eventBus.on(["element.dblclick"],({element:e})=>{e.type===o.ElementType.label&&this._selectLabelText(e)}),this.eventBus.on(["keyboard.keydown"],({keyEvent:e})=>{Z(e,m.Ys.KeyC,{ctrl:!0})&&this._copySelectedLabelText()})}subscribeEvents(){this.eventBus.on(["element.dblclick"],e=>this.editElementLabel(e.element)),this.eventBus.on(["canvas.viewbox.changing","element.mousedown","popupMenu.open"],()=>{this.directEditing.isActive()&&this.directEditing.complete()}),this.eventBus.on(["drag.init"],e=>{if(this.directEditing.isActive()){this.directEditing.complete();const t=e.shape;t&&t.x&&t.y&&this.selection.select(t)}}),this.eventBus.on(["create.end"],m.aN.LOW,e=>this.onCreateEnd(e)),this.eventBus.on(["connect.end"],m.aN.LOW,e=>{const t=e.context.connection;this.editElementLabel(t)}),this.eventBus.on(["directEditing.activate"],e=>{const t=e.active.element.label;t&&this.canvas.addMarker(t,"djs-element-hidden")}),this.eventBus.on(["directEditing.complete","directEditing.cancel"],e=>this.showElementLabel(e)),this.eventBus.on([o.Handlers.element.deleteElementsExecuted],e=>this.clearLabelTargetsCaption(e.context)),this.eventBus.on(["keyboard.keydown"],e=>this.onKeyDown(e))}onCreateEnd(e){const t=e.shape;e.context.canExecute&&this.editElementLabel(t)}editElementLabel(e){e.constructor!==mn.fC&&this.directEditing.activate(e.labelTarget||e)}getPadding(e,t){return f.mapValues(e,n=>n*t)}getBoxBounds(e){let t;const n=this.canvas,i=n.zoom(),a=o.Labels.label.width*i,r=this.getPadding(o.Labels.label.padding,i),c=r.paddingTop,h=r.paddingBottom,_=e.label,E=1;if(_){const I=n.getAbsoluteBBox(_);t={height:I.height+c+h,width:a,minHeight:o.Labels.label.minHeight,x:Math.round(I.x+I.width/2-a/2),y:Math.round(I.y-c)}}else{const I=this.diagramText.style,z=I.fontSize*I.lineHeight*i+c+h+E*2,ue={height:z/i,width:a/i},si=this.diagramText.getLabelPosition(e,ue),At=n.getAbsoluteBBox(si);t={height:z,width:a,x:Math.round(At.x-a/2),y:Math.round(At.y-c-E)}}const T=e.width?e.width+(Je+E)*2:o.Labels.label.minWidth;return t.minWidth=T*i,t}getTextStyle(e,t,n){const i=t.fontSize*e;return{...t,fontSize:`${i}px`,padding:`${n.paddingTop}px ${n.paddingRight}px ${n.paddingBottom}px ${n.paddingLeft}px`}}getElementStyle(e){const t=this.canvas.zoom(),n=f.cloneDeep(this.diagramText.style),i=o.Labels.label.padding;return this.getTextStyle(t,n,this.getPadding(i,t))}activate(e){const t=this.getBoxBounds(e),n=this.getElementStyle(e),i=["djs-direct-editing-parent"];let a;return e.needClearCaption?(a="",e.needClearCaption=!1):a=e.caption||"",{autoResize:!0,bounds:t,centerVertically:!0,options:{autoResize:!0,classList:i},style:n,text:a}}update(e,t,n){this.modeling.updateLabel(e,t)}};ke=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("directEditing")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("modeling")),(0,s.__param)(4,(0,o.Inject)("diagramText")),(0,s.__param)(5,(0,o.Inject)("selection")),(0,s.__param)(6,(0,o.Inject)("rules")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,K,Object,Object,Object])],ke);var xn=l(13463);let Ae=class extends xn.Z{constructor(e,t,n,i){super(e,t,n),this.eventBus=t,this.modeling=n,this.diagramText=i,this.subscribeEvents()}onMoveConnectionLabel(e){const t=e.context,i=t.connection.label;if(i){const a=t.hints.delta;this.modeling.moveShape(i,a)}}onReconnectStart(e){const{connection:t,hints:n,newSource:i,oldSource:a}=e.context,r=t.label,c=n&&n.doUpdateLabelPosition;if(r&&c){const h={x:i.x-a.x,y:i.y-a.y};this.modeling.moveShape(r,h)}}subscribeEvents(){this.eventBus.on([o.Handlers.connection.moveConnectionLabel],this.onMoveConnectionLabel.bind(this)),super.postExecute(["connection.updateWaypoints"],this.onUpdateWaypoints.bind(this)),super.postExecute(["connection.layout"],this.onConnectionLayout.bind(this)),super.postExecute(["connection.reconnectStart"],this.onReconnectStart.bind(this)),super.postExecute(["shape.replace"],e=>{const t=e.context.newShape;this.modeling.updateLabel(t,t.caption)})}onConnectionLayout(e){const n=e.context.connection,i=n.label;if(!this.canMoveLabel(e,i))return;const a=this.getLabelOffset(n.waypoints,i);this.modeling.moveShape(i,a)}getLabelOffset(e,t){const n=this.diagramText.getConnectionLabelPosition(e,t);return{x:n.x-t.x-Math.round(t.width/2),y:n.y-t.y-Math.round(t.height/2)}}canMoveLabel(e,t){const{connection:n,hints:i,oldWaypoints:a,newSource:r}=e.context,c=i&&i.doUpdateLabelPosition;return t&&(!f.isEqual(n.waypoints,a)||r)&&c!==!1}onUpdateWaypoints(e){const t=e.context,n=t.connection,i=n.label;if(!this.canMoveLabel(e,i))return;const a=this.getLabelOffset(n.waypoints,i),r=this.getLabelOffset(t.oldWaypoints,i),c={x:a.x-r.x,y:a.y-r.y};this.modeling.moveShape(i,c)}};Ae=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("injector")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("modeling")),(0,s.__param)(3,(0,o.Inject)("diagramText")),(0,s.__metadata)("design:paramtypes",[Object,Object,K,F])],Ae);class vt{constructor(e){this._parent=e.useRtl?(0,u.domify)('<div><textarea rows="1" dir="rtl" style="direction: rtl;" class="djs-direct-editing-content"></textarea></div>'):(0,u.domify)('<div><textarea rows="1" class="djs-direct-editing-content"></textarea></div>'),this.container=e.container,this._textArea=(0,u.query)(".djs-direct-editing-content",this._parent),this.keyHandler=e.keyHandler||(()=>{}),this._mousedown=t=>{t.stopPropagation()},this.resizeHandler=e.resizeHandler||(()=>{}),this.autoResize=this.autoResize.bind(this)}create(e,t,n,i){const a=this._parent,r=this._textArea,c=this.container;i=this._options=i||{},t=this._style=t||{};const h=f.pick(t,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);f.assign(a.style,{boxSizing:"border-box",left:e.x+"px",outline:"none",overflow:"visible",position:"absolute",textAlign:"center",top:e.y+"px",wordWrap:"normal",width:e.width+"px"},h);const _=f.pick(t,["borderLeft","fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return f.assign(r.style,{boxSizing:"border-box",outline:"none",wordWrap:"break-word",width:e.minWidth+"px",maxHeight:e.maxHeight+"px",maxWidth:(e.maxWidth||e.width)+"px",minHeight:e.minHeight+"px",minWidth:e.minWidth+"px"},_),i.centerVertically&&f.assign(r.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},_),r.value=n,u.event.bind(r,"keydown",this.keyHandler),u.event.bind(r,"mousedown",this._mousedown),u.event.bind(r,"paste",this._handlePaste),u.event.bind(r,"keydown",this.autoResize),u.event.bind(r,"blur",this.blur),a.className="djs-direct-editing-parent",i.classList&&a.classList.add(...i.classList),c.appendChild(a),this._textArea.selectionStart=n.length,this._textArea.selectionEnd=n.length,this._textArea.focus(),n&&this.resizeWidth(),this.resizeHeight(),a}resizeHeight(){this._textArea.style.height="auto",this._textArea.style.height=this._textArea.scrollHeight+"px"}resizeWidth(){this._textArea.style.width="auto",this._textArea.style.width=this._textArea.scrollWidth+"px"}autoResize(){f.defer(()=>{if(this._textArea.scrollHeight>0){const e=this._textArea.getBoundingClientRect();this.resizeWidth(),this.resizeHeight(),this.resizeHandler({dx:0,dy:this._textArea.scrollHeight-e.height,height:e.height,width:e.width})}})}destroy(){const e=this._parent,t=this._textArea;t.value="",e.removeAttribute("style"),t.removeAttribute("style"),u.event.unbind(t,"keydown",this.keyHandler),u.event.unbind(t,"mousedown",this._mousedown),u.event.unbind(t,"keydown",this.autoResize),u.event.unbind(t,"blur",this.blur),(0,u.remove)(e)}getValue(){return this._textArea.value}}let Ue=class{constructor(e,t,n,i,a,r,c){this._eventBus=e,this._canvas=t,this._elementRegistry=n,this._graphicsFactory=i,this._diagramText=a,this.config=r,this._providers=[],this._textbox=c||new vt({useRtl:r.isRtl}),this._textbox.container=t.getContainer(),this._textbox.keyHandler=this._handleKey.bind(this),this._textbox.blur=this._blur.bind(this),this._textbox.resizeHandler=this.handleResize.bind(this),this._eventBus.on("diagram.destroy",1e3,this.deactivate,this)}_handleKey(e){if(ie(e)===m.Ys.Escape.keyCode){e.stopPropagation(),e.preventDefault(),this.cancel();return}gt(e)&&pt(e,()=>this.complete())}_blur(){this.complete()}_fire(e,t){t=t||{active:this.active},this._eventBus.fire("directEditing."+e,t)}handleResize(e){this._fire("resize",e)}getNewBounds(){const e=this.activeTextbox.getBoundingClientRect();return{x:e.top,y:e.left,width:e.width,height:e.height}}registerProvider(e){this._providers.push(e)}isActive(){return Boolean(this.active)}cancel(){this.active&&this.close("cancel")}animate(e){const t=this.activeTextbox.classList;if(!(t&&t.contains("djs-direct-editing-rotate-90")))return;const i="djs-direct-editing-rotate-0";e?t.add(i):t.remove(i)}deactivate(){this._textbox.destroy(),this._fire("deactivate",null),this.active=null}close(e){this.animate(!1),this._fire(e,null),this.deactivate()}complete(){const e=this.active;if(!e)return;const t=this.getValue();e.provider.update(e.element,t,this.getNewBounds()),this.close("complete")}getValue(){return this._textbox.getValue()}activate(e){this.isActive()&&this.cancel();let t=null;this.initialHeight=e.height,this.initialWidth=e.width;const n=this._providers.find(i=>(t=i.activate(e),t?i:null));return t&&(this.activeTextbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this.active={element:e,context:t,provider:n},this.animate(!0),this._fire("activate",null)),Boolean(t)}};Ue=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("elementRegistry")),(0,s.__param)(3,(0,o.Inject)("graphicsFactory")),(0,s.__param)(4,(0,o.Inject)("diagramText")),(0,s.__param)(5,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object])],Ue);var bt;let se=class{constructor(e,t,n,i){this.elements=e,this.styles=t,this.diagramText=n,this.eventBus=i}updateClass(e,t){const n=this.elements.getConfig(t),i=e.parentElement||e.parentNode,a=i.classList;(0,f.forEach)(this.elements.items,r=>{a.remove(r.type),a.remove(r.userTaskType)}),i.classList.add(n.userTaskType||n.type)}createText(e,t,n){const i=this.diagramText.createText(t,n);return(0,j.Sh)(i).add("djs-label"),n.className&&(0,j.Sh)(i).add(n.className),(0,j.R3)(e,i),i}drawRect(e,t,n,i,a,r){(0,f.isObject)(a)&&(r=a,a=0),a=a||0,r=this.styles.computeStyle(r,{fill:"none",stroke:"#EBEBEB",strokeWidth:1});const c=(0,j.Ue)("rect");return(0,j.Lj)(c,{height:n-a*2,rx:i,ry:i,width:t-a*2,x:a,y:a}),(0,j.Lj)(c,r),(0,j.R3)(e,c),c}draw(e,t){return this.updateClass(e,t),null}};se=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("elements")),(0,s.__param)(1,(0,o.Inject)("styles")),(0,s.__param)(2,(0,o.Inject)("diagramText")),(0,s.__param)(3,(0,o.Inject)("eventBus")),(0,s.__metadata)("design:paramtypes",[Object,typeof(bt=typeof Re.Z<"u"&&Re.Z)=="function"?bt:Object,F,Object])],se);const _t={ELLIPSE:"ellipse",RECTANGLE:"rect"};var Cn=l(12961);class qe extends se{getEllipseBackgroundConfig(e){const n=e.backgroundStyle.padding||0,i=Math.round(Math.max(e.width,e.height)/2),a=Math.round(e.height/2);return{rx:i+n,ry:a+n,cx:Math.round(e.width/2),cy:Math.round(e.height/2-1)}}getLabelBackgroundConfig(e){const t=e.backgroundStyle,i=(t&&t.type)===_t.ELLIPSE?this.getEllipseBackgroundConfig(e):this.getDefaultBackgroundConfig(e),a=t&&t.fill;f.assign(i,a?{fill:a}:{style:"fill: transparent;"});const r=t&&t.filter;if(r){const c=Cn.F.createShadowFilter(r);f.assign(i,{filter:c})}return i}setLabelBackground(e,t){const n=t.backgroundStyle,i=n&&n.type||_t.RECTANGLE,a=(0,j.Ue)(i),r=this.getLabelBackgroundConfig(t);(0,j.Lj)(a,r),(0,j.R3)(e,a)}getDefaultBackgroundConfig(e){return{height:e.height,width:e.width}}getLabelText(e){return e.caption||e.labelTarget&&e.labelTarget.caption||""}getDrawOptions(e){const t=e.caption?0:3,n={box:{height:e.height,width:e.width+t,x:e.x,y:e.y},fitBox:!1,style:{...this.diagramText.style,direction:"ltr"}};return f.assign(n.style,e.style),n}draw(e,t){super.draw(e,t),this.setLabelBackground(e,t);const n=this.getLabelText(t),i=this.getDrawOptions(t),a=this.diagramText.createText(n,i);return(0,j.Sh)(a).add("djs-label"),(0,j.R3)(e,a),a}}let ge=class{constructor(e,t){this.renderingLabel=e,this.renderingShape=t}create(e){return e===o.DiagramElementType.label?this.renderingLabel:this.renderingShape}};ge=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("renderingLabel")),(0,s.__param)(1,(0,o.Inject)("renderingShape")),(0,s.__metadata)("design:paramtypes",[qe,se])],ge);var xt,Ct;let pe=class extends un.Z{constructor(e,t,n,i,a){super(e),this.eventBus=e,this.styles=t,this.diagramText=n,this.renderingFactory=i,this.elementRegistry=a}setDataItemMarker(e,t){let n=t.itemName;if(t.type===o.DiagramElementType.label){const i=t.labelTarget.itemName;n=n||i&&i+"_label"}n&&e.setAttributeNS(null,"data-item-marker",n)}canRender(){return!0}drawShape(e,t){return this.setDataItemMarker(e,t),this.renderingFactory.create(t.type).draw(e,t)}drawConnection(e,t){return super.drawConnection(e,t)}createFeatureContext(){return{styles:this.styles,diagramText:this.diagramText,elementRegistry:this.elementRegistry}}};(0,s.__decorate)([(0,Xe.Xu)(Qe,Xe.I2.instead),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object,Object]),(0,s.__metadata)("design:returntype",void 0)],pe.prototype,"drawConnection",null),pe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("styles")),(0,s.__param)(2,(0,o.Inject)("diagramText")),(0,s.__param)(3,(0,o.Inject)("renderingShapeFactory")),(0,s.__param)(4,(0,o.Inject)("elementRegistry")),(0,s.__metadata)("design:paramtypes",[typeof(xt=typeof Le.Z<"u"&&Le.Z)=="function"?xt:Object,typeof(Ct=typeof Re.Z<"u"&&Re.Z)=="function"?Ct:Object,Object,ge,Object])],pe);let ze=class{constructor(e,t,n,i,a){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.config=i,this.diagramUtils=a,this.highlightClassName="animated",this.subscribeEvents()}get supportHighlight(){return this.config.isReadOnly}onSelectionChanged(e){const{newSelection:t,oldSelection:n}=e;n.forEach(i=>this.changeConnectionSelection(i,!1)),t.forEach(i=>this.changeConnectionSelection(i,!0))}changeConnectionSelection(e,t){const n=this.elementRegistry.filter(i=>i.source===e||i.target===e);n.forEach(i=>{t?this.canvas.addMarker(i,this.highlightClassName):this.canvas.removeMarker(i,this.highlightClassName)}),this.bringToFront(n,e)}bringToFrontElement(e){this.canvas.bringToFrontElement(e)}subscribeEvents(){this.supportHighlight&&this.eventBus.on(["selection.changed"],m.aN.LOW,e=>this.onSelectionChanged(e))}bringToFront(e,t){e.forEach(i=>this.bringToFrontElement(i)),this.elementRegistry.filter(i=>!this.diagramUtils.isConnection(i)).forEach(i=>this.bringToFrontElement(i)),this.bringToFrontElement(t)}};ze=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__param)(2,(0,o.Inject)("elementRegistry")),(0,s.__param)(3,(0,o.Inject)("config")),(0,s.__param)(4,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,o.DiagramUtils])],ze);var jn=l(19304);let Fe=class extends jn.Z{constructor(e,t,n,i,a,r,c,h){super(n,t,e,i,a,r),this.elements=c,this.diagramUtils=h,this.AXIS_TO_DIMENSION={x:"width",y:"height"}}_excludeLabelsWithoutTargets(e){return e.filter(t=>t.type===o.ElementType.label?e.some(n=>n.id===t.labelTarget.id):!0)}calculateAdjustments(e,t,n,i){const a=[],r=[];return e.forEach(c=>{const h=c[t],_=h+c[this.AXIS_TO_DIMENSION[t]];if(!!c.parent&&!c.waypoints){if(!this.canResizeShape(c,i,t)&&(n>0&&h>i||n<0&&_<i))return a.push(c);if(this.canResizeShape(c,i,t)||h<i&&_>i&&this._rules.allowed("shape.resize",{shape:c}))return r.push(c)}}),{movingShapes:this._excludeLabelsWithoutTargets(a),resizingShapes:this._excludeLabelsWithoutTargets(r)}}init(e,t){const n=super.init(e,t);return n&&(t.minAllowedDelta=this.getMinAllowedDelta(t.resizingShapes,t.direction,t.movingShapes),t.spaceToolConstraints=null),n}getDelta(e){const t=super.getDelta(e);return o.DiagramUtils.getCorrectSpaceToolDelta(t,e)}canResizeShape(e,t,n){return!1}getMinAllowedDelta(e,t,n){return null}};Fe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("dragging")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("modeling")),(0,s.__param)(4,(0,o.Inject)("rules")),(0,s.__param)(5,(0,o.Inject)("toolManager")),(0,s.__param)(6,(0,o.Inject)("elements")),(0,s.__param)(7,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,o.DiagramElements,o.DiagramUtils])],Fe);var En=l(98080);class jt extends En.Z{getDelta(e){const t=super.getDelta(e);return o.DiagramUtils.getCorrectSpaceToolDelta(t,e)}}var Et=l(42776),Dn=l(89851),Sn=l(25128),et=l(21322),tt=l(27049),Dt,St,wt;const wn={min:.2,max:4};let He=class extends Dn.Z{constructor(e,t,n,i,a,r){super(e,t,n),this.config=e,this.eventBus=t,this.canvas=n,this.createPopupMenu=i,this.popupMenu=a,this.localStorage=r,this.cancelAnimation$=new et.Subject,this.eventBus.on(["canvas.viewbox.changed"],m.aN.MEDIUM,c=>{this.onCanvasViewBoxChanged(c)})}cancelAnimation(){this.cancelAnimation$.next(!0)}_handleWheel(e){if(this.cancelAnimation(),this.createPopupMenu.isOpen()){this.createPopupMenu.onWheel(e);return}if(this.popupMenu.isOpen()){this.popupMenu.onWheel(e);return}super._handleWheel(e)}onCanvasViewBoxChanged(e){const t=this.canvas.scroll();t.x=Math.round(t.x)||0,t.y=Math.round(t.y)||0;const n=this.getInitScroll();t.x!==n.x||t.y!==n.y?this.localStorage.set("scroll",t):this.localStorage.remove("scroll");const i=e.viewbox.scale;i&&i!==this.getInitScale()?this.localStorage.set("scale",i):this.localStorage.remove("scale")}getInitScale(){return this.config&&this.config.initScale||1}getInitScroll(){return this.config&&this.config.initScroll||{x:0,y:0}}getScale(){return this.canvas.viewbox().scale}getScroll(){return this.canvas.scroll()}setZoom(e){const t=this.canvas.viewbox().outer,n={x:t.width/2,y:t.height/2};this.canvas.zoom((0,Sn.T)(wn,e),n)}setScroll(e){const t=this.getScroll();this.canvas.scroll({dx:-t.x+e.x,dy:-t.y+e.y})}animateZoomScroll({toScale:e,toScroll:t,fromScale:n=null,fromScroll:i=null,stepCount:a=20,stepPeriod:r=1}){var c=this;return(0,N.Z)(function*(){if(c.cancelAnimation(),n=n||c.getScale(),i=i||c.getScroll(),n===e&&i.x===t.x&&i.y===t.y)return;const h=(e-n)/a,_=(t.x-i.x)/a,E=(t.y-i.y)/a;return new Promise(T=>{(0,et.interval)(r).pipe((0,tt.take)(a+1),(0,tt.takeUntil)(c.cancelAnimation$),(0,tt.finalize)(()=>{c.eventBus.fire("animateZoomScroll.done"),T()})).subscribe(I=>{c.setZoom(n+h*I),c.setScroll({x:i.x+_*I,y:i.y+E*I})})})})()}animateZoom(e){var t=this;return(0,N.Z)(function*(){const n=t.getScroll();yield t.animateZoomScroll({toScale:e,toScroll:n,stepCount:5,stepPeriod:1})})()}initZoomScroll(e=null,t=0){const n=e||this.localStorage.get("scroll")||this.getInitScroll(),i=t||this.localStorage.get("scale")||this.getInitScale();this.getScale()!==i&&this.setZoom(i);const r=this.getScroll();(r.x!==n.x||r.y!==n.y)&&this.setScroll(n)}animateResetView(){var e=this;return(0,N.Z)(function*(){yield e.animateZoomScroll({toScale:e.getInitScale(),toScroll:e.getInitScroll()})})()}fitToView(){this.cancelAnimation(),this.canvas.zoom("fit-viewport",null);const e=this.getInitScroll();this.canvas.scroll({dx:e.x,dy:e.y})}zoomOut(e=.1){this.cancelAnimation(),this.setZoom(this.getScale()-e)}zoomIn(e=.1){this.cancelAnimation(),this.setZoom(this.getScale()+e)}};He=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("config")),(0,s.__param)(1,(0,o.Inject)("eventBus")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__param)(3,(0,o.Inject)("createPopupMenu")),(0,s.__param)(4,(0,o.Inject)("popupMenu")),(0,s.__param)(5,(0,o.Inject)("localStorage")),(0,s.__metadata)("design:paramtypes",[Object,typeof(Dt=typeof Le.Z<"u"&&Le.Z)=="function"?Dt:Object,typeof(St=typeof re.Z<"u"&&re.Z)=="function"?St:Object,ne,typeof(wt=typeof Et.Z<"u"&&Et.Z)=="function"?wt:Object,$])],He);class nt{constructor(e){this.context=e,this.modeling=e.modeling,this.localizableStrings=e.localizableStrings,this.canvas=e.canvas,this.contextPad=e.contextPad,this.popupMenu=e.popupMenu,this.connect=e.connect,this.create=e.create,this.elementFactory=e.elementFactory,this.elements=e.elements,this.elementToolsConfig=e.elementToolsConfig}getAddItemsConfig(e){const t=this.elementToolsConfig.addItems,n={};return t.forEach(i=>{const a=this.addElementDragStart.bind(this,i);n["add."+i.type]={action:{dragstart:a},imageUrl:i.image,title:i.title}}),n}getDragStartShapeConfig(e){const t=this.elements.getConfig(e);return{type:e.type,width:t.width,height:t.height,caption:""}}addElementDragStart(e,t,n){const i=this.getDragStartShapeConfig(e),a=this.elementFactory.createShape(i);this.create.start(t,a,{source:n})}getDeleteConfig(e){return{delete:{action:{click:()=>{this.modeling.removeElements([e])}},...this.elementToolsConfig.tools.delete}}}getSetupConfig(){return{setup:{action:{click:(e,t)=>{const n=this.getPopupMenuPosition(e,t);this.popupMenu.open(t,"setup",n)}},...this.elementToolsConfig.tools.setup}}}getPopupMenuPosition(e,t){const n=this.canvas.getContainer().getBoundingClientRect(),i=this.contextPad.getPad(t).html.getBoundingClientRect(),a=3,r=1;return{cursor:{x:e.clientX,y:e.clientY},x:i.left+i.width+a-n.left,y:i.top-r-n.top}}getConnectConfig(){return{connect:{action:{dragstart:(e,t,n)=>{this.connect.start(e,t,n)}},...this.elementToolsConfig.tools.connect}}}hasSetupMenu(e){return!this.popupMenu.isEmpty(e,"setup")}hasConnectConfig(e){return e.type&&e.type!==o.DiagramElementType.connection}hasAddItemsMenu(e){return!0}hasDeleteAction(e){return!0}getContextPadEntries(e){const t={};return this.hasDeleteAction(e)&&Object.assign(t,this.getDeleteConfig(e)),this.hasSetupMenu(e)&&Object.assign(t,this.getSetupConfig()),this.hasAddItemsMenu(e)&&Object.assign(t,this.getAddItemsConfig(e)),this.hasConnectConfig(e)&&Object.assign(t,this.getConnectConfig()),t}}class Ot extends nt{getContextPadEntries(){return{}}}class Pt{constructor(e){this.context=e}getElementToolsFeature(e){return o.DiagramUtils.isLabel(e)?new Ot(this.context):new nt(this.context)}}let Ke=class{constructor(e,t,n,i,a,r,c,h,_,E){this.elements=_,this.elementToolsConfig=E;const T=h.localizableStrings;t.registerProvider(this);const I={modeling:n,localizableStrings:T,contextPad:t,canvas:c,popupMenu:r,elementFactory:i,create:a,connect:e,elements:_,elementToolsConfig:E};this.initializeElementToolsFactory(I)}initializeElementToolsFactory(e){this.toolsFactory=new Pt(e)}getContextPadEntries(e){return this.toolsFactory.getElementToolsFeature(e).getContextPadEntries(e)}};Ke=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("connect")),(0,s.__param)(1,(0,o.Inject)("contextPad")),(0,s.__param)(2,(0,o.Inject)("modeling")),(0,s.__param)(3,(0,o.Inject)("elementFactory")),(0,s.__param)(4,(0,o.Inject)("create")),(0,s.__param)(5,(0,o.Inject)("popupMenu")),(0,s.__param)(6,(0,o.Inject)("canvas")),(0,s.__param)(7,(0,o.Inject)("config")),(0,s.__param)(8,(0,o.Inject)("elements")),(0,s.__param)(9,(0,o.Inject)("elementToolsConfig")),(0,s.__metadata)("design:paramtypes",[Object,Object,K,Object,Object,Object,Object,Object,o.DiagramElements,Object])],Ke);class It{constructor(){this._featureService=new et.ReplaySubject(1)}set featureService(e){this._featureService.next(e)}getFeatureServiceValues(e){return this._featureService.subscribe(t=>{t.getFeatureValues(n=>{e(n)})})}}var On=l(80507);class Mt{findIntersectSegment(e,t){const n={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};let i=-1,a;const r=e.waypoints;for(let c=0;c<r.length-1;c++){const h={x1:r[c].x,y1:r[c].y,x2:r[c+1].x,y2:r[c+1].y},_=n,E={x1:Math.min(h.x1,h.x2)-1,y1:Math.min(h.y1,h.y2)-1,x2:Math.max(h.x1,h.x2)+1,y2:Math.max(h.y1,h.y2)+1},T=Math.max(0,Math.min(E.x2,_.x2)-Math.max(E.x1,_.x1)),I=Math.max(0,Math.min(E.y2,_.y2)-Math.max(E.y1,_.y1)),V=T*I;(V>i||i<0)&&(i=V,a=h)}return a}getAlignDelta(e,t){let n=0,i=0;const a=(0,X.wS)(t);return e.x1===e.x2?n=e.x1-a.x:i=e.y1-a.y,{x:n,y:i}}isForbiddenType(e){return o.DiagramUtils.isLabel(e)}canSplit(e){return e&&e.length===1&&!this.isForbiddenType(e[0])}splitConnection({connection:e,shapes:t,modeling:n}){if(e&&this.canSplit(t)){const i=t[0],a=e.target,r=this.findIntersectSegment(e,i),c=this.getAlignDelta(r,i);n.moveShape(i,c);const h=(0,y.Pi)(i);n.reconnectEnd(e,i,h,{isUpdateConnectionType:!1}),n.connect(i,a,{})}}}var Pn=l(279),it=l(71709);let We=class extends Pn.Z{constructor(e,t){super(),this.connectionDocking=e,this.config=t}isStraightConnection(e,t,n){return!0}isShapeCenter(e,t){const{height:n,width:i,x:a,y:r}=t,c=Math.floor(e.x-a-i/2),h=Math.floor(e.y-r-n/2);return c===0&&h===0}getPreferredDirectionWithPoint(e,t){const n=t.x+t.width/2,i=t.y+t.height/2,a=e.x-n,r=e.y-i;let c;return a<0?r<0?c=-a>-r?"l":"t":c=-a>r?"l":"b":r<0?c=a>-r?"r":"t":c=a>r?"r":"b",c}getBoundingRect(e){const n=e.y-10,i=e.x+e.width+10,a=e.y+e.height+10,r=e.x-10;return{top:n,right:i,bottom:a,left:r}}findSourceLayout(e,t,n,i){let a;const r=this.getBoundingRect(e),c=this.getBoundingRect(t);switch(n){case"t":a=c.top<=r.bottom?"t":"b";break;case"b":a=c.bottom<=r.top?"t":"b";break;case"l":a=r.right<=c.left?"r":"l";break;case"r":a=c.right<=r.left?"l":"r";break}return a===n&&(i==="h"&&["r","l"].includes(n)&&(r.top>c.bottom?a="t":r.bottom<c.top||r.bottom>=c.bottom?a="b":a="t"),i==="v"&&["t","b"].includes(n)&&(r.left>c.right?a="l":r.right>=c.right||r.right<c.left?a="r":a="l")),a}getPreferredLayouts(e,t,n,i={}){const a=(0,X.wS)(e),r=(0,X.wS)(t),c=Math.abs(a.x-r.x),h=Math.abs(a.y-r.y),_=c<h?"v":"h";let E;const T=i.connectionStart;if(T)this.isShapeCenter(T,e)||(E=this.getPreferredDirectionWithPoint(T,e));else{const z=n&&n[0],ue=z&&(z.original||o.DiagramUtils.getOriginalWaypoint(z,e));z&&!this.isShapeCenter(ue,e)&&(E=this.getPreferredDirectionWithPoint(z,e))}let I;const V=i.connectionEnd;if(V)this.isShapeCenter(V,t)||(I=this.getPreferredDirectionWithPoint(V,t));else{const z=n&&n.slice(-1)[0],ue=z&&(z.original||o.DiagramUtils.getOriginalWaypoint(z,t));z&&!this.isShapeCenter(ue,t)&&(I=this.getPreferredDirectionWithPoint(z,t))}return!E&&I&&(E=this.findSourceLayout(e,t,I,_)),E&&!I&&(I=this.findSourceLayout(t,e,E,_)),!E&&!I?[`${_}:${_}`]:[`${E}:${I}`]}layoutConnection(e,t={}){const n=t.source||e.source,i=t.target||e.target;t.startChanged&&!t.connectionStart&&(t.connectionStart=(0,X.wS)(n)),t.endChanged&&!t.connectionEnd&&(t.connectionEnd=(0,X.wS)(i));const a=e.waypoints,r=t.connectionStart||a&&a.length&&a[0].original,c=t.connectionEnd||a&&a.length&&a[a.length-1].original;let h;!t.shapeMoving&&!t.startChanged&&!t.endChanged?(t.preferredLayouts=this.getPreferredLayouts(n,i,a,t),h=it.I6(n,i,r,c,t)):h=it.ju(n,i,r,c,a,t),this.isStraightConnection(n,i,e)&&h.length>2&&h.splice(1,h.length-2);const E=Object.assign(e);return E.waypoints=it.Fb(h),this.connectionDocking.getCroppedWaypoints(E,n,i)}};We=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("connectionDocking")),(0,s.__param)(1,(0,o.Inject)("config")),(0,s.__metadata)("design:paramtypes",[Object,Object])],We);class st{constructor(e,t){this.eventBus=e,this.outlineFactory=t,e.on("shape.added",m.aN.LOW,this.onShapeAdded.bind(this)),e.on("shape.changed",m.aN.LOW,this.onShapeChanged.bind(this)),e.on("connection.added",this.onConnectionAdded.bind(this)),e.on("connection.changed",this.onConnectionChanged.bind(this))}onShapeAdded(e){this.onUpdateOutline(e)}onShapeChanged(e){this.onUpdateOutline(e)}onConnectionAdded(e){this.onUpdateOutline(e)}onConnectionChanged(e){this.onUpdateOutline(e)}onUpdateOutline(e){const t=e.element;this.outlineFactory.getOutline(t).draw(t,e.gfx)}}class ae{constructor(e){this.config=e}findOutline(e){return(0,u.query)("."+this.config.outlineClassName,e)}getOutline(e){let t=this.findOutline(e);if(!t){const n=e;t=this.createOutline(n)}return t}createOutline(e){const t=this.getSvgName(),n=(0,j.Ue)(t),i=this.getCreateOutlineConfig();return(0,j.Lj)(n,i),(0,j.R3)(e,n),n}getSvgName(){return"rect"}getCreateOutlineConfig(){return{...this.config.outlineStyle,shapeRendering:"geometricPrecision"}}draw(e,t){const n=this.getOutline(t);this.updateOutline(n,e)}erase(e,t){const n=this.findOutline(t);n&&n.remove()}}class In extends ae{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return f.assign(e,{cx:10,cy:10,r:30})}getSvgName(){return"circle"}updateOutline(e,t){const n=t.width/2;(0,j.Lj)(e,{cx:n,cy:n,r:n+this.config.offset})}}class Tt extends ae{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return f.assign(e,{x:10,y:10,width:100,height:100})}updateOutline(e,t){const n=(0,$e.jY)(t,!1),i=this.config.offset;(0,j.Lj)(e,{height:n.height+i*2,width:n.width+i*2,x:n.x-i,y:n.y-i})}draw(e,t){this.config.rules.allowed("canShowConnectionOutline")&&super.draw(e,t)}}class Lt extends ae{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return f.assign(e,{x:10,y:10,width:100,height:100,rx:5})}updateOutline(e,t){const n=this.config.offset;(0,j.Lj)(e,{x:-n,y:-n,width:t.width+n*2,height:t.height+n*2})}}class Rt extends ae{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return f.assign(e,{x:10,y:10,width:100,height:100})}updateOutline(e,t){this.config.rules.allowed("canShowLabelOutline")&&(0,j.Lj)(e,{x:-2,y:-2,width:t.width+2*2,height:t.height+2})}draw(e,t){this.config.rules.allowed("canShowLabelOutline")&&super.draw(e,t)}}let oe=class{constructor(e,t,n,i){this.styles=e,this.rules=t,this.elements=n,this.diagramUtils=i,this.config=this.getConfig()}getConfig(){const e="djs-outline",t={...this.styles.cls(e,["no-fill"],null),strokeDasharray:"4,2",strokeWidth:"1px"};return{outlineClassName:e,outlineStyle:t,offset:Je,elements:this.elements,rules:this.rules}}getOutline(e){switch(!0){case o.DiagramUtils.isLabel(e):return new Rt(this.config);case this.diagramUtils.isConnection(e):return new Tt(this.config);default:return new Lt(this.config)}}};oe=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("styles")),(0,s.__param)(1,(0,o.Inject)("rules")),(0,s.__param)(2,(0,o.Inject)("elements")),(0,s.__param)(3,(0,o.Inject)("diagramUtils")),(0,s.__metadata)("design:paramtypes",[Object,Object,o.DiagramElements,o.DiagramUtils])],oe);let Ze=class extends st{constructor(e,t){super(e,t),this.outlineFactory=t}};Ze=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("outlineFactory")),(0,s.__metadata)("design:paramtypes",[Object,oe])],Ze);class Mn extends ae{constructor(){super(...arguments),this._factor45Angle=Math.sqrt(1/2)}getDefaultHeight(){return 55}getCreateOutlineConfig(){const e=this._factor45Angle,t=this.getDefaultHeight()/2,n=super.getCreateOutlineConfig();return f.assign(n,{x:10,y:10,width:100,height:100,transform:`matrix(${e} -${e} ${e} ${e} 0 ${t})`})}updateOutline(e,t){const n=this._factor45Angle,i=t.height/2,a=this.config.offset;(0,j.Lj)(e,{x:-a,y:-a,width:t.width*n+a*2,height:t.height*n+a*2,transform:`matrix(${n} -${n} ${n} ${n} 0 ${i})`})}}let at=class extends st{constructor(e,t,n){super(e,t),this.outlineFactory=t,this.registry=n,this.notValidElements=new Set,e.on(["element.validation"],this.onElementIsValidChanged.bind(this))}onElementIsValidChanged(e){const t=e.id;e.isValid?this.removeElement(t):this.addElement(t)}addElement(e){if(!this.notValidElements.has(e)&&this.registry.get(e)){this.notValidElements.add(e);const t=this.registry.get(e),n=this.registry.getGraphics(t);this.onUpdateOutline({element:t,gfx:n})}}removeElement(e){if(this.notValidElements.has(e)){this.notValidElements.delete(e);const t=this.registry.get(e),n=this.registry.getGraphics(t);this.outlineFactory.getOutline(t).erase(t,n)}}onUpdateOutline(e){const t=e.element;this.notValidElements.has(t.id)&&super.onUpdateOutline(e)}};at=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("validationOutlineFactory")),(0,s.__param)(2,(0,o.Inject)("elementRegistry")),(0,s.__metadata)("design:paramtypes",[Object,oe,Object])],at);class Bt extends se{getSizeConfig(e){const t=this.elements.getConfig(e);return this.styles.style({height:e.height||t.height,width:e.width||t.width})}getImageSource(e){const t=this.elements.getConfig(e);return e.largeImage||t.largeImage}draw(e,t){super.draw(e,t);const n=this.elements.getConfig(t);if(!n)throw new Error(`Element type ${t.type} not supported`);const i=(0,j.Ue)("image"),a=this.getSizeConfig(t),r=this.getImageSource(t);return(0,j.Lj)(i,a),i.setAttributeNS("http://www.w3.org/1999/xlink","href",r),i.setAttributeNS(null,"type",n.type),i.setAttributeNS(null,"preserveAspectRatio","none"),(0,j.R3)(e,i),i}}let Ne=class{constructor(e){this.popupMenu=e,this.popupMenu.registerProvider("setup",this)}getPopupMenuEntries(e){return{}}getHeaderEntries(e){return[]}};Ne=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("popupMenu")),(0,s.__metadata)("design:paramtypes",[Object])],Ne);class Tn{constructor(e,t){this.width=e,this.height=t}}var Ln=l(22586),Rn=l(9237),Bn=l(27521),kn=l(98192),An=l(45193),Un=l(17722),zn=l(43190),Fn=l(98059),Hn=l(7984),kt=l(85960),Kn=l(20677),Wn=l(40549),Zn=l(88848),Nn=l(23430),Vn=l(82032),$n=l(85081),Yn=l(63343),Gn=l(76795),Xn=l(42226),Qn=l(83208),Jn=l(70734),qn=l(67859),ei=l(52232),ti=l(5206);let ot=class{constructor(e,t){this.eventBus=e,this.canvas=t,this._isOpen=!1,this._init()}_init(){this._popupContainer=(0,u.domify)('<div class="djs-diagram-popup"></div>');const e=this.canvas.getContainer();this._popup=e.appendChild(this._popupContainer),this._subscribeEvents()}_subscribeEvents(){this._subscribeEventBusEvents(),this._subscribeDomEvents()}_subscribeDomEvents(){this._popup.onwheel=e=>this._onWheel(e)}_onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this._popup.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}_onViewBoxChanged(){this._state&&this._state.parentContainer&&this.open({parentContainer:this._state.parentContainer,html:this._state.html,width:this._state.width,options:this._state.options})}_subscribeEventBusEvents(){this.eventBus.on(["canvas.resized","zoom.changed","selection.changed"],()=>this.close()),this.eventBus.on("popup.open",e=>this.open(e)),this.eventBus.on("canvas.viewbox.changing",()=>this.hide()),this.eventBus.on("canvas.viewbox.changed",()=>this._onViewBoxChanged())}getPopupPosition(e){const{parentContainer:t}=e,{e:n,f:i}=t.getCTM(),{height:a}=t.getBoundingClientRect(),r=5,c=i+a+r,{width:h}=t.getBoundingClientRect(),_=e.options?.direction||"right";let E=n;return _==="right"&&(E+=h-e.width),_==="left"&&(E-=h),{x:E,y:c}}open(e){if(!e.width)throw new Error("width must be > 0");this._state={parentContainer:e.parentContainer,html:e.html,width:e.width,options:e.options};const{x:t,y:n}=this.getPopupPosition(e);return(0,f.assign)(this._popupContainer.style,{left:`${t}px`,top:`${n}px`,visibility:"visible",width:`${e.width}px`}),this._isOpen=!0,this._popupContainer.innerHTML=e.html,this._popupContainer}close(){!this._isOpen||(this.hide(),this._state={})}hide(){(0,f.assign)(this._popupContainer.style,{visibility:"hidden"}),this._popupContainer.innerHTML=""}};ot=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object])],ot);let rt=class{constructor(e,t,n){this.eventBus=e,this.Tooltips=t,this.canvas=n,this.tooltipTimeout=400,e.on("element.hover",this.onElementHover.bind(this)),this.Tooltips._updateRoot=()=>{}}onElementHover(e){clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(()=>{const{element:t,gfx:n}=e;this.elementId!==t.id&&this.tooltipId&&this.removeTooltip(),t.tooltip&&!this.tooltipId&&this.addTooltip(n,t)},this.tooltipTimeout)}removeTooltip(){this.Tooltips.remove(this.tooltipId),this.tooltipId=null}addTooltip(e,t){this.elementId=t.id;const n=t.tooltipConfig||{};this.tooltipId=this.Tooltips.add({position:{x:0,y:0},type:n.type,html:this.getTemplate(t.tooltip)}),this.setPosition(e,t)}getTemplate(e){return`<div class="tooltip">${e}</div>`}getDiagramSize(){const t=this.canvas.getContainer().getBoundingClientRect();return{width:t.width,height:t.height}}getHtmlContainer(){return this.Tooltips.get(this.tooltipId).htmlContainer}setPosition(e,t){const{a:n,e:i,f:a}=e.getCTM();let r=i+t.width*n,c=a+t.height*n;const h=this.getDiagramSize(),_=this.getHtmlContainer(),{width:E,height:T}=_.getBoundingClientRect();r+E>h.width&&(r=i-E),c+T>h.height&&(c=a-T),Object.assign(_.style,{left:r+"px",top:c+"px"})}};rt=(0,s.__decorate)([(0,s.__param)(0,(0,o.Inject)("eventBus")),(0,s.__param)(1,(0,o.Inject)("tooltips")),(0,s.__param)(2,(0,o.Inject)("canvas")),(0,s.__metadata)("design:paramtypes",[Object,Object,Object])],rt);var ni=l(68567);const ii={__depends__:[Ln.Z,Rn.Z,Bn.Z,kn.Z,An.Z,zn.Z,Fn.Z,Hn.Z,Kn.Z,Wn.Z,Zn.Z,qn.Z,Nn.Z,kt.Z,Vn.Z,Xn.Z,ti.Z,G,ei.Z,Un.Z,he,Qn.Z],__init__:["canvas","commandStack","contextPad","contextPadProvider","copyPaste","labelSupport","diagramLoader","diagramRenderer","diagramRules","diagramEventHandlerController","diagramText","directEditing","editorActions","elementFactory","elementRegistry","keyboardBindings","labelEdit","layouter","localStorage","outline","resize","resizeHandles","resizePreview","setupMenuProvider","handTool","spaceToolPreview","bendpointMove","bendpoints","featureProvider","connectionPreview","connectionSegmentMove","paletteProvider","paletteElements","elementToolsConfig","createPopupMenu","palette","connectionHighlight","minimap","diagramPopup","lassoTool","diagramUtils","diagramPaletteTools","diagramTooltips"],canvas:["type",J],commandStack:["type",H],connectionDocking:["type",Jn.Z],contextPad:["type",_e],contextPadProvider:["type",Ke],copyPaste:["type",xe],labelSupport:["type",Ae],diagramLoader:["type",Se],diagramRenderer:["type",pe],diagramRules:["type",S],diagramEventHandlerController:["type",ni.SZ],directEditing:["type",Ue],editorActions:["type",Ce],elementFactory:["type",lt],elementRegistry:["type",je],keyboardBindings:["type",ut],localStorage:["type",$],modeling:["type",K],outline:["type",Ze],resize:["type",$n.Z],resizeHandles:["type",Yn.Z],resizePreview:["type",Gn.Z],setupMenuProvider:["type",Ne],handTool:["type",kt.Z],spaceToolPreview:["type",jt],bendpoints:["type",G],featureProvider:["type",It],connectionPreview:["type",g],popupMenu:["type",Te],connectionSegmentMove:["type",he],labelEdit:["type",ke],diagramText:["type",F],outlineFactory:["type",oe],renderingShapeFactory:["type",ge],renderingLabel:["type",qe],renderingShape:["type",Bt],layouter:["type",We],elements:["type",o.DiagramElements],paletteProvider:["type",Ie],splitConnectionHelper:["type",Mt],spaceTool:["type",Fe],paletteElements:["type",o.DiagramPaletteElements],elementToolsConfig:["type",Ee],createPopupMenu:["type",ne],palette:["type",Pe],replaceMenuGroups:["type",function(){return{}}],zoomScroll:["type",He],connectionHighlight:["type",ze],minimap:["type",Oe],diagramPopup:["type",ot],lassoTool:["type",De],previewSupport:["type",ft],diagramUtils:["type",o.DiagramUtils],diagramPaletteTools:["type",Me],diagramTooltips:["type",rt]}},84531:(A,P,l)=>{l.d(P,{S:()=>s});class s{stopSync(){}startSync(){}subscribeServerChanges(){return[]}}},68567:(A,P,l)=>{l.d(P,{Zb:()=>o,SZ:()=>v.S,Cy:()=>S,Oq:()=>y,Bb:()=>d.B,gz:()=>m});var s=l(94450);class o{}o.\u0275fac=function(O){return new(O||o)},o.\u0275prov=s.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"});var v=l(84531),D=l(8239),x=l(21322);class S{constructor(){this.error$=new x.Subject,this.updateElementCaption$=new x.Subject,this.updateConnectionCaption$=new x.Subject,this.updateCaption$=new x.Subject,this.changed$=new x.Subject,this.startLoading$=new x.Subject,this.endLoading$=new x.ReplaySubject(1)}init(){}bufferiseOps(O,L,k){}load(O,L){return(0,D.Z)(function*(){return Promise.resolve(null)})()}getDiagramConfig(){return(0,D.Z)(function*(){return Promise.resolve()})()}diagramInitialized(){}commit(O){return(0,D.Z)(function*(){})()}undo(){}redo(){}clearCash(){}}S.\u0275fac=function(O){return new(O||S)},S.\u0275prov=s.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac});class y{get data(){return this.diagramData}set data(O){this.diagramData=O}get diagram(){return this.internalDiagram}set diagram(O){this.internalDiagram=O}getDiagramDataId(){return this.diagramData?this.diagramData.id:null}getDiagramDataCaption(){return this.diagramData?this.diagramData.caption:null}hasDiagramData(){return!!this.diagramData}}y.\u0275fac=function(O){return new(O||y)},y.\u0275prov=s.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac,providedIn:"root"});var d=l(66740);class m{generate(O,L,k,R="{prefix} {index}"){let f=0,U="",B;do f=f+1,U=R.replace("{prefix}",k).replace("{index}",f.toString()),B=O.find(Q=>(Q[L]||"").toLowerCase()===U.toLowerCase());while(B);return U}}m.\u0275fac=function(O){return new(O||m)},m.\u0275prov=s.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})},66740:(A,P,l)=>{l.d(P,{B:()=>x});var s=l(65418),o=l.n(s),v=l(97600),D=l.n(v);class x{constructor(y){this.utils=y}_setAbsolutePosition(y,d,m){if(m.includes(y.id)||v.isUndefined(y.rx)||v.isUndefined(y.ry))return;const M=y.parent;let O=d.elements[M]||d.connections[M];O?(this.utils.isConnection(O)&&(O=d.elements[O.source]),this._setAbsolutePosition(O,d,m),y.x=O.x+y.rx,y.y=O.y+y.ry):(y.x=y.rx,y.y=y.ry),m.push(y.id)}setRelativePosition(y,d=null){let m=d||y.labelTarget||y.parent;m.id===s.Roots.root.id?(y.rx=y.x,y.ry=y.y):(this.utils.isConnection(m)&&(m=m.source),y.rx=y.x-m.x,y.ry=y.y-m.y)}setShapeAbsolutePosition(y,d=null){let m=d||y.labelTarget||y.parent;m.id===s.Roots.root.id?(v.isUndefined(y.rx)||(y.x=y.rx),v.isUndefined(y.ry)||(y.y=y.ry)):(this.utils.isConnection(m)&&(m=m.source),v.isUndefined(y.rx)||(y.x=m.x+y.rx),v.isUndefined(y.ry)||(y.y=m.y+y.ry))}setAbsolutePosition(y){if(!y)return;const d=[];v.forEach(y.elements,m=>{this._setAbsolutePosition(m,y,d)}),v.forEach(y.labels,m=>{this._setAbsolutePosition(m,y,d)})}}},94082:(A,P,l)=>{l.d(P,{F:()=>s.F});var s=l(12961)},12961:(A,P,l)=>{l.d(P,{F:()=>s});class s{static createFeFlood(v,D="#000",x=0){return this.createElement(v,{"flood-color":D,"flood-opacity":x||0,result:"colorResult"},"feFlood")}static createFeComposite(v){return this.createElement(v,{operator:"in",in:"colorResult",in2:"blurResult",result:"shadowResult"},"feComposite")}static createFeGaussianBlur(v,D=0){return this.createElement(v,{result:"blurResult",in:"offsetResult",stdDeviation:D},"feGaussianBlur")}static createFeBlend(v){return this.createElement(v,{in:"SourceGraphic",in2:"shadowResult",mode:"normal"},"feBlend")}static setAttribute(v,D){const x=Object.keys(D);for(const S of x)v.setAttribute(S.toString(),D[S])}static createElement(v,D,x){let S;return D&&D.id&&(S=v.getElementById(D.id)),S||(S=document.createElementNS(this.xmlns,x)),D&&this.setAttribute(S,D),S}static createFilter(v,D){return this.createElement(v,{id:D,width:"200%",height:"200%"},"filter")}static createFeOffset(v,D=0,x=0){return this.createElement(v,{result:"offsetResult",in:"SourceAlpha",dx:D,dy:x},"feOffset")}static addDefs(){const v=document.querySelector("svg"),D=v.getElementsByTagName("defs")[0];if(D==null){const x=document.createElementNS(this.xmlns,"defs");return v.appendChild(x)}return D}static createShadowFilter(v){const D=document.querySelector("svg"),x=v.name;if(!x)throw new Error("ArgumentNullOrEmptyException");const S=D.getElementById(x),y="url(#"+x+")";if(S)return y;const d=this.addDefs(),m=this.createFilter(D,x),M=this.createFeOffset(D,v.offsetX,v.offsetY);m.appendChild(M);const O=this.createFeGaussianBlur(D,v.blur);m.appendChild(O);const L=this.createFeFlood(D,v.color,v.opacity);m.appendChild(L);const k=this.createFeComposite(D);m.appendChild(k);const R=this.createFeBlend(D);return m.appendChild(R),d.appendChild(m),y}}s.xmlns="http://www.w3.org/2000/svg"}}]);
