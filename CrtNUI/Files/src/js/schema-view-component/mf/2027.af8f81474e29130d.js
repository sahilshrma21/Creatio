(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[2027],{32027:(Ae,Za,v)=>{v.r(Za),v.d(Za,{AppearanceSettingsDefaultLoaderService:()=>R.jZ,BASE_PAGE_COMPONENT_PROVIDERS:()=>W,BasePageComponent:()=>L,BaseRelatedInMainRecordsService:()=>R.SX,CARD_STATE_ATTRIBUTE_NAME:()=>H,CHILDREN_OUTLET_TOKEN:()=>tr,CLOSE_PAGE_COMMAND:()=>Re,CURRENT_DESKTOP_OPTION_NAME:()=>R.j_,CardComponent:()=>te,ChildOutlet:()=>T.aK,ChildrenRouterOutletDirective:()=>ne,ClientSchemaParentSchemaService:()=>R.Tx,ConfigurationStructureService:()=>R.b,CreateNewLookupPagePreprocessor:()=>ie,Crt7XRequest:()=>At,Crt7xModuleComponent:()=>F,Crt7xSchemaComponent:()=>Z,CrtRouterOutletComponent:()=>U,CrtSchemaOutletComponent:()=>P,DATA_GRID_IS_MULTI_SELECTION_MODE_ATTRIBUTE_NAME:()=>Me,DESKTOP_ENTITY_SCHEMA_NAME:()=>R.zi,DataGridSelectionStateLookupPagePreprocessor:()=>le,DataSourceRepositoryService:()=>R.jW,DataSourcesLookupPagePreprocessor:()=>ce,DataSourcesOldTagMiniPagePreprocessor:()=>ue,Desktop:()=>T.Hi,DesktopPageComponent:()=>ae,DesktopService:()=>R.mJ,FileUploadProcessingService:()=>R.dO,HEADER_CAPTION_ATTRIBUTE_NAME:()=>ee,HomePageComponent:()=>J,InitSearchFilterLookupPagePreprocessor:()=>de,LookupPageProfileSchemaProvider:()=>R.am,ModalOutletService:()=>fe,NAVIGATION_PREPROCESSOR_PROVIDERS:()=>$e,OLD_TAG_MINI_PAGE_DATA_TOKEN:()=>be,PAGE_LOOKUP_CREATED_RECORD_ATTRIBUTE_NAME:()=>Ne,PAGE_LOOKUP_DATA_GRID_NAME:()=>$,PAGE_LOOKUP_DATA_SOURCE_NAME:()=>ye,PAGE_LOOKUP_DATA_TOKEN:()=>T.HO,PAGE_LOOKUP_IS_CREATE_ALLOWED_ATTRIBUTE_NAME:()=>Ie,PAGE_LOOKUP_IS_MULTI_SELECTION_MODE_PART_ATTRIBUTE_NAME:()=>Qa,PAGE_LOOKUP_RESULT_TYPE_DEFAULT_VALUE:()=>T.TV,PAGE_LOOKUP_SEARCH_FILTER_FILTERED_COLUMN_GROUPS:()=>Ja,PAGE_LOOKUP_SEARCH_FILTER_VALUE:()=>Wa,PageComponent:()=>X,PageLookupResultType:()=>T.pb,ROUTER_OUTLET_HISTORY_VIEW_LIMIT_TOKEN:()=>ls.A,RelatedRecordsActionsEnum:()=>R.Gm,RouterOutletHistory:()=>xe.B,RunBusinessProcessRequestPreprocessor:()=>pe,SCHEMA_MODAL_COMPONENT_TYPE:()=>R.F$,SCHEMA_VIEW_MASK_TOKEN:()=>Ge,SchemaModalComponent:()=>oe,SchemaModalService:()=>R.Lu,SchemaOutletComponentResolverService:()=>Y,SchemaOutletPreprocessor:()=>se,SchemaViewDataSourceFactoryService:()=>R.Q1,SchemaViewModule:()=>q,SectionComponent:()=>Q,SelectionApiMode:()=>T.dh,SelectionWindowResult:()=>T.Vr,ShellHomePagePreprocessor:()=>he,StaticFolderService:()=>R.N1,TaggingService:()=>R.FL,TypeFilterOldTagMiniPagePreprocessor:()=>me,ViewModelDataDelayerService:()=>R.Wn,ViewState:()=>T.f7});var l=v(74742),x=v(31134),je=v(2876),s=v(94450),Pe=v(34560),za=v(71006),o=v(75378),k=v(77207),br=v(99965),b=v(99293),qa=v(18369),N=v(33177),C=v(41307),Ce=v(6523),O=v(96923),g=v(34038),K=v(46338),V=v(97055),j=v(14537),w=v(78094),h=v(49475),D=v(52045),Ka=v(16464),S=v(24709),E=v(97600),p=v(21322);const wr=["schemaComponent"],W=[j.ViewEventsNotifier,{provide:h.ALLOW_PAGE_DESIGN,useValue:!0}];class L{get hidden(){return this._hidden}set hidden(e){this._hidden=e,this._display=e?"none":""}get pageToolsVisible(){return!this.hidden}constructor(e,t,a,r){this.injector=e,this.googleTagManager=t,this.ngZone=a,this._sysSettingsService=r,this._viewEventsNotifier=(0,s.inject)(j.ViewEventsNotifier),this._display="",this._hidden=!1,this.isBackgroundEffectRequired=!0,this._init$=new p.ReplaySubject(1),this._subscription=new p.Subscription,this._isComponentDetached=!1,this._isComponentAttached=!1,this._addFlexFullHeightToHost=!0,this._isDisableWindowUnloadWatcher=!1,this._useNewShellSettingValue=!1,this._useScrollPositionService=!1,this.handlerChain=o.HandlerChainService.instance,this.destroyed$=new p.Subject,this.schemaStateGenerated=new s.EventEmitter,this.parametersChange=new s.EventEmitter,this.schemaExceptionThrown=new s.EventEmitter,this.schemaState=null,this.modelInitConfigs=null,this.parameters=null,(0,p.forkJoin)([this._sysSettingsService.getByCode("UseNewShell"),this.googleTagManager.initialize()]).subscribe(([n])=>{this._useNewShellSettingValue=n.value,this._init$.next()}),this._useScrollPositionService=this.injector.get(h.USE_SAVE_SCROLL_POSITION_SERVICE,!1),this.window=this.injector.get(N.WINDOW_TOKEN),this._setFeatures()}set schema(e){this._schemaName=e}get schema(){return this._schemaName}get backgroundEffectRequirement(){return this.isBackgroundEffectRequired}get scrollPositions(){return this._saveScrollPositionService?.scrollPositions}set scrollPositions(e){this._saveScrollPositionService&&(this._saveScrollPositionService.scrollPositions=e)}_sendGTMData(e){const t={moduleName:this.gtmModuleName,schemaName:this.schema,primaryData:e,useNewShell:this._useNewShellSettingValue};this.googleTagManager.track(t)}_processRequest(e,t){return this.ngZone.runOutsideAngular(()=>this.sendRequest({...e,scopes:t._scopes,$context:t}))}_getPrimaryDataSourceSchemaNameFromSchemaState(e){let t="";const a=e.models?.find(r=>r.getDataSource().dataSourceName==="PDS");return a&&(t=a?.dataSchemaName),t||(t=e.models[0]?.dataSchemaName),t}_setFeatures(){this.featureValues=this.injector.get(h.FEATURE_VALUES),this._isDisableWindowUnloadWatcher=this.featureValues.DisableWindowUnloadWatcher,this.isPageReusable=this.featureValues.UseSchemaOutletReuseViewStrategy&&(0,E.get)(this.window,["Terrasoft","isAngularHost"])}_trackGTM(){const e=this._getPrimaryDataSourceSchemaNameFromSchemaState(this.schemaState);this._init$.subscribe({next:()=>this._sendGTMData(e)})}sendRequest(e){return this.handlerChain.process(e)}onDetach(){this._isComponentDetached=!0,this._useScrollPositionService&&this._saveScrollPositionService?.stopScrollTracking();const e=this.schemaState?.viewModel;e&&this._isComponentAttached&&this._processRequest(new S.HandleViewModelPauseRequest,e).then(()=>{this._isComponentAttached=!1}),this._viewEventsNotifier.viewAttached$.next(!1)}onAttach(){this._isComponentDetached=!1;let e;this.schemaState?e=(0,p.of)(this.schemaState.viewModel):e=this.schemaStateGenerated.pipe((0,p.take)(1),(0,p.map)(a=>a.viewModel));const t=e.pipe((0,p.take)(1),(0,p.observeOn)(p.animationFrameScheduler),(0,p.switchMap)(a=>!this._isComponentDetached&&a?(this._viewEventsNotifier.viewAttached$.next(!0),this._useScrollPositionService&&(this._saveScrollPositionService?.restoreScrollPosition(),this._saveScrollPositionService?.startScrollTracking()),this._processRequest(new S.HandleViewModelResumeRequest,a)):(0,p.of)(null)),(0,p.tap)(()=>this._isComponentAttached=!0),(0,p.map)(()=>null),(0,p.shareReplay)({refCount:!1,bufferSize:1}),(0,p.takeUntil)(this.destroyed$));return t.subscribe(),t}ngOnInit(){globalThis.Terrasoft&&!globalThis.Terrasoft.isAngularHost&&this.onAttach()}ngOnDestroy(){globalThis.Terrasoft&&!globalThis.Terrasoft.isAngularHost&&this.onDetach(),this._init$.complete(),this._subscription.unsubscribe(),this.destroyed$?.next(),this.destroyed$?.complete()}onSchemaStateGenerated(e){this.schemaState=e,this.schemaStateGenerated.next(e),this._trackGTM()}onParametersChange(e){this.parametersChange.emit(e)}onSchemaExceptionThrown(e){this.schemaExceptionThrown.emit(e)}onBeforeUnload(){return Terrasoft.SessionEndUserNotification?.sessionExpired||this._isComponentDetached||this._isDisableWindowUnloadWatcher?!0:!this.schemaState?.viewModel?._isChanged}}L.\u0275fac=function(e){return new(e||L)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(C.GoogleTagManagerService),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(C.SysSettingsService))},L.\u0275dir=s.\u0275\u0275defineDirective({type:L,selectors:[["","crtBasePage",""]],viewQuery:function(e,t){if(e&1&&(s.\u0275\u0275viewQuery(h.SaveScrollPositionDirective,5,h.SaveScrollPositionService),s.\u0275\u0275viewQuery(wr,5)),e&2){let a;s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(t._saveScrollPositionService=a.first),s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(t.schemaComponent=a.first)}},hostVars:5,hostBindings:function(e,t){e&1&&s.\u0275\u0275listener("beforeunload",function(){return t.onBeforeUnload()},!1,s.\u0275\u0275resolveWindow),e&2&&(s.\u0275\u0275attribute("data-item-marker",t.dataItemMarker),s.\u0275\u0275styleProp("display",t._display),s.\u0275\u0275classProp("flex-full-height",t._addFlexFullHeightToHost))},inputs:{schemaState:"schemaState",modelInitConfigs:"modelInitConfigs",parameters:"parameters",schema:"schema",features:"features"},outputs:{schemaStateGenerated:"schemaStateGenerated",parametersChange:"parametersChange",schemaExceptionThrown:"schemaExceptionThrown"},features:[s.\u0275\u0275ProvidersFeature([W])]});var M=v(27049);const ee="HeaderCaption",H="CardState",$e=[S.MetadataPreprocessorService,{provide:S.CRT_METADATA_PREPROCESSOR,useFactory:(i,e)=>[...i,...e],deps:[[new s.SkipSelf,new s.Optional,S.CRT_METADATA_PREPROCESSOR],[new s.SkipSelf,new s.Optional,S.CRT_METADATA_NAVIGATION_PREPROCESSOR]]}],ye="MainDS",$="DataGridMain",Wa="SearchFilterMain_SearchValue",Ja="SearchFilterMain_FilteredColumnsGroups",Ie="IsCreateAllowed",Ne="CreatedRecord",Qa="_IsMultiselectionMode",Me=`${$}${Qa}`,Xa=new s.InjectionToken("Listen 7x custom events token");function kr(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",2),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onDesignButtonClicked())}),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275elementEnd()}i&2&&s.\u0275\u0275property("iconSize","medium")("iconPosition","only-icon")("size","medium")("title",s.\u0275\u0275pipeBind1(1,4,"BasePage.DesignButtonHint"))}function Or(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",3),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onExpandButtonClicked())}),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("icon",t.expandButtonIcon)("iconSize","medium")("iconPosition","only-icon")("size","medium")("title",s.\u0275\u0275pipeBind1(1,5,t.expandButtonTitle)+" (Ctrl+Shift+F)")}}class G{constructor(e){this.injector=e,this._rightsService=this.injector.get(C.RightsService),this._storageService=this.injector.get(h.StorageService),this._featureValues=this.injector.get(h.FEATURE_VALUES),this._window=this.injector.get(N.WINDOW_TOKEN),this._document=this.injector.get(x.DOCUMENT),this._allowPageDesign=this.injector.get(h.ALLOW_PAGE_DESIGN,!1),this._expandAttributeName="center-container-expanded",this._storageExpandedKey="isCenterContainerExpanded",this._features$=new p.ReplaySubject(1),this.expandButtonIcon="expand-icon",this.designButtonVisible=!1,this.expandButtonVisible=!1,this._expandButtonState=this._loadExpandedFromStorage()}set schema(e){this._schemaName=e,this._updateToolsButtonVisibility(),this._updateExpandButtonInfo()}get schema(){return this._schemaName}set features(e){this._features$.next(e)}set _expandButtonState(e){this._document.body.setAttribute(this._expandAttributeName,String(e)),this._saveExpandedToStorage(e)}get _expandButtonState(){return this._document.body.getAttribute(this._expandAttributeName)==="true"}_saveExpandedToStorage(e){this._storageService.set(this._storageExpandedKey,String(e))}_loadExpandedFromStorage(){return this._storageService.get(this._storageExpandedKey)==="true"}_updateExpandButtonInfo(){const e=this._expandButtonState;this._setExpandButtonInfo(e)}_updateToolsButtonVisibility(){this._updateDesignButtonVisibility(),this._updateExpandButtonVisibility()}_updateDesignButtonVisibility(){if(!this._allowPageDesign){this.designButtonVisible=!1;return}(0,p.combineLatest)([this._features$,this._rightsService.getCanExecuteOperation("CanManageSolution")]).subscribe(([e,t])=>{this.designButtonVisible=e?.tools?.canDesign&&t})}_updateExpandButtonVisibility(){if(this._featureValues.DisableCenterContainerExpandButtonFeature){this.expandButtonVisible=!1;return}this._features$.subscribe(e=>{this.expandButtonVisible=e?.tools?.canExpand})}_setExpandButtonInfo(e){this.expandButtonIcon=e?"collapse-icon":"expand-icon",this.expandButtonTitle=e?"BasePage.CollapseButtonTitle":"BasePage.ExpandButtonTitle"}onKeyDown(e){this.expandButtonVisible&&e.ctrlKey&&e.shiftKey&&e.code==="KeyF"&&this.onExpandButtonClicked()}onDesignButtonClicked(){const t=`${(0,h.getWorkspaceBaseUrl)()}ClientApp/#/InterfaceDesigner/${this.schema}`;this._window.open(t,"_blank")}onExpandButtonClicked(){const t=!this._expandButtonState;this._expandButtonState=t,this._setExpandButtonInfo(t)}}G.\u0275fac=function(e){return new(e||G)(s.\u0275\u0275directiveInject(s.Injector))},G.\u0275cmp=s.\u0275\u0275defineComponent({type:G,selectors:[["crt-page-tools"]],hostBindings:function(e,t){e&1&&s.\u0275\u0275listener("keydown",function(r){return t.onKeyDown(r)},!1,s.\u0275\u0275resolveWindow)},inputs:{schema:"schema",features:"features"},features:[s.\u0275\u0275ProvidersFeature([h.StorageService])],decls:2,vars:2,consts:[["class","design-button","icon","min-settings-icon",3,"iconSize","iconPosition","size","title","clicked",4,"ngIf"],["class","expand-button",3,"icon","iconSize","iconPosition","size","title","clicked",4,"ngIf"],["icon","min-settings-icon",1,"design-button",3,"iconSize","iconPosition","size","title","clicked"],[1,"expand-button",3,"icon","iconSize","iconPosition","size","title","clicked"]],template:function(e,t){e&1&&(s.\u0275\u0275template(0,kr,2,6,"crt-button",0),s.\u0275\u0275template(1,Or,2,7,"crt-button",1)),e&2&&(s.\u0275\u0275property("ngIf",t.designButtonVisible),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",t.expandButtonVisible))},dependencies:[x.NgIf,g.CrtButtonComponent,k.TranslatePipe],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row}crt-button[_ngcontent-%COMP%]{--button-border-radius: 50%;--crt-button-default-contrast-color: var(--crt-color-primary-grey)}"]});function Vr(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onParametersChange(r))})("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))})("schemaExceptionThrown",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaExceptionThrown(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Fr(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onParametersChange(r))})("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))})("schemaExceptionThrown",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaExceptionThrown(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Hr(i,e){if(i&1&&s.\u0275\u0275element(0,"crt-page-tools",5),i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class te extends L{constructor(e,t,a,r,n,c){super(r,e,a,n),this.googleTagManager=e,this._customEventService=t,this.ngZone=a,this.injector=r,this.sysSettingsService=n,this._customEvents=c,this._customEventSubscription=new Array,this.moduleName="PageModule",this.gtmModuleName="Form",this.dataItemMarker="card"}_subscribeOnCustomEvents(e,t){return this._customEventService.subscribe(e).pipe(t).subscribe(a=>{this._customEventService.createOutboundChannel(e).next(a)})}_subscribeOnValidateCard(){return this._subscribeOnCustomEvents("ValidateCard8x",e=>e.pipe((0,M.switchMap)(()=>{const t=this.schemaState.viewModel;return t.validate(),t.isValid()})))}_subscribeOnGetOperation(){return this._subscribeOnCustomEvents("GetOperation8x",e=>e.pipe((0,M.switchMap)(()=>this.schemaState.viewModel[H])))}_subscribeOnSaveCard(){return this._subscribeOnCustomEvents("SaveCard8x",e=>e.pipe((0,M.switchMap)(t=>{const a=this.schemaState.viewModel;return a.executeRequest({type:"crt.SaveRecordRequest",$context:a,...t})})))}_subscribeOnUpdateCard(){return this._subscribeOnCustomEvents("UpdateCard8x",e=>e.pipe((0,M.switchMap)(t=>{const a=this.schemaState?.viewModel;return(0,p.combineLatest)([a.getPrimaryModelName(),(0,p.of)(t),(0,p.of)(a)])}),(0,M.tap)(([t,a,r])=>{const n=r.getViewModelAttributePath(t,a.key);n&&(r[n]=a.value)})))}_subscribeCustomEvents(){this._unsubscribeCustomEvents(),this._customEventSubscription.push(this._subscribeOnValidateCard(),this._subscribeOnSaveCard(),this._subscribeOnUpdateCard(),this._subscribeOnGetOperation())}_unsubscribeCustomEvents(){this._customEventSubscription.forEach(e=>e.unsubscribe()),this._customEventSubscription=[]}onAttach(){const e=super.onAttach();return this._customEvents&&this._subscribeCustomEvents(),e}onDetach(){super.onDetach(),this._unsubscribeCustomEvents()}}te.\u0275fac=function(e){return new(e||te)(s.\u0275\u0275directiveInject(C.GoogleTagManagerService),s.\u0275\u0275directiveInject(N.CustomEventService),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(C.SysSettingsService),s.\u0275\u0275directiveInject(Xa,8))},te.\u0275cmp=s.\u0275\u0275defineComponent({type:te,selectors:[["crt-card"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown",4,"ngIf","ngIfElse"],["reusableSchema",""],[3,"schema","features",4,"ngIf"],["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown"],["schemaComponent",""],[3,"schema","features"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,Vr,2,4,"crt-schema",0),s.\u0275\u0275template(1,Fr,2,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,Hr,1,2,"crt-page-tools",2)),e&2){const a=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",a),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.pageToolsVisible)}},dependencies:[x.NgIf,V.SchemaComponent,V.CrtReusableSchemaComponent,h.SaveScrollPositionDirective,G],styles:["[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});function Br(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onParametersChange(r))})("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))})("schemaExceptionThrown",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaExceptionThrown(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Lr(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onParametersChange(r))})("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))})("schemaExceptionThrown",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaExceptionThrown(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Ur(i,e){if(i&1&&s.\u0275\u0275element(0,"crt-page-tools",5),i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class J extends L{constructor(){super(...arguments),this.moduleName="HomePageModule",this.gtmModuleName="HomePage",this.dataItemMarker="home-page"}}J.\u0275fac=function(){let i;return function(t){return(i||(i=s.\u0275\u0275getInheritedFactory(J)))(t||J)}}(),J.\u0275cmp=s.\u0275\u0275defineComponent({type:J,selectors:[["crt-home-page"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown",4,"ngIf","ngIfElse"],["reusableSchema",""],[3,"schema","features",4,"ngIf"],["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown"],["schemaComponent",""],[3,"schema","features"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,Br,2,4,"crt-schema",0),s.\u0275\u0275template(1,Lr,2,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,Ur,1,2,"crt-page-tools",2)),e&2){const a=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",a),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.pageToolsVisible)}},dependencies:[x.NgIf,V.SchemaComponent,V.CrtReusableSchemaComponent,h.SaveScrollPositionDirective,G],styles:["[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});var d=v(8239);class he{constructor(e){this._schemaInfoService=e}_isSchemaInheritedBaseHomePage(e){return e.tag.includes("BaseHomePage")}_setWrapElement(e){const t=(0,E.cloneDeep)(e.viewConfig);e.viewConfig=[{name:"MainWrapContainer",type:"crt.FlexContainer",direction:"column",gap:8,stretch:!0,fitContent:!1,items:t}]}_setHeaderViewConfig(e,t){const a={name:"HeaderContainer",type:"crt.FlexContainer",direction:"column",gap:8,color:"primary",padding:{top:"large",right:"large",bottom:"medium",left:"large"},fitContent:!0,items:[{name:"HeaderLabel",type:"crt.Label",caption:t,labelType:"headline-1"}]};e.items.unshift(a)}_setGridPadding(e){const t=e.items.find(a=>a.type==="crt.GridContainer")||{};t.padding="0 8px"}crtOnMetaDataInit(e){var t=this;return(0,d.Z)(function*(){const a=e;if(t._isSchemaInheritedBaseHomePage(a)){const r=yield t._schemaInfoService.getSchemaCaptionByName(a.name);t._setWrapElement(a),t._setHeaderViewConfig(a.viewConfig[0],r),t._setGridPadding(a.viewConfig[0])}return e})()}}he.\u0275fac=function(e){return new(e||he)(s.\u0275\u0275inject(C.SchemaInfoService))},he.\u0275prov=s.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac});function jr(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onParametersChange(r))})("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))})("schemaExceptionThrown",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaExceptionThrown(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function $r(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onParametersChange(r))})("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))})("schemaExceptionThrown",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaExceptionThrown(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function Gr(i,e){if(i&1&&s.\u0275\u0275element(0,"crt-page-tools",5),i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class Q extends L{constructor(){super(...arguments),this.moduleName="SectionModule",this.gtmModuleName="List",this.dataItemMarker="section"}}Q.\u0275fac=function(){let i;return function(t){return(i||(i=s.\u0275\u0275getInheritedFactory(Q)))(t||Q)}}(),Q.\u0275cmp=s.\u0275\u0275defineComponent({type:Q,selectors:[["crt-section"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown",4,"ngIf","ngIfElse"],["reusableSchema",""],[3,"schema","features",4,"ngIf"],["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown"],["schemaComponent",""],[3,"schema","features"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,jr,2,4,"crt-schema",0),s.\u0275\u0275template(1,$r,2,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,Gr,1,2,"crt-page-tools",2)),e&2){const a=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",a),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.pageToolsVisible)}},dependencies:[x.NgIf,V.SchemaComponent,V.CrtReusableSchemaComponent,h.SaveScrollPositionDirective,G],styles:["[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});function Zr(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onParametersChange(r))})("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))})("schemaExceptionThrown",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaExceptionThrown(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function zr(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",3,4),s.\u0275\u0275listener("parametersChanged",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onParametersChange(r))})("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))})("schemaExceptionThrown",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaExceptionThrown(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)("parameters",t.parameters)}}function qr(i,e){if(i&1&&s.\u0275\u0275element(0,"crt-page-tools",5),i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class X extends L{constructor(){super(...arguments),this.moduleName="PageModule",this.gtmModuleName="Form",this.dataItemMarker="page"}}X.\u0275fac=function(){let i;return function(t){return(i||(i=s.\u0275\u0275getInheritedFactory(X)))(t||X)}}(),X.\u0275cmp=s.\u0275\u0275defineComponent({type:X,selectors:[["crt-page"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:4,vars:3,consts:[["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown",4,"ngIf","ngIfElse"],["reusableSchema",""],[3,"schema","features",4,"ngIf"],["crtSaveScrollPosition","",3,"schema","schemaState","modelInitConfigs","parameters","parametersChanged","schemaStateGenerated","schemaExceptionThrown"],["schemaComponent",""],[3,"schema","features"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,Zr,2,4,"crt-schema",0),s.\u0275\u0275template(1,zr,2,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,qr,1,2,"crt-page-tools",2)),e&2){const a=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",a),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.pageToolsVisible)}},dependencies:[x.NgIf,V.SchemaComponent,V.CrtReusableSchemaComponent,h.SaveScrollPositionDirective,G],styles:["[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});const Kr=["container"];let F=class extends j.CrtBaseComponent{constructor(e,t){super(e),this._injector=e,this._requireJsProvider=t}get _requirejs(){return this._requireJsProvider.get()}ngAfterViewInit(){this.container.nativeElement.id=N.NameGenerator.generateUnique("7xModule"),this.load7xModule()}load7xModule(){this._requirejs(["core-base"],e=>{this._initSandbox(e),this._requirejs(["sandbox_"+this.module],t=>{t.loadModule(this.module,{id:"sandbox_"+this.module+this.container.nativeElement.id,renderTo:this.doNotRender?null:this.container.nativeElement.id,instanceConfig:{...this.instanceConfig}})})})}_initSandbox(e){e.createContext(this.module,{id:this.module,moduleName:this.module})}};F.\u0275fac=function(e){return new(e||F)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(h.RequireJsProvider))},F.\u0275cmp=s.\u0275\u0275defineComponent({type:F,selectors:[["crt-7x-module"]],viewQuery:function(e,t){if(e&1&&s.\u0275\u0275viewQuery(Kr,7,s.ElementRef),e&2){let a;s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(t.container=a.first)}},inputs:{module:"module",doNotRender:"doNotRender",instanceConfig:"instanceConfig"},features:[s.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["container",""]],template:function(e,t){e&1&&s.\u0275\u0275element(0,"div",null,0)}}),(0,l.__decorate)([(0,o.CrtInput)(),(0,l.__metadata)("design:type",String)],F.prototype,"module",void 0),(0,l.__decorate)([(0,o.CrtInput)(),(0,l.__metadata)("design:type",Boolean)],F.prototype,"doNotRender",void 0),(0,l.__decorate)([(0,o.CrtInput)(),(0,l.__metadata)("design:type",Object)],F.prototype,"instanceConfig",void 0),F=(0,l.__decorate)([(0,o.CrtViewElement)({type:"crt.ModuleLoader",reuseStrategy:o.ViewElementReuseStrategy.Reuse}),(0,l.__metadata)("design:paramtypes",[s.Injector,h.RequireJsProvider])],F);const Ge=new s.InjectionToken("SCHEMA_VIEW_MASK_TOKEN");function Wr(i,e){if(i&1&&s.\u0275\u0275element(0,"crt-page-tools",2),i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schema)("features",t.features)}}class Z extends L{get hidden(){return!this._visible}constructor(e,t,a,r,n,c,u){super(r,e,n,c),this._googleTagManager=e,this._customEventService=t,this._requireJsProvider=a,this.injector=r,this.ngZone=n,this.sysSettingsService=c,this._parentCdr=u,this._isStart7xRenderModule$=new p.ReplaySubject(1),this._visible=!0,this._hide$=new p.Subject,this._shouldShowBodyMask=!1,this.moduleName="7xSchema",this._mask=this.injector.get(Ge),this._subscribeOn7xMaskEvents()}get _requirejs(){return this._requireJsProvider.get()}ngAfterViewInit(){this._requirejs(["core-base","ext-base"],(e,t)=>{this._moduleId&&e.unloadModule(this._moduleId),this._moduleId=e.loadModule("ViewModuleWrapper",{renderTo:t.get("7xContainer")})})}_subscribeOnStart7xRenderModule(){this._isStart7xRenderModule$.next(!1),this._renderModuleSubscription?.unsubscribe(),this._renderModuleSubscription=this._customEventService.subscribe("Start7xRenderModule").pipe((0,p.first)()).subscribe(()=>{this._isStart7xRenderModule$.next(!0)})}_convertToMaskSettings(e){const t={};return"timeout"in e&&(t.delay=e.timeout),t}_subscribeOn7xMaskEvents(){this._customEventService.subscribe("ShowBodyMask").pipe((0,M.takeUntil)(this.destroyed$)).subscribe(e=>{const t=e?this._convertToMaskSettings(e):null;this._shouldShowBodyMask||(this._shouldShowBodyMask=!0,this._mask.addTask("BLOCKING_BODY_7X_TASK",t))}),this._customEventService.subscribe("HideBodyMask").pipe((0,M.takeUntil)(this.destroyed$)).subscribe(()=>{this._shouldShowBodyMask=!1,this._mask.removeTask("BLOCKING_BODY_7X_TASK")})}subscribeOn7xEvents(){this._subscribeOnStart7xRenderModule()}show(){return this._visible?Promise.resolve(void 0).then(()=>{this?._parentCdr?.detectChanges()}):(0,p.lastValueFrom)(this._isStart7xRenderModule$.pipe((0,p.first)(e=>e),(0,M.map)(()=>(this._visible=!0,this?._parentCdr?.detectChanges(),null)),(0,M.takeUntil)(this._hide$)),{defaultValue:void 0})}hide(){this._hide$.next(),this._renderModuleSubscription?.unsubscribe(),this._visible=!1}}Z.\u0275fac=function(e){return new(e||Z)(s.\u0275\u0275directiveInject(C.GoogleTagManagerService),s.\u0275\u0275directiveInject(N.CustomEventService),s.\u0275\u0275directiveInject(h.RequireJsProvider),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(C.SysSettingsService),s.\u0275\u0275directiveInject(s.ChangeDetectorRef,4))},Z.\u0275cmp=s.\u0275\u0275defineComponent({type:Z,selectors:[["crt-7x-schema"]],hostVars:2,hostBindings:function(e,t){e&2&&s.\u0275\u0275classProp("display-none",t.hidden)},features:[s.\u0275\u0275ProvidersFeature([...W,{provide:h.ALLOW_PAGE_DESIGN,useValue:!1}]),s.\u0275\u0275InheritDefinitionFeature],decls:2,vars:1,consts:[["id","7xContainer",1,"flex-full-height"],[3,"schema","features",4,"ngIf"],[3,"schema","features"]],template:function(e,t){e&1&&(s.\u0275\u0275element(0,"div",0),s.\u0275\u0275template(1,Wr,1,2,"crt-page-tools",1)),e&2&&(s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",!t.hidden))},dependencies:[x.NgIf,G],styles:['[_nghost-%COMP%]   div[id="7xContainer"][_ngcontent-%COMP%]{width:100%;background-color:#fff}.display-none[_nghost-%COMP%]{display:none}body[OldUI=false][_ngcontent-%COMP%]   .card-content-container[_ngcontent-%COMP%] > .actions-container[_ngcontent-%COMP%]{position:fixed}',"[_nghost-%COMP%]{position:relative}crt-page-tools[_ngcontent-%COMP%]{position:absolute;right:0;top:0}.rtl[_nghost-%COMP%]   .tools[_ngcontent-%COMP%]{right:initial;left:0}"]});var A=v(34617),xe=v(15915),Ya=v(72856),er=v(54514),R=v(491);function Jr(i,e){if(i&1&&s.\u0275\u0275element(0,"div",8),i&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("ngStyle",t.tileBackgroundStyle)}}const Qr=function(i){return{visible:i}};function Xr(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",9)(1,"crt-button",10),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext().$implicit,n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.editDesktop(r))}),s.\u0275\u0275elementEnd()()}if(i&2){const t=s.\u0275\u0275nextContext().$implicit,a=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(6,Qr,a.desktopHovered===t.schemaName))("iconPosition",a.editDesktopIconPosition)("icon",a.editDesktopIconName)("iconSize",a.editDesktopIconSize)("size",a.editDesktopSize)("title",a.editDesktopTooltipTitle)}}const Yr=function(i){return{active:i}};function es(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",2),s.\u0275\u0275listener("click",function(){const n=s.\u0275\u0275restoreView(t).$implicit,c=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(c.selectDesktop(n))})("mouseover",function(){const n=s.\u0275\u0275restoreView(t).$implicit,c=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(c.desktopHovered=n.schemaName)})("mouseout",function(){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.desktopHovered=null)}),s.\u0275\u0275elementStart(1,"div",3),s.\u0275\u0275template(2,Jr,1,1,"div",4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"div",5)(4,"div",6),s.\u0275\u0275text(5),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(6,Xr,2,8,"div",7),s.\u0275\u0275elementEnd()()}if(i&2){const t=e.$implicit,a=s.\u0275\u0275nextContext();s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(4,Yr,t.schemaName===a.selectedDesktopSchemaName)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",a.tileBackgroundStyle),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",t.title," "),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",a.canEditDesktop)}}class ge{constructor(e,t,a,r){this.injector=e,this._translateService=t,this._changeDetector=a,this._appBackgroundService=r,this._editDesktopIcon=v(60954),this._subscription=new p.Subscription,this.editDesktopIconName="edit-desktop-icon",this.editDesktopIconPosition=O.IconPositionEnum.OnlyIcon,this.editDesktopIconSize=O.SizeEnum.Large,this.editDesktopSize=O.SizeEnum.Large,this.editDesktopTooltipTitle=this._translateService.instant("DesktopSelector.EditDesktop"),this.desktops=[],this.canEditDesktop=!1,this.desktopSelected=new s.EventEmitter,this.desktopEdit=new s.EventEmitter,this._iconRegistry=e.get(Ya.MatIconRegistry),this._domSanitizer=e.get(er.DomSanitizer)}_registerIcons(){this._iconRegistry.addSvgIconLiteral(this.editDesktopIconName,this._domSanitizer.bypassSecurityTrustHtml(this._editDesktopIcon))}ngOnInit(){this._registerIcons();const e=this._appBackgroundService.getConfig().pipe((0,p.map)(t=>g.AppBackgroundService.getBackgroundMode(t)===g.AppBackgroundMode.Image?g.AppBackgroundService.getImageStyle(t):g.AppBackgroundService.getColorStyle(t))).subscribe(t=>{this.tileBackgroundStyle=t,this._changeDetector.detectChanges()});this._subscription.add(e)}ngOnDestroy(){this._subscription.unsubscribe()}selectDesktop(e){e.schemaName!==this.selectedDesktopSchemaName&&this.desktopSelected.emit(e)}editDesktop(e){!this.canEditDesktop||this.desktopEdit.emit(e)}}ge.\u0275fac=function(e){return new(e||ge)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(k.TranslateService),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(g.AppBackgroundService))},ge.\u0275cmp=s.\u0275\u0275defineComponent({type:ge,selectors:[["crt-desktop-selector"]],inputs:{desktops:"desktops",canEditDesktop:"canEditDesktop",selectedDesktopSchemaName:"selectedDesktopSchemaName"},outputs:{desktopSelected:"desktopSelected",desktopEdit:"desktopEdit"},decls:2,vars:1,consts:[[1,"desktop-selector"],["class","desktop-selector-element",3,"ngClass","click","mouseover","mouseout",4,"ngFor","ngForOf"],[1,"desktop-selector-element",3,"ngClass","click","mouseover","mouseout"],[1,"desktop-selector-element-image-container"],["class","desktop-selector-element-image-container-img",3,"ngStyle",4,"ngIf"],[1,"desktop-selector-element-info-container"],[1,"desktop-selector-element-title"],["class","desktop-selector-element-action",4,"ngIf"],[1,"desktop-selector-element-image-container-img",3,"ngStyle"],[1,"desktop-selector-element-action"],[1,"desktop-selector-element-edit",3,"ngClass","iconPosition","icon","iconSize","size","title","clicked"]],template:function(e,t){e&1&&(s.\u0275\u0275elementStart(0,"div",0),s.\u0275\u0275template(1,es,7,6,"div",1),s.\u0275\u0275elementEnd()),e&2&&(s.\u0275\u0275advance(1),s.\u0275\u0275property("ngForOf",t.desktops))},dependencies:[x.NgClass,x.NgForOf,x.NgIf,x.NgStyle,g.CrtButtonComponent],styles:[`.desktop-selector[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;overflow-x:auto;padding:4px;gap:8px}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element[_ngcontent-%COMP%]{width:196px;min-width:196px;padding:8px;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;gap:5px;border-radius:10px;cursor:pointer}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-image-container-img[_ngcontent-%COMP%]{background-size:cover;height:100%;width:180px;aspect-ratio:4/3;border-radius:5px;position:relative}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-image-container-img[_ngcontent-%COMP%]:after{content:"";display:block;position:absolute;inset:0;background-position:center;background-repeat:no-repeat;background-size:40%;background-size:50%;background-image:url("data:image/svg+xml,%3Csvg width='93' height='44' viewBox='0 0 93 44' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect y='12.5715' width='44.2857' height='14.1429' rx='2' fill='%23181818' fill-opacity='0.4'/%3E%3Crect width='44.2857' height='6.28571' rx='2' fill='white' fill-opacity='0.3'/%3E%3Crect x='48.7144' y='12.5715' width='44.2857' height='14.1429' rx='2' fill='%23181818' fill-opacity='0.4'/%3E%3Crect y='29.8572' width='44.2857' height='14.1429' rx='2' fill='%23181818' fill-opacity='0.4'/%3E%3Crect x='48.7144' y='29.8572' width='44.2857' height='14.1429' rx='2' fill='%23181818' fill-opacity='0.4'/%3E%3C/svg%3E%0A")}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-info-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;gap:5px}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-title[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;flex:1}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-action[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;align-self:center}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-edit[_ngcontent-%COMP%]{visibility:hidden}.desktop-selector[_ngcontent-%COMP%]   .desktop-selector-element-edit.visible[_ngcontent-%COMP%]{visibility:visible}`]});function ts(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-schema",4),s.\u0275\u0275listener("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schemaName)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)}}function as(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-reusable-schema",4),s.\u0275\u0275listener("schemaStateGenerated",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.onSchemaStateGenerated(r))}),s.\u0275\u0275elementEnd()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("schema",t.schemaName)("schemaState",t.schemaState)("modelInitConfigs",t.modelInitConfigs)}}function rs(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",5),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.setShowDesktopSelectorState(!1))}),s.\u0275\u0275elementStart(1,"div",6),s.\u0275\u0275listener("click",function(r){return r.stopPropagation()}),s.\u0275\u0275elementStart(2,"crt-desktop-selector",7),s.\u0275\u0275listener("desktopSelected",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.setActiveDesktop(r))})("desktopEdit",function(r){s.\u0275\u0275restoreView(t);const n=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(n.editDesktop(r))}),s.\u0275\u0275elementEnd()()()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(2),s.\u0275\u0275property("desktops",t.desktops)("selectedDesktopSchemaName",t.schemaName)("canEditDesktop",t.canEditDesktop)}}function ss(i,e){if(i&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",8)(1,"crt-button",9),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.setShowDesktopSelectorState(!0))}),s.\u0275\u0275elementEnd()()}if(i&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("iconPosition",t.selectDesktopIconPosition)("icon",t.selectDesktopIconName)("iconSize",t.selectDesktopIconSize)("size",t.selectDesktopSize)("title",t.selectDesktopTooltipTitle)}}class ae extends L{constructor(e,t,a,r,n,c,u){super(a,t,r,u),this._desktopService=e,this.injector=a,this.ngZone=r,this._translateService=n,this._changeDetector=c,this.sysSettingsService=u,this._selectDesktopIcon=v(94171),this.moduleName="Desktop",this.gtmModuleName=this.moduleName,this.dataItemMarker="desktop-page",this.isBackgroundEffectRequired=!1,this.selectDesktopIconName="select-desktop-icon",this.canEditDesktop=!1,this.showDesktopSelector=!1,this.showDesktopSelectorButton=!1,this.selectDesktopIconPosition=O.IconPositionEnum.OnlyIcon,this.selectDesktopIconSize=O.SizeEnum.Large,this.selectDesktopSize=O.SizeEnum.Large,this.selectDesktopTooltipTitle=this._translateService.instant("DesktopSelector.ShowDesktopSelector"),this._window=a.get(N.WINDOW_TOKEN),this._iconRegistry=a.get(Ya.MatIconRegistry),this._domSanitizer=a.get(er.DomSanitizer)}_getFirstDesktopBySchemaName(e){return this.desktops.find(t=>t.schemaName===e)??null}_getFirstDesktop(){return this.desktops.length===0?null:this.desktops[0]}_getCurrentDesktop(){return this._getFirstDesktopBySchemaName(this.schemaName)}_registerIcons(){this._iconRegistry.addSvgIconLiteral(this.selectDesktopIconName,this._domSanitizer.bypassSecurityTrustHtml(this._selectDesktopIcon))}ngOnInit(){var e=()=>super.ngOnInit,t=this;return(0,d.Z)(function*(){if(e().call(t),t.desktops=yield t._desktopService.getUserDesktops(),t.desktops.length>0){if(t._registerIcons(),t.schemaName=yield t._desktopService.getCurrentDesktopSchemaName(),t.schema=t.schemaName,t.canEditDesktop=yield t._desktopService.canEditDesktop(),t.showDesktopSelectorButton=!0,!t._getCurrentDesktop()){const r=t._getFirstDesktop();yield t.setActiveDesktop(r)}}else t.schema=t.schemaName="CentralAreaDesktopTemplate",t.showDesktopSelectorButton=!1;t._changeDetector.detectChanges()})()}setActiveDesktop(e){var t=this;return(0,d.Z)(function*(){t.schemaName!==e?.schemaName&&(yield t._desktopService.setCurrentDesktop(e),t.schemaName=e?e.schemaName:null,t._changeDetector.detectChanges())})()}editDesktop(e){const t=(0,h.getWorkspaceBaseUrl)()+"ClientApp/#/InterfaceDesigner/"+e.schemaName;this._window.open(t,"_blank")}setShowDesktopSelectorState(e){this.showDesktopSelector=e,this._changeDetector.detectChanges()}}ae.\u0275fac=function(e){return new(e||ae)(s.\u0275\u0275directiveInject(R.mJ),s.\u0275\u0275directiveInject(C.GoogleTagManagerService),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(s.NgZone),s.\u0275\u0275directiveInject(k.TranslateService),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(C.SysSettingsService))},ae.\u0275cmp=s.\u0275\u0275defineComponent({type:ae,selectors:[["crt-desktop"]],features:[s.\u0275\u0275ProvidersFeature([W]),s.\u0275\u0275InheritDefinitionFeature],decls:5,vars:4,consts:[[3,"schema","schemaState","modelInitConfigs","schemaStateGenerated",4,"ngIf","ngIfElse"],["reusableSchema",""],["class","desktop-selector-overlay",3,"click",4,"ngIf"],["class","desktop-selector-button-container",4,"ngIf"],[3,"schema","schemaState","modelInitConfigs","schemaStateGenerated"],[1,"desktop-selector-overlay",3,"click"],[1,"desktop-selector-container",3,"click"],[3,"desktops","selectedDesktopSchemaName","canEditDesktop","desktopSelected","desktopEdit"],[1,"desktop-selector-button-container"],[1,"desktop-selector-button",3,"iconPosition","icon","iconSize","size","title","clicked"]],template:function(e,t){if(e&1&&(s.\u0275\u0275template(0,ts,1,3,"crt-schema",0),s.\u0275\u0275template(1,as,1,3,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275template(3,rs,3,3,"div",2),s.\u0275\u0275template(4,ss,2,5,"div",3)),e&2){const a=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",!t.isPageReusable)("ngIfElse",a),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",t.showDesktopSelector),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",t.showDesktopSelectorButton)}},dependencies:[x.NgIf,g.CrtButtonComponent,V.SchemaComponent,V.CrtReusableSchemaComponent,ge],styles:["[_nghost-%COMP%]   .desktop-selector-overlay[_ngcontent-%COMP%]{z-index:999;position:fixed;width:100%;height:100vh;top:0;left:0;right:0;display:flex;align-items:flex-end;flex-direction:column-reverse;padding:0 10px 50px}[_nghost-%COMP%]   .desktop-selector-container[_ngcontent-%COMP%]{z-index:1000;height:228px;padding:12px;max-width:62%;border-radius:10px}[_nghost-%COMP%]   .desktop-selector-button-container[_ngcontent-%COMP%]{position:fixed;bottom:6px;display:flex;width:100%;left:0;right:0;padding:0 10px;flex-direction:row-reverse}"]});class Y{resolve(e){return(0,d.Z)(function*(){let t=e.moduleName;if(e.schemaName){if(!(yield A.NavigationUtils.isAngularSchema(e.schemaName)))return Z;t=t||(yield A.NavigationUtils.getModuleName(e.schemaName))}switch(t){case"HomePage":return J;case"CardSchemaViewModule":case"Card":return te;case"PageSchemaViewModule":case"Page":return X;case"SectionSchemaViewModule":case"Section":return Q;case"Desktop":return ae;default:return Z}})()}}Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275prov=s.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac,providedIn:"root"});const ns=new s.InjectionToken("SCHEMA_OUTLET_VIEW_STORE_LIMIT_TOKEN");class re{constructor(e,t){this._schemaChangeListenerService=t,this._storeLimit=20,this._items=new Map,this._destroyed$=new p.Subject,this._outdatedViews=[],e!==null&&(this._storeLimit=e),this._subscribeOnSchemaChanged()}_subscribeOnSchemaChanged(){this._schemaChangeListenerService.schemaChanged$.pipe((0,M.takeUntil)(this._destroyed$)).subscribe(e=>{if(e.schemaType===h.SchemaTypes.ClientUnitSchema){const t=e.name;this._items.has(t)&&(this._outdatedViews.push(this._items.get(t)),this._items.delete(t))}})}_enforceStoreLimit(){const e=Array.from(this._items.keys());for(let t=0;t<this._items.size-this._storeLimit;t++){const a=e[t];this._items.get(a)?.destroy(),this._items.delete(a)}}get size(){return this._items.size}get(e){return this._items.get(e)}set(e,t){this._items.set(e,t),this._enforceStoreLimit()}destroy(){this._items.forEach(e=>e.destroy()),this._items.clear(),this._outdatedViews.forEach(e=>e.destroy()),this._outdatedViews=[],this._destroyed$.next(),this._destroyed$.complete()}}re.\u0275fac=function(e){return new(e||re)(s.\u0275\u0275inject(ns,8),s.\u0275\u0275inject(h.SchemaChangeListenerService))},re.\u0275prov=s.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac});var T=v(32935),_e=v(76596);const tr=new s.InjectionToken("CHILDREN_OUTLET_TOKEN"),Re=new s.InjectionToken("CLOSE_PAGE_COMMAND",{providedIn:"root",factory:()=>(0,h.simpleCommand)(()=>o.HandlerChainService.instance.process({type:"crt.7XRequest",action:"BackHistoryState",$context:null}))}),be=new s.InjectionToken("OldTagMiniPageDataToken");var Ze;const os=["container"],is=["7xContainer"];let P=Ze=class extends j.CrtBaseComponent{set parameters(e){this._setParametersValue$.next(e)}set schemaName(e){this._config={schemaName:e},this._changeSchema().pipe((0,p.takeUntil)(this._destroyed)).subscribe()}get schemaName(){return this._config?.schemaName}constructor(e,t,a,r,n,c,u,m,_,f){super(e),this._injector=e,this._customEventService=t,this._cdr=a,this._router=r,this._schemaModalService=n,this._featureValues=c,this._appendSchemaStateFromUrlService=u,this._modelInitConfigsGenerator=m,this._componentResolver=_,this._environmentInjector=f,this._cancelSchemaChanging=new p.Subject,this._destroyed=new p.Subject,this._setParametersValue$=new p.ReplaySubject(1),this._viewStoreService=(0,s.inject)(re),this._addClsToHost=!0,this._addFlexFullHeightToHost=!0,this.maskSettings={delay:500},this.componentBackgroundStateChanged=new s.EventEmitter,this.beforeSchemaChangeEvent=new s.EventEmitter,this.afterSchemaChangeEvent=new s.EventEmitter,this.parametersChange=new s.EventEmitter,this.schemaExceptionThrown=new s.EventEmitter}ngOnInit(){this._schemaModalService.modalCreated$.pipe((0,p.takeUntil)(this._destroyed)).subscribe(e=>{this.viewState.modalRefs.set(e.id,e)}),this._schemaModalService.modalClosed$.pipe((0,p.takeUntil)(this._destroyed)).subscribe(e=>{this.viewState.modalRefs.delete(e)})}_getComponentType(e){return(0,p.from)(this._componentResolver.resolve({schemaName:e.schemaName,moduleName:e.moduleName}))}_hideCurrentComponent(){this.componentRef?this._hide8xComponent():this.componentRef7x?.instance?.hide()}_hide8xComponent(){!this.componentRef||(this.componentRef.instance.onDetach(),this._featureValues.DisableSchemaOutletHiddenBeforeDetach||(this.componentRef.instance.hidden=!0,this._cdr.detectChanges()),this.viewContainerRef.detach(),this._hideModals(),this.componentRef=null,this.viewState=null)}_hideModals(){const e=this?.viewState?.modalRefs;if(e){const t=Array.from(e.keys());this._schemaModalService.hideModals(t)}}_restoreModals(){if(this.viewState.modalRefs?.size){const e=Array.from(this.viewState.modalRefs.keys());this._schemaModalService.restoreModals(e)}}_subscribeSetParametersValue(){const e=this.componentRef.instance;this._subscriptionSetParametersValue?.unsubscribe(),this._subscriptionSetParametersValue=this._setParametersValue$.subscribe(t=>{e.parameters=t})}_subscribeOnParametersChanges(){this._subscriptionParametersChange?.unsubscribe(),this._subscriptionParametersChange=this.componentRef.instance.parametersChange.subscribe(e=>{this.parametersChange.emit(e)})}_subscribeExceptionThrown(){this._subscriptionErrorThrown?.unsubscribe(),this._subscriptionErrorThrown=this.componentRef.instance.schemaExceptionThrown.subscribe(e=>this.schemaExceptionThrown.emit(e))}_subscribeOn8xComponentDestroy(e){this.componentRef.instance.destroyed$.pipe((0,p.take)(1)).subscribe(()=>{e?.viewModel?.destroy()})}_canRestore8xComponent(){const e=this._config.restoreViewState;return e&&!e.pageRef.hostView.destroyed}_canReuse8xComponent(){return Boolean(this._config.schemaName&&A.NavigationUtils.isAngularRouting(this._config.moduleName)&&this._viewStoreService.get(this._config.schemaName))}_set8xComponentInitProperties(){this._appendSchemaStateFromUrlService.shouldAppendState(this._config.schemaName)&&this._appendSchemaStateFromUrlService.appendState(this._config);const e=this.componentRef.instance;e.schema=this._config.schemaName,e.modelInitConfigs=this._config.modelInitConfigs??this._modelInitConfigsGenerator.generate(this._config),e.parameters=this._config.parameters,e.scrollPositions=new Map,this.componentRef.changeDetectorRef.detectChanges()}_setup8xComponent(){return this.componentRef.instance.features=this.features,this.componentBackgroundStateChanged.emit(this.componentRef.instance.backgroundEffectRequirement),this._subscribeExceptionThrown(),this._subscribeSetParametersValue(),this._cdr.detectChanges(),this.componentRef.instance.onAttach().pipe((0,p.observeOn)(p.animationFrameScheduler),(0,p.tap)(()=>this._subscribeOnParametersChanges()))}_setViewState(){this.viewState=new T.f7(this.componentRef,new Map,this.componentRef.instance.schemaState,this._featureValues.UseSchemaOutletReuseViewStrategy,this.componentRef.instance.scrollPositions,this._featureValues)}_create7xComponentIfNeeded(){this.componentRef7x||(this.componentRef7x=this.viewContainerRef7x.createComponent(Z),this.componentRef7x.changeDetectorRef.detectChanges())}_prepare7xComponent(){return this._hide8xComponent(),this._create7xComponentIfNeeded(),this.componentRef7x.instance.features=this.features,this.componentBackgroundStateChanged.emit(this.componentRef7x.instance.backgroundEffectRequirement),(0,p.from)(this.componentRef7x.instance.show())}_create8xComponent(e){return this._hideCurrentComponent(),this.componentRef=this.viewContainerRef.createComponent(e,{injector:this._injector,environmentInjector:this._environmentInjector}),this._set8xComponentInitProperties(),this._setup8xComponent().pipe((0,p.observeOn)(p.animationFrameScheduler),(0,p.tap)(()=>{this._featureValues.UseSchemaOutletReuseViewStrategy||this._subscribeOn8xComponentDestroy(this.componentRef.instance.schemaState),this._setViewState(),this._featureValues.UseSchemaOutletReuseViewStrategy&&this._viewStoreService.set(this._config.schemaName,this.componentRef)}))}_reuse8xComponent(){return(0,p.of)(null).pipe((0,p.observeOn)(p.animationFrameScheduler),(0,p.tap)(()=>this._hideCurrentComponent()),(0,p.observeOn)(p.animationFrameScheduler),(0,p.switchMap)(()=>{const e=this._viewStoreService.get(this._config.schemaName);return this.viewContainerRef.insert(e.hostView),this.componentRef=e,this.componentRef.instance.schema=null,this.componentRef.instance.schemaState=null,this.componentRef.changeDetectorRef.detectChanges(),this._set8xComponentInitProperties(),this._setup8xComponent()}),(0,p.observeOn)(p.animationFrameScheduler),(0,p.tap)(()=>{this._featureValues.UseSchemaOutletReuseViewStrategy||this._subscribeOn8xComponentDestroy(this.componentRef.instance.schemaState),this._setViewState(),this.componentRef.instance.hidden&&(this.componentRef.instance.hidden=!1)}))}_restore8xComponent(){this._hideCurrentComponent();const e=this._config.restoreViewState,t=e.pageRef.instance;return t.hidden&&(t.hidden=!1),t.schemaState!==e.schemaState&&(t.schemaState=e.schemaState,t.scrollPositions=e.scrollPositions),e.pageRef.changeDetectorRef.detectChanges(),this.viewContainerRef.insert(e.pageRef.hostView),this.componentRef=e.pageRef,this.viewState=e,this._restoreModals(),this._setup8xComponent()}_prepareComponent(){return this._canRestore8xComponent()?this._restore8xComponent():this._canReuse8xComponent()?this._reuse8xComponent():this._getComponentType(this._config).pipe((0,p.switchMap)(e=>e===Z?this._prepare7xComponent():this._create8xComponent(e)))}_changeSchema(){return this._config?(this._cancelSchemaChanging.next(),this.beforeSchemaChange(),this.componentRef7x?.instance.subscribeOn7xEvents(),this._prepareComponent().pipe((0,p.tap)(()=>{this.afterSchemaChange(),this._router.onNavigateEnd(),this._cdr.detectChanges()}),(0,p.takeUntil)(this._cancelSchemaChanging))):(0,p.of)(void 0)}preload7xConfiguration(){const e=(0,p.firstValueFrom)(this._customEventService.getDataViaEvent("ConfigurationViewModuleLoaded"));return this._create7xComponentIfNeeded(),e.then(()=>{})}beforeSchemaChange(){this.mask.addTask("SCHEMA_CHANGE",{delay:1e3}),this.beforeSchemaChangeEvent.emit()}afterSchemaChange(){this.mask.removeTask("SCHEMA_CHANGE"),this.afterSchemaChangeEvent.emit()}setConfig(e){return this._config=e,this._changeSchema()}get config(){return this._config}ngOnDestroy(){this._schemaModalService.closeModals(),this.viewState=null,this._viewStoreService.destroy(),this._cancelSchemaChanging.next(),this._cancelSchemaChanging.complete(),this._destroyed.next(),this._destroyed.complete()}};P.\u0275fac=function(e){return new(e||P)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(N.CustomEventService),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(A.CrtRouter),s.\u0275\u0275directiveInject(_e.L),s.\u0275\u0275directiveInject(h.FEATURE_VALUES),s.\u0275\u0275directiveInject(A.AppendSchemaStateFromUrlService),s.\u0275\u0275directiveInject(A.ModelInitConfigsGeneratorService),s.\u0275\u0275directiveInject(Y),s.\u0275\u0275directiveInject(s.EnvironmentInjector))},P.\u0275cmp=s.\u0275\u0275defineComponent({type:P,selectors:[["crt-schema-outlet"]],viewQuery:function(e,t){if(e&1&&(s.\u0275\u0275viewQuery(os,7,s.ViewContainerRef),s.\u0275\u0275viewQuery(is,7,s.ViewContainerRef),s.\u0275\u0275viewQuery(b.MaskDirective,7)),e&2){let a;s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(t.viewContainerRef=a.first),s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(t.viewContainerRef7x=a.first),s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(t.mask=a.first)}},hostVars:4,hostBindings:function(e,t){e&2&&s.\u0275\u0275classProp("crt-schema-outlet",t._addClsToHost)("flex-full-height",t._addFlexFullHeightToHost)},inputs:{parameters:"parameters",schemaName:"schemaName",componentRef:"componentRef",features:"features"},outputs:{componentBackgroundStateChanged:"componentBackgroundStateChanged",beforeSchemaChangeEvent:"beforeSchemaChangeEvent",afterSchemaChangeEvent:"afterSchemaChangeEvent",parametersChange:"parametersChange",schemaExceptionThrown:"schemaExceptionThrown"},features:[s.\u0275\u0275ProvidersFeature([_e.L,{provide:Ge,useFactory:i=>i.mask,deps:[(0,s.forwardRef)(()=>Ze)]},re]),s.\u0275\u0275InheritDefinitionFeature],decls:5,vars:1,consts:[[3,"crtMask","crtMaskSettings"],["container",""],["7xContainer",""]],template:function(e,t){e&1&&(s.\u0275\u0275elementContainerStart(0,0),s.\u0275\u0275elementContainer(1,null,1)(3,null,2),s.\u0275\u0275elementContainerEnd()),e&2&&s.\u0275\u0275property("crtMaskSettings",t.maskSettings)},dependencies:[b.MaskDirective]}),(0,l.__decorate)([(0,o.CrtInput)(),(0,l.__metadata)("design:type",Object),(0,l.__metadata)("design:paramtypes",[Object])],P.prototype,"parameters",null),(0,l.__decorate)([(0,o.CrtInput)(),(0,l.__metadata)("design:type",String),(0,l.__metadata)("design:paramtypes",[String])],P.prototype,"schemaName",null),(0,l.__decorate)([(0,o.CrtInput)(),(0,l.__metadata)("design:type",s.ComponentRef)],P.prototype,"componentRef",void 0),(0,l.__decorate)([(0,o.CrtInput)(),(0,l.__metadata)("design:type",Object)],P.prototype,"features",void 0),(0,l.__decorate)([(0,o.CrtOutput)(),(0,l.__metadata)("design:type",Object)],P.prototype,"componentBackgroundStateChanged",void 0),(0,l.__decorate)([(0,o.CrtOutput)(),(0,l.__metadata)("design:type",Object)],P.prototype,"beforeSchemaChangeEvent",void 0),(0,l.__decorate)([(0,o.CrtOutput)(),(0,l.__metadata)("design:type",Object)],P.prototype,"afterSchemaChangeEvent",void 0),(0,l.__decorate)([(0,o.CrtOutput)(),(0,l.__metadata)("design:type",Object)],P.prototype,"parametersChange",void 0),(0,l.__decorate)([(0,o.CrtOutput)(),(0,l.__metadata)("design:type",Object)],P.prototype,"schemaExceptionThrown",void 0),P=Ze=(0,l.__decorate)([(0,o.CrtViewElement)({type:"crt.SchemaOutlet"}),(0,l.__metadata)("design:paramtypes",[s.Injector,N.CustomEventService,s.ChangeDetectorRef,A.CrtRouter,_e.L,h.FeatureValues,A.AppendSchemaStateFromUrlService,A.ModelInitConfigsGeneratorService,Y,s.EnvironmentInjector])],P);function ar(i,e){if(i==="@event")return`${i}.${e}`;const t=i.indexOf(".");return i.substring(0,t+1)+e+i.substring(t)}class se{constructor(e,t,a){this._featureService=e,this._metadataModifierService=t,this._loaderService=a}_getSchemaOutlets(e){return h.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SchemaOutlet",e.viewConfig)}_getIsProcessingDisabled(){return(0,p.lastValueFrom)(this._featureService.getFeatureState("DisableCommunicationBetweenSchemas"))}_getAllSchemaParameters(e){var t=this;return(0,d.Z)(function*(){const a=yield(0,p.lastValueFrom)(t._loaderService.load(e));let r={};return a.forEach(n=>{const c=n.structure.parameters;c&&(r=Object.assign(c,r))}),r})()}_getParametersName(e,t){const a=Object.keys(t);return Object.entries(e).filter(([r])=>a.includes(r))}_getUserRequest(e,t){const a=t.params;if((0,E.isObject)(a))for(const[r,n]of Object.entries(a))/@event/.test(n)&&(a[r]=ar(n,e));return[e,t]}_getDefaultRequest(e,t,a){const n=t.split("|").map(m=>m.trim())[0].replace("$",""),c=a[e];let u=ar("@event",e);return c.dataValueTypeName==="Lookup"&&(u+=` | crt.ToLookup: '${c.referenceSchemaName}'`),[e,{request:"crt.SetViewModelAttributeRequest",params:{attributeName:n,value:u}}]}_getRequestEntries(e,t,a){const r=this._getOutputs(e,t);return t.map(([n,c])=>{const u=r[n];return u?this._getUserRequest(n,u):this._getDefaultRequest(n,c,a)})}_getOutputs(e,t){const a=t.map(([n])=>n),r={};for(const n of a){const c=e[`${n}Change`];c&&(r[n]=c)}return r}_getParametersChangeConfig(e,t,a){const r=this._getRequestEntries(e,t,a);return{request:"crt.ParametersChangeRequest",params:{entries:Object.fromEntries(r)}}}_getKeyValuePairAttributeName(e,t){return`${e}_${t}ToKeyValuePair`}_getConverterExpression(e,t){let a;if(!e[1]&&t)a="crt.ToObjectProp: 'value'";else{const[,...r]=e;a=r.join(" | ")}return a}_addParametersAttributes(e,t,a,r){t.forEach(([n,c])=>{const u=a[n],m=c.split("|").map(y=>y.trim()),_=this._getKeyValuePairAttributeName(r,n),f=u.dataValueTypeName==="Lookup";if(m.length===1&&!f)this._metadataModifierService.addProperty(e,_,{from:c.replace("$",""),converter:`crt.ToKeyValuePair:'${n}'`});else{const y=m[0].replace("$",""),I=y+"Converted";this._metadataModifierService.addProperty(e,I,{from:y,converter:this._getConverterExpression(m,f)}),this._metadataModifierService.addProperty(e,_,{from:I,converter:`crt.ToKeyValuePair:'${n}'`})}})}crtOnMetaDataInit(e){var t=this;return(0,d.Z)(function*(){if(yield t._getIsProcessingDisabled())return e;const a=e,r=t._getSchemaOutlets(a);if(!r.length)return e;const n=a.viewModelConfig.attributes;for(const c of r){const u=c.viewConfig,m=u.name,_=yield t._getAllSchemaParameters(u.schemaName),f=t._getParametersName(u,_);t._addParametersAttributes(n,f,_,m);const y=f.map(([cn])=>t._getKeyValuePairAttributeName(m,cn)),I=c.viewConfig.name+"_Parameters";t._metadataModifierService.addProperty(n,I,{from:y,converter:"crt.ToObjectFromEntries"}),t._metadataModifierService.addProperty(c.viewConfig,"parameters",`$${I}`);const ve=t._getParametersChangeConfig(c.viewConfig,f,_);t._metadataModifierService.addProperty(c.viewConfig,"parametersChange",ve)}return Promise.resolve(e)})()}}se.\u0275fac=function(e){return new(e||se)(s.\u0275\u0275inject(C.FeatureService),s.\u0275\u0275inject(S.MetadataModifierService),s.\u0275\u0275inject(D.AmdSchemaLoaderService))},se.\u0275prov=s.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac});class ne{constructor(){this._subscription=new p.Subscription,this.contextName="root",this._router=(0,s.inject)(A.CrtRouter),this._childrenOutlet=(0,s.inject)(tr),this._initSubscriptions()}_initSubscriptions(){this._childrenOutlet.forEach(e=>{this._subscription.add(this._router.getChildNavigation$(this.contextName,e.getTarget()).pipe((0,M.switchMap)(t=>e.applySegments(t))).subscribe())})}ngOnDestroy(){this._subscription.unsubscribe()}}ne.\u0275fac=function(e){return new(e||ne)},ne.\u0275dir=s.\u0275\u0275defineDirective({type:ne,selectors:[["","crtChildrenRouterOutlet",""]],inputs:{contextName:"contextName"},standalone:!0});const cs=["component"];let U=class extends j.CrtBaseComponent{constructor(e,t,a,r,n,c,u){super(e),this.injector=e,this._crtRouter=t,this._history=a,this._window=r,this._crtZoneService=n,this._maskService=c,this._googleTagManager=u,this._subscription=new p.Subscription,this._destroyed$=new p.Subject,this.contentBackgroundChanged=new s.EventEmitter,this._navigationService=e.get(A.CrtNavigationService)}_subscribeHistoryState(){[this._subscribeNavigation(),this._subscribeNavigateStart(),this._subscribeNavigateEnd()].forEach(e=>this._subscription.add(e))}_trackSplashScreenHiding(){const{moduleName:e,schemaName:t}=this._crtRouter.getActiveRouteInfo(),a=Math.round(this._window.performance.now());this._googleTagManager.initialize().pipe((0,p.take)(1)).subscribe(()=>{this._googleTagManager.track({eventName:"performance_metrics",splashScreenTime:a,moduleName:e,schemaName:t})})}_handleLoadingAnimation(){this._maskService.loadingAnimationVisible&&(this._maskService.hideBodyMask(),this._trackSplashScreenHiding())}_setSchemaState(e){const{state:t,root:a}=e;return this.schemaOutletComponent.setConfig({schemaName:a.schemaName,moduleName:a.moduleName,...t}).pipe((0,p.tap)(()=>{this._handleLoadingAnimation();const r=this.schemaOutletComponent.viewState;this._history.storeView(r)}))}_handleNavigation(e){const{state:t,root:a}=e;if(this._history.goTo(t),t.silent&&!t._internalNotSilentIn8x&&!this._history.lastTransition.isBack)return(0,p.of)(null);const n={...t};return this._history.canRestoreView()&&(n.restoreViewState=this._history.getView()),this._setSchemaState({root:a,state:n})}_subscribeNavigation(){return this._crtRouter.getNavigation$().pipe((0,p.switchMap)(e=>this._handleNavigation(e))).subscribe()}_subscribeNavigateStart(){return this._crtRouter.navigateStart$.subscribe(()=>{this.schemaOutletComponent.beforeSchemaChange()})}_subscribeNavigateEnd(){return this._crtRouter.navigateEnd$.subscribe(()=>{this.schemaOutletComponent.afterSchemaChange()})}_initMainShellFeatures(){this.injector.get(j.BINDING_CONTEXT,null)?.viewModel$?.pipe((0,p.filter)(t=>t?._scopeName==="MainShell"),(0,p.takeUntil)(this._destroyed$)).subscribe(()=>{this.schemaOutletComponent.features={tools:{canDesign:!0,canExpand:!0}}})}_goToDesktop(){var e=this;return(0,d.Z)(function*(){yield e._navigationService.navigate({mode:A.NavigationMode.Push,options:{type:A.NavigationOptionsTypeEnum.Schema},state:{moduleName:"Desktop"}})})()}ngAfterViewInit(){this._initMainShellFeatures();const e=this._crtZoneService.get(A.NAVIGATION_ZONE_NAME);window[A.EXECUTION_ZONES_CONTAINER_NAME_FOR_7X]={centerPanel:e},this.schemaOutletComponent.preload7xConfiguration().then(()=>this._subscribeHistoryState())}ngOnDestroy(){this._subscription.unsubscribe(),this._destroyed$.next(),this._destroyed$.complete()}onBackgroundStateChanged(e){this.contentBackgroundChanged.emit(e)}handleSchemaException(e){e instanceof h.AclRightsException&&this._goToDesktop()}};U.\u0275fac=function(e){return new(e||U)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(A.CrtRouter),s.\u0275\u0275directiveInject(xe.B),s.\u0275\u0275directiveInject(N.WINDOW_TOKEN),s.\u0275\u0275directiveInject(h.CrtZoneService),s.\u0275\u0275directiveInject(b.MaskService),s.\u0275\u0275directiveInject(C.GoogleTagManagerService))},U.\u0275cmp=s.\u0275\u0275defineComponent({type:U,selectors:[["crt-router-outlet"]],viewQuery:function(e,t){if(e&1&&s.\u0275\u0275viewQuery(cs,7),e&2){let a;s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(t.schemaOutletComponent=a.first)}},outputs:{contentBackgroundChanged:"contentBackgroundChanged"},features:[s.\u0275\u0275ProvidersFeature([...$e,xe.B,{provide:Xa,useValue:!0},{provide:S.VIEW_EVENT_ZONE_NAME,useValue:A.NAVIGATION_ZONE_NAME},{provide:h.CRT_NAVIGATION_LOCK_TOKEN,deps:[S.VIEW_EVENT_ZONE_NAME,h.CrtZoneService,h.FEATURE_VALUES],useFactory:h.navigationLockFactory},{provide:h.USE_SAVE_SCROLL_POSITION_SERVICE,useValue:!0}]),s.\u0275\u0275InheritDefinitionFeature],decls:3,vars:0,consts:[["crtChildrenRouterOutlet","",3,"componentBackgroundStateChanged","schemaExceptionThrown"],["component",""]],template:function(e,t){e&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"crt-schema-outlet",0,1),s.\u0275\u0275listener("componentBackgroundStateChanged",function(r){return t.onBackgroundStateChanged(r)})("schemaExceptionThrown",function(r){return t.handleSchemaException(r)}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd())},dependencies:[ne,P],styles:[`crt-router-outlet .crt-schema-outlet{height:calc(100vh - 56px)}@media screen and (max-width: 790px){crt-router-outlet .crt-schema-outlet{height:calc(100vh - 96px)}}crt-router-outlet .flex-full-height{display:flex;flex-direction:column;min-height:0;min-width:0;flex-grow:1}
`],encapsulation:2}),(0,l.__decorate)([(0,o.CrtOutput)(),(0,l.__metadata)("design:type",Object)],U.prototype,"contentBackgroundChanged",void 0),U=(0,l.__decorate)([(0,o.CrtViewElement)({type:"crt.RouterOutlet",reuseStrategy:o.ViewElementReuseStrategy.Reuse}),(0,l.__metadata)("design:paramtypes",[s.Injector,A.CrtRouter,xe.B,Window,h.CrtZoneService,b.MaskService,C.GoogleTagManagerService])],U);var ls=v(3272),Te=v(75903);const ds={provide:Re,useFactory:(i,e,t)=>e.preventDefaultCloseCommand?t:(0,h.simpleCommand)(()=>i.close()),deps:[Te.MatLegacyDialogRef,Te.MAT_LEGACY_DIALOG_DATA,[new s.SkipSelf,new s.Optional,Re]]},us=["container"];class oe{get visible(){return this._visible}constructor(e,t){this.data=e,this._document=t,this._visible=!1}get page(){return this.schemaOutletComponent.instance.componentRef.instance}ngOnInit(){var e=this;return(0,d.Z)(function*(){e.schemaOutletComponent=e.componentContainer.createComponent(P);const{action:t,schemaName:a,recordId:r,defaultValues:n,parameters:c}=e.data,u={operation:t,schemaName:a,recordId:r,parameters:c};t&&(u.modelInitConfigs=[{action:t,recordId:r,defaultValues:n}]),e.schemaOutletComponent.instance.features={tools:{canDesign:!0}},yield(0,p.firstValueFrom)(e.schemaOutletComponent.instance.setConfig(u)),e._visible=!0})()}detachContent(){this.componentContainer.detach(),this._visible=!1}attachContent(){this.componentContainer.insert(this.schemaOutletComponent.hostView),this._visible=!0}}oe.\u0275fac=function(e){return new(e||oe)(s.\u0275\u0275directiveInject(Te.MAT_LEGACY_DIALOG_DATA),s.\u0275\u0275directiveInject(x.DOCUMENT))},oe.\u0275cmp=s.\u0275\u0275defineComponent({type:oe,selectors:[["crt-schema-modal"]],viewQuery:function(e,t){if(e&1&&s.\u0275\u0275viewQuery(us,7,s.ViewContainerRef),e&2){let a;s.\u0275\u0275queryRefresh(a=s.\u0275\u0275loadQuery())&&(t.componentContainer=a.first)}},features:[s.\u0275\u0275ProvidersFeature([...$e,ds,{provide:S.VIEW_EVENT_ZONE_NAME,useValue:A.NAVIGATION_ZONE_NAME},{provide:h.CRT_NAVIGATION_LOCK_TOKEN,deps:[S.VIEW_EVENT_ZONE_NAME,h.CrtZoneService,h.FEATURE_VALUES],useFactory:h.navigationLockFactory}])],decls:2,vars:0,consts:[["container",""]],template:function(e,t){e&1&&s.\u0275\u0275elementContainer(0,null,0)},styles:[`crt-schema-modal{display:flex;flex-direction:column;min-height:0;min-width:0;flex-grow:1}crt-schema-modal .flex-full-height{display:flex;flex-direction:column;min-height:0;min-width:0;flex-grow:1}.mat-dialog-container crt-schema-modal{display:flex!important}
`],encapsulation:2});let B=class{};B.\u0275fac=function(e){return new(e||B)},B.\u0275mod=s.\u0275\u0275defineNgModule({type:B}),B.\u0275inj=s.\u0275\u0275defineInjector({providers:[A.AppendSchemaStateFromUrlService],imports:[x.CommonModule,b.MaskModule]}),B=(0,l.__decorate)([(0,o.CrtModule)({viewElements:[P,U,F]})],B),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(B,{declarations:[P,U,F],imports:[x.CommonModule,b.MaskModule,ne],exports:[P,U,F]})}();let ze=class{convert(e,t,a,r=null){return e?a:r}};ze=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.BooleanToStringValue"})],ze);let qe=class{convert(e,t,a){return!e&&!a}};qe=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.NorCondition"})],qe);let Ke=class{convert(e,t,...a){let r=e[0];for(let n=0,c=a.length;n<c;n++)r+=e[n+1]?a[n]:"";return r}};Ke=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.AppendConditionalParts"})],Ke);let we=class{isEmptyCollection(e){return!(e?.length>0)}hasFilterValues(e){return e?e.some(t=>{try{t=JSON.parse(t)}catch{}return!(0,E.isEmpty)(t)}):!1}convert(e){const t=e.shift();return this.isEmptyCollection(t)&&!this.hasFilterValues(e)}};we=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.DataGridHasNoItems"})],we);let We=class extends we{convert(e){const t=e.shift();return this.isEmptyCollection(t)&&this.hasFilterValues(e)}};We=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.DataGridHasNoFilteredItems"})],We);let Je=class{convert([e,t]){return e||t?.length>0}};Je=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.HasUnsavedDataOr7XDetails"})],Je);let Qe=class{convert(e,t){return e?.type==="specific"?e.selected?.length>0:e?.type==="all"}};Qe=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.IsAnySelected"})],Qe);let Xe=class{_isSelectionStateEmpty(e){return e?.type?e.type==="all"?!1:e.type==="specific"?!e.selected?.length:!0:!0}convert(e,t,a){return this._isSelectionStateEmpty(a)?null:e}};Xe=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.SkipIfSelectionEmpty"})],Xe);let Ee=class{constructor(e){this._entitySchemaQueryBuilder=e}_addDataSourceFilters(e,t,a){var r=this;return(0,d.Z)(function*(){const n=yield r._getDataSourceFilters(t,a);n&&e.add(n)})()}_addFilterBySelectedItems(e,t,a){const r=this._getInFilter(o.ComparisonType.Equal,a,t);r&&e.add(r)}_addFilterByUnselectedItems(e,t,a){const r=this._getInFilter(o.ComparisonType.Not_equal,a,t);r&&e.add(r)}_getInFilter(e,t,a){if(!t||!a?.length)return null;const r=new o.ColumnExpression({columnPath:t}),n=a.map(c=>new o.ParameterExpression({value:c}));return new o.InFilter(e,r,n)}_getDataSourceFilters(e,t){var a=this;return(0,d.Z)(function*(){const r=e.getBoundDataSchemaByAttributePath(t),n=e.getBoundDataSourceNameByAttributePath(t),c=yield e.getDataSourceLoadParameters(n);if(!c)return null;try{return(0,p.firstValueFrom)(a._entitySchemaQueryBuilder.build(r,[],c.parameters).pipe((0,p.map)(u=>u?.filters)))}catch{return null}})()}convert(e,t,a,r){var n=this;return(0,d.Z)(function*(){const c=t,u=c.getBoundDataSchemaByAttributePath(a).primaryAttributeName,m=r?.type==="specific"&&r?.selected?.length,_=r?.type==="all"&&r?.unselected?.length,f=new o.EntitySchemaQuery("tempTable");return m&&n._addFilterBySelectedItems(f.filters,r.selected,u),m||(yield n._addDataSourceFilters(f.filters,c,a)),_&&n._addFilterByUnselectedItems(f.filters,r.unselected,u),f.getMetadata().filters})()}};Ee=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.ToCollectionFilters"}),(0,l.__metadata)("design:paramtypes",[S.EntitySchemaQueryBuilder])],Ee);const rr="count";class sr{constructor(e,t){this.queryExecutor=e,this.entitySchemaQueryBuilder=t}_getItemsCount(e,t,a,r){var n=this;return(0,d.Z)(function*(){const c=t.getBoundDataSourceNameByAttributePath(a),u=yield n.getLoadItemsCountParameters(e,c,t),m=n.getLoadItemsCountParametersAttributeName(a),_=yield t[m];if((0,E.isEqual)(_,u))return t.attributes[r];const f=t.dataSchemas[c],y=yield n._loadItemsCount(f,u);return t[m]=u,y})()}_loadItemsCount(e,t){var a=this;return(0,d.Z)(function*(){const r=yield a._createItemsCountQuery(e,t);return(yield(0,p.lastValueFrom)(a.queryExecutor.executeSelectQuery(r)))[0][rr]})()}_createItemsCountQuery(e,t){const a=[{name:rr,path:e.primaryAttributeName||"Id",caption:"count",type:"function",aggregationConfig:{aggregationFunction:o.AggregationFunction.Count},dataValueType:o.DataValueType.Integer,functionConfig:{aggregation:o.AggregationFunction.Count,aggregationEval:"distinct",type:"aggregation"}}];return(0,p.firstValueFrom)(this.entitySchemaQueryBuilder.build(e,a,t))}getLoadItemsCountParameters(e,t,a){return(0,d.Z)(function*(){return(yield a.getDataSourceLoadParameters(t)).parameters})()}convert(e,t,a,r){var n=this;return(0,d.Z)(function*(){try{return yield n._getItemsCount(e,t,a,r)}catch(c){return console.error(`Can't get items count for the '${a}': ${c}`),n.defaultItemsCount}})()}}let Ye=class extends sr{constructor(e,t){super(e,t),this.defaultItemsCount=1/0}_resetItemsCountLoadParameters(e,t){const a=this.getLoadItemsCountParametersAttributeName(e);t[a]=null}getLoadItemsCountParametersAttributeName(e){return(0,g.createTotalItemsCountLoadParametersAttributeName)(e)}convert(e,t,a,r){const[n,c]=e;return c?n.length===0?(this._resetItemsCountLoadParameters(a,t),Promise.resolve(0)):super.convert(e,t,a,r):t.attributes[r]}};Ye=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.ToCollectionItemsCount"}),(0,l.__metadata)("design:paramtypes",[Ce.QueryExecutor,S.EntitySchemaQueryBuilder])],Ye);let et=class extends sr{constructor(e,t){super(e,t),this.defaultItemsCount=0}_getLoadedUnselectedItems(e,t){return(0,d.Z)(function*(){return e?.length?(yield Promise.all(t.map(r=>e.findByPrimaryAttribute(r)))).filter(r=>r!==void 0):[]})()}_createExceptUnselectedItemsFilter(e,t,a){const n=a.dataSchemas[t]?.primaryAttributeName||"Id",c=new o.ColumnExpression({columnPath:n}),u=e.unselected.map(m=>new o.ParameterExpression({value:m}));return{type:o.ModelParameterType.Filter,value:new o.InFilter(o.ComparisonType.Not_equal,c,u)}}getLoadItemsCountParameters(e,t,a){var r=()=>super.getLoadItemsCountParameters,n=this;return(0,d.Z)(function*(){const[,c]=e,u=yield r().call(n,e,t,a),m=n._createExceptUnselectedItemsFilter(c,t,a);return u.push(m),u})()}getLoadItemsCountParametersAttributeName(e){return(0,g.createSelectedItemsCountLoadParametersAttributeName)(e)}convert(e,t,a,r){var n=()=>super.convert,c=this;return(0,d.Z)(function*(){const[u,m,_]=e??[];if((0,E.isNil)(_)||!m?.type)return 0;if(m.type==="specific")return m.selected?.length??0;const f=m.unselected??[];if(f.length===0||_===1/0)return _;const y=yield c._getLoadedUnselectedItems(u,f);return y.length===f.length?Math.max(0,_-y.length):n().call(c,e,t,a,r)})()}};et=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.ToCollectionSelectedItemsCount"}),(0,l.__metadata)("design:paramtypes",[Ce.QueryExecutor,S.EntitySchemaQueryBuilder])],et);let tt=class{convert(e,t,a){return[a,e]}};tt=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.ToKeyValuePair"})],tt);var at=v(24821);let rt=class{_getParametersExpression(e){return e.map(t=>new o.ParameterExpression({value:t}))}convert(e,t,a){if(!a||!e?.length)return{};const r=new o.InFilter(o.ComparisonType.Equal,new o.ColumnExpression({columnPath:a}),this._getParametersExpression(e));return(0,at.classToPlain)(r)}};rt=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.ToInFilter"})],rt);let st=class{convert(e,t,a){const r=new Array;return e.forEach((n,c)=>{typeof a[c]>"u"||r.push({name:a[c],value:n})}),r}};st=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.ToObjectCollectionWithMapping"})],st);let nt=class{convert(e,t){return Object.fromEntries(e)}};nt=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.ToObjectFromEntries"})],nt);let ot=class{convert(e,t,a){return(0,d.Z)(function*(){const{referenceSchemaName:r}=yield(0,S.getEntitySchemaAttribute)(t,a);return(0,h.getEntityUrl)(r,e)})()}};ot=(0,l.__decorate)([(0,o.CrtConverter)({type:"crt.ToRecordLinkAsync"})],ot);var De=v(85431);class nr extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){yield t.checkPressedKey(e),yield t.next?.handle(e)})()}}let it=class extends o.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}_hasUnsavedDetails(e){return(0,d.Z)(function*(){return(yield e[S.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME])?.length>0})()}_canDiscardChanges(){var e=this;return(0,d.Z)(function*(){const t=e._messageDialogProvider.open({data:{message:"Dialog.CanDiscardUnsavedData",actions:[g.DEFAULT_DIALOG_ACTIONS.NO,g.DEFAULT_DIALOG_ACTIONS.YES]}});return(yield(0,p.lastValueFrom)(t))===g.DEFAULT_DIALOG_ACTIONS.YES.key})()}handle(e){var t=this;return(0,d.Z)(function*(){return(yield t._hasUnsavedDetails(e.$context))?t._canDiscardChanges():yield t.next?.handle(e)})()}};it=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.CanDiscardUnsavedDataRequest",type:"crt.CanDiscardUnsavedDataAnd7XDetailHandler",scopes:["ProductConditions_FormPage","OpportunityConditions_FormPage"]}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],it);let or=class extends o.BaseRequest{constructor(){super(...arguments),this.type="crt.CanDiscardUnsavedDataRequest"}};or=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.CanDiscardUnsavedDataRequest"})],or);let ct=class extends o.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}_canDiscardChanges(){var e=this;return(0,d.Z)(function*(){const t=e._messageDialogProvider.open({data:{message:"Dialog.CanDiscardUnsavedData",actions:[g.DEFAULT_DIALOG_ACTIONS.NO,g.DEFAULT_DIALOG_ACTIONS.YES]}});return(yield(0,p.lastValueFrom)(t))===g.DEFAULT_DIALOG_ACTIONS.YES.key})()}_isContextChanged(e){return e instanceof S.BaseViewModelCollection?Promise.resolve(e.isChanged):e?.IsChanged}handle(e){var t=this;return(0,d.Z)(function*(){return(yield t._isContextChanged(e.$context))?t._canDiscardChanges():!0})()}};ct=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CanDiscardUnsavedDataHandler",requestType:"crt.CanDiscardUnsavedDataRequest"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],ct);let lt=class extends o.BaseRequestHandler{_cancelDetailChanges(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getUnsavedDetailsData(e);if(a?.length>0)return t._processDiscardChanges(e,a)})()}_processDiscardChanges(e,t){return(0,d.Z)(function*(){yield Promise.all(t.map(a=>a.discardChanges())),e[S.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]=[]})()}_getUnsavedDetailsData(e){return(0,d.Z)(function*(){return yield e[S.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]})()}_hasUnsavedData(e){return e[S.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME]}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context;return yield t._cancelDetailChanges(a),(yield t._hasUnsavedData(a))?yield t.next?.handle(e):!0})()}};lt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.CancelRecordChangesRequest",type:"crt.CancelRecord7XDetailsChangesHandler",scopes:["ProductConditions_FormPage","OpportunityConditions_FormPage"]})],lt);function ir(i){if(!Array.isArray(i))return null;const e=i.map(t=>t?.errorInfo).filter(Boolean);return{success:i.length===0||i.every(t=>t?.success),errorInfo:e.length===0?void 0:e.join(`
`),rowsAffected:i.reduce((t,a)=>t+a?.rowsAffected||0,0)}}function dt(i){if(!Array.isArray(i))return null;if(i.length===0||i.every(a=>a?.success))return{success:!0};const t=i.map(a=>a?.success===!0?void 0:a?.errorInfo).filter(Boolean);return{success:!1,errorInfo:t.length===0?void 0:t.join(`
`)}}function cr(i){const e=i.dataSchemas||{};return Object.keys(e).filter(a=>e[a]?.dataSourceConfig?.type==="crt.EntityDataSource")[0]}function ms(i){return i!==null&&typeof i=="string"}function ps(i,e,t,a){return ut.apply(this,arguments)}function ut(){return ut=(0,d.Z)(function*(i,e,t,a){const n=i.dataSchemas[e].findAttributeByName(t);return n.dataValueType===o.DataValueType.Lookup&&ms(a)?new D.ToLookupConverter().convert(a,i,n.referenceSchemaName):a}),ut.apply(this,arguments)}function hs(i,e=[]){return e.length?!(i!==o.ModelInPageAction.Add&&i!==o.ModelInPageAction.Copy):!1}function lr(i,e){return mt.apply(this,arguments)}function mt(){return mt=(0,d.Z)(function*(i,e){const{name:t,defaultValues:a}=e;let r=null;if(hs(o.ModelInPageAction.Add,a)){r={};for(const{attributeName:n,value:c}of a)if(!(0,E.isNil)(c)){let u=c;const m=i?.getViewModelAttributePath(t,n);m&&(u=yield ps(i,t,n,c),i[m]=u),r[n]=u}}return r}),mt.apply(this,arguments)}function dr(i,e){return pt.apply(this,arguments)}function pt(){return pt=(0,d.Z)(function*(i,e){const t=yield lr(i,e),{name:a}=e;return yield(0,p.lastValueFrom)(i.create(a,t),{defaultValue:null}),{success:!0}}),pt.apply(this,arguments)}let ht=class extends o.BaseRequestHandler{constructor(e,t){super(),this._messageDialogProvider=e,this._maskService=t}_cancelPrimaryDataChanges(e){var t=this;return(0,d.Z)(function*(){const a={type:"crt.CancelPrimaryDataChangesRequest",$context:e.$context},r=yield t.handlerChain.process(a);return dt(r)})()}_reloadData(e,t){var a=this;return(0,d.Z)(function*(){try{return yield a.handlerChain.process({type:"crt.LoadDataRequest",$context:e,dataSourceName:t}),{success:!0}}catch(r){const n=r?.message;return{success:!1,errorInfo:n}}})()}_loadDefaultValues(e){const t=[],a=(0,S.getRootModels)(e),r=e.modelInitConfigs;for(const n of a){const c=e.getModelByName(n);if(c.mode===h.ModelMode.Create){const u=c.getDataSource(),m=r?.find(_=>_.name===u.dataSourceName&&_.action===o.ModelInPageAction.Add);m&&t.push(dr(e,m))}}return t}_cancelDataChanges(e){var t=this;return(0,d.Z)(function*(){const a=e.$context;yield a.waitAsyncTasksFinish();let r=[];(yield a.getPrimaryModelName())&&r.push(t._cancelPrimaryDataChanges(e)),a._getModelNamesByLoadType(h.DataSourceLoadingType.OnInit).forEach(m=>{r.push(t._reloadData(a,m))}),r=r.concat(t._loadDefaultValues(a));const u=yield Promise.all(r);return dt(u)})()}_displayErrorDialog(e){const t=e?.message;t&&this._messageDialogProvider.open({data:{message:t,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}handle(e){var t=this;return(0,d.Z)(function*(){const a="RECORD_CHANGES_CANCELING";yield t._maskService.showMask(a,e.$context);try{const r=yield t._cancelDataChanges(e);if(r.success===!0)return!0;throw new Error(r.errorInfo)}catch(r){return t._displayErrorDialog(r),!1}finally{t._maskService.hideMask(a,e.$context)}})()}};ht=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CancelRecordChangesHandler",requestType:"crt.CancelRecordChangesRequest"}),(0,l.__param)(1,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,o.MaskService])],ht);let gt=class extends o.BaseRequestHandler{constructor(e,t){super(),this._messageDialogProvider=e,this._maskService=t}_cancelCollectionPrimaryDataChanges(e){var t=this;return(0,d.Z)(function*(){const a={type:"crt.CancelCollectionPrimaryDataChangesRequest",$context:e.$context,primaryAttributeValues:e.recordIds,collectionAttributeName:e.itemsAttributeName},r=yield t.handlerChain.process(a);return dt(r)})()}_displayErrorDialog(e){const t=e?.message;t&&this._messageDialogProvider.open({data:{message:t,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}handle(e){var t=this;return(0,d.Z)(function*(){const a="RECORDS_CHANGES_CANCELING_"+e.itemsAttributeName+"_"+(e.recordIds??[]).join("_");yield t._maskService.showMask(a,e.$context);try{const r=yield t._cancelCollectionPrimaryDataChanges(e);if(r.success===!0)return!0;throw new Error(r.errorInfo)}catch(r){return t._displayErrorDialog(r),!1}finally{t._maskService.hideMask(a,e.$context)}})()}};gt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CancelRecordsChangesHandler",requestType:"crt.CancelRecordsChangesRequest"}),(0,l.__param)(1,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,o.MaskService])],gt);let _t=class extends o.BaseRequestHandler{constructor(e){super(),this._closePageCommand=e}handle(e){var t=this;return(0,d.Z)(function*(){const r=yield e.$context[H];if(r===o.ModelInPageAction.Edit)return yield t.next?.handle(e);r===o.ModelInPageAction.Add||r===o.ModelInPageAction.Copy?t._closePageCommand.execute():yield t.next?.handle(e)})()}};_t=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CardCancelRecordChangesHandler",requestType:"crt.CancelRecordChangesRequest",scopes:[S.Scopes.AllCards]}),(0,l.__param)(0,(0,o.CrtInject)(Re)),(0,l.__metadata)("design:paramtypes",[Object])],_t);class ur extends o.BaseRequestHandler{getEntityName(e){var t=this;return(0,d.Z)(function*(){const a=yield t.getPrimaryName(e);return e.$context.dataSchemas[a]?.dataSourceConfig?.config?.entitySchemaName})()}initDataViews(e,t={},a){var r=this;return(0,d.Z)(function*(){const n=yield r.getEntityName(e),c={...t,entityName:n};yield r.handlerChain.process({type:"crt.7XRequest",action:"InitDataViews",$context:a||e.$context,payload:c,scopes:e.scopes})})()}}let St=class extends ur{constructor(e){super(),this._resourceFinderService=e}_getPrimaryDataSourceCaption(e){return!e||!e.caption?"":this._resourceFinderService.findLocalizableValue(e.caption)}_getHeaderCaption(e,t){var a=this;return(0,d.Z)(function*(){const r=yield e.getPrimaryDataSchema(),n=yield e.getPrimaryModelName(),c=e.getViewModelAttributePath(n,r?.primaryDisplayAttributeName),u=yield a._getDefaultCaption(t);if(t.attributeName===c){const m=t.value.trim();return Promise.resolve(m||u)}return Promise.resolve(null)})()}_updateCardCaption(e,t){var a=this;return(0,d.Z)(function*(){const r=yield a._getHeaderCaption(t,e);if(r&&e.$context[ee]!==r){e.$context[ee]=r;const n={caption:r,hidePageCaption:!0};yield a.initDataViews(e,n,t)}})()}_isCreateRecordState(e){return e===o.ModelInPageAction.Add||e===o.ModelInPageAction.Copy}_getDefaultCaption(e){var t=this;return(0,d.Z)(function*(){const a=yield e.$context.Resources?.Strings?.NewRecord,r=yield e.$context.Resources?.Strings?.Record,n=yield e.$context[H];return t._isCreateRecordState(n)?a:r})()}_setDefaultCaption(e,t){var a=this;return(0,d.Z)(function*(){let r;if(a._isCreateRecordState(e.value))r=yield e.$context.Resources?.Strings?.NewRecord;else{const c=yield t.getPrimaryDataSchema(),u=yield t.getPrimaryModelName(),m=t.getViewModelAttributePath(u,c?.primaryDisplayAttributeName);r=m?yield t[m]:a._getPrimaryDataSourceCaption(c)}e.$context[ee]=r;const n={caption:r,hidePageCaption:!0};yield a.initDataViews(e,n)})()}getPrimaryName(e){return(0,d.Z)(function*(){return yield e.$context.getPrimaryModelName()})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context;return e.attributeName===H?yield t._setDefaultCaption(e,a):e.attributeName&&(yield t._updateCardCaption(e,a)),yield t.next?.handle(e)})()}};St=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleViewModelAttributeChangeRequest",type:"crt.CardChangeAttributeHandler",scopes:[S.Scopes.AllCards]}),(0,l.__metadata)("design:paramtypes",[h.ResourceFinderService])],St);let ke=class extends o.BaseRequestHandler{constructor(e){super(),this.messageDialogProvider=e}_getEntitySchemaName(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]?.dataSourceConfig?.config?.entitySchemaName}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}validateRequest(e){return!e.entityName&&!e.itemsAttributeName&&!e.entityPageName?(this.messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}),!1):!0}handle(e){var t=this;return(0,d.Z)(function*(){if(!t.validateRequest(e))return;const a={type:"crt.7XRequest",action:"AddRecord",$context:e.$context,payload:{entityName:e.entityName??t._getEntitySchemaName(e),defaultValues:e.defaultValues,entityPageName:e.entityPageName}};yield t.handlerChain.process(a)})()}};ke=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.CreateRecordRequest",type:"crt.CreateRecordHandler"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],ke);let ft=class extends ke{_saveRecord(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r={type:"crt.SaveRecordRequest",preventCardClose:!0,preventCardStateChange:!0,$context:a,scopes:e.scopes},n=yield t.handlerChain.process(r);if(n){const c=yield a.getPrimaryModelName(),u=yield a.getPrimaryDataSchema(),m={type:"crt.LoadDataRequest",dataSourceName:c,parameters:[{type:"primaryColumnValue",value:u.primaryAttributeName}],$context:a,scopes:e.scopes};yield t.handlerChain.process(m)}return n})()}handle(e){var t=this;return(0,d.Z)(function*(){if(!t.validateRequest(e))return;const r=yield e.$context.HasUnsavedData,n=e.skipUnsavedData;if(!r||n){yield t.next?.handle(e);return}(yield t._saveRecord(e))&&(yield t.next?.handle(e))})()}};ft=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.CreateRecordRequest",type:"crt.CardCreateRecordHandler",scopes:[S.Scopes.AllCards]})],ft);let vt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=a.modelInitConfigs||[];r&&r.length>0&&(a[H]=r[0].action),yield t.next?.handle(e)})()}};vt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CardInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:[S.Scopes.AllCards]})],vt);let Ct=class extends o.BaseRequestHandler{_backHistoryState(e){var t=this;return(0,d.Z)(function*(){yield t.handlerChain.process({type:"crt.7XRequest",action:"BackHistoryState",$context:e})})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=yield t.next?.handle(e),r=yield e.$context[H];a&&!e.preventCardClose&&(r===o.ModelInPageAction.Add||r===o.ModelInPageAction.Copy)&&(yield t._backHistoryState(e.$context));const n=r===o.ModelInPageAction.Edit;return!e.preventCardStateChange&&!n&&a&&(e.$context[H]=o.ModelInPageAction.Edit),a})()}};Ct=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.CardSaveRecordHandler",scopes:[S.Scopes.AllCards]})],Ct);let yt=class extends o.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}handle(e){var t=this;return(0,d.Z)(function*(){if(!e.entityName&&!e.itemsAttributeName||!e.recordId){t._messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}});return}const a=yield e.$context.CardState;return e.trackUnsavedData==null&&(e.trackUnsavedData=a==null||a===o.ModelInPageAction.Edit),t.next?.handle(e)})()}};yt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.UpdateRecordRequest",type:"crt.CardUpdateRecordHandler",scopes:[S.Scopes.AllCards,S.Scopes.AllSections]}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],yt);let Rt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const a={...e,preventCardClose:!0},r=yield t.next.handle(a);return r&&!e.preventCardClose&&(yield t.handlerChain.process({$context:e.$context,type:"crt.ClosePageRequest"})),r})()}};Rt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.SaveMiniPageHandler",requestType:"crt.SaveRecordRequest",scopes:[S.Scopes.AllMiniCards]})],Rt);let Tt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const a={type:"crt.ClosePageRequest",$context:e.$context,scopes:e.scopes};yield t.handlerChain.process(a)})()}};Tt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CancelMiniPageChangesHandler",requestType:"crt.CancelRecordChangesRequest",scopes:[S.Scopes.AllMiniCards]})],Tt);let Et=class extends nr{_cancelRecord(e){return(0,d.Z)(function*(){e.event.preventDefault(),yield e.$context.executeRequest({type:"crt.CancelRecordChangesRequest",$context:e.$context})})()}_saveRecord(e){return(0,d.Z)(function*(){e.event.preventDefault(),yield e.$context.executeRequest({type:"crt.SaveRecordRequest",$context:e.$context})})()}checkPressedKey(e){var t=this;return(0,d.Z)(function*(){if((0,h.escapePressed)(e.event))return t._cancelRecord(e);if((0,h.ctrlSPressed)(e.event))return t._saveRecord(e)})()}};Et=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleKeyboardHotkeysRequest",type:"crt.KeyboardHotkeysMiniPageHandler",scopes:[S.Scopes.AllMiniCards]})],Et);let Oe=class extends o.BaseRequestHandler{constructor(e){super(),this._closePageCommand=e}handle(){return this._closePageCommand.execute(),Promise.resolve()}};(0,l.__decorate)([(0,S.CrtCanDiscardUnsavedData)(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[]),(0,l.__metadata)("design:returntype",Promise)],Oe.prototype,"handle",null),Oe=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.ClosePageHandler",requestType:"crt.ClosePageRequest"}),(0,l.__param)(0,(0,o.CrtInject)(Re)),(0,l.__metadata)("design:paramtypes",[Object])],Oe);let Dt=class extends o.BaseRequestHandler{constructor(e,t,a){super(),this._configurationDataService=e,this._userInfo=t,this._requireJs=a.get(h.REQUIRE_JS)}_addNewSchemaDescriptors(e){const t=Terrasoft.configuration.RootSchemaDescriptors;e.forEach(a=>{t[a.schemaName]={path:a.path}})}_getDescriptorsPaths(e){const t={};return e.forEach(a=>{t[a.schemaName]=x.Location.joinWithSlash((0,h.getWorkspaceBaseUrl)(),a.path)}),t}_registerPathInRequireJs(e){this._requireJs.config({paths:e})}_getResourcesPaths(e,t){const a={};if(e.length===0)return a;const r=this._userInfo.cultureInfo.sysCultureName,n=e.find(u=>u.cultureName===r);return n?(n.resources.filter(u=>t.includes(u.schemaName)).forEach(u=>{a[u.resourceSchemaName]=u.paths.map(m=>x.Location.joinWithSlash((0,h.getWorkspaceBaseUrl)(),m))}),a):(console.error(`Resources for culture ${r} not found, when registered schema resources`),a)}_getNewItems(e){const t=Terrasoft.configuration.RootSchemaDescriptors,a=Object.keys(t);return e.filter(r=>!a.includes(r.schemaName)).map(r=>r)}_sendUpdateLeftPanelRequest(e){var t=this;return(0,d.Z)(function*(){const a={type:"crt.NavigationPanelLoadDataRequest",scopes:e.scopes,$context:e.$context};yield t.handlerChain.process(a)})()}_addNewEntityStructure(){var e=this;return(0,d.Z)(function*(){yield(0,p.lastValueFrom)(e._getConfigurationData().pipe((0,p.tap)(t=>{if(t?.data?.entitiesStructure)return e._registerNewEntityStructure(t.data.entitiesStructure)})))})()}_getConfigurationData(){return this._configurationDataService.getData(!0)}_registerNewEntityStructure(e){Terrasoft.configuration.EntityStructure||(Terrasoft.configuration.EntityStructure=[]);const t=Terrasoft.configuration.EntityStructure;e.filter(r=>!t[r.entitySchemaName]).forEach(({entitySchemaName:r,page8x:n,typeColumnName:c,pages:u})=>{const m=u.map(_=>({UId:_.cardSchemaUId,cardSchemaName:_.cardSchemaName,miniPageSchema:_.miniPageSchemaName,schemaGroup:_.schemaGroup,typeColumnName:c}));t[r]={entitySchemaName:r,page8X:n,attribute:c,pages:m}})}_register(e){var t=this;return(0,d.Z)(function*(){const a=e.data,r=a?.schemaPaths;if(!r||r.length===0)return Promise.resolve();Terrasoft.configuration.RootSchemaDescriptors||(Terrasoft.configuration.RootSchemaDescriptors={});const n=t._getNewItems(r);if(n.length===0)return Promise.resolve();const c=a.schemaResourcesPaths||[],u=t._getResourcesPaths(c,n.map(_=>_.schemaName)),m=t._getDescriptorsPaths(n);t._registerPathInRequireJs({...u,...m}),t._addNewSchemaDescriptors(n),yield t._addNewEntityStructure(),yield t._sendUpdateLeftPanelRequest(e)})()}handle(e){var t=this;return(0,d.Z)(function*(){e.data&&(yield t._register(e)),yield t.next?.handle(e)})()}};Dt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.ConfigurationStructureChangeRequest",type:"crt.ConfigurationStructureChangeRequestHandler",scopes:[]}),(0,l.__metadata)("design:paramtypes",[C.ConfigurationDataService,h.UserInfo,s.Injector])],Dt);let At=class extends o.BaseRequest{};At=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.7XRequest"})],At);let Pt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=a.dataSchemas,n=Object.entries(r).filter(([,c])=>c.dataSourceConfig?.config?.entitySchemaName===e.entitySchemaName).map(([c])=>c);for(const c of n)yield t.handlerChain.process({type:"crt.HandleModelEventRequest",$context:a,modelName:c,modelEvent:e.modelEvent});return t.next?.handle(e)})()}};Pt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.7XHandleModelEventRequest",type:"crt.CrtModelEventHandler"})],Pt);const mr="ConfigurationStructureUpdateSubscriptionAttribute";let It=class extends o.BaseRequestHandler{constructor(e){super(),this._serverClientOperationNotificationReceiver=e}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,{scopes:r,$context:n}=e;a[mr]=t._serverClientOperationNotificationReceiver.getNotifications("ConfigurationStructureChanged").subscribe(c=>{const u={type:"crt.ConfigurationStructureChangeRequest",data:c,scopes:r,$context:n};t.handlerChain.process(u)}),yield t.next?.handle(e)})()}};It=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.ConfigurationStructureUpdateHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["MainShell"]}),(0,l.__metadata)("design:paramtypes",[C.ServerClientOperationNotificationReceiver])],It);let Nt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){e.$context[mr]?.unsubscribe(),yield t.next?.handle(e)})()}};Nt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.ConfigurationStructureUpdateDestroyHandler",requestType:"crt.HandleViewModelDestroyRequest",scopes:["MainShell"]})],Nt);let Mt=class extends o.BaseRequestHandler{constructor(e,t){super(),this._navigationService=e,this._messageDialogProvider=t}_convertValue(e,t){return typeof e=="object"&&e?.value?{attributeName:t,value:{displayValue:e.displayValue,primaryColorValue:e.primaryColorValue,value:e.value}}:{attributeName:t,value:e}}_getDefaultValuesByModel(e,t,a,r){const n=[];return r&&Object.entries(r).forEach(([c,u])=>{const m=t[c],_=u.modelConfig?.path,f=a?.find(I=>`${e}.${I.path}`===_);if(!m||!_||!f?.name)return;const y=this._convertValue(m,f.name);n.push(y)}),n}_generateModelInitConfigs(e,t,a){const r=(0,E.cloneDeep)(e.modelInitConfigs?.filter(m=>m.name!==t)||[]),n=e.modelInitConfigs?.find(m=>m.name===t);return[{defaultValues:this._mergeDefaultValues(n?.defaultValues,a)||[],action:n?.action,recordId:n?.recordId},...r.filter(Boolean)]}_showErrorMessage(){this._messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}_mergeDefaultValues(e,t){if((0,E.isEmpty)(e))return t||[];const a=(0,E.cloneDeep)(e);return t.forEach(r=>{const n=a.find(c=>c.attributeName===r.attributeName);n?n.value=r.value:a.push(r)}),a}handle(e){var t=this;return(0,d.Z)(function*(){try{const a=e.$context,r=yield a.getPrimaryModelName(),n=yield a.getPrimaryDataSchema(),c=n.name,u=t._getDefaultValuesByModel(r,a.attributes,n.attributes,a.viewModelConfig.attributes),m=u?.slice(-1),_=yield A.NavigationUtils.getPageForActionAsync({entityName:c,defaultValues:m});if((0,E.isEmpty)(_?.cardSchema)){t._showErrorMessage();return}const f=t._generateModelInitConfigs(a,r,u),y=new A.SchemaNavigationOptions(_.cardSchema);y.modelInitConfigs=f;const I={mode:A.NavigationMode.Replace,options:y};return yield t._navigationService.navigate(I),t.next?.handle(e)}catch(a){const r=a.message;console.error(r);return}})()}};Mt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.ContinueInOtherPageRequest",type:"crt.ContinueInOtherPageHandler"}),(0,l.__metadata)("design:paramtypes",[A.CrtNavigationService,g.MessageDialogProvider])],Mt);let pr=class extends o.BaseRequest{constructor(){super(...arguments),this.type="crt.CopyRecordRequest"}};pr=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.CopyRecordRequest"})],pr);let Ve=class extends o.BaseRequestHandler{_getEntitySchemaName(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getDataSourceName(e);return e.$context.dataSchemas[a]?.dataSourceConfig?.config?.entitySchemaName})()}_getDataSourceName(e){const t=e.$context.getBoundDataSourceName(e.itemsAttributeName);return t||e.$context.getPrimaryModelName()}handle(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getEntitySchemaName(e),r={type:"crt.7XRequest",action:"CopyRecord",$context:e.$context,payload:{entityName:e.entityName??a,recordId:e.recordId}};yield t.handlerChain.process(r)})()}};(0,l.__decorate)([(0,S.CrtCanDiscardUnsavedData)(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[Object]),(0,l.__metadata)("design:returntype",Promise)],Ve.prototype,"handle",null),Ve=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.CopyRecordRequest",type:"crt.CopyRecordHandler",scopes:[]})],Ve);let xt=class extends o.BaseRequestHandler{constructor(e){super(),this._dataSchemaRepository=e}handle(e){var t=this;return(0,d.Z)(function*(){const a=yield(0,p.firstValueFrom)(t._dataSchemaRepository.get(e.schemaName)),r={type:"crt.7XRequest",action:"AddRecordFromEditLookupCell",$context:e.$context,payload:{attributeName:e.attributeName,entityName:a.name,displayValue:e.detail?.searchValue||"",displayColumn:a.primaryDisplayAttributeName}};yield t.handlerChain.process(r)})()}};xt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.CreateRecordFromEditLookupCellRequest",type:"crt.CreateRecordFromEditLookupCellHandler"}),(0,l.__metadata)("design:paramtypes",[S.DataSchemaRepositoryService])],xt);let bt=class extends o.BaseRequestHandler{constructor(e,t){super(),this._window=e,this._environmentInjector=t}_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}handle(e){var t=this;return(0,d.Z)(function*(){(0,E.get)(t._window,"Terrasoft")?.isAngularHost||t._environmentInjector.get(R.Lu,null,{optional:!0})?.closeModals();const a=t._getDataSchema(e),r={type:"crt.7XRequest",action:"AddRecordFromLookup",$context:e.$context,payload:{attributeName:e.attributeName,entityName:e.schemaName??a?.name,displayValue:e.detail?.searchValue||"",displayColumn:a?.primaryDisplayAttributeName,defaultValues:e?.defaultValues}};yield t.handlerChain.process(r)})()}};bt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.CreateRecordFromLookupRequest",type:"crt.CreateRecordFromLookupHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards,S.Scopes.AllLookupSelectionWindows]}),(0,l.__param)(0,(0,o.CrtInject)(N.WINDOW_TOKEN)),(0,l.__metadata)("design:paramtypes",[Window,s.EnvironmentInjector])],bt);let wt=class extends o.BaseRequestHandler{constructor(e,t,a){super(),this._customEventService=e,this._window=t,this._crtNavigationLock=a}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context;return(0,E.get)(t._window,"Terrasoft")?.isAngularHost&&(t._subscription=t._subscribeOnCardModuleResponse(e),a._subscriptions.add(t._subscription)),yield t.next?.handle(e),t._subscription})()}_subscribeOnCardModuleResponse(e){const t=e.$context;return this._customEventService.subscribe("CardModuleResponse").pipe((0,M.switchMap)(a=>{const r=a.action==="edit"?S.ModelEventType.Update:S.ModelEventType.Create;return this._crtNavigationLock.wait(()=>o.HandlerChainService.instance.process({type:"crt.7XHandleModelEventRequest",$context:t,entitySchemaName:a.entitySchemaName,modelEvent:{type:r,payload:{primaryAttributesValues:[[{value:a.uId,name:a.primaryColumnName}]]}}}))})).subscribe()}};wt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleViewModelInitRequest",type:"crt.CreateUpdateRecordFrom7XHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards,S.Scopes.AllLookupSelectionWindows]}),(0,l.__param)(1,(0,o.CrtInject)(N.WINDOW_TOKEN)),(0,l.__param)(2,(0,o.CrtInject)(h.CRT_NAVIGATION_LOCK_TOKEN)),(0,l.__metadata)("design:paramtypes",[N.CustomEventService,Window,Object])],wt);var gs=v(83232),_s=v(23074);let kt=class extends o.BaseRequestHandler{constructor(e,t){super(),this._workspaceExplorerService=e,this._schemaCacheService=t}handle(e){return(0,p.lastValueFrom)(this._workspaceExplorerService.delete([{type:gs.WorkspaceItemType.ClientUnitSchema,uId:e.schemaUid}]).pipe((0,p.tap)(t=>{t.success&&this._schemaCacheService.invalidateClientUnitSchema(e.schemaName)})))}};kt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.DeleteClientUnitSchemaRequest",type:"crt.DeleteClientUnitSchemaHandler"}),(0,l.__metadata)("design:paramtypes",[_s.WorkspaceExplorerService,D.SchemaCacheService])],kt);let Ot=class extends o.BaseRequestHandler{_getDataSourceName(e){return(0,d.Z)(function*(){const t=e.$context,a=t.getBoundDataSourceName(e.itemsAttributeName);if(a)return a;const r=yield t.getPrimaryModelName();return r||cr(t)})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getDataSourceName(e);return t.handlerChain.process({type:"crt.DeleteRecordsRequest",$context:e.$context,dataSourceName:a,recordIds:[e.recordId],scopes:e.scopes})})()}};Ot=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.DeleteRecordRequest",type:"crt.DeleteRecordHandler"})],Ot);let Vt=class extends o.BaseRequestHandler{constructor(e,t,a,r,n,c){super(),this._messageDialogProvider=e,this._translateService=t,this._multiDeleteService=a,this._notifyService=r,this._userInfo=n,this._maskService=c}_getTaskName(e){return"DELETING_"+e.dataSourceName+"_RECORDS"}_openInfoDialog(e){var t=this;return(0,d.Z)(function*(){yield(0,p.lastValueFrom)(t._messageDialogProvider.open({data:{message:e,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}))})()}_displayErrorDialog(e){const t=e?.message;t&&this._notifyService.error({message:t,translate:!1})}_validateRequest(e){const{filters:t,recordIds:a}=e??{};if(t&&a?.length)throw new Error('Cannot delete records: concurrently set "filters" and "recordIds" are not supported.');if(!t&&!a?.length)throw new Error(this._translateService.instant("InfoDialog.SelectRecordsToDelete"))}_canDelete(e,t){return(0,d.Z)(function*(){const a=e.dataSourceName;return(yield e.$context.canDelete(a,{primaryColumnValue:t}))?.result})()}_tryDeleteRecords(e){var t=this;return(0,d.Z)(function*(){yield t._maskService.showMask(t._getTaskName(e),e.$context);try{const{success:a,error:r}=yield t._deleteRecords(e);yield t._maskService.hideMask(t._getTaskName(e),e.$context),!a&&r&&(yield t._openInfoDialog(r))}catch{yield t._maskService.hideMask(t._getTaskName(e),e.$context),yield t._openInfoDialog("InfoDialog.UnableToDeleteSelectedRecord")}})()}_deleteRecords(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=a.dataSchemas[e.dataSourceName],n=t._createDeleteRecordsConfig(e,r),c=t._createMultiDeleteStartRequest(n,r,a);return yield t.handlerChain.process(c),(0,p.firstValueFrom)(t._multiDeleteService.deleteRecords(n))})()}_createDeleteRecordsConfig(e,t){const{filters:a,recordIds:r}=e,n=t?.dataSourceConfig?.config?.entitySchemaName;return{operationKey:(0,o.generateGuid)(),entitySchemaName:n,filters:a instanceof o.FilterGroup?(0,at.classToPlain)(a):a,primaryColumnValues:r}}_createMultiDeleteStartRequest(e,t,a){const{operationKey:r,entitySchemaName:n,primaryColumnValues:c}=e,u=c?.length?c.map(m=>({name:t.primaryAttributeName,value:m})):null;return{type:"crt.7XRequest",action:"MultiDeleteStart",$context:a,payload:{operationKey:r,entitySchemaName:n,removedDataInfo:u}}}_showInsufficientRightsDialog(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=a.dataSchemas[e.dataSourceName];yield t._maskService.hideMask(t._getTaskName(e),a);const n=r?.caption,u=t._translateService.instant("InfoDialog.RightLevelWarningMessage").replace("{0}",n);yield t._openInfoDialog(u)})()}_confirmRecordsDelete(e){var t=this;return(0,d.Z)(function*(){const a=e?"ConfirmationDialog.DeleteRecordConfirmation":"ConfirmationDialog.DeleteRecordsConfirmation",r=t._messageDialogProvider.open({data:{message:a,actions:[g.DEFAULT_DIALOG_ACTIONS.NO,g.DEFAULT_DIALOG_ACTIONS.YES]}});return(yield(0,p.lastValueFrom)(r))===g.DEFAULT_DIALOG_ACTIONS.YES.key})()}handle(e){var t=this;return(0,d.Z)(function*(){try{t._validateRequest(e);const a=e.recordIds?.length===1;yield t._maskService.showMask(t._getTaskName(e),e.$context);const r=yield t._canDelete(e,a?e.recordIds[0]:null);return yield t._maskService.hideMask(t._getTaskName(e),e.$context),r?(yield t._confirmRecordsDelete(a))?t._tryDeleteRecords(e):void 0:t._showInsufficientRightsDialog(e)}catch(a){t._displayErrorDialog(a)}finally{yield t._maskService.hideMask(t._getTaskName(e),e.$context)}})()}};Vt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.DeleteRecordsRequest",type:"crt.DeleteRecordsHandler"}),(0,l.__param)(5,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,k.TranslateService,C.MultiDeleteService,b.NotifyService,h.UserInfo,o.MaskService])],Vt);let Ft=class extends o.BaseRequestHandler{_addDetailDataToUnsavedDetailsDataAttribute(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=yield t._getUnsavedDetailsData(a);t._hasDetailInUnsavedDetailsData(r,e.detailId)||(r.push(t._createdUnsavedDetailDataFromRequest(e)),t._subscribeOnUnsavedDetailDestroyed(e),a[S.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]=r)})()}_createdUnsavedDetailDataFromRequest(e){return{detailId:e.detailId,saveChanges:e.saveChanges,discardChanges:e.discardChanges}}_subscribeOnUnsavedDetailDestroyed(e){var t=this;e.destroyed().then(()=>{setTimeout((0,d.Z)(function*(){yield t._removeDetailFromUnsavedDetailsDataIfNeed(e.detailId,e.$context)}))})}_removeDetailFromUnsavedDetailsDataIfNeed(e,t){var a=this;return(0,d.Z)(function*(){const r=yield a._getUnsavedDetailsData(t);!a._hasDetailInUnsavedDetailsData(r,e)||(t[S.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]=r.filter(n=>n.detailId!==e))})()}_getUnsavedDetailsData(e){return(0,d.Z)(function*(){return[...yield e[S.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]].filter(Boolean)})()}_hasDetailInUnsavedDetailsData(e,t){return e.some(a=>a.detailId===t)}handle(e){var t=this;return(0,d.Z)(function*(){return e.detailId&&(yield t._addDetailDataToUnsavedDetailsDataAttribute(e)),t.next?.handle(e)})()}};Ft=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.DetailChangedRequest",type:"crt.DetailChangedHandler"})],Ft);let hr=class extends o.BaseRequest{};hr=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.DownloadEntityFileRequest"})],hr);let Ht=class extends o.BaseRequestHandler{constructor(e){super(),this.fileApiService=e}handle(e){var t=this;return(0,d.Z)(function*(){return yield t.fileApiService.download(e.detail.file.url,e.detail.file.displayValue)})()}};Ht=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.DownloadEntityFileRequest",type:"crt.DownloadEntityFileHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards]}),(0,l.__metadata)("design:paramtypes",[h.FileApiService])],Ht);let Bt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,{referenceSchemaName:r}=yield(0,S.getEntitySchemaAttribute)(a,e.primaryAttributeName),n={type:"crt.7XRequest",action:"HandleEmailLinkClick",$context:a,$initialEvent:{...e.$initialEvent,recordId:e.recordId,primaryDisplayName:e.primaryDisplayName,entitySchemaName:r,emailAddress:e.emailAddress}};return yield t.handlerChain.process(n)})()}};Bt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.EmailLinkClickHandler",requestType:"crt.EmailLinkClickRequest",scopes:[]})],Bt);var Ss=v(42378),fs=v.n(Ss);class Fe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Fe.prototype)}}class He extends Error{constructor(e){super(e),Object.setPrototypeOf(this,He.prototype)}}let Be=class extends o.BaseRequestHandler{constructor(e,t,a,r,n,c,u,m,_){var f;super(),f=this,this._rightsService=e,this._messageDialogProvider=t,this._exportToExcelService=a,this._resourceFinderService=r,this._entitySchemaQueryBuilder=n,this._translateService=c,this._dataSchemaToDataSourceAttributeConverter=u,this._dateTimeFormatToken=m,this._maskService=_,this._exportEntityOperationName="Export",this._exportOperationCode="CanExportGrid",this._maximumFileNameLength=76,this._defaultDateTimePattern="DD_MM_YYYY_HH_mm",this._isCanExecuteExportExcelOperation=()=>(0,p.firstValueFrom)(this._rightsService.getCanExecuteOperation(this._exportOperationCode)),this._isCanExecuteEntityExportOperation=y=>(0,p.firstValueFrom)(this._rightsService.getCanExecuteEntityOperation(y,this._exportEntityOperationName)),this._isCanExportToExcel=function(){var y=(0,d.Z)(function*(I){return(yield f._isCanExecuteExportExcelOperation())||f._isCanExecuteEntityExportOperation(I.name)});return function(I){return y.apply(this,arguments)}}(),this._handleError=y=>this._messageDialogProvider.open({data:{message:this._getDialogErrorMessage(y),actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}),this.getItemsAttributeName=y=>y?.items.toString().split("$").pop()}_searchAttributeInDataSchema(e,t){const a=e.attributes?.find(r=>r.name===t);return a?this._dataSchemaToDataSourceAttributeConverter.create(a.attributeType).convert(a):null}_buildColumnAttribute(e,t,a,r){var n=this;return(0,d.Z)(function*(){let c,u;if(typeof e=="string")c=e;else{const f=a[e.code]??{};(0,S.isModelAttributeConfig)(f)&&(c=f?.modelConfig?.path?.split(".")?.slice(1)?.join(".")??""),u=e.caption}const m=n._searchAttributeInDataSchema(t,c),_=yield n._resourceFinderService.findViewModelResourceValue(u,r);return m?{...m,path:m.path||c,caption:_||null}:{type:"default",path:c,name:c,caption:_||null}})()}_createColumns(e,t,a,r){var n=this;return(0,d.Z)(function*(){const c=[],u=yield n.getColumns(e,r.$context);if(!u)return c;for(const m of u){const _=yield n._buildColumnAttribute(m,t,a,r.$context.Resources);c.push(_)}return c})()}_buildEsq(e,t){var a=this;return(0,d.Z)(function*(){const r=e.$context,n=a.getViewConfig(e),c=a.getItemsAttributeName(n),u=r.getBoundDataSourceNameByAttributePath(c),m=yield r.getDataSourceLoadParameters(u);m||a.throwSettingsExportError();const _=r.getAttributeViewModelConfig(c),f=yield a._createColumns(n,t,_,e),y={pagingConfig:m.options.pagingConfig,sortingConfig:m.options.sortingConfig};return(0,p.firstValueFrom)(a._entitySchemaQueryBuilder.build(t,f,m.parameters,y))})()}_buildFileName(e){const t=this._getDateTimePattern(),a=fs()(new Date).format(t),r=this.getExportedViewTitle(e);return`${this._formattingFileName(r,a.length)}_${a}`}_getDateTimePattern(){if(!this._dateTimeFormatToken)return this._defaultDateTimePattern;const e=this._dateTimeFormatToken.shortDatePattern,t=this._dateTimeFormatToken.shortTimePattern;return`${e}_${t}`.replace(/[^\w]/gi,"_")}_formattingFileName(e,t){const a=this._maximumFileNameLength-t;return(0,h.stripFileName)(e).substring(0,a)}_export(e){var t=this;return(0,d.Z)(function*(){const a=t.getDataSchema(e);if(!(yield t._isCanExportToExcel(a)))throw new Fe;const r=yield t._buildEsq(e,a),n=t.getFilters(e);n&&(r.clearFilters(),Object.entries(n.items).forEach(([u,m])=>{r.filters.add(m,u)}));const c=t._buildFileName(e);return(0,p.firstValueFrom)(t._exportToExcelService.exportRecordsFromEsqToExcel(r?.getMetadata(),c).pipe((0,M.map)(u=>{if(!u?.GetExportToExcelKeyResult?.success)throw new Error(u.GetExportToExcelKeyResult.errorInfo.message)})))})()}_getDialogErrorMessage(e){return e instanceof Fe?this._translateService.instant("InfoDialog.ExportToExcel.PermissionsErrorMessage"):e instanceof He?this._translateService.instant("InfoDialog.SettingsErrorMessage"):e.message}getColumns(e,t){const a=Array.isArray(e.columns)?e.columns.filter(({columnType:r,hidden:n})=>r!=="tools"&&!n):[];return Promise.resolve(a)}throwSettingsExportError(){throw new He}getDataSchema(e){const t=e.$context,a=this.getViewItemsAttributeName(e),r=t.getBoundDataSchemaByAttributePath(a);return r||this.throwSettingsExportError(),r}getFilters(e){return null}handle(e){var t=this;return(0,d.Z)(function*(){const a=t.getTaskName(e);try{return t._maskService.showMask(a,e.$context),yield t._export(e)}catch(r){t._handleError(r)}finally{t._maskService.hideMask(a,e.$context)}})()}};Be=(0,l.__decorate)([(0,l.__param)(6,(0,s.Inject)(S.DATA_SCHEMA_TO_DATA_SOURCE_ATTRIBUTE_CONVERTER_FACTORY)),(0,l.__param)(7,(0,s.Inject)(h.DATE_TIME_FORMAT_INFO)),(0,l.__param)(8,(0,s.Inject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[C.RightsService,g.MessageDialogProvider,C.ExportToExcelService,h.ResourceFinderService,S.EntitySchemaQueryBuilder,k.TranslateService,N.Factory,Object,o.MaskService])],Be);let Lt=class extends Be{getViewConfig(e){return{columns:(Array.isArray(e.columns),e.columns),items:`$${this.getViewItemsAttributeName(e)}`}}getViewItemsAttributeName(e){return e.viewModelAttributeName}getExportedViewTitle(e){return e.fileName}getTaskName(e){return"EXPORT_CHART_DATA_GRID_TO_EXCEL_"+e.fileName}constructor(e,t,a,r,n,c,u,m,_){super(e,t,a,r,n,c,u,m,_)}};Lt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.ExportChartDataGridToExcelRequest",type:"crt.ExportChartDataGridToExcelHandler"}),(0,l.__param)(6,(0,o.CrtInject)(S.DATA_SCHEMA_TO_DATA_SOURCE_ATTRIBUTE_CONVERTER_FACTORY)),(0,l.__param)(7,(0,o.CrtInject)(h.DATE_TIME_FORMAT_INFO)),(0,l.__param)(8,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[C.RightsService,g.MessageDialogProvider,C.ExportToExcelService,h.ResourceFinderService,S.EntitySchemaQueryBuilder,k.TranslateService,N.Factory,Object,o.MaskService])],Lt);let Ut=class extends Be{constructor(e,t,a,r,n,c,u,m,_,f,y,I){super(e,t,a,r,n,c,u,m,_),this._schemaService=f,this._folderTreeRelatedElementConfigsProvider=y,this._dataGridFolderTreeRelationsProvider=I}getFilters(e){return e.filters}getViewConfig(e){return this._schemaService.getViewConfigInfoByName(e.viewName)?.viewConfig}getViewItemsAttributeName(e){const t=this.getViewConfig(e);return t?.items||this.throwSettingsExportError(),this.getItemsAttributeName(t)}getExportedViewTitle(e){const t=this.getDataSchema(e);return(0,h.getLocalizableStringValue)(t.caption,this._translateService.currentLang)}getTaskName(e){return"EXPORT_DATA_GRID_TO_EXCEL_"+e.viewName}getColumns(e,t){var a=()=>super.getColumns,r=this;return(0,d.Z)(function*(){const n=yield a().call(r,e,t),c=r._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(e,r._schemaService.schema);if(!c)return n;const{activeFolderFolderTreeIdAttrName:u}=(0,h.buildFolderTreeAttributeNames)(c.name),m=yield t[u];if(!m)return n;const _=yield(0,p.firstValueFrom)(r._folderTreeRelatedElementConfigsProvider.get({folderId:m,schemaName:r._schemaService.schemaName,elementName:e.name}));return _?_.columns.map(f=>f.viewMetadata).filter(Boolean).filter(({columnType:f,hidden:y})=>f!=="tools"&&!y):n})()}};Ut=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.ExportDataGridToExcelRequest",type:"crt.ExportDataGridToExcelHandler"}),(0,l.__param)(6,(0,o.CrtInject)(S.DATA_SCHEMA_TO_DATA_SOURCE_ATTRIBUTE_CONVERTER_FACTORY)),(0,l.__param)(7,(0,o.CrtInject)(h.DATE_TIME_FORMAT_INFO)),(0,l.__param)(8,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[C.RightsService,g.MessageDialogProvider,C.ExportToExcelService,h.ResourceFinderService,S.EntitySchemaQueryBuilder,k.TranslateService,N.Factory,Object,o.MaskService,D.SchemaService,C.FolderTreeRelatedElementConfigsProvider,g.DataGridFolderTreeRelationsProvider])],Ut);class gr extends o.BaseRequestHandler{_getOpenLookupPageRequestConfig(e){const t=e.$context;return{type:"crt.OpenSelectionWindowRequest",$context:t,scopes:e.scopes,features:this.getLookupPageFeatures(),entitySchemaName:this.getLookupPageEntitySchemaName(e),caption:this.getLookupPageCaption(e),filtersConfig:this._getLookupPageFiltersConfig(e),afterClosed:a=>this._afterClosedLookupPageAction(e,a.filter)}}_getLookupPageFiltersConfig(e){const t=this.getLookupPageFilter(e);if(!t)return;const a="lookup_page_filter";return{filterAttributes:[{name:a,loadOnChange:!1}],attributesConfig:{[a]:{value:t}}}}_afterClosedLookupPageAction(e,t){this.maskService.showMask(this.getMaskTaskName(e),e.$context),this.runServiceAction(e,t).pipe((0,p.tap)(()=>{this.maskService.hideMask(this.getMaskTaskName(e),e.$context)})).subscribe(a=>{this._processServiceResult(e,a)})}_processServiceResult(e,t){const a={message:t.message,translate:!1};if(t.success){this.showSuccessNotification(e,a);return}this.notifyService.error(a)}_validateRequest(e){return this._validateRequestDataSource(e)&&this._validateRequestFilters(e)}_validateRequestDataSource(e){return e.dataSourceName?!0:(this.messageDialogProvider.open({data:{message:"InfoDialog.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}),!1)}_validateRequestFilters(e){return this._isValidFilters(e.filters)?!0:(this.notifyService.error({message:this.invalidErrorMessageForSelectRecordsValidator,translate:!0}),!1)}_isValidFilters(e){return(0,E.isObject)(e)&&"items"in e&&!(0,E.isEmpty)(e.items)}constructor(e){super(),this.injector=e,this.notifyService=e.get(b.NotifyService),this.maskService=e.get(o.MaskService),this.messageDialogProvider=e.get(g.MessageDialogProvider)}getLookupPageFeatures(){return{create:{enabled:!1},select:{multiple:!0,selectAll:!1}}}getLookupPageFilter(e){return null}showSuccessNotification(e,t){this.notifyService.show(t)}getRelatedRecordsSchemaName(e){return e.$context.dataSchemas[e.dataSourceName]?.name}runServiceAction(e,t){const a=this.createServiceData(e,t);return this.openLookupPageMode==="AddRecords"?this.addRecordsServiceAction(a):this.removeRecordsServiceAction(a)}addRecordsServiceAction(e){return this.baseRelatedInMainRecordsService.addRelatedRecords(e)}removeRecordsServiceAction(e){return this.baseRelatedInMainRecordsService.removeRelatedRecords(e)}initializeData(e){}handle(e){var t=this;return(0,d.Z)(function*(){if(!t._validateRequest(e))return;yield t.initializeData(e);const a=t._getOpenLookupPageRequestConfig(e);yield t.handlerChain.process(a)})()}}class _r extends gr{get invalidErrorMessageForSelectRecordsValidator(){return`InfoDialog.RecordsInStaticFolders.SelectRecordsTo${this.openLookupPageMode}Message`}_updateStaticFolderDataSource(e){var t=this;if(!e.$context.isDataSourceForCollection(e.dataSourceName))return;const r={type:"crt.LoadDataRequest",$context:e.$context,dataSourceName:e.dataSourceName,config:{loadType:o.DataSourceLoadType.Reload}};setTimeout((0,d.Z)(function*(){yield t.handlerChain.process(r)}))}constructor(e){super(e),this.injector=e,this.baseRelatedInMainRecordsService=e.get(R.N1)}showSuccessNotification(e,t){super.showSuccessNotification(e,t),this._updateStaticFolderDataSource(e)}createServiceData(e,t){const a=this.getRelatedRecordsSchemaName(e);return{relatedRecordsSchemaName:a,relatedRecordColumnName:this._oldInFolderColumnSchemaName,relatedRecordsFilters:e.filters,relatedInMainRecordsSchemaName:(0,g.getOldInFolderEntitySchemaName)(a),mainRecordsSchemaName:(0,g.getOldFolderEntitySchemaName)(a),mainRecordColumnName:g.STATIC_FOLDER_COLUMN_NAME,mainRecordsFilters:t}}getLookupPageEntitySchemaName(e){const t=e.$context.dataSchemas[e.dataSourceName]?.name;return(0,g.getOldFolderEntitySchemaName)(t)}getLookupPageCaption(e){}getLookupPageFilter(e){const t=new o.FilterGroup;return t.addSchemaColumnFilterWithParameter(o.ComparisonType.Equal,"FolderType",g.STATIC_FOLDER_TYPE_ID,"StaticFolderTypeFilter"),t}getMaskTaskName(e){return`RecordsInStaticFolders_${this.getRelatedRecordsSchemaName(e)}`}initializeData(e){var t=this;return(0,d.Z)(function*(){const a=t.getRelatedRecordsSchemaName(e);t._oldInFolderColumnSchemaName=yield(0,g.getOldInFolderReferenceColumnName)(a)})()}}let jt=class extends _r{constructor(e){super(e),this._injector=e,this.openLookupPageMode="AddRecords"}};jt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.AddRecordsInStaticFoldersRequest",type:"crt.AddRecordsInStaticFoldersHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],jt);let $t=class extends _r{constructor(e){super(e),this._injector=e,this.openLookupPageMode="RemoveRecords"}};$t=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.RemoveRecordsInStaticFoldersRequest",type:"crt.RemoveRecordsInStaticFoldersHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],$t);let Gt=class extends o.BaseRequestHandler{_buildImportManagerUrl(e){const t=(0,h.getWorkspaceBaseUrl)(),a="NUI",r="ViewModule.aspx?isFreedomUI=true&vm=FileImportWizard#FileImportModule/FileImportStartPage",n=(0,o.generateGuid)(),c=e.entitySchemaName||"";return(0,h.joinPath)(t,a,r,n,c)}_openImportManager(e){const t=this._buildImportManagerUrl(e);this._window.open(t,"_blank")}_showOperationProhibitionDialog(){var e=this;return(0,d.Z)(function*(){return(0,p.firstValueFrom)(e._dialogService.openOperationPermissionsErrorDialog(e._importOperationName))})()}_isCanImportFromExcel(){var e=this;return(0,d.Z)(function*(){return(0,p.firstValueFrom)(e._rightsService.getCanExecuteOperation(e._importOperationName))})()}constructor(e,t,a){super(),this._rightsService=e,this._dialogService=t,this._window=a,this._importOperationName="CanImportFromExcel"}handle(e){var t=this;return(0,d.Z)(function*(){if(!(yield t._isCanImportFromExcel())){yield t._showOperationProhibitionDialog();return}t._openImportManager(e)})()}};Gt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.ImportDataRequest",type:"crt.ImportDataHandler"}),(0,l.__param)(2,(0,o.CrtInject)(N.WINDOW_TOKEN)),(0,l.__metadata)("design:paramtypes",[C.RightsService,b.DialogService,Object])],Gt);let Sr=class extends o.BaseRequest{};Sr=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.LoadRightsModuleRequest"})],Sr);let Zt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r={type:"crt.7XRequest",action:"LoadRightsModule",$context:a,payload:{...e.payload}};return yield t.handlerChain.process(r)})()}};Zt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.LoadRightsModuleHandler",requestType:"crt.LoadRightsModuleRequest",scopes:[]})],Zt);let zt=class extends o.BaseRequestHandler{constructor(){super(...arguments),this._emptySelectionState={type:"specific",selected:[]}}_getSelectedRowsCount(e){return e.type==="specific"?e.selected.length:null}handle(e){var t=this;return(0,d.Z)(function*(){const a=`${e.itemsAttributeName}_${g.GRID_SELECTION_STATE_ATTRIBUTE_NAME}`,r=(yield e.$context[a])??t._emptySelectionState,n=new D.SelectionStateModel(r,!0),c=n.isSelected(e.rowId),u=t._getSelectedRowsCount(r);c&&u===1||(n.toggleSelection(e.rowId),e.$context[a]=n.state),(!c&&u===0||c&&u===1)&&(yield o.HandlerChainService.instance.process({type:"crt.SelectLookupPageRequest",$context:e.$context,scopes:[...e.scopes]}))})()}};zt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.LookupPageDataGridRowDoubleClickHandler",requestType:"crt.LookupPageDataGridRowDoubleClickRequest",scopes:["BaseLookupPageTemplate"]})],zt);let qt=class extends nr{_cancelRecord(e){return(0,d.Z)(function*(){e.event.preventDefault(),yield e.$context.executeRequest({type:"crt.ClosePageRequest",$context:e.$context})})()}checkPressedKey(e){var t=this;return(0,d.Z)(function*(){if((0,h.escapePressed)(e.event))return t._cancelRecord(e)})()}};qt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleKeyboardHotkeysRequest",type:"crt.LookupPageKeyboardHotkeysHandler",scopes:["BaseLookupPageTemplate"]})],qt);let Kt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const a=yield t.next?.handle(e),r=`${$}_${g.GRID_SELECTION_STATE_ATTRIBUTE_NAME}`,n=yield e.$context[r],c=n?.selected??[],u=(yield e.$context[Me])??!1,m=e.primaryAttributeValue?.value;c.includes(m)||(e.$context[r]={type:n?.type??"specific",selected:u?c.concat(...a):[...a]})})()}};Kt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.LookupPageSetDataGridSelectionStateHandler",requestType:"crt.SetTopRecordRequest",scopes:[S.Scopes.AllLookupSelectionWindows]})],Kt);var fr=v(8785);let Wt=class extends o.BaseRequestHandler{constructor(e){super(),this._injector=e,this._pageLookupData=this._injector.get(T.HO)}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=yield a[ee];a[ee]=fr.String.format(t._pageLookupData.header,r),yield t.next?.handle(e)})()}};Wt=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.LookupPageViewModelInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["BaseLookupPageTemplate"]}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Wt);let Jt=class extends o.BaseRequestHandler{constructor(e){super(),this._notifyService=e}handle(e){var t=this;return(0,d.Z)(function*(){yield t._notifyService.show({message:e.message,translate:e.translate,closeOnClickOutside:!1,duration:e.duration})})()}};Jt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.NotificationRequest",type:"crt.NotificationHandler"}),(0,l.__metadata)("design:paramtypes",[b.NotifyService])],Jt);let Qt=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){if(!e.entityName)return;const a={type:"crt.7XRequest",action:"OpenDuplicatesPage",$context:e.$context,payload:{entityName:e.entityName,schemaName:"LazyDuplicatesPageV2"}};yield t.handlerChain.process(a)})()}};Qt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.OpenDuplicatesPageRequest",type:"crt.OpenDuplicatesPageHandler"})],Qt);var Le=v(65181);class ie{constructor(e,t){this._pageLookupData=e,this._featureService=t,this._typedPagesFeatureName="DisableTypedPagesForSelectionWindow"}_setupForMenuMode(e){e?.menuItems?.forEach(t=>{t.clicked.request="crt.CreateRecordFromLookupRequest",t.clicked.params?.defaultValues?.length&&(t.clicked.params={schemaName:this._pageLookupData.entitySchemaName,attributeName:Ne,defaultValues:[...t.clicked.params.defaultValues]})})}_setupForDefaultMode(e){const t=e.clicked.params?.defaultValues;e.clicked={request:"crt.CreateRecordFromLookupRequest",params:{schemaName:this._pageLookupData.entitySchemaName,attributeName:Ne}},t?.length&&(e.clicked.params.defaultValues=[...t])}_setupAddNewButton(e){this._getNewButtons(e).forEach(({viewConfig:a})=>a.clickMode==="menu"?this._setupForMenuMode(a):this._setupForDefaultMode(a))}_getNewButtons(e){const t=h.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig),a="NewButton";return t.filter(({viewConfig:r})=>r.name===a||r?.clicked?.request==="crt.CreateRecordRequest")}_setupButtonEntityNameParameter(e){this._getNewButtons(e).forEach(({viewConfig:a})=>{if(a.visible=`$${Ie}`,this._pageLookupData?.features?.create?.enabled){if(!a.clicked){a.clicked={params:{entityName:this._pageLookupData.entitySchemaName}};return}a.clicked.params={...a.clicked?.params??{},entityName:this._pageLookupData.entitySchemaName}}})}_setupAddNewButtonWithoutTypedPages(e){this._getNewButtons(e).forEach(({viewConfig:a})=>{a.visible=`$${Ie}`,this._pageLookupData?.features?.create?.enabled&&(a.clicked={request:"crt.CreateRecordFromLookupRequest",params:{schemaName:this._pageLookupData.entitySchemaName,attributeName:Ne}})})}crtGetIsPreventCaching(){return Promise.resolve(!0)}crtOnMetaDataInit(e){var t=this;return(0,d.Z)(function*(){const a=e,r=a.viewModelConfig.attributes;return r[Ie]={value:t._pageLookupData?.features?.create?.enabled??!1},t._typedPagesFeatureEnabled=!(yield(0,p.lastValueFrom)(t._featureService.getFeatureState(t._typedPagesFeatureName))),t._typedPagesFeatureEnabled?t._setupButtonEntityNameParameter(a):t._setupAddNewButtonWithoutTypedPages(a),Promise.resolve(e)})()}crtOnViewModelInit(e,t,a){const r=e;return this._pageLookupData?.features?.create?.enabled&&this._typedPagesFeatureEnabled&&this._setupAddNewButton(r),Promise.resolve(e)}}ie.\u0275fac=function(e){return new(e||ie)(s.\u0275\u0275inject(T.HO,8),s.\u0275\u0275inject(C.FeatureService))},ie.\u0275prov=s.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac});class ce{constructor(e,t){this._pageLookupData=e,this._entitySchemaService=t}_setDataSourcesConfig(e){const r=e.modelConfig.dataSources[ye].config;r.entitySchemaName=this._pageLookupData.entitySchemaName,r.useRecordDeactivation=!this._pageLookupData.features?.showDeactivatedRecords}_setAttribute(e,t){if(!t)return;const a=ye+"_"+t,r=ye+"."+t;e[a]?e[a].modelConfig.path=r:e[a]={modelConfig:{path:r}}}_setAttributesPath(e,t){const n=e.viewModelConfig.attributes[$].viewModelConfig?.attributes,c=t.getPrimaryColumn();this._setAttribute(n,c?.name);const u=t.getPrimaryDisplayColumn();this._setAttribute(n,u?.name);const m=t.getPrimaryColorColumn();this._setAttribute(n,m?.name)}_setPredefinedFilter(e){const t=this._pageLookupData.filtersConfig;if(t){const a=e.viewModelConfig,r=a.attributes[$],n=r.modelConfig.filterAttributes;r.modelConfig.filterAttributes=[...n,...t.filterAttributes],Object.assign(a.attributes,t.attributesConfig)}}_getEntitySchema(){var e=this;return(0,d.Z)(function*(){return(yield(0,p.lastValueFrom)(e._entitySchemaService.getEntitySchemaByName(e._pageLookupData.entitySchemaName))).entitySchema})()}_setDataGridPrimaryDisplayColumn(e,t){const a=(0,K.getDataGridViewConfigs)(e,["crt.DataGrid"]).find(u=>u.name===$),r=t.getPrimaryDisplayColumn(),n=ye+"_"+r.name,c=a.columns;c.length===0&&c.push({id:(0,o.generateGuid)(),caption:`#ResourceString(${n})#`,code:n,dataValueType:r.dataValueType})}_getViewNames(e){const{viewConfig:t}=e;return h.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button"],t).filter(a=>{const r=a?.viewConfig?.clicked;return r?.request==="crt.SelectLookupPageRequest"&&r?.params?.viewName}).map(a=>a?.viewConfig?.clicked?.params?.viewName)}_addRowDoubleClickRequests(e){this._getViewNames(e).forEach(a=>{const r=(0,K.getDataGridViewConfigs)(e,["crt.DataGrid"]).find(n=>n.name===a);if(!r?.rowDoubleClick){const n={request:"crt.LookupPageDataGridRowDoubleClickRequest",params:{itemsAttributeName:a,rowId:"@event.rowId"}};r.rowDoubleClick=n}})}crtGetIsPreventCaching(){return Promise.resolve(!0)}crtOnMetaDataInit(e){var t=this;return(0,d.Z)(function*(){if(t._pageLookupData){t._setDataSourcesConfig(e);const a=yield t._getEntitySchema();t._setAttributesPath(e,a),t._setDataGridPrimaryDisplayColumn(e,a),t._setPredefinedFilter(e),t._addRowDoubleClickRequests(e)}return e})()}}ce.\u0275fac=function(e){return new(e||ce)(s.\u0275\u0275inject(T.HO,8),s.\u0275\u0275inject(h.EntitySchemaService))},ce.\u0275prov=s.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac});class le{constructor(e){this._pageLookupData=e,this._features=e.features,this._dataGridFeatures={rows:{selection:{enable:!0,multiple:this._features?.select?.multiple??!1,selectAll:this._features?.select?.selectAll??!1}}}}_getMainDataGridViewConfig(e){return(0,K.getDataGridViewConfigs)(e,["crt.DataGrid"]).find(({name:a})=>a===$)}_setupDataGridFeaturesInViewConfig(e,t){e.features=(0,E.merge)({},e.features,this._dataGridFeatures);const a=e.features?.rows?.selection;t.attributes[Me]={value:a?.multiple??!1}}_setupDataGridSelectionState(e,t){const a=this._pageLookupData.selectionState,r=e.selectionState.slice(1);a&&(t.attributes[r].value=a)}_setupDataGridFeaturesInViewModelAttribute(e,t){var a=this;return(0,d.Z)(function*(){const r=yield e[t],n=(0,E.merge)({},r,a._dataGridFeatures);e[t]=n;const c=n?.rows?.selection;e[Me]=c?.multiple??!1})()}crtGetIsPreventCaching(){return Promise.resolve(!0)}crtOnMetaDataInit(e){const t=e,a=t.viewModelConfig,r=this._getMainDataGridViewConfig(t);return(0,D.isBindingExpression)(r.features)||this._setupDataGridFeaturesInViewConfig(r,a),this._setupDataGridSelectionState(r,a),Promise.resolve(e)}crtOnViewModelInit(e,t,a){var r=this;return(0,d.Z)(function*(){const n=e,c=r._getMainDataGridViewConfig(n);if((0,D.isBindingExpression)(c.features)){const u=c.features.slice(1);yield r._setupDataGridFeaturesInViewModelAttribute(a,u)}return e})()}}le.\u0275fac=function(e){return new(e||le)(s.\u0275\u0275inject(T.HO,8))},le.\u0275prov=s.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac});class de{constructor(e,t){this._pageLookupData=e,this._searchFilterPreprocessorService=t}crtOnViewModelInit(e,t,a){var r=this;return(0,d.Z)(function*(){const{defaultSearchValue:n}=r._pageLookupData;if(!n)return e;const c=yield r._searchFilterPreprocessorService.getColumnsModelByAttributeName(e,a,$);return a[Wa]=n,a[Ja]=[{group:{name:c.viewName},columns:c.columns}],e})()}}de.\u0275fac=function(e){return new(e||de)(s.\u0275\u0275inject(T.HO,8),s.\u0275\u0275inject(Le.SearchFilterPreprocessorService))},de.\u0275prov=s.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac});var vs=v(70806);class ue{constructor(e){this._oldTagMiniPageData=e}_setDataSourcesConfig(e){const t=e.modelConfig,a=t.primaryDataSourceName,r=t.dataSources[a];(0,E.set)(r.config,"entitySchemaName",this._oldTagMiniPageData.entitySchemaName)}crtGetIsPreventCaching(){return Promise.resolve(!0)}crtOnMetaDataInit(e){return!!this._oldTagMiniPageData&&(0,vs.isNotEmpty)(this._oldTagMiniPageData.entitySchemaName)&&this._setDataSourcesConfig(e),Promise.resolve(e)}}ue.\u0275fac=function(e){return new(e||ue)(s.\u0275\u0275inject(be,8))},ue.\u0275prov=s.\u0275\u0275defineInjectable({token:ue,factory:ue.\u0275fac});class me{_addTagTypeFilterIfNeed(e){var t=this;return(0,d.Z)(function*(){const a=t._getTagTypeAttributesNames(e);!a.length||(yield t._prepareAllowedOldTagOperations(),t._createAndAddTagTypeFilterAttribute(e),t._addTagTypeFilterAttributeToTypesAttributes(e,a))})()}_getTagTypeAttributesNames(e){const t=[],a=this._getViewModuleAttributes(e);return(0,E.forOwn)(a,(r,n)=>{!r.isCollection||this._getAttributeEntitySchemaName(e,r)!==g.OLD_TAG_TYPE_SOURCE_SCHEMA||t.push(n)}),t}_getAttributeEntitySchemaName(e,t){const a=this._getAttributeEntitySchemaNameFromEmbeddedModel(t);return a||this._getAttributeEntitySchemaNameFromDataSource(e,t)}_getAttributeEntitySchemaNameFromEmbeddedModel(e){return this._getEntitySchemaNameFromDataSourceConfig(e.embeddedModel?.config)}_getEntitySchemaNameFromDataSourceConfig(e){return e?.config?.entitySchemaName}_getAttributeEntitySchemaNameFromDataSource(e,t){const a=this._getAttributeDataSourceName(t);if(!a)return;const r=this._getDataSourceConfigByName(e,a);return this._getEntitySchemaNameFromDataSourceConfig(r)}_getAttributeDataSourceName(e){return e.modelConfig?.path}_getDataSourceConfigByName(e,t){return e.modelConfig.dataSources[t]}_prepareAllowedOldTagOperations(){var e=this;return(0,d.Z)(function*(){e._allowedOldTagOperation=yield(0,g.getAllowedOldTagOperations)(e._rightsService)})()}_createAndAddTagTypeFilterAttribute(e){const t=(0,g.createOldTagTypeFilter)(this._allowedOldTagOperation),a=this._getViewModuleAttributes(e);!a||a[this._typeFilterAttributeName]||(a[this._typeFilterAttributeName]={value:t})}_addTagTypeFilterAttributeToTypesAttributes(e,t){const a=this._getViewModuleAttributes(e);!a||t.forEach(r=>{const n=a[r],c=n.modelConfig||{},u=c.filterAttributes||[];u.find(_=>_.name===this._typeFilterAttributeName)||(u.push({name:this._typeFilterAttributeName,loadOnChange:!0}),c.filterAttributes=u,n.modelConfig=c)})}_getViewModuleAttributes(e){return e.viewModelConfig?.attributes}constructor(e){this._rightsService=e,this._typeFilterAttributeName="Old_Tag_Type_Dynamic_Filter",this._allowedOldTagOperation={canManageCorporateTags:!1,canManagePublicTags:!1}}crtOnModelInit(e,t){var a=this;return(0,d.Z)(function*(){return yield a._addTagTypeFilterIfNeed(e),e})()}}me.\u0275fac=function(e){return new(e||me)(s.\u0275\u0275inject(C.RightsService))},me.\u0275prov=s.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac});class pe{crtOnMetaDataInit(e){const t=e,a=(0,j.getRequestBindingConfigs)(t.viewConfig,"crt.RunBusinessProcessRequest");for(const r of a){const n=r.params.filters;if(!n)continue;const c=n.split("|")[1]?.split(":")??[];if(c[0]?.trim()!=="crt.ToCollectionFilters")continue;const u=c.find(f=>f.indexOf("SelectionState")>=0)?.trim(),m=h.MetadataSchemaUtils.getViewConfigInfoByProperty("selectionState",u,t.viewConfig);if(m.length===0)continue;const _=m[0].viewConfig;r.params.activeRow=_.activeRow}return Promise.resolve(e)}}pe.\u0275fac=function(e){return new(e||pe)},pe.\u0275prov=s.\u0275\u0275defineInjectable({token:pe,factory:pe.\u0275fac});const Cs=[{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:ce,deps:[T.HO,h.EntitySchemaService],multi:!0},{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:ie,deps:[T.HO,C.FeatureService],multi:!0},{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:le,deps:[T.HO],multi:!0},{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:de,deps:[T.HO,Le.SearchFilterPreprocessorService],multi:!0}];var ys=v(39630);const vr=[{provide:h.EntitySchemaService,useClass:h.EntitySchemaService},...Cs,{provide:D.AbstractProfileSchemaProvider,useClass:ys.a,deps:[C.UserSchemaProfileService,T.HO]},{provide:D.ProfileSchemaLoaderService,useClass:D.ProfileSchemaLoaderService},{provide:D.ProfileSchemaLocalizationService,useClass:D.ProfileSchemaLocalizationService},D.SCHEMA_LOCALIZATION_SERVICE_FACTORY_PROVIDER,{provide:Le.SearchFilterPreprocessorService,useClass:Le.SearchFilterPreprocessorService}];let Xt=class extends o.BaseRequestHandler{constructor(e){super(),this._injector=e,this._modalService=e.get(_e.L),this._entitySchemaService=e.get(h.EntitySchemaService),this._resourceFinderService=e.get(h.ResourceFinderService),this._featureValues=e.get(h.FEATURE_VALUES)}_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}_getEntitySchemaName(e){return e.entitySchemaName?e.entitySchemaName:this._getDataSchema(e).name}_getCaption(e,t){return e.caption?Promise.resolve(this._resourceFinderService.findLocalizableValue(e.caption)):this._getCaptionTemplate(e,t)}_getCaptionTemplate(e,t){var a=this;return(0,d.Z)(function*(){let r="";const n=e.$context;if(e.itemAttributeName&&e.itemAttributeName in n.Resources.Strings)r=yield n.Resources.Strings[e.itemAttributeName];else{const c=yield(0,p.firstValueFrom)(a._entitySchemaService.getEntitySchemaByName(t));if(!c.success)throw new Error(`Entity with name ${t} not found`);r=a._resourceFinderService.findLocalizableValue(c.entitySchema.caption)}return`{0} ${r}`})()}_createModalInjector(e){var t=this;return(0,d.Z)(function*(){const a=t._getEntitySchemaName(e),r=yield t._getCaption(e,a),n=yield e.$context[e.itemAttributeName],c=typeof n=="string"?n:null;return s.Injector.create({parent:t._injector,providers:[{provide:T.HO,useValue:{header:r,entitySchemaName:a,defaultSearchValue:c,selectionApiMode:T.dh.Legacy,filtersConfig:e.filtersConfig,features:e.features,selectionState:e.selectionState,returnEmptyValue:e.returnEmptyValue},deps:[]},...vr]})})()}_openLookupPage(e){var t=this;return(0,d.Z)(function*(){const a=yield t._createModalInjector(e),r=e.$context,n=e.schemaName||"BaseLookupPageTemplate";(yield t._modalService.show({schemaName:n},{injector:a})).afterClosed().pipe((0,M.take)(1),(0,p.filter)(u=>u)).subscribe(u=>{e.itemAttributeName&&(r[e.itemAttributeName]=u),e?.afterClosed?.(u)})})()}handle(e){var t=this;return(0,d.Z)(function*(){t._featureValues.DisableOpenLookupPageHandlerInZone?yield t._openLookupPage(e):yield t._injector.get(s.NgZone).run(()=>t._openLookupPage(e)),yield t.next?.handle(e)})()}};Xt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.OpenLookupPageRequest",type:"crt.OpenLookupPageHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Xt);let Cr=class extends o.BaseRequest{};Cr=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.OpenLookupPageRequest"})],Cr);let yr=class extends o.BaseRequest{};yr=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.OpenSelectionWindowRequest"})],yr);let Yt=class extends o.BaseRequestHandler{constructor(e){super(),this._injector=e,this._modalService=e.get(_e.L),this._entitySchemaService=e.get(h.EntitySchemaService),this._resourceFinderService=e.get(h.ResourceFinderService),this._featureValues=e.get(h.FEATURE_VALUES)}_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}_getEntitySchemaName(e){return e.entitySchemaName?e.entitySchemaName:this._getDataSchema(e).name}_getCaption(e,t){return e.caption?Promise.resolve(this._resourceFinderService.findLocalizableValue(e.caption)):this._getCaptionTemplate(e,t)}_getCaptionTemplate(e,t){var a=this;return(0,d.Z)(function*(){let r="";const n=e.$context;if(e.itemAttributeName&&e.itemAttributeName in n.Resources.Strings)r=yield n.Resources.Strings[e.itemAttributeName];else{const c=yield(0,p.firstValueFrom)(a._entitySchemaService.getEntitySchemaByName(t));if(!c.success)throw new Error(`Entity with name ${t} not found`);r=a._resourceFinderService.findLocalizableValue(c.entitySchema.caption)}return`{0} ${r}`})()}_createModalInjector(e){var t=this;return(0,d.Z)(function*(){const a=t._getEntitySchemaName(e),r=yield t._getCaption(e,a),n=yield e.$context[e.itemAttributeName],c=typeof n=="string"?n:null;return s.Injector.create({parent:t._injector,providers:[{provide:T.HO,useValue:{header:r,entitySchemaName:a,selectionApiMode:T.dh.New,defaultSearchValue:c,filtersConfig:e.filtersConfig,features:e.features,selectionState:e.selectionState,returnEmptyValue:e.returnEmptyValue},deps:[]},...vr]})})()}_openLookupPage(e){var t=this;return(0,d.Z)(function*(){const a=yield t._createModalInjector(e),r=e.$context,n=e.schemaName||"BaseLookupPageTemplate";(yield t._modalService.show({schemaName:n},{injector:a})).afterClosed().pipe((0,M.take)(1),(0,M.map)(u=>u??new T.Vr({canceled:!0}))).subscribe(function(){var u=(0,d.Z)(function*(m){if(e.itemAttributeName&&!m.canceled){const _=yield m.getLookupValues(),f=e.features?.select?.multiple?_:_[0];r[e.itemAttributeName]=f}e?.afterClosed?.(m)});return function(m){return u.apply(this,arguments)}}())})()}handle(e){var t=this;return(0,d.Z)(function*(){t._featureValues.DisableOpenLookupPageHandlerInZone?yield t._openLookupPage(e):yield t._injector.get(s.NgZone).run(()=>t._openLookupPage(e)),yield t.next?.handle(e)})()}};Yt=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.OpenSelectionWindowRequest",type:"crt.OpenSelectionWindowHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Yt);let ea=class extends o.BaseRequestHandler{_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.dataSchemas[t]}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.itemsAttributeName)}handle(e){var t=this;return(0,d.Z)(function*(){const a=t._getDataSchema(e),r={type:"crt.7XRequest",action:"OpenLookupSource",$context:e.$context,payload:{entitySchemaName:e.schemaName??a?.name,displayValue:a?.caption.toString()}};yield t.handlerChain.process(r)})()}};ea=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.OpenLookupSourceRequest",type:"crt.OpenLookupSourceHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards]})],ea);let ta=class extends o.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}handle(e){var t=this;return(0,d.Z)(function*(){if(!e.schemaName){t._messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}});return}const a={type:"crt.7XRequest",action:"OpenPage",$context:e.$context,payload:{schemaName:e.schemaName,modelInitConfigs:(0,E.cloneDeep)(e.modelInitConfigs),parameters:(0,E.cloneDeep)(e.parameters)}};return t.handlerChain.process(a)})()}};ta=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.OpenPageRequest",type:"crt.OpenPageHandler"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],ta);var Rs=v(66219);let aa=class extends o.BaseRequestHandler{constructor(e){super(),this.injector=e,this.alignModalFunc=(t,a,r)=>{t.forEach(n=>{n.contentRect.height>0&&n.contentRect.width>0&&this._positionDialog(this._dialogRef,a,r)})},this._modalService=e.get(R.Lu),this._router=e.get(A.CrtRouter)}_createModalInjector(e){return s.Injector.create({parent:this.injector,providers:[{provide:h.EntitySchemaService,useClass:h.EntitySchemaService},{provide:D.ProfileSchemaLoaderService,useClass:D.ProfileSchemaLoaderService},{provide:D.ProfileSchemaLocalizationService,useClass:D.ProfileSchemaLocalizationService},D.SCHEMA_LOCALIZATION_SERVICE_FACTORY_PROVIDER]})}_closeDialog(e){this._resizeObserver.disconnect(),e?.close(),this._dialogRef=null}_positionDialog(e,t,a){let r=t,n=a;const c=e?.componentInstance?.componentContainer?.element?.nativeElement?.parentElement?.parentElement;t+c?.offsetWidth>window.innerWidth&&(r=t-c?.offsetWidth),a+c?.offsetHeight>window.innerHeight&&(n=window.innerHeight-c?.offsetHeight),e.updatePosition({left:`${r}px`,top:`${n}px`}),c.style.visibility="visible"}handle(e){var t=this;return(0,d.Z)(function*(){const a=t._createModalInjector(e);t._dialogRef&&t._closeDialog(t._dialogRef),t._dialogRef=yield t._modalService.show({schemaName:e.schemaName,recordId:e.recordId,action:o.ModelInPageAction.Edit},{injector:a}),t._resizeObserver=new Rs.Z(n=>t.alignModalFunc(n,e.offsetX,e.offsetY));const r=t._dialogRef?.componentInstance?.componentContainer?.element?.nativeElement?.parentElement?.parentElement;r.style.visibility="hidden",r.style.zIndex=9999,t._dialogRef.afterOpened().subscribe(()=>{t._resizeObserver.observe(r)}),t._dialogRef.backdropClick().subscribe(n=>t._closeDialog(t._dialogRef)),t._router.navigateStart$.subscribe(n=>t._closeDialog(t._dialogRef)),yield t.next?.handle(e)})()}};aa=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.OpenPositionedPageRequest",type:"crt.OpenPositionedPageHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],aa);let ra=class extends o.BaseRequestHandler{_getDSPrimaryAttributeName(e,t){const a=e.dataSchemas[t];return e.getViewModelAttributePath(t,a.primaryAttributeName)}_setAttributeValue(e,t,a,r=!1){e[t]=a,r&&e.getControl(t).formControl.markAsPristine()}_loadDataSource(e,t,a=[]){var r=this;return(0,d.Z)(function*(){yield r.handlerChain.process({type:"crt.LoadDataRequest",$context:t,dataSourceName:e,parameters:a})})()}_loadDS(e,t){var a=this;return(0,d.Z)(function*(){const r=t.name,n=e.dataSchemas[r],c=e.getViewModelAttributePath(r,n.primaryAttributeName);yield a._loadDataSource(r,e,[{type:o.ModelParameterType.PrimaryColumnValue,value:c}])})()}_copyDS(e,t,a,r){var n=this;return(0,d.Z)(function*(){yield n.handlerChain.process({type:"crt.CopyDataRequest",$context:e,dataSourceName:t,recordId:a,copiedValues:r})})()}_initModelInEditModeAsync(e,t){var a=this;return(0,d.Z)(function*(){const{name:r,recordId:n}=t,c=a._getDSPrimaryAttributeName(e,r);a._setAttributeValue(e,c,n,!0),yield a._loadDS(e,t)})()}_initModelInAddingModeAsync(e,t){return(0,d.Z)(function*(){yield dr(e,t)})()}_initModelInCopyModeAsync(e,t){var a=this;return(0,d.Z)(function*(){const{name:r,recordId:n}=t,c=yield lr(e,t);yield a._copyDS(e,r,n,c)})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=a.modelInitConfigs||[],n=yield a.getPrimaryModelName(),c=a._getModelNamesByLoadType(h.DataSourceLoadingType.OnInit);r.forEach(u=>{const m=u.action;if(u.name=u.name||n,!u.name)return;m===o.ModelInPageAction.Edit?t._initModelInEditModeAsync(a,u):m===o.ModelInPageAction.Add?t._initModelInAddingModeAsync(a,u):m===o.ModelInPageAction.Copy?t._initModelInCopyModeAsync(a,u):t._loadDataSource(u.name,a);const _=c.indexOf(u.name);_>-1&&c.splice(_,1)}),c.forEach(u=>{t._loadDataSource(u,a)}),yield t.next?.handle(e)})()}};ra=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.PageInitHandler",requestType:"crt.HandleViewModelInitRequest"})],ra);let sa=class extends o.BaseRequestHandler{constructor(e){super(),this._customEventService=e}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.phoneNumber;return t._customEventService.createOutboundChannel("PhoneLinkClick").next(a),t.next?.handle(e)})()}};sa=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.PhoneLinkClickHandler",requestType:"crt.PhoneLinkClickRequest",scopes:[]}),(0,l.__metadata)("design:paramtypes",[N.CustomEventService])],sa);let na=class extends o.BaseRequestHandler{_setTopRecord(e,t,a,r,n){var c=this;return(0,d.Z)(function*(){yield c._actionToCurrentDataSourceCollection(e,t,function(){var u=(0,d.Z)(function*(m,_){if(r===S.MoveNewRecordTo.Begin){const f=_.find(y=>y.attributes[y.primaryAttributeName]===a.value);_.moveTo(f,0)}yield c._processSetTopRecordRequest(e,m,a,n)});return function(m,_){return u.apply(this,arguments)}}())})()}_actionToCurrentDataSourceCollection(e,t,a){return(0,d.Z)(function*(){for(const[r,n]of Object.entries(e.attributes))n instanceof S.BaseViewModelCollection&&e.getBoundDataSourceNameByAttributePath(r)===t&&(yield a(r,n))})()}_checkIfRecordExists(e,t,a){var r=this;return(0,d.Z)(function*(){let n=!1;return yield r._actionToCurrentDataSourceCollection(e,t,function(){var c=(0,d.Z)(function*(u,m){const _=a.value;n=(yield m.findByPrimaryAttribute(_))!==void 0});return function(u,m){return c.apply(this,arguments)}}()),n})()}_processSetTopRecordRequest(e,t,a,r){var n=this;return(0,d.Z)(function*(){const c={type:"crt.SetTopRecordRequest",$context:e,itemsAttributeName:t,primaryAttributeValue:a,scopes:r??e._scopes};yield n.handlerChain.process(c)})()}_onRecordUpdated(e,t,a,r=null){var n=this;return(0,d.Z)(function*(){return yield n.handlerChain.process({type:"crt.LoadDataRequest",$context:e,dataSourceName:t,parameters:[{type:o.ModelParameterType.PrimaryColumnValue,value:"@requestPayload.primaryColumnValue"}],config:{loadType:o.DataSourceLoadType.Load,doNotUpdateLastLoadParameters:!0,payload:{primaryColumnValue:a,attributes:r}}})})()}_onRecordCreated(e,t,a,r,n,c=S.MoveNewRecordTo.Begin){var u=this;return(0,d.Z)(function*(){(yield u._onRecordUpdated(e,t,a))?.[0]?.[r.primaryAttributeName]===a.value&&(yield u._setTopRecord(e,t,a,c,n))})()}_refreshPageData(e,t,a,r){var n=this;return(0,d.Z)(function*(){const c=e.dataSchemas[t],u=a.modelEvent.payload?.changedAttributes||[];if(u.length===0||a.modelEvent.type!==S.ModelEventType.Update)return Promise.resolve(null);if(r)for(const m of r){const _=m.find(f=>f.name===c.primaryAttributeName);yield n._onRecordUpdated(e,t,_,u)}else yield n._onRecordUpdated(e,t,null,u)})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=e.modelEvent.payload?.primaryAttributesValues,n=e.modelName;if(!a.getModelByName(n).isLoaded)return t.next?.handle(e);if(!a.isDataSourceForCollection(n))return yield t._refreshPageData(a,n,e,r),t.next?.handle(e);if([S.ModelEventType.Create,S.ModelEventType.Update].includes(e.modelEvent.type)){const u=a.dataSchemas[n];for(const m of r){const _=m.find(y=>y.name===u.primaryAttributeName),f=yield t._checkIfRecordExists(a,n,_);e.modelEvent.type===S.ModelEventType.Create&&!f?yield t._onRecordCreated(a,n,_,u,e.scopes,e.moveNewRecordTo):yield t._onRecordUpdated(a,n,_)}}return t.next?.handle(e)})()}};na=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleModelEventRequest",type:"crt.ViewModelCollectionRecordChangedHandler"})],na);let oa=class extends o.BaseRequestHandler{constructor(e,t){super(),this._processEngineService=e,this._notifyService=t}_getPrimaryDsId(e){return(0,d.Z)(function*(){const t=e.$context,a=yield t.getPrimaryModelName(),r=t.dataSchemas[a];if(!r||!a)return;const n=t.getViewModelAttributePath(a,r.primaryAttributeName);return e.$context[n]})()}_applyRecordIdToProcessParameters(e){var t=this;return(0,d.Z)(function*(){if(e.recordIdProcessParameterName){const a=yield t._getPrimaryDsId(e);if(a){const r=(0,E.cloneDeep)(e.processParameters)??{};return r[e.recordIdProcessParameterName]=a,r}}return e.processParameters})()}_getSortingColumns(e){return e?.sorting?e.sorting.reduce((t,{columnName:a,direction:r})=>(t[a]=r,t),{}):null}_showNotification(e){var t=this;return(0,d.Z)(function*(){if(e.showNotification){const a=e.notificationText??"RunProcessHandler.ProcessHasStarted";yield t._notifyService.show({message:a,translate:!e.notificationText})}})()}_clearSelectionState(e){if(e.selectionStateAttributeName)return this.handlerChain.process({type:"crt.ChangeViewModelAttributeValueRequest",scopes:e.scopes,$context:e.$context,attributeName:e.selectionStateAttributeName,attributeValue:null})}_handleRequest(e,t){var a=this;return(0,d.Z)(function*(){const r=e.processName;let n;if(e.processRunType===S.RunProcessType.ForTheSelectedRecords){const m=e.$context.dataSchemas[e.dataSourceName];if(!e.filters){const y=e.activeRow;if(y){const I=new o.FilterGroup;I.addPrimarySchemaColumnInFilter([y],"activeRowFilter"),e={...e,filters:I.toJson()}}else return yield a._notifyService.show({message:"RunProcessHandler.CannotRunProcess.NoRecordsSelected"}),null}let _=null;e.parameterMappings&&(_=Object.keys(e.parameterMappings)[0]);const f={processName:r,entitySchemaName:m.name,filterConfig:e.filters,sortingColumns:a._getSortingColumns(e),inputParameterName:_};n=a._processEngineService.executeProcessForMatchingRecords(f),yield a._clearSelectionState(e)}else n=a._processEngineService.executeProcessByName(r,t,e.resultParameterNames);const c=yield(0,p.lastValueFrom)(n);return c?.success?yield a._showNotification(e):yield a._notifyService.error({message:c.errorInfo?.message??"Failed to start process"}),c})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=yield t._applyRecordIdToProcessParameters(e);return t._handleRequest(e,a)})()}};oa=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.RunBusinessProcessHandler",requestType:"crt.RunBusinessProcessRequest"}),(0,l.__metadata)("design:paramtypes",[C.ProcessEngineService,b.NotifyService])],oa);let Rr=class extends o.BaseRequest{constructor(){super(...arguments),this.type="crt.SaveAttributeToProfileRequest"}};Rr=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.SaveAttributeToProfileRequest"})],Rr);let ia=class extends o.BaseRequestHandler{constructor(e){super(),this._schemaPartsService=e}handle(e){var t=this;return(0,d.Z)(function*(){const{profileAttributeName:a}=e;if(!a)return;const r=yield e.$context[a];yield t._schemaPartsService.apply(([n])=>{const c={attribute:a,config:{value:r}};return n.setViewModelAttribute(c.attribute,c.config),Promise.resolve()}),yield t._schemaPartsService.commit()})()}};ia=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.SaveAttributeToProfileHandler",requestType:"crt.SaveAttributeToProfileRequest"}),(0,l.__metadata)("design:paramtypes",[D.SchemaPartsService])],ia);let ca=class extends o.BaseRequestHandler{constructor(e,t){super(),this._notifyService=e,this._maskService=t,this._taskName="DETAILS_SAVING"}_saveRecordData(e){var t=this;return(0,d.Z)(function*(){return(yield t._hasUnsavedData(e.$context))?yield t.next?.handle(e):!0})()}_saveDetailsData(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getUnsavedDetailsData(e);return a?.length>0?t._processSaveDetails(e,a):!0})()}_processSaveDetails(e,t){var a=this;return(0,d.Z)(function*(){yield a._maskService.showMask(a._taskName,e);const r=[];try{const c=(yield Promise.all(t.map(u=>a._saveDetail(u)))).filter(u=>!u.success);c.length>0&&a._displayErrorDialog(c.map(u=>u.message)),r.push(...c.map(u=>u.detailId))}finally{e[S.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]=t.filter(n=>r.includes(n.detailId)),a._maskService.hideMask(a._taskName,e)}return r.length===0})()}_saveDetail(e){return e.saveChanges().then(()=>({detailId:e.detailId,success:!0})).catch(t=>({detailId:e.detailId,success:!1,message:t.message}))}_getUnsavedDetailsData(e){return(0,d.Z)(function*(){return yield e[S.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]})()}_hasUnsavedData(e){return e[S.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME]}_displayErrorDialog(e){const t=e.join(". ");this._notifyService.error({message:t,translate:!1})}handle(e){var t=this;return(0,d.Z)(function*(){return(yield t._saveRecordData(e))?yield t._saveDetailsData(e.$context):!1})()}};ca=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.SaveRecordAnd7XDetailHandler",scopes:["ProductConditions_FormPage","OpportunityConditions_FormPage"]}),(0,l.__param)(1,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[b.NotifyService,o.MaskService])],ca);let la=class extends o.BaseRequestHandler{constructor(e,t){super(),this._notifyService=e,this._maskService=t}_savePrimaryData(e){var t=this;return(0,d.Z)(function*(){const a={type:"crt.SavePrimaryDataRequest",$context:e.$context,scopes:e.scopes},r=yield t.handlerChain.process(a);return ir(r)})()}_sendCardResponse(e,t){var a=this;return(0,d.Z)(function*(){const r=yield e.getPrimaryModelName();if(!r)return;const n=yield e.getPrimaryDataSchema();if(!n?.primaryAttributeName)return;const c=e.getViewModelAttributePath(r,n.primaryAttributeName),u=e.getViewModelAttributePath(r,n.primaryDisplayAttributeName),m={type:"crt.7XRequest",action:"CardResponse",payload:{action:e[H],success:t,primaryDisplayColumnName:n.primaryDisplayAttributeName,uId:yield e[c],primaryColumnValue:yield e[c],primaryDisplayColumnValue:yield e[u],referenceSchemaName:e.dataSchemas[r]?.dataSourceConfig?.config?.entitySchemaName},$context:e};return a.handlerChain.process(m)})()}_displayErrorDialog(e){const t=e?.message;t&&this._notifyService.show({message:t,translate:!1})}handle(e){var t=this;return(0,d.Z)(function*(){const a="RECORD_SAVING";yield t._maskService.showMask(a,e.$context);try{const r=yield t._savePrimaryData(e);if(!r.success)throw new Error(r.errorInfo);return yield t._sendCardResponse(e.$context,!0),e.$context.IsChanged=!1,!0}catch(r){return t._displayErrorDialog(r),!1}finally{t._maskService.hideMask(a,e.$context),yield t.next?.handle(e)}})()}};la=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.SaveRecordHandler"}),(0,l.__param)(1,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[b.NotifyService,o.MaskService])],la);let da=class extends o.BaseRequestHandler{constructor(e,t){super(),this._notifyService=e,this._maskService=t}_saveCollectionPrimaryDataResult(e){var t=this;return(0,d.Z)(function*(){const a={type:"crt.SaveCollectionPrimaryDataRequest",$context:e.$context,primaryAttributeValues:e.recordIds,collectionAttributeName:e.itemsAttributeName};return yield t.handlerChain.process(a)})()}_displayErrorDialog(e){const t=e?.message;t&&this._notifyService.show({message:t,translate:!1})}_getFirstErrorInfoFromSaveDataResult(e){return e.find(t=>!t.success).errorInfo}_reloadDependentModels(e){const t=e.$context,a=t.getBoundDataSourceNameByAttributePath(e.itemsAttributeName),r=t.getModelByName(a);r&&t._reloadDependentModels(r,[])}handle(e){var t=this;return(0,d.Z)(function*(){const a="RECORDS_SAVING_"+e.itemsAttributeName+"_"+(e.recordIds??[]).join("_");yield t._maskService.showMask(a,e.$context);try{const r=yield t._saveCollectionPrimaryDataResult(e);if(ir(r).success)return t._reloadDependentModels(e),!0;const c=t._getFirstErrorInfoFromSaveDataResult(r);throw new Error(c)}catch(r){return t._displayErrorDialog(r),!1}finally{t._maskService.hideMask(a,e.$context)}})()}};da=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SaveRecordsRequest",type:"crt.SaveRecordsHandler"}),(0,l.__param)(1,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[b.NotifyService,o.MaskService])],da);class Tr extends o.BaseRequestHandler{_isNotAllowedTarget(e){return(0,E.isEmpty)(e)||!e.columns||!(0,E.isEmpty)(e)&&Array.isArray(e.columns)&&e.columns.length!==1}_getFilteredColumnFromTarget(e,t){const a=e.getBoundDataSchemaByAttributePath(t.viewAttributeName),r=t.columns.slice().shift();let n;if(typeof r=="string")n=r;else{const u=e.getAttributeViewModelConfig(t.viewAttributeName);n=this.getAttributeNameByColumn(u,r)}const c=this.findAttributeInDataSchema(a,n);return(0,h.isAllowedTypeSearchColumn)(c)?n:g.VIRTUAL_ALL_OPTION_ID}findAttributeInDataSchema(e,t){return e.attributes?.find(a=>a.name===t)}getFilteredColumnFromTarget(e,t){return this._isNotAllowedTarget(t)?g.VIRTUAL_ALL_OPTION_ID:this._getFilteredColumnFromTarget(e,t)}getAttributeNameByColumn(e,t){const a=e[t.code]??{};return(0,S.isModelAttributeConfig)(a)?a?.modelConfig?.path?.split(".").slice(1).join(".")??"":""}}let ua=class extends Tr{_getFilteredColumnFromRequest(e,t){const a=this._getSearchFilterTargetFromRequest(t);return this.getFilteredColumnFromTarget(e,a)}_getSearchFilterTargetFromRequest(e){return this._createSearchFilterTargets(e.searchFilterGroups,e.searchFilterColumnsGroups).slice().shift()}_createSearchFilterTargets(e,t){return e.map(a=>({filterAttributeName:a.filterAttributeName,viewAttributeName:a.viewAttributeName,columns:(0,g.getColumnsNamesOfSearchFilteredColumnsGroups)(a.viewAttributeName,t)}))}handle(e){const t=e.$context;return(0,p.lastValueFrom)(t.setValue({[e.searchValueAttributeName]:e.value,[e.searchFilteredColumnAttributeName]:this._getFilteredColumnFromRequest(t,e),[e.searchFilteredColumnsGroupsAttributeName]:e.searchFilterColumnsGroups}))}};ua=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SearchFilterColumnsGroupsRequest",type:"crt.SearchFilterColumnsGroupsHandler"})],ua);let ma=class extends Tr{constructor(e){super(),this._searchFilterBuilder=e}_buildFiltersAndSet(e,t){var a=this;return(0,d.Z)(function*(){const r=[];for(const n of t?.searchFilterTargets||[])!n.columns||r.push(e.setValue({[n.filterAttributeName]:yield a._searchFilterBuilder.buildFilter(e,t.value,n.columns,n.viewAttributeName)}));return Promise.all(r)})()}_setSearchFilterValueToAttribute(e,t){return(0,d.Z)(function*(){const a=t.searchValueAttributeName;!a||(yield(0,p.firstValueFrom)(e.setValue({[a]:t.value})))})()}_setSearchFilteredColumnToAttribute(e,t){var a=this;return(0,d.Z)(function*(){const r=t.searchFilteredColumnAttributeName;!r||(yield(0,p.firstValueFrom)(e.setValue({[r]:a._getFilteredColumnFromRequest(e,t)})))})()}_getFilteredColumnFromRequest(e,t){const a=t.searchFilterTargets.slice().shift();return this.getFilteredColumnFromTarget(e,a)}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context;return yield t._setSearchFilterValueToAttribute(a,e),yield t._setSearchFilteredColumnToAttribute(a,e),t._buildFiltersAndSet(a,e)})()}};ma=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SearchFilterRequest",type:"crt.SearchFilterHandler"}),(0,l.__metadata)("design:paramtypes",[g.SearchFilterBuilderService])],ma);let pa=class extends ur{constructor(e,t){super(),this._configurationDataService=e,this._navigationService=t}_getModuleCaption(){var e=this;return(0,d.Z)(function*(){const t=yield(0,p.lastValueFrom)(e._configurationDataService.getData()),a=e._navigationService.getActiveRouteInfo();return e._getModuleStructureBySectionSchema(a.schemaName,t?.data)?.moduleCaption})()}_getModuleStructureBySectionSchema(e,t){return Object.values(t.modulesStructure).find(a=>a.sectionSchema===e)}getPrimaryName(e){const t=cr(e.$context);return Promise.resolve(t)}initDataViews(e){var t=()=>super.initDataViews,a=this;return(0,d.Z)(function*(){const r=yield a._getModuleCaption();return r&&(e.$context[ee]=r),t().call(a,e)})()}handle(e){var t=this;return(0,d.Z)(function*(){return yield t.initDataViews(e),t.next?.handle(e)})()}};pa=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleViewModelInitRequest",type:"crt.SectionInitHandler",scopes:[S.Scopes.AllSections]}),(0,l.__metadata)("design:paramtypes",[C.ConfigurationDataService,A.CrtNavigationService])],pa);let ha=class extends o.BaseRequestHandler{constructor(e,t,a){super(),this._window=e,this._fileProcessingService=t,this._messageDialogProvider=a}_checkErrorsAndShowMessage(e){const t=this._fileProcessingService.createFileErrorMessageForLogs(e);t&&this._messageDialogProvider.open({data:{message:t,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}_onFileSelected(e,t){var a=this;return(0,d.Z)(function*(){const r=yield a._fileProcessingService.processSelectedFiles(e,t.maximumAllowedFileSize);return t.displayErrors&&r.errors&&a._checkErrorsAndShowMessage(r.errors),r})()}_createInputElement(e,t){const a=e.createElement("input");return a.id="file-upload-input",a.type="file",a.multiple=t.multiple??!1,a.accept=t.allowedFileTypes??"",a.setAttribute("style","display: none"),a}_removeInputElement(e,t){setTimeout(()=>{delete t.onchange,e.documentElement.removeChild(t)},1e3)}handle(e){const t=this._window.document,a=this._createInputElement(t,e),r=new Promise(n=>{a.onchange=c=>{n(this._onFileSelected(Array.from(c.target.files),e))},a.oncancel=()=>{n({files:[],errors:[]})}});return t.documentElement.appendChild(a),setTimeout(()=>{a.click()},70),this._removeInputElement(t,a),r}};ha=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SelectFileRequest",type:"crt.SelectFileHandler"}),(0,l.__param)(0,(0,o.CrtInject)(N.WINDOW_TOKEN)),(0,l.__metadata)("design:paramtypes",[Object,R.dO,g.MessageDialogProvider])],ha);let ga=class extends o.BaseRequestHandler{constructor(e,t,a){super(),this._dialogRef=e,this._pageLookupData=t,this._injector=a}_instantiate(e){return(0,o.instantiate)(e,t=>this._injector.get(t))}_getLookupValues(e,t,a){if(!t)return Promise.resolve([]);if(this._pageLookupData.features?.select?.selectAll===!0||t.type==="all")throw new Error("Opening lookup page with features { resultType: 'lookupValues', selectAll: true, ... } is not supported. Use { resultType: 'lookupValues', selectAll: false, ... } or { resultType: 'filter', selectAll: true, ... } instead.");const r=this._instantiate(D.ToLookupConverter),n=e.getBoundDataSchemaByAttributePath(a);return r.convert(t.selected,e,n.name)}_getFilters(e,t,a){var r=this;return(0,d.Z)(function*(){if(!t||t.type==="specific"&&!t.selected?.length)return r._pageLookupData.returnEmptyValue?{isEmpty:!0}:void 0;const n=yield e[a];return r._instantiate(Ee).convert(n,e,a,t)})()}_handleLegacy(e){var t=this;return(0,d.Z)(function*(){let a;const r=e.$context,n=e.viewName||$,c=`${n}_${g.GRID_SELECTION_STATE_ATTRIBUTE_NAME}`,u=yield r[c],m=t._pageLookupData.features?.select?.resultType;if(!m||m===T.pb.LookupValues){const _=yield t._getLookupValues(r,u,n);a=t._pageLookupData.features?.select?.multiple?_:_[0]}else if(m===T.pb.Filter)a=yield t._getFilters(r,u,n);else{const _=[T.pb.LookupValues,T.pb.Filter].join(", ");throw new Error(`Invalid lookup page resultType ${m}. Available values: ${_}`)}yield t.next?.handle(e),t._dialogRef.close(a)})()}_handleWithNewApi(e){var t=this;return(0,d.Z)(function*(){const a={...e,type:"crt.SelectSelectionWindowRequest"};yield t.handlerChain.process(a)})()}handle(e){var t=this;return(0,d.Z)(function*(){t._pageLookupData.selectionApiMode===T.dh.Legacy?yield t._handleLegacy(e):yield t._handleWithNewApi(e)})()}};ga=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SelectLookupPageRequest",type:"crt.SelectLookupPageHandler",scopes:["BaseLookupPageTemplate"]}),(0,l.__param)(1,(0,o.CrtInject)(T.HO)),(0,l.__metadata)("design:paramtypes",[Te.MatLegacyDialogRef,Object,s.Injector])],ga);let _a=class extends o.BaseRequestHandler{constructor(e,t,a){super(),this._dialogRef=e,this._pageLookupData=t,this._injector=a}_instantiate(e){return(0,o.instantiate)(e,t=>this._injector.get(t))}_getFilters(e,t,a){var r=this;return(0,d.Z)(function*(){if(!t||t.type==="specific"&&!t.selected?.length)return r._pageLookupData.returnEmptyValue?{isEmpty:!0}:void 0;const n=yield e[a];return r._instantiate(Ee).convert(n,e,a,t)})()}_getLookupValuesFromContext(e,t,a){if(!e?.length)return[];const r=this._instantiate(D.ToLookupConverter),u=(Array.isArray(e)?e:[e]).filter(o.isGuid),m=r.getLookupValuesFromContext(u,t,a),{lookupValues:_}=m;return _}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=e.viewName||$,n=`${r}_${g.GRID_SELECTION_STATE_ATTRIBUTE_NAME}`,c=yield a[n],u=yield t._getFilters(a,c,r),m=a.getBoundDataSchemaByAttributePath(r),_=t._getLookupValuesFromContext(c?.selected??[],a,m.name),f=new T.Vr({entityName:m.name,selectionState:c,filter:u,cachedLookupValues:_});yield t.next?.handle(e),t._dialogRef.close(f)})()}};_a=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SelectSelectionWindowRequest",type:"crt.SelectSelectionWindowHandler",scopes:["BaseLookupPageTemplate"]}),(0,l.__param)(1,(0,o.CrtInject)(T.HO)),(0,l.__metadata)("design:paramtypes",[Te.MatLegacyDialogRef,Object,s.Injector])],_a);let Sa=class extends o.BaseRequestHandler{constructor(e){super(),this._schemaService=e}_getViewElementsViewConfigs(e){if(!e)return[];if("modelName"in e&&e.modelName){const t=this._schemaService.findAllAttributesByDataSourceAttributePath(e.modelName)?.filter(Boolean)?.map(a=>`$${a}`);return t?.length?this._schemaService.getViewConfigInfoByPropertyValues(t)?.map(a=>a?.viewConfig):[]}return[]}_getViewElementsSelectionOptions(e){return(this._getViewElementsViewConfigs(e)??[]).map(a=>{if(a.type==="crt.DataGrid"&&!a?._selectionOptions){const r=(0,E.cloneDeep)(a);r.selectionState??(r.selectionState=`$${(0,g.createDataGridSelectionStateAttributeName)(r)}`);const n=(0,g.createDataGridInitialSelectionOptions)(r);return n&&(r._selectionOptions=n),r}return a}).filter(a=>Boolean(a?._selectionOptions)).map(a=>a._selectionOptions)}_cleanupSelectionState(e,t){var a=this;return(0,d.Z)(function*(){const{scopes:r,target:n,$context:c}=t;if(!(yield a._isCleanupSelectionAvailable(e,n,c)))return;const m={type:"crt.ChangeViewModelAttributeValueRequest",scopes:r,$context:c,attributeName:e,attributeValue:null};return a.handlerChain.process(m)})()}_isCleanupSelectionAvailable(e,t,a){return(0,d.Z)(function*(){const r=t?.type;if(!r?.length)return!0;const n=yield a[e];return n?.type?r.includes(n.type):!0})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=t._getViewElementsSelectionOptions(e.target).map(r=>(0,D.getSourceSelectionStateAttributeName)(r)).filter(Boolean).map(r=>t._cleanupSelectionState(r,e));return yield Promise.all(a),t.next?.handle(e)})()}};Sa=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CleanupSelectionStateHandler",requestType:"crt.CleanupSelectionStateRequest"}),(0,l.__metadata)("design:paramtypes",[D.SchemaService])],Sa);let fa=class extends o.BaseRequestHandler{_cleanupSelectionState(e){const{scopes:t,$context:a,modelName:r}=e,n={type:"crt.CleanupSelectionStateRequest",scopes:t,$context:a,target:{modelName:r}};return this.handlerChain.process(n)}handle(e){var t=this;return(0,d.Z)(function*(){const{modelName:a,modelEvent:r}=e,n=e.$context;if(!a||!n.isDataSourceForCollection(a))return t.next?.handle(e);const c=r?.type;return(c===S.ModelEventType.Create||c===S.ModelEventType.Delete)&&(yield t._cleanupSelectionState(e)),t.next?.handle(e)})()}};fa=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CleanupSelectionStateWhenCreatingDeletingDataHandler",requestType:"crt.HandleModelEventRequest"})],fa);const Ts="CleanupAllSelectionWhenReloadingData",Es="CleanupSpecificSelectionWhenReloadingData";let va=class extends o.BaseRequestHandler{constructor(e){super(),this._isCleanupAllSelectionEnabled=Boolean(e?.[Ts]),this._isCleanupSpecificSelectionEnabled=Boolean(e?.[Es])}_getCleanupSelectionTargetTypes(){const e=[];return this._isCleanupAllSelectionEnabled&&e.push("all"),this._isCleanupSpecificSelectionEnabled&&e.push("specific"),e}_cleanupSelectionStates(e){const{scopes:t,$context:a,dataSourceName:r}=e;if(!r)return Promise.resolve();const n={type:"crt.CleanupSelectionStateRequest",scopes:t,$context:a,target:{type:this._getCleanupSelectionTargetTypes(),modelName:r}};return this.handlerChain.process(n)}handle(e){var t=this;return(0,d.Z)(function*(){return!t._isCleanupAllSelectionEnabled&&!t._isCleanupSpecificSelectionEnabled||(0,S.isDataReloading)(e)&&(yield t._cleanupSelectionStates(e)),t.next?.handle(e)})()}};va=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.CleanupSelectionStateWhenReloadingDataHandler",requestType:"crt.LoadDataRequest"}),(0,l.__param)(0,(0,s.Inject)(h.FEATURE_VALUES)),(0,l.__param)(0,(0,o.CrtInject)(h.FEATURE_VALUES)),(0,l.__metadata)("design:paramtypes",[h.FeatureValues])],va);let Ca=class extends o.BaseRequestHandler{constructor(e,t){super(),this._messageDialogProvider=e,this._modalProvider=t,this._maskName="SetRecordRightsHandlerMask"}_getDataSchemaAttributeValue(e,t){return(0,d.Z)(function*(){const a=yield e.getPrimaryModelName(),r=e.getViewModelAttributePath(a,t);return e[r]})()}_getLoadRightsModuleParameters(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=yield a.getPrimaryDataSchema();return{primaryColumnValue:yield t._getDataSchemaAttributeValue(a,r.primaryAttributeName),primaryDisplayColumnValue:yield t._getDataSchemaAttributeValue(a,r.primaryDisplayAttributeName),entitySchemaName:r.name,hideAdditionalLookupButtons:e.openInModalWindow}})()}_saveViewModelIfNeed(e){var t=this;return(0,d.Z)(function*(){const{$context:a,scopes:r}=e;if((yield a[H])===o.ModelInPageAction.Edit&&!e.openInModalWindow)return!0;const c={type:"crt.SaveRecordRequest",preventCardClose:e.openInModalWindow,scopes:r,$context:a};return t.handlerChain.process(c)})()}_showSettingsErrorDialog(){var e=this;return(0,d.Z)(function*(){yield(0,p.firstValueFrom)(e._messageDialogProvider.open({data:{message:"InfoDialog.SetRecordRights.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}))})()}_isHasPrimaryDataSource(e){return(0,d.Z)(function*(){return!!(yield e.$context.getPrimaryModelName())})()}_openLoadRightsModule(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getLoadRightsModuleParameters(e),{$context:r,scopes:n}=e,c={type:"crt.LoadRightsModuleRequest",scopes:n,$context:r,payload:a};return t.handlerChain.process(c)})()}_openModalWindowRightsModule(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getLoadRightsModuleParameters(e);t._modalProvider.open(g.CrtRightsComponent,{data:a,panelClass:"crt-rights-modal",disableClose:!0})})()}handle(e){var t=this;return(0,d.Z)(function*(){if(!(yield t._isHasPrimaryDataSource(e))){t._showSettingsErrorDialog();return}if(!!(yield t._saveViewModelIfNeed(e)))return e.openInModalWindow?t._openModalWindowRightsModule(e):t._openLoadRightsModule(e)})()}};Ca=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SetRecordRightsRequest",type:"crt.SetRecordRightsRequest"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,g.ModalProvider])],Ca);let Er=class extends o.BaseRequest{};Er=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.ShowDialogRequest"})],Er);let ya=class extends o.BaseRequestHandler{constructor(e){super(),this._messageDialogProvider=e}handle(e){return(0,p.firstValueFrom)(this._messageDialogProvider.open(e.dialogConfig))}};ya=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.ShowDialogRequest",type:"crt.ShowDialogHandler"}),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider])],ya);let Ra=class extends o.BaseRequestHandler{_isValidRequiredRequestParameters(e){return!!e.tagIds?.length&&!!e.recordId&&((0,g.isOldStructure)(e)||!!e.recordSchemaName)}_insertTagsInRecordModel(e){var t=this;return(0,d.Z)(function*(){const a=yield(0,p.lastValueFrom)(t._createTagInRecordModel(e));return t._createInsertDtoArray(e).map(r=>a.insert(r))})()}_createTagInRecordModel(e){return(0,g.isOldStructure)(e)?S.Model.create(e.tagInRecordSourceSchemaName):S.Model.create(g.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME)}_createInsertDtoArray(e){return e.tagIds.map(t=>({Tag:t})).map(t=>this._getCreateDtoFunction(e)(e,t))}_getCreateDtoFunction(e){return(0,g.isOldStructure)(e)?this._createOldStructureDto:this._createNewStructureDto}_createOldStructureDto(e,t){return{...t,[g.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA]:e.recordId}}_createNewStructureDto(e,t){return{...t,[g.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA]:e.recordId,RecordSchemaName:e.recordSchemaName}}handle(e){var t=this;return(0,d.Z)(function*(){if(!t._isValidRequiredRequestParameters(e))return;const a=e.$context;return(0,p.lastValueFrom)((0,p.forkJoin)(yield t._insertTagsInRecordModel(e)).pipe((0,p.switchMap)(()=>a.load(e.dataSourceName,[],{loadType:o.DataSourceLoadType.Reload})),(0,p.catchError)(()=>(0,p.of)())),{defaultValue:null})})()}};Ra=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.AddTagsInRecordRequest",type:"crt.AddTagsInRecordHandler"})],Ra);let Ta=class extends o.BaseRequestHandler{handle(e){return(0,d.Z)(function*(){const t=e.$context;return yield(0,p.lastValueFrom)(t.delete(e.dataSourceName,[{type:o.ModelParameterType.PrimaryColumnValue,value:e.id}]).pipe((0,p.catchError)(()=>(0,p.of)()))),(0,p.lastValueFrom)(t.load(e.dataSourceName,[],{loadType:o.DataSourceLoadType.Reload}))})()}};Ta=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.DeleteTagInRecordRequest",type:"crt.DeleteTagInRecordHandler"})],Ta);let Ea=class extends o.BaseRequestHandler{handle(e){if(e.action!=="InitDataViews")return this.next?.handle(e)}};Ea=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.7XRequest",type:"crt.OldTag7XRequestHandler",scopes:["OldTagMiniPage"]})],Ea);const Ds=[{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:ue,deps:[be],multi:!0},{provide:S.CRT_METADATA_NAVIGATION_PREPROCESSOR,useClass:me,deps:[C.RightsService],multi:!0}];let Da=class extends o.BaseRequestHandler{constructor(e){super(),this._injector=e,this._schemaModalService=e.get(R.Lu)}_createModalInjector(e){return s.Injector.create({parent:this._injector,providers:[{provide:be,useValue:{entitySchemaName:e.entitySchemaName},deps:[]},...Ds]})}_createSchemaModalConfig(e){return{schemaName:"OldTagMiniPage",action:e.action,recordId:e.recordId,defaultValues:e.defaultValues,parameters:e.parameters}}handle(e){var t=this;return(0,d.Z)(function*(){const a=t._createModalInjector(e),r=t._createSchemaModalConfig(e);yield t._schemaModalService.show(r,{injector:a}),yield t.next?.handle(e)})()}};Da=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.OpenOldTagMiniPageHandler",requestType:"crt.OpenOldTagMiniPageRequest"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Da);let Aa=class extends o.BaseRequestHandler{_isNewTagRecord(e){return(0,d.Z)(function*(){const t=yield e[H];return[o.ModelInPageAction.Add,o.ModelInPageAction.Copy].includes(t)})()}_insertTagInSchemaRecord(e){var t=this;return(0,d.Z)(function*(){const a=yield(0,p.lastValueFrom)(S.Model.create(g.DEFAULT_TAG_IN_SCHEMA_SCHEMA_NAME)),r=yield t._getPrimaryAttributeValue(e),n=yield e[g.TAG_ENTITY_SCHEMA_NAME_PAGE_ATTRIBUTE_NAME];if(!r||!n)return!1;const c=yield(0,p.lastValueFrom)(a.insert({Tag:r,EntitySchemaName:n}));return c.success&&(yield t._notifyTagChange(e,r)),c.success})()}_getPrimaryAttributeValue(e){var t=this;return(0,d.Z)(function*(){const a=yield e.getPrimaryModelName();if(!a)return;const r=yield t._getPrimaryDataSchemaPrimaryAttributeName(e);if(!r)return;const n=e.getViewModelAttributePath(a,r);return e[n]})()}_getPrimaryDataSchemaPrimaryAttributeName(e){return(0,d.Z)(function*(){return(yield e.getPrimaryDataSchema())?.primaryAttributeName})()}_notifyTagChange(e,t){var a=this;return(0,d.Z)(function*(){const r=yield a._getPrimaryDataSchemaPrimaryAttributeName(e);S.ModelEventNotificationService.instance.notify({modelId:(0,o.generateGuid)(),dataSchemaName:g.DEFAULT_TAG_SOURCE_SCHEMA_NAME,type:S.ModelEventType.Update,payload:{primaryAttributesValues:[[{name:r,value:t}]]}})})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=yield t._isNewTagRecord(a),n=yield t.next?.handle(e);return r&&n?t._insertTagInSchemaRecord(a):n})()}};Aa=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.SaveRecordRequest",type:"crt.TagMiniPageSaveRecordHandler",scopes:["TagMiniPage"]})],Aa);let Pa=class extends o.BaseRequestHandler{_isNeedUpdateTagInRecordDataSource(e){const t=e.modelName;return[S.ModelEventType.Update,S.ModelEventType.Delete].includes(e.modelEvent.type)&&this._isTagSelectListItemsDataSourceName(t)}_isTagSelectListItemsDataSourceName(e){return e?.endsWith("_List_Items_DS")}_updateTagInRecordDataSource(e){var t=this;const a=e.$context,r=this._getTagSelectItemsDataSourceName(e.modelName);if(!a.isDataSourceForCollection(r))return;const n={type:"crt.LoadDataRequest",$context:e.$context,dataSourceName:r,config:{loadType:o.DataSourceLoadType.Reload}};setTimeout((0,d.Z)(function*(){yield t.handlerChain.process(n)}))}_getTagSelectItemsDataSourceName(e){return e.replace("_List_","_")}handle(e){var t=this;return(0,d.Z)(function*(){const a=yield t.next?.handle(e);return t._isNeedUpdateTagInRecordDataSource(e)&&(yield t._updateTagInRecordDataSource(e)),a})()}};Pa=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleModelEventRequest",type:"crt.TagModelChangedHandler"})],Pa);class Dr extends gr{get invalidErrorMessageForSelectRecordsValidator(){return`InfoDialog.TagsInRecords.SelectRecordsTo${this.openLookupPageMode}Message`}_getRecordColumnName(e){return(0,g.isOldStructure)(e)?g.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA:g.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA}_createDefaultValuesForTaggingIfNeed(e,t){return this._isOldTag(e)?null:{RecordSchemaName:t}}_isOldTag(e){return e!==g.DEFAULT_TAG_SOURCE_SCHEMA_NAME}_prepareDataForList(e){var t=this;return(0,d.Z)(function*(){t._tagColumnSchemaName=(yield t._getTagColumnFromTagInRecordSchema(e)).referenceSchemaName,!(0,g.isOldStructure)(e)&&(yield t._prepareAllowedTagAccessesForTagging())})()}_getTagColumnFromTagInRecordSchema(e){var t=this;return(0,d.Z)(function*(){return(yield(0,p.lastValueFrom)(t.entitySchemaRepository.getSchemaByName(t._getTagInRecordSourceSchemaName(e)))).columns.find(r=>r.name===g.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA)})()}_getTagInRecordSourceSchemaName(e){return(0,g.isOldStructure)(e)?e.tagInRecordSourceSchemaName:g.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME}_prepareAllowedTagAccessesForTagging(){var e=this;return(0,d.Z)(function*(){e._allowedTagAccessesForTaggingIds=yield(0,g.getAllowedTagAccessesForTagging)(e.tagRightsService)})()}_getLookupPageFiltersForOldStructure(){return(0,g.createOldTagListFilter)(this.userInfo)}_getLookupPageFiltersForNewStructure(e){return(0,g.createTagListFilter)([e],this._allowedTagAccessesForTaggingIds)}constructor(e){super(e),this.injector=e,this._allowedTagAccessesForTaggingIds=[],this.entitySchemaRepository=e.get(h.EntitySchemaRepository),this.translateService=e.get(k.TranslateService),this.baseRelatedInMainRecordsService=e.get(R.FL),this.tagRightsService=e.get(g.TagRightsService),this.userInfo=e.get(h.UserInfo)}createServiceData(e,t){return{relatedRecordsSchemaName:this.getRelatedRecordsSchemaName(e),relatedRecordColumnName:this._getRecordColumnName(e),relatedRecordsFilters:e.filters,relatedInMainRecordsSchemaName:this._getTagInRecordSourceSchemaName(e),mainRecordsSchemaName:this._tagColumnSchemaName,mainRecordColumnName:g.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA,mainRecordsFilters:t}}addRecordsServiceAction(e){const t=e.relatedRecordsSchemaName;return e.defaultValues=this._createDefaultValuesForTaggingIfNeed(this._tagColumnSchemaName,t),super.addRecordsServiceAction(e)}getLookupPageEntitySchemaName(e){return this._tagColumnSchemaName}getLookupPageCaption(e){const t=this.openLookupPageMode==="AddRecords"?"AddTagCaption":"RemoveTagCaption";return this.translateService.instant(`OpenTagLookupPage.${t}`)}getLookupPageFilter(e){const a=e.$context.dataSchemas[e.dataSourceName]?.name;return this._isOldTag(this._tagColumnSchemaName)?this._getLookupPageFiltersForOldStructure():this._getLookupPageFiltersForNewStructure(a)}getMaskTaskName(e){return`TAGGING_${this.getRelatedRecordsSchemaName(e)}_RECORDS`}initializeData(e){var t=this;return(0,d.Z)(function*(){yield t._prepareDataForList(e)})()}}let Ia=class extends Dr{constructor(e){super(e),this._injector=e,this.openLookupPageMode="AddRecords"}};Ia=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.AddTagsInRecordsRequest",type:"crt.AddTagsInRecordsHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Ia);let Na=class extends Dr{constructor(e){super(e),this._injector=e,this.openLookupPageMode="RemoveRecords"}};Na=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.RemoveTagsInRecordsRequest",type:"crt.RemoveTagsInRecordsHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Na);let Ue=class extends o.BaseRequestHandler{constructor(e,t,a){super(),this._messageDialogProvider=e,this._customEventService=t,this._isAngularHost=a}_getEntitySchemaName(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getDataSourceName(e);return e.$context.dataSchemas[a]?.dataSourceConfig?.config?.entitySchemaName})()}_getDataSourceName(e){const t=e.$context.getBoundDataSourceName(e.itemsAttributeName);return t||e.$context.getPrimaryModelName()}_subscribeOnCardModuleResponse(e){return this._customEventService.subscribe("CardModuleResponse").pipe((0,M.switchMap)(t=>this._updateLookups(e,t))).subscribe()}_setAttributesValue(e,t,a,r){return(0,d.Z)(function*(){const n=a?.attributes.filter(c=>c.referenceSchemaName===r.entitySchemaName);for(const c of n||[]){const u=e.getViewModelAttributePath(t,c.name);u&&(yield e[u])?.value===r.primaryColumnValue&&(yield e.set(u,{value:r.primaryColumnValue,displayValue:r.primaryDisplayColumnValue},{silent:!0}))}})()}_isModelLoaded(e,t){const a=e.getBoundDataSourceNameByAttributePath(t);return e.getModelByName(a)?.isLoaded}_updateLookups(e,t){var a=this;return(0,d.Z)(function*(){const r=e.$context,n=yield a._getDataSourceName(e),c=r.dataSchemas[n];yield a._setAttributesValue(r,n,c,t);for(const[u,m]of Object.entries(r.attributes))if(m instanceof S.BaseViewModelCollection&&a._isModelLoaded(r,u)){const _=yield r[u];for(const f of _||[]){const y=Object.entries(f.dataSchemas);for(const[I,ve]of y||[])yield a._setAttributesValue(f,I,ve,t)}}})()}handle(e){var t=this;return(0,d.Z)(function*(){if(!e.entityName&&!e.itemsAttributeName||!e.recordId){t._messageDialogProvider.open({data:{message:"InfoDialog.OpenPage.SettingsErrorMessage",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}});return}const a=e.entityName?e.entityName:yield t._getEntitySchemaName(e),r={type:"crt.7XRequest",action:"EditRecord",$context:e.$context,payload:{recordId:e.recordId,entityName:a,replaceHistoryState:e.replaceHistoryState}};if(t._isAngularHost){const n=t._subscribeOnCardModuleResponse(e);e.$context?._subscriptions.add(n)}return t.handlerChain.process(r)})()}};(0,l.__decorate)([(0,S.CrtCanDiscardUnsavedData)(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[Object]),(0,l.__metadata)("design:returntype",Promise)],Ue.prototype,"handle",null),Ue=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.UpdateRecordRequest",type:"crt.UpdateRecordHandler"}),(0,l.__param)(2,(0,o.CrtInject)(h.IS_ANGULAR_HOST)),(0,l.__metadata)("design:paramtypes",[g.MessageDialogProvider,N.CustomEventService,Boolean])],Ue);let Ar=class extends o.BaseRequest{};Ar=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.UploadDataAttributeFileRequest"})],Ar);let Ma=class extends o.BaseRequestHandler{constructor(e){super(),this.fileApiService=e}handle(e){var t=this;return(0,d.Z)(function*(){const a={...e.detail.file,fileEntitySchemaName:"SysFile"};return yield(0,p.lastValueFrom)(t.fileApiService.uploadAsColumn(a),{defaultValue:null})})()}};Ma=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.UploadDataAttributeFileRequest",type:"crt.UploadDataAttributeFileHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards]}),(0,l.__metadata)("design:paramtypes",[h.FileApiService])],Ma);let Pr=class extends o.BaseRequest{};Pr=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.UploadEntityFileRequest"})],Pr);let xa=class extends o.BaseRequestHandler{constructor(e){super(),this.fileApiService=e}_getDataSchema(e){const t=this._getDataSourceName(e);return e.$context.models.find(a=>a.dataSource.dataSourceName===t)}_getDataSourceName(e){return e.$context.getBoundDataSourceName(e.filesAttributeName)}handle(e){var t=this;return(0,d.Z)(function*(){const r=t._getDataSchema(e)?.dataSource?.initialConfig,n=r.storageSchemaName,c=r.recordSchemaName,u=r.recordColumnName,m=e.$context.attributes[e.recordAttributeName],_={...e.detail.file,fileEntitySchemaName:n,recordEntitySchemaName:c,recordColumnName:u,recordId:m?.value||m};return r.storageSchemaName===r.entitySchemaName?yield(0,p.lastValueFrom)(t.fileApiService.upload(_),{defaultValue:null}):yield(0,p.lastValueFrom)(t.fileApiService.uploadAndAttach(_),{defaultValue:null})})()}};xa=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.UploadEntityFileRequest",type:"crt.UploadEntityFileHandler",scopes:[S.Scopes.AllSections,S.Scopes.AllCards]}),(0,l.__metadata)("design:paramtypes",[h.FileApiService])],xa);let ba=class extends o.BaseRequestHandler{_removedItemIndex(e,t,a){return(0,d.Z)(function*(){for(let r=0;r<e.length;r++){const n=e[r],c=n.getViewModelAttributePath(t,a.name);if((yield n[c])===a.value)return r}return-1})()}_onRecordDeleted(e,t,a){var r=this;return(0,d.Z)(function*(){for(const[n,c]of Object.entries(e.attributes))if(c instanceof S.BaseViewModelCollection&&e.getBoundDataSourceNameByAttributePath(n)===t){const u=c,m=yield r._removedItemIndex(u,t,a);if(m>=0){const _=u[m];u.removeChildModel(_),u.splice(m,1)}}})()}_removeDeletedItemsFromCollection(e,t){const a=e.$context,r=e.modelName,n=a.dataSchemas[r];t.filter(u=>u.name===n.primaryAttributeName).forEach(u=>this._onRecordDeleted(a,r,u))}_reloadData(e,t){return this.handlerChain.process({type:"crt.LoadDataRequest",$context:t,dataSourceName:e,config:{loadType:o.DataSourceLoadType.Reload}})}_refreshData(e){var t=this;return(0,d.Z)(function*(){const a=e.$context,r=e.modelEvent.payload?.primaryAttributesValues;r?.length||(yield t._reloadData(e.modelName,a));for(const n of r)Array.isArray(n)&&(yield t._removeDeletedItemsFromCollection(e,n))})()}handle(e){var t=this;return(0,d.Z)(function*(){return e.$context.isDataSourceForCollection(e.modelName)&&e.modelEvent.type===S.ModelEventType.Delete&&(yield t._refreshData(e)),t.next?.handle(e)})()}};ba=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleModelEventRequest",type:"crt.ViewModelRecordsDeletedHandler"})],ba);let Ir=class extends o.BaseRequest{constructor(){super(...arguments),this.type="crt.ParametersChangeRequest"}};Ir=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.ParametersChangeRequest"})],Ir);let wa=class extends o.BaseRequestHandler{handle(e){var t=this;return(0,d.Z)(function*(){const{$context:a,entries:r}=e||{},n=[];for(const c of Object.values(r)){const{params:u,request:m}=c,_={type:m,scopes:e.scopes,$context:a,...u};n.push(t.handlerChain.process(_))}return n.length>0&&(yield Promise.all(n)),Promise.resolve()})()}};wa=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.ParametersChangeRequestHandler",requestType:"crt.ParametersChangeRequest"})],wa);let Nr=class extends o.BaseRequest{constructor(){super(...arguments),this.type="crt.SetViewModelAttributeRequest"}};Nr=(0,l.__decorate)([(0,o.CrtRequest)({type:"crt.SetViewModelAttributeRequest"})],Nr);let ka=class extends o.BaseRequestHandler{handle(e){const{$context:t,attributeName:a,value:r}=e||{};return r&&(t[a]=r),Promise.resolve()}};ka=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.SetViewModelAttributeRequestHandler",requestType:"crt.SetViewModelAttributeRequest"})],ka);let Oa=class extends o.BaseRequestHandler{constructor(e,t,a,r){super(),this._schemaService=e,this._notifyService=t,this._translateService=a,this._printablesService=r,this._translatePrefix="PrintablesHandler"}_getRecordIdByPrimaryDataSource(e){return(0,d.Z)(function*(){const{dataSourceName:t,$context:a}=e,r=yield a.getPrimaryModelName();if(t===r){const n=yield a.getPrimaryDataSchema(),c=a.getViewModelAttributePath(r,n.primaryAttributeName);return a[c]}return null})()}_getRecordId(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getRecordIdByPrimaryDataSource(e);if(a)return a;const r=e.$context.getCollectionViewModelAttributePath(e.dataSourceName),n=t._schemaService.getViewConfigInfoByPropertyValues([`$${r}`]).map(m=>m.viewConfig).filter(m=>["crt.DataGrid","crt.FileList","crt.ApprovalList","crt.ChartWidget","crt.IndicatorWidget","crt.GaugeWidget","crt.Gallery","crt.Calendar"].includes(m.type));if(n.length>1)throw new Error("Several view elements are bound to specified in the request datasource.");const u=`${n?.[0].name}_ActiveRow`;return e.$context[u]})()}_getFilters(e){return e instanceof o.FilterGroup?(0,at.classToPlain)(e):e}_isRequestValid(e){return!(!e||!e.templateId||!e.dataSourceName||!e.printableCaption)}_showInfoMessage(e){var t=this;return(0,d.Z)(function*(){const a=t._translateService.instant(`${t._translatePrefix}.${e}`);yield t._notifyService.show({message:a})})()}handle(e){var t=this;return(0,d.Z)(function*(){if(!t._isRequestValid(e))return t._showInfoMessage("InvalidRequestCaption");const r=t._getFilters(e.filters);if(r){const m={templateId:e.templateId,filtersConfig:JSON.stringify(r),convertInPDF:e.convertInPDF};return t._printablesService.generatePrintablesByFilter(m,e.printableCaption)}if((yield e.$context[H])===o.ModelInPageAction.Add)return t._showInfoMessage("PrintForUnsavedRecordCaption");const u=yield t._getRecordId(e);if(u){const m={templateId:e.templateId,recordIds:[u],convertInPDF:e.convertInPDF};return t._printablesService.generatePrintables(m,e.printableCaption)}return t._showInfoMessage("SelectRecord")})()}};Oa=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.PrintablesRequest",type:"crt.PrintablesHandler"}),(0,l.__metadata)("design:paramtypes",[D.SchemaService,b.NotifyService,k.TranslateService,C.PrintablesService])],Oa);let Va=class extends o.BaseRequestHandler{constructor(e){super(),this._injector=e,this._viewModelDataDelayerService=this._injector.get(R.Wn,null,{optional:!0})}handle(e){var t=this;return(0,d.Z)(function*(){t._viewModelDataDelayerService?.setState(e.$context,S.ViewModelStates.Paused),yield t.next?.handle(e)})()}};Va=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleViewModelPauseRequest",type:"crt.SetViewModelPauseStateRequestHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Va);let Fa=class extends o.BaseRequestHandler{constructor(e){super(),this._injector=e,this._viewModelDataDelayerService=this._injector.get(R.Wn,null,{optional:!0})}handle(e){var t=this;return(0,d.Z)(function*(){t._viewModelDataDelayerService?.setState(e.$context,S.ViewModelStates.Active),yield t.next?.handle(e)})()}};Fa=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleViewModelResumeRequest",type:"crt.SetViewModelResumeStateRequestHandler"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Fa);const Mr=/#ResourceString\((.*)\)#/;let Ha=class extends o.BaseRequestHandler{constructor(e){super(),this._schemaPartsService=e}_getResourceKeys(e){return(0,E.isEmpty)(e)?null:typeof e=="string"?Mr.test(e)?[e.replace(Mr,"$1")]:[]:typeof e=="object"?Object.values(e).map(t=>this._getResourceKeys(t)).flat():Array.isArray(e)?e.map(t=>this._getResourceKeys(t)).flat():null}_removeResources(e,t){var a=this;return(0,d.Z)(function*(){const{viewConfig:r}=e;if(!r)return;const n=yield t.loadResources();if((0,E.isEmpty)(n?.localizableStrings))return;const c=Object.keys(n.localizableStrings),u=Object.values(r).map(_=>a._getResourceKeys(_)).flat().filter(_=>Boolean(_)&&c.includes(_));if(!u.length)return;const m=(0,E.cloneDeep)(n);u.forEach(_=>m.localizableStrings[_]=void 0),yield t.upsertResources(m)})()}_removeViewElement(e,t){const{index:a,parentName:r,parentPropertyName:n}=e;if(!r||a==null||a<0)return;((t.getViewConfigInfoByName(r)?.viewConfig||{})?.[n]??[]).splice(a,1)}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.name;return a&&(yield t._schemaPartsService.apply(function(){var r=(0,d.Z)(function*([n,c]){const u=n.getViewConfigInfoByName(a);!u||(t._removeViewElement(u,n),yield t._removeResources(u,c))});return function(n){return r.apply(this,arguments)}}()),yield t._schemaPartsService.commit({silent:!1})),t.next?.handle(e)})()}};Ha=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.RemoveViewElementRequest",type:"crt.RemoveViewElementHandler"}),(0,l.__metadata)("design:paramtypes",[D.SchemaPartsService])],Ha);let Ba=class extends o.BaseRequestHandler{constructor(e){super(),this._notifyService=e.get(b.NotifyService)}_showNotification(e){const t={message:e,duration:1e4,translate:!0};this._notifyService.show(t)}_getSelectedGridItems(e,t,a){return(0,d.Z)(function*(){const r=a.getBoundDataSourceNameByAttributePath(e),n=yield a[e],c=a.getModelByName(r),m=(yield(0,p.lastValueFrom)(c.getSchema())).primaryAttributeName;return n.filter(_=>t.includes(_.attributes[`${r}_${m}`]))})()}_getSelectedItems(e,t){var a=this;return(0,d.Z)(function*(){const r=yield t[e];if(r.type==="all")return a._showNotification("MoveSelectedItemsHandler.SelectAllIsNotAllowedMessage"),[];if(r.type==="specific")return r?.selected.map(n=>n)})()}_isLookupValue(e){return Boolean(e?.value)}_toPrimaryDataSourceAttribute(e){return e.substring(this._primaryDataSourceName.length+1,e.length)}_getItemDefaultValue(e,t,a){var r=this;return(0,d.Z)(function*(){if(r._isLookupValue(a.value)){const n=a.value,c=r._isFromPrimaryDataSource(n.value),u=c?yield t[r._toPrimaryDataSourceAttribute(n.value)]:yield e[n?.value],m=c?yield t[r._toPrimaryDataSourceAttribute(n.displayValue)]:yield e[n?.displayValue];return{value:u,displayValue:m}}else return r._isFromPrimaryDataSource(a.value)?yield t[r._toPrimaryDataSourceAttribute(a.value)]:yield e[a.value]})()}_isFromPrimaryDataSource(e){return e.startsWith(this._primaryDataSourceName)}_getDefaultValues(e,t,a){var r=this;return(0,d.Z)(function*(){const n={};for(const c of t??[]){let u;switch(c.type){case S.MoveSelectedItemDefaultValueType.Root:u=yield a[c.value];break;case S.MoveSelectedItemDefaultValueType.Item:u=yield r._getItemDefaultValue(e,a,c);break;case S.MoveSelectedItemDefaultValueType.Const:u=c.value;break}n[c.attributeName]=u}return n})()}_createCollectionItem(e,t,a,r){var n=this;return(0,d.Z)(function*(){const u={...yield n._getDefaultValues(t,r,a)};yield e.createItem({initialAttributeValues:u})})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context;t._primaryDataSourceName=yield a.getPrimaryModelName();const r=yield t._getSelectedItems(e.selectionStateAttribute,a),n=yield t._getSelectedGridItems(e.sourceAttribute,r,a),c=yield a[e.targetAttribute];for(const u of n)yield t._createCollectionItem(c,u,a,e.defaultValues);yield a.set(e.selectionStateAttribute,[])})()}};Ba=(0,l.__decorate)([(0,o.CrtRequestHandler)({type:"crt.MoveSelectedItemsHandler",requestType:"crt.MoveSelectedItemsRequest"}),(0,l.__metadata)("design:paramtypes",[s.Injector])],Ba);const As=JSON.parse(`{"ConfirmationDialog":{"DeleteRecordConfirmation":"Are you sure that you want to delete the selected record?","DeleteRecordsConfirmation":"Are you sure that you want to delete the selected records?","SaveDataGridConfigsForAllUsers":"Save list settings for all users?","ResetDataGridConfigsToDefault":"Restore default list settings?","ClearDataGridConfigsForActiveFolder":"Clear list settings for \\"{0}\\"?","SaveSummariesForAll":"Save summaries settings for all users?","ResetSummaries":"Restore default summaries settings?"},"InfoDialog":{"RightLevelWarningMessage":"Insufficient rights to delete records in the '{0}' object","UnableToDeleteSelectedRecord":"Unable to delete selected record","SelectRecordsToDelete":"Select records to delete","SettingsErrorMessage":"Unable to execute the action.\\n\\rSystem administrator must check the button settings in the Freedom UI Designer.","ExportToExcel":{"PermissionsErrorMessage":"You do not have permission to perform this operation.\\nPlease contact your system administrator. Check access to the export object and permission to perform the system operation."},"FileUpload":{"SizeValidationMessage":"{0} MB maximum file size limit exceeded.\\n\\r\\n\\r Files:\\n- {1}","NoConnectedFileList":"The file upload destination is not set.\\n\\rPlease choose the destination in the button settings.","InvalidRequestParams":"Unable to upload the file(s) as the page component has not been set up yet. The system administrator can finish the setup in the Freedom UI designer.","ChangeFileSizeInfoMessage":"You can increase the maximum file size in the \\"Attachment max size\\" system setting.","FileListHeader":"Files","MaxFileSizeExceededExceptionMessage":"{0} MB maximum file size limit exceeded.","UnknownServerError":"Something went wrong.\\n\\rPlease try uploading the file again.","AttachedToUnsavedRecord":"Unable to attach the files to the record that has not been created yet. Please create the record before uploading the files","InvalidExtension":{"Deny":"The [{0}] file extension is forbidden by security settings. If you need to work with such files, please contact your system administrator to remove the extension from the [File extensions DenyList] (FileExtensionsDenyList) system setting","Allow":"The [{0}] file extension is forbidden by security settings. If you need to work with such files, please contact your system administrator to add the extension to the [File extensions AllowList] (FileExtensionsAllowList) system setting"}},"ImageUpload":{"MaxFileSizeExceededExceptionMessage":"{0} MB maximum file size limit exceeded.","UnknownUploadError":"Unknown upload error. Please contact the system administrator."},"SetRecordRights":{"SettingsErrorMessage":"Action error.\\nContact your system administrator. Check the action settings in System Designer."},"OpenPage":{"SettingsErrorMessage":"Action error.\\nContact your system administrator. Check the action settings in System Designer."},"TagsInRecords":{"SelectRecordsToAddRecordsMessage":"Select records to add tags","SelectRecordsToRemoveRecordsMessage":"Select records to remove tags"},"RecordsInStaticFolders":{"SelectRecordsToAddRecordsMessage":"Select records to add to the static folder","SelectRecordsToRemoveRecordsMessage":"Select records to remove from the static folder"}},"OpenTagLookupPage":{"AddTagCaption":"Add tag","RemoveTagCaption":"Remove tag"},"PrintablesHandler":{"PrintForUnsavedRecordCaption":"The report can not be printed for unsaved record.","InvalidRequestCaption":"Action is not valid. Please check print settings.","SelectRecord":"Select record for printing report"},"MoveSelectedItemsHandler":{"SelectAllIsNotAllowedMessage":"It is not possible to move all selected records by this action, please select as many records as needed one by one"}}`),Ps=JSON.parse(`{"ConfirmationDialog":{"DeleteRecordConfirmation":"\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C?","DeleteRecordsConfirmation":"\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u044B\u0435 \u0437\u0430\u043F\u0438\u0441\u0438?","SaveDataGridConfigsForAllUsers":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u043F\u0438\u0441\u043A\u0430 \u0434\u043B\u044F \u0432\u0441\u0435\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439?","ResetDataGridConfigsToDefault":"\u0412\u0435\u0440\u043D\u0443\u0442\u044C \u0434\u043B\u044F \u0441\u043F\u0438\u0441\u043A\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E?","ClearDataGridConfigsForActiveFolder":"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0434\u043B\u044F \\"{0}\\"?","SaveSummariesForAll":"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0438\u0442\u043E\u0433\u043E\u0432 \u0434\u043B\u044F \u0432\u0441\u0435\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u0439?","ResetSummaries":"\u0412\u0435\u0440\u043D\u0443\u0442\u044C \u0434\u043B\u044F \u0438\u0442\u043E\u0433\u043E\u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E?"},"InfoDialog":{"RightLevelWarningMessage":"\u041D\u0435\u0434\u043E\u0441\u0442\u0430\u0442\u043E\u0447\u043D\u043E \u043F\u0440\u0430\u0432 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0437\u0430\u043F\u0438\u0441\u0438 \u0432 \u043E\u0431\u044A\u0435\u043A\u0442\u0435 '{0}'","UnableToDeleteSelectedRecord":"\u0412\u044B\u0434\u0435\u043B\u0435\u043D\u043D\u0443\u044E \u0437\u0430\u043F\u0438\u0441\u044C \u043D\u0435 \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u043E\u0441\u044C \u0443\u0434\u0430\u043B\u0438\u0442\u044C","SelectRecordsToDelete":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F","SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\\r\u0421\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u043F\u0440\u043E\u0432\u0435\u0440\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u043A\u043D\u043E\u043F\u043A\u0438 \u0432  \u0434\u0438\u0437\u0430\u0439\u043D\u0435\u0440\u0435 Freedom UI.","ExportToExcel":{"PermissionsErrorMessage":"\u0423 \u0432\u0430\u0441 \u043D\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u0438\u044F \u043D\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0435 \u044D\u0442\u043E\u0439 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u0434\u043E\u0441\u0442\u0443\u043F \u043A \u043E\u0431\u044A\u0435\u043A\u0442\u0443 \u044D\u043A\u0441\u043F\u043E\u0440\u0442\u0430 \u0438 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u0438\u0435 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0439 \u043E\u043F\u0435\u0440\u0430\u0446\u0438\u0438."},"FileUpload":{"SizeValidationMessage":"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430: {0} \u041C\u0411.\\n\\r\\n\\r \u0424\u0430\u0439\u043B\u044B:\\n- {1}","NoConnectedFileList":"\u0421\u043F\u0438\u0441\u043E\u043A, \u043A\u0443\u0434\u0430 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044C \u0444\u0430\u0439\u043B\u044B, \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D.\\n\\r\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043F\u0438\u0441\u043E\u043A \u0434\u043B\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u043E\u0432 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u0445 \u044D\u0442\u043E\u0439 \u043A\u043D\u043E\u043F\u043A\u0438.","InvalidRequestParams":"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u0430\u0439\u043B(\u044B), \u0442\u0430\u043A \u043A\u0430\u043A \u0434\u0430\u043D\u043D\u044B\u0439 \u043A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u0435\u0449\u0435 \u043D\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043D. \u0410\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440 \u0441\u0438\u0441\u0442\u0435\u043C\u044B \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 \u043A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442\u0430 \u0432 \u0434\u0438\u0437\u0430\u0439\u043D\u0435\u0440\u0435 Freedom UI.","ChangeFileSizeInfoMessage":"\u0423\u0432\u0435\u043B\u0438\u0447\u0438\u0442\u044C \u044D\u0442\u043E \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043C\u043E\u0436\u043D\u043E \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0439 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0435 \xAB\u041C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430\xBB.","FileListHeader":"\u0424\u0430\u0439\u043B\u044B","MaxFileSizeExceededExceptionMessage":"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 {0} \u041C\u0411.","UnknownServerError":"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A.\\n\\r\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437.","AttachedToUnsavedRecord":"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0444\u0430\u0439\u043B\u044B \u043A \u0435\u0449\u0435 \u043D\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u043D\u043E\u0439 \u0437\u0430\u043F\u0438\u0441\u0438. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0441\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u044C \u043F\u0435\u0440\u0435\u0434 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u043E\u0439 \u0444\u0430\u0439\u043B\u043E\u0432","InvalidExtension":{"Deny":"\u0424\u0430\u0439\u043B\u044B \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435\u043C [{0}] \u0437\u0430\u043F\u0440\u0435\u0449\u0435\u043D\u044B \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u043C\u0438 \u0431\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0441\u0442\u0438. \u0415\u0441\u043B\u0438 \u0432\u0430\u043C \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u0441 \u0444\u0430\u0439\u043B\u0430\u043C\u0438 \u0442\u0430\u043A\u043E\u0433\u043E \u0442\u0438\u043F\u0430, \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043C\u044B, \u0434\u043B\u044F \u0442\u043E\u0433\u043E \u0447\u0442\u043E\u0431\u044B \u0443\u0431\u0440\u0430\u0442\u044C \u0434\u0430\u043D\u043D\u043E\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0439 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 [\u0421\u043F\u0438\u0441\u043E\u043A \u0437\u0430\u043F\u0440\u0435\u0449\u0435\u043D\u043D\u044B\u0445 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0439 \u0444\u0430\u0439\u043B\u043E\u0432] (FileExtensionsDenyList)","Allow":"\u0424\u0430\u0439\u043B\u044B \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435\u043C [{0}] \u0437\u0430\u043F\u0440\u0435\u0449\u0435\u043D\u044B \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430\u043C\u0438 \u0431\u0435\u0437\u043E\u043F\u0430\u0441\u043D\u043E\u0441\u0442\u0438. \u0415\u0441\u043B\u0438 \u0432\u0430\u043C \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u0441 \u0444\u0430\u0439\u043B\u0430\u043C\u0438 \u0442\u0430\u043A\u043E\u0433\u043E \u0442\u0438\u043F\u0430, \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430 \u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043C\u044B, \u0434\u043B\u044F \u0442\u043E\u0433\u043E \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0434\u0430\u043D\u043D\u043E\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u0443\u044E \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 [\u0421\u043F\u0438\u0441\u043E\u043A \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043D\u043D\u044B\u0445 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0439 \u0444\u0430\u0439\u043B\u043E\u0432] (FileExtensionsAllowList)"}},"ImageUpload":{"MaxFileSizeExceededExceptionMessage":"\u041F\u0440\u0435\u0432\u044B\u0448\u0435\u043D \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0430\u0437\u043C\u0435\u0440 \u0444\u0430\u0439\u043B\u0430 {0} \u041C\u0411.","UnknownUploadError":"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043C\u044B."},"SetRecordRights":{"SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F \u0432 System Designer."},"OpenPage":{"SettingsErrorMessage":"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F.\\n\u041E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443. \u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u043A\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0435\u043A \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F \u0432 System Designer."},"TagsInRecords":{"SelectRecordsToAddRecordsMessage":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0442\u0435\u0433\u0430","SelectRecordsToRemoveRecordsMessage":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0442\u0435\u0433\u0430"},"RecordsInStaticFolders":{"SelectDataToAddRecordsMessage":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0432 \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0443\u044E \u0433\u0440\u0443\u043F\u043F\u0443","SelectDataToRemoveRecordsMessage":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0438\u0437 \u0441\u0442\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u043E\u0439 \u0433\u0440\u0443\u043F\u043F\u044B"}},"OpenTagLookupPage":{"AddTagCaption":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0435\u0433","RemoveTagCaption":"\u0423\u0431\u0440\u0430\u0442\u044C \u0442\u0435\u0433"},"PrintablesHandler":{"PrintForUnsavedRecordCaption":"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043E\u0442\u0447\u0435\u0442 \u043F\u043E\u043A\u0430 \u0437\u0430\u043F\u0438\u0441\u044C \u043D\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0430.","InvalidRequestCaption":"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u043E. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u043F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 \u043F\u0435\u0447\u0430\u0442\u0438.","SelectRecord":"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u044C \u0434\u043B\u044F \u043F\u0435\u0447\u0430\u0442\u0438 \u043E\u0442\u0447\u0435\u0442\u0430"},"MoveSelectedItemsHandler":{"SelectAllIsNotAllowedMessage":"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043F\u0435\u0440\u0435\u043C\u0435\u0441\u0442\u0438\u0442\u044C \u0432\u0441\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u044D\u0442\u0438\u043C \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435\u043C, \u043F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u043E\u043B\u044C\u043A\u043E \u0437\u0430\u043F\u0438\u0441\u0435\u0439, \u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E, \u043F\u043E \u043E\u0434\u043D\u043E\u0439"}}`),Is={["en-US"]:As,["ru-RU"]:Ps};let La=class extends o.BaseRequestHandler{constructor(e){super(),this._schemaPartsService=e}_saveToProfile(e,t){var a=this;return(0,d.Z)(function*(){(0,E.isEmpty)(e)||(yield a._schemaPartsService.apply(function(){var r=(0,d.Z)(function*([n]){yield n.setViewModelAttribute(e,t)});return function(n){return r.apply(this,arguments)}}()),yield a._schemaPartsService.commit())})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context;return yield t._saveToProfile(e.valueAttributeName,{value:e.value}),(0,p.lastValueFrom)(a.setValue({[e.valueAttributeName]:e.value}))})()}};La=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.QuickFilterRequest",type:"crt.QuickFilterHandler"}),(0,l.__metadata)("design:paramtypes",[D.SchemaPartsService])],La);let Ua=class extends o.BaseRequestHandler{constructor(e){super(),this._featureService=e,this._synchronize=null}_isValid(e,t,a){return!(a._getAttributeDataValueTypeName(e)==="Color"&&!t)}handle(e){var t=this;return(0,d.Z)(function*(){const a=e.$context;if(t._synchronize=t._synchronize??!(yield(0,p.firstValueFrom)(t._featureService.getFeatureState("DisableModelBindAttributeSynchronization"))),t._synchronize){const r=e.attributeName,n=a._getBoundAttributesNames(r);for(const c of n??[]){const u=e.value;(yield a[c])!==u&&t._isValid(r,u,a)&&(a[c]=u)}}return t.next?.handle(e)})()}};Ua=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.HandleViewModelAttributeChangeRequest",type:"crt.SynchronizeAttributesHandler"}),(0,l.__metadata)("design:paramtypes",[C.FeatureService])],Ua);const xr="Type.Id";let ja=class extends o.BaseRequestHandler{constructor(e,t,a){super(),this._rightsService=e,this._translateService=t,this._messageDialogProvider=a}_getOldTagDataSchema(e){return e.$context.getBoundDataSchemaByAttributePath(e.itemsAttributeName)}_getOldTagTypeId(e,t){return(0,d.Z)(function*(){const r=yield(yield o.Model.create(e)).load({attributes:[xr],parameters:[{type:o.ModelParameterType.PrimaryColumnValue,value:t}]});return Promise.resolve((0,E.get)((0,E.first)(r),xr))})()}_isCanDeleteOldTag(e){var t=this;return(0,d.Z)(function*(){return Promise.resolve(t._isNotPublicOldTagTypes(e)||(yield t._canDeletePublicOldTagTypes(e)))})()}_isNotPublicOldTagTypes(e){return e!==g.OLD_PUBLIC_TAG_TYPE_ID&&e!==g.OLD_CORPORATE_TAG_TYPE_ID}_canDeletePublicOldTagTypes(e){var t=this;return(0,d.Z)(function*(){const a=yield t._getAllowedOldTagOperations();return e===g.OLD_PUBLIC_TAG_TYPE_ID&&a.canManagePublicTags||e===g.OLD_CORPORATE_TAG_TYPE_ID&&a.canManageCorporateTags})()}_getAllowedOldTagOperations(){return(0,g.getAllowedOldTagOperations)(this._rightsService)}_deleteOldTag(e){return this.handlerChain.process({...e,type:"crt.DeleteRecordRequest"})}_showInsufficientRightsDialog(e){var t=this;return(0,d.Z)(function*(){const a=t._getInsufficientRightsErrorMessage(e);yield t._openInfoDialog(a)})()}_getInsufficientRightsErrorMessage(e){const t=this._getDataSchemaCaption(e),a="InfoDialog.RightLevelWarningMessage";return this._translateService.instant(a).replace("{0}",t)}_getDataSchemaCaption(e){return(0,h.getLocalizableStringValue)(e.caption,this._translateService.currentLang)}_openInfoDialog(e){var t=this;return(0,d.Z)(function*(){yield(0,p.lastValueFrom)(t._messageDialogProvider.open({data:{message:e,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}))})()}handle(e){var t=this;return(0,d.Z)(function*(){const a=t._getOldTagDataSchema(e),r=yield t._getOldTagTypeId(a.name,e.recordId);return(yield t._isCanDeleteOldTag(r))?t._deleteOldTag(e):t._showInsufficientRightsDialog(a)})()}};ja=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.DeleteOldTagRecordRequest",type:"crt.DeleteOldTagRecordHandler"}),(0,l.__metadata)("design:paramtypes",[C.RightsService,k.TranslateService,g.MessageDialogProvider])],ja);let $a=class extends o.BaseRequestHandler{constructor(e,t,a,r,n,c,u){super(),this._fileApiService=e,this._fileProcessingService=t,this._fileReaderService=a,this._messageDialogProvider=r,this._translateService=n,this._notifyService=c,this._maskService=u}_uploadFile(e,t,a){const r=[...e],n=[...t];let c=0;const u="UPLOAD_FILE_"+r.map(m=>m.name).join("_");this._maskService.showMask(u,a.$context),(0,p.from)(r).pipe((0,M.mergeMap)(m=>this._fileReaderService.read(m)),(0,M.map)(m=>{const _=(0,o.generateGuid)();return{...m,id:_,recordColumnName:a.recordColumnName,fileEntitySchemaName:a.fileEntitySchemaName,recordEntitySchemaName:a.recordEntitySchemaName,recordId:a.recordId,fileGroup:a.fileGroup,tag:a.tag}}),(0,M.concatMap)(m=>this._fileApiService.upload(m).pipe((0,M.tap)(()=>{this._addFileToCollection(m)}),(0,p.catchError)(_=>{const f=_?.status===400,y=_.error?.error||this._translateService.instant("InfoDialog.FileUpload.UnknownServerError"),I=f?y:_.errorCode,ve=f?y:_.message;return n.push((0,h.createFileErrorLogItem)(_.file,I,ve)),(0,p.of)(null)})))).subscribe({next:()=>{c++,c>=r.length&&(this._maskService.hideMask(u,a.$context),this._checkErrorsAndShowMessage(n))},complete:()=>{r.length===0&&this._checkErrorsAndShowMessage(n),this._maskService.hideMask(u,a.$context)}})}_checkErrorsAndShowMessage(e){const t=this._fileProcessingService.createFileErrorMessageForLogs(e);t&&this._messageDialogProvider.open({data:{message:t,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}_processFilesFromRequst(e){var t=this;return(0,d.Z)(function*(){const{files:a,errors:r}=yield t._fileProcessingService.processSelectedFiles(e.files,e.maximumAllowedFileSize);t._uploadFile(a,r,e)})()}_processFilesWithSelection(e){var t=this;return(0,d.Z)(function*(){const{maximumAllowedFileSize:a,allowedFileTypes:r}=e,n={type:"crt.SelectFileRequest",maximumAllowedFileSize:a,allowedFileTypes:r,multiple:!0,displayErrors:!1,$context:e.$context},{files:c,errors:u}=yield t.handlerChain.process(n);t._uploadFile(c,u,e)})()}_addFileToCollection(e){var t=this;return(0,d.Z)(function*(){if(!t._itemsCollection||e.file?.size===0)return null;const a=yield t._itemsCollection.createItem({index:0,initialModelValues:{Id:e.id,Name:e.file.name,Size:e.file.size}});a?.formApiModel?.markAsDirty(),a?.markPrimaryModelFor(h.ModelMode.Update)})()}checkTargetSchema(e){let t=!0;const a=e.$context;if(e.fileEntitySchemaName!=="SysFile"&&a.PrimaryModelMode===h.ModelMode.Create){t=!1;const r=this._translateService.instant("InfoDialog.FileUpload.AttachedToUnsavedRecord");this._notifyService.show({message:r})}return t}checkRequestParams(e){const t=e.recordId;return t?.value&&(e.recordId=t.value),e.recordId instanceof S.BaseViewModel&&(e.recordId=null),this.validateRequest(e)}validateRequest(e){return!e.recordId||!e.recordColumnName||!e.fileEntitySchemaName?(this._messageDialogProvider.open({data:{message:"InfoDialog.FileUpload.InvalidRequestParams",actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}}),!1):!0}handle(e){var t=this;return(0,d.Z)(function*(){if(!!t.checkRequestParams(e)&&!!t.checkTargetSchema(e)){if(t._itemsCollection=yield e.$context[e.itemsAttributeName],e.files){yield t._processFilesFromRequst(e);return}yield t._processFilesWithSelection(e)}})()}};$a=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.UploadFileRequest",type:"crt.UploadFileHandler"}),(0,l.__param)(6,(0,o.CrtInject)(h.DEVKIT_MASK_SERVICE)),(0,l.__metadata)("design:paramtypes",[h.FileApiService,R.dO,h.FileReaderService,g.MessageDialogProvider,k.TranslateService,b.NotifyService,o.MaskService])],$a);let Ga=class extends o.BaseRequestHandler{constructor(e,t,a,r){super(),this._imageApiService=e,this._translateService=t,this._sysSettingsService=a,this._messageDialogProvider=r}_openInfoDialog(e){this._messageDialogProvider.open({data:{message:e,actions:[g.DEFAULT_DIALOG_ACTIONS.OK]}})}_processImageUploadResponse(e,t,a){if(t.error){this._openInfoDialog(t.error);return}if(!e.imageAttributeName)return;const r=e.$context,n={value:a,displayValue:e.details.file.name};r[e.imageAttributeName]=n,r.formApiModel.controls[e.imageAttributeName].markAsDirty()}_uploadImage(e){const t=(0,o.generateGuid)();return(0,p.lastValueFrom)(this._imageApiService.upload(t,e.details.file).pipe((0,p.tap)(a=>this._processImageUploadResponse(e,a,t)),(0,p.map)(()=>t),(0,p.catchError)(a=>(this._openInfoDialog("InfoDialog.ImageUpload.UnknownUploadError"),console.error(a),(0,p.of)(null)))))}_updloadImageAsync(e){const t=(0,o.generateGuid)();this._imageApiService.upload(t,e.details.file).subscribe({next:a=>this._processImageUploadResponse(e,a,t),error:a=>{this._openInfoDialog("InfoDialog.ImageUpload.UnknownUploadError"),console.error(a)}})}validateFile(e){var t=this;return(0,d.Z)(function*(){const a=e.details.file,r=yield(0,p.lastValueFrom)(t._sysSettingsService.getByCode("MaxImageSize")),n=e.details.maxFileSize,c=r?.value||0,u=n?Math.min(c,e.details.maxFileSize):c,m=u*h.BYTES_IN_MEGABYTE;if(a.size>m){const _=fr.String.Format(t._translateService.instant("InfoDialog.ImageUpload.MaxFileSizeExceededExceptionMessage"),u);return t._openInfoDialog(_),!1}return!0})()}handle(e){var t=this;return(0,d.Z)(function*(){if(e.details?.file&&(yield t.validateFile(e))){if(e.awaitResponse)return t._uploadImage(e);t._updloadImageAsync(e)}return(0,p.lastValueFrom)((0,p.of)(null))})()}};Ga=(0,l.__decorate)([(0,o.CrtRequestHandler)({requestType:"crt.UploadImageRequest",type:"crt.UploadImageHandler"}),(0,l.__metadata)("design:paramtypes",[h.ImageApiService,k.TranslateService,C.SysSettingsService,g.MessageDialogProvider])],Ga);function Ns(i,e){return(0,d.Z)(function*(){const t=yield(0,p.firstValueFrom)(i.getFeatureState("DisableFreedomUiLazyLoading"));o.LazyModulesManager.instance.lazyLoadingDisabled=t,t&&(yield(0,p.firstValueFrom)(e.loaded$.pipe((0,p.filter)(Boolean))),yield o.LazyModulesManager.instance.loadAll())})}class Se extends O.DataSourceStructureExplorerService{constructor(e,t,a,r){super(),this._dataSourceRepository=e,this._dataSchemaRepository=t,this._entityBackwardReferenceService=a,this._featureValues=r}getDataSchemaAttributeByPath(e){return(0,p.throwError)(new Error("Method not implemented"))}getDataSchemaByName(e){return this._dataSchemaRepository.get(e)}getDataSourceByName(e){return(0,p.of)(this._dataSourceRepository.get(e))}getDataSources(){return(0,p.of)(this._dataSourceRepository.getAll())}getDataSchemaBackReference(e){return this._featureValues.UseBackwardReferencesInStructureExplorer?this._entityBackwardReferenceService.getBackwardReferences(e):(0,p.of)([])}}Se.\u0275fac=function(e){return new(e||Se)(s.\u0275\u0275inject(R.jW),s.\u0275\u0275inject(S.DataSchemaRepositoryService),s.\u0275\u0275inject(O.EntityBackwardReferenceService),s.\u0275\u0275inject(h.FEATURE_VALUES))},Se.\u0275prov=s.\u0275\u0275defineInjectable({token:Se,factory:Se.\u0275fac});class z{}z.\u0275fac=function(e){return new(e||z)},z.\u0275mod=s.\u0275\u0275defineNgModule({type:z}),z.\u0275inj=s.\u0275\u0275defineInjector({providers:[{provide:O.DataSourceStructureExplorerService,useClass:Se}],imports:[O.DataSourceStructureExplorerModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(z,{imports:[O.DataSourceStructureExplorerModule]})}();const Ms=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Odaberi radnu povr\u0161inu","EditDesktop":"Uredi radnu povr\u0161inu"},"BasePage":{"DesignButtonHint":"Uredi stranicu","ExpandButtonTitle":"Pro\u0161iri","CollapseButtonTitle":"Skupi"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Neva\u017Ee\u0107i parametri","ServiceResult":{"ErrorMessage":"Do\u0161lo je do pogre\u0161ke. Molimo kontaktirajte administratora sustava"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Ozna\u010Deno {{ count }} stavka/e","RemoveTagsMessage":"Neozna\u010Deno {{ count }} stavka/e","AddTagsSuccessfulRunProcess":"Proces masovnog ozna\u010Davanja zapo\u010Deo je za odabrane stavke. Ovo mo\u017Ee potrajati neko vrijeme","RemoveTagsSuccessfulRunProcess":"Proces masovnog uklanjanja oznaka zapo\u010Deo je za odabrane stavke. Ovo mo\u017Ee potrajati neko vrijeme"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Dodano je {{ count }} zapisa u mapu/e","RemoveRecordsMessage":"Uklonjeno je {{ count }} zapisa iz mape/a"}},"RunProcessHandler":{"ProcessHasStarted":"Akcija je uspje\u0161no zapo\u010Dela","CannotRunProcess":{"NoRecordsSelected":"Ova akcija zahtijeva barem jedan zapis kako bi se izvr\u0161ila. Molimo odaberite zapise na koje \u017Eelite primijeniti akciju i poku\u0161ajte ponovno"}}}'),xs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"TaggingService":{"NotValidParametersMessage":"Not valid parameters","TaggingResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time","ErrorMessage":"An error occurred. Please contact the system administrator"}}}'),bs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"V\xE1lassza ki az asztalt","EditDesktop":"Asztal szerkeszt\xE9se"},"BasePage":{"DesignButtonHint":"Oldal szerkeszt\xE9se","ExpandButtonTitle":"Kibont\xE1s","CollapseButtonTitle":"\xD6sszez\xE1r"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Nem \xE9rv\xE9nyes param\xE9terek","ServiceResult":{"ErrorMessage":"Hiba t\xF6rt\xE9nt. K\xE9rj\xFCk, l\xE9pjen kapcsolatba a rendszergazd\xE1val"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Megjel\xF6lt {{ count }} elem(ek)","RemoveTagsMessage":"Megjel\xF6l\xE9s n\xE9lk\xFCli {{ count }} elem(ek)","AddTagsSuccessfulRunProcess":"A kiv\xE1lasztott t\xE9tel(ek) t\xF6meges c\xEDmk\xE9z\xE9si folyamata elindult. Ez eltarthat egy ideig","RemoveTagsSuccessfulRunProcess":"A c\xEDmk\xE9k t\xF6meges elt\xE1vol\xEDt\xE1sa elindult a kiv\xE1lasztott elem(ek) eset\xE9ben. Ez eltarthat egy ideig"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Hozz\xE1adott {{ count }} rekord(ok) a mapp\xE1ban (mapp\xE1kban)","RemoveRecordsMessage":"Elt\xE1vol\xEDtott {{ count }} rekord(ok) a mapp\xE1b\xF3l (mapp\xE1kb\xF3l)"}},"RunProcessHandler":{"ProcessHasStarted":"The action has successfully started","CannotRunProcess":{"NoRecordsSelected":"This action needs at least one record to run. Please select the records you want to apply it to and try again"}}}'),ws=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"}}'),ks=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u9009\u62E9\u684C\u9762","EditDesktop":"\u7F16\u8F91\u684C\u9762"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Os=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Vs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Fs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Hs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Bs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"P\xEBrzgjidh desktopin","EditDesktop":"Modifiko desktopin"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Ls=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Selecteaz\u0103 desktop-ul","EditDesktop":"Editeaz\u0103 desktop-ul"},"BasePage":{"DesignButtonHint":"Pagina editare","ExpandButtonTitle":"Extinde","CollapseButtonTitle":"Restr\xE2nge"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Us=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Selecionar desktop","EditDesktop":"Editar desktop"},"BasePage":{"DesignButtonHint":"Editar p\xE1gina","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),js=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Selecionar a \xE1rea de trabalho","EditDesktop":"Editar o desktop"},"BasePage":{"DesignButtonHint":"P\xE1gina de edi\xE7\xE3o","ExpandButtonTitle":"Expandir","CollapseButtonTitle":"Recolher"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Par\xE2metros inv\xE1lidos","ServiceResult":{"ErrorMessage":"Ocorreu um erro. Favor, entrar em contato com o administrador do sistema"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Etiquetados {{ count }} item(ns)","RemoveTagsMessage":"Removidas as etiquetas de {{ count }} item(ns)","AddTagsSuccessfulRunProcess":"Processo de etiquetagem em massa iniciado para o(s) item(ns) escolhido(s). Isto poder\xE1 levar algum tempo","RemoveTagsSuccessfulRunProcess":"Processo de remo\xE7\xE3o em massa de etiquetas iniciado para o(s) item(ns) escolhido(s). Isto poder\xE1 levar algum tempo"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Adicionado(s) {{ count }} registro(s) na(s) pasta(s)","RemoveRecordsMessage":"Removido(s) {{ count }} registro(s) da(s) pasta(s)"}}}'),$s=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Gs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}}}'),Zs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\uB370\uC2A4\uD06C\uD1B1 \uC120\uD0DD","EditDesktop":"\uBC14\uD0D5 \uD654\uBA74 \uD3B8\uC9D1"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"\uD655\uC7A5","CollapseButtonTitle":"\uBD95\uAD34"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"\uC720\uD6A8\uD558\uC9C0 \uC54A\uC740 \uB9E4\uAC1C \uBCC0\uC218","ServiceResult":{"ErrorMessage":"\uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. \uC2DC\uC2A4\uD15C \uAD00\uB9AC\uC790\uC5D0\uAC8C \uBB38\uC758\uD558\uC2ED\uC2DC\uC624"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"\uD0DC\uADF8 \uBD80\uCC29 {{ count }}\uAC1C \uD488\uBAA9","RemoveTagsMessage":"\uD0DC\uADF8\uC5C6\uC74C {{ count }}\uAC1C \uD488\uBAA9","AddTagsSuccessfulRunProcess":"\uC120\uD0DD\uD55C \uD56D\uBAA9\uC5D0 \uB300\uD574 \uB300\uB7C9 \uD0DC\uADF8 \uC9C0\uC815 \uD504\uB85C\uC138\uC2A4\uAC00 \uC2DC\uC791\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC2DC\uAC04\uC774 \uC880 \uAC78\uB9B4 \uC218 \uC788\uC2B5\uB2C8\uB2E4","RemoveTagsSuccessfulRunProcess":"\uC120\uD0DD\uD55C \uD56D\uBAA9\uC5D0 \uB300\uD574 \uB300\uB7C9 \uD0DC\uADF8 \uC81C\uAC70 \uD504\uB85C\uC138\uC2A4\uAC00 \uC2DC\uC791\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC2DC\uAC04\uC774 \uC880 \uAC78\uB9B4 \uC218 \uC788\uC2B5\uB2C8\uB2E4"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"\uD3F4\uB354\uC5D0 {{ count }}\uAC1C\uC758 \uB808\uCF54\uB4DC \uCD94\uAC00","RemoveRecordsMessage":"\uD3F4\uB354\uC5D0\uC11C {{{ count }}\uAC1C\uC758 \uB808\uCF54\uB4DC\uB97C \uC81C\uAC70\uD588\uC2B5\uB2C8\uB2E4"}},"RunProcessHandler":{"ProcessHasStarted":"\uC791\uC5C5\uC774 \uC131\uACF5\uC801\uC73C\uB85C \uC2DC\uC791\uB418\uC5C8\uC2B5\uB2C8\uB2E4","CannotRunProcess":{"NoRecordsSelected":"\uC774 \uC791\uC5C5\uC744 \uC2E4\uD589\uD558\uB824\uBA74 \uC801\uC5B4\uB3C4 \uD558\uB098\uC758 \uB808\uCF54\uB4DC\uAC00 \uD544\uC694\uD569\uB2C8\uB2E4. \uC801\uC6A9\uD560 \uB808\uCF54\uB4DC\uB97C \uC120\uD0DD\uD55C \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD558\uC2ED\uC2DC\uC624"}}}'),zs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\u306E\u9078\u629E","EditDesktop":"\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\u306E\u7DE8\u96C6"},"BasePage":{"DesignButtonHint":"\u30DA\u30FC\u30B8\u306E\u7DE8\u96C6","ExpandButtonTitle":"\u5C55\u958B","CollapseButtonTitle":"\u6298\u308A\u305F\u305F\u3080"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}},"RunProcessHandler":{"ProcessHasStarted":"The action has successfully started","CannotRunProcess":{"NoRecordsSelected":"This action needs at least one record to run. Please select the records you want to apply it to and try again"}}}'),qs=JSON.parse(`{"DesktopSelector":{"ShowDesktopSelector":"Seleziona desktop","EditDesktop":"Modifica desktop"},"BasePage":{"DesignButtonHint":"Modifica pagina","ExpandButtonTitle":"Espandi","CollapseButtonTitle":"Riduci"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Parametri non validi","ServiceResult":{"ErrorMessage":"Si \xE8 verificato un errore. Si prega di contattare l'amministratore di sistema"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"{{ count }} elemento/i contrassegnato/i","RemoveTagsMessage":"{{ count }} elemento/i non contrassegnato/i","AddTagsSuccessfulRunProcess":"Il processo di tagging massivo \xE8 stato avviato per gli elementi selezionati. Potrebbe richiedere un po' di tempo","RemoveTagsSuccessfulRunProcess":"Il processo di rimozione tag massivo \xE8 stato avviato per gli elementi selezionati. Potrebbe richiedere un po' di tempo"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"{{ count }} elementi sono stati aggiunti alla cartella","RemoveRecordsMessage":"{{ count }} elementi sono stati rimossi dalla cartella"}},"RunProcessHandler":{"ProcessHasStarted":"L'azione \xE8 iniziata con successo","CannotRunProcess":{"NoRecordsSelected":"Questa azione richiede almeno un record da eseguire. Seleziona i record a cui vuoi applicarlo e riprova"}}}`),Ks=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}},"RunProcessHandler":{"ProcessHasStarted":"The action has successfully started","CannotRunProcess":{"NoRecordsSelected":"This action needs at least one record to run. Please select the records you want to apply it to and try again"}}}'),Ws=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u05D1\u05D7\u05E8 \u05E9\u05D5\u05DC\u05D7\u05DF \u05E2\u05D1\u05D5\u05D3\u05D4","EditDesktop":"\u05E2\u05E8\u05D5\u05DA \u05E9\u05D5\u05DC\u05D7\u05DF \u05E2\u05D1\u05D5\u05D3\u05D4"},"BasePage":{"DesignButtonHint":"\u05E2\u05E8\u05D5\u05DA \u05D3\u05E3","ExpandButtonTitle":"Expand","CollapseButtonTitle":"\u05E6\u05DE\u05E6\u05DD"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}},"RunProcessHandler":{"ProcessHasStarted":"The action has successfully started","CannotRunProcess":{"NoRecordsSelected":"This action needs at least one record to run. Please select the records you want to apply it to and try again"}}}'),Js=JSON.parse(`{"DesktopSelector":{"ShowDesktopSelector":"S\xE9lectionner le poste de travail","EditDesktop":"Editer le poste de travail"},"BasePage":{"DesignButtonHint":"Modifier page","ExpandButtonTitle":"D\xE9velopper","CollapseButtonTitle":"R\xE9duire"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Param\xE8tres invalides","ServiceResult":{"ErrorMessage":"Une erreur s'est produite. Veuillez contacter l'administrateur du syst\xE8me"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"\xC9l\xE9ment(s) tagg\xE9(s) {{ count }}","RemoveTagsMessage":"\xC9l\xE9ment(s) non tagg\xE9(s) {{ count }}","AddTagsSuccessfulRunProcess":"Le processus de tag en masse a commenc\xE9 pour le(s) \xE9l\xE9ment(s) s\xE9lectionn\xE9(s). Cela peut prendre quelque temps","RemoveTagsSuccessfulRunProcess":"Le processus de suppression en masse des tags a commenc\xE9 pour le(s) \xE9l\xE9ment(s). Cela peut prendre quelque temps"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Ajout de {{ count }} enregistrements dans le(s) dossier(s)","RemoveRecordsMessage":"Suppression de {{ count }} enregistrements dans le(s) dossier(s)"}},"RunProcessHandler":{"ProcessHasStarted":"L'action a bien d\xE9marr\xE9","CannotRunProcess":{"NoRecordsSelected":"Cette action n\xE9cessite au moins un enregistrement pour s'ex\xE9cuter. Veuillez s\xE9lectionner les enregistrements auxquels vous souhaitez l'appliquer et r\xE9essayer"}}}`),Qs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Seleccionar escritorio","EditDesktop":"Editar escritorio"},"BasePage":{"DesignButtonHint":"Editar p\xE1gina","ExpandButtonTitle":"Expandir","CollapseButtonTitle":"Colapsar"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Par\xE1metros no v\xE1lidos","ServiceResult":{"ErrorMessage":"Se ha producido un error. Por favor, contacte con el administrador del sistema"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Etiquetado {{ count }} elemento(s)","RemoveTagsMessage":"Elemento(s) {{ count }} sin etiquetar","AddTagsSuccessfulRunProcess":"Se inici\xF3 el proceso de etiquetado masivo para los art\xEDculos elegidos. Esto puede llevar alg\xFAn tiempo","RemoveTagsSuccessfulRunProcess":"Se inici\xF3 el proceso de eliminaci\xF3n masiva de etiquetas para los art\xEDculos elegidos. Esto puede llevar alg\xFAn tiempo"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Se agregaron {{ count }} registro(s) en las carpeta(s)","RemoveRecordsMessage":"Se eliminaron {{ count }} registro(s) de la(s) carpeta(s)"}},"RunProcessHandler":{"ProcessHasStarted":"La acci\xF3n ha comenzado con \xE9xito","CannotRunProcess":{"NoRecordsSelected":"Esta acci\xF3n necesita al menos un registro para ejecutarse. Seleccione los registros a los que desea aplicarlo e int\xE9ntelo nuevamente"}}}'),Xs=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"}}'),Ys=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Desktop ausw\xE4hlen","EditDesktop":"Desktop bearbeiten"},"BasePage":{"DesignButtonHint":"\xC4nderungsseite","ExpandButtonTitle":"Erweitern","CollapseButtonTitle":"Einklappen"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Ung\xFCltige Parameter","ServiceResult":{"ErrorMessage":"Ein Fehler ist aufgetreten. Bitte kontaktieren Sie den Systemadministrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"{{ count }} Element(e) getagged","RemoveTagsMessage":"{{ count }} Elemente(n) ohne Tag","AddTagsSuccessfulRunProcess":"Massenmarkierungsprozess f\xFCr die ausgew\xE4hlten Elemente(n) gestartet. Dies kann einige Zeit dauern","RemoveTagsSuccessfulRunProcess":"Der Prozess zum Entfernen von Tags f\xFCr die ausgew\xE4hlten Elemente(n) wurde gestartet. Dies kann einige Zeit dauern"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"{{ count }} Eintr\xE4ge(n) im Ordner(n) hinzugef\xFCgt","RemoveRecordsMessage":"{{ count }} Aufzeichnung(en) aus Ordner(n) entfernt"}},"RunProcessHandler":{"ProcessHasStarted":"Die Aktion wurde erfolgreich gestartet","CannotRunProcess":{"NoRecordsSelected":"Diese Aktion ben\xF6tigt mindestens einen Datensatz zum Ausf\xFChren. Bitte w\xE4hlen Sie die Datens\xE4tze aus, auf die Sie sie anwenden m\xF6chten und versuchen Sie es erneut"}}}'),en=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}},"RunProcessHandler":{"ProcessHasStarted":"The action has successfully started","CannotRunProcess":{"NoRecordsSelected":"This action needs at least one record to run. Please select the records you want to apply it to and try again"}}}'),tn=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u0418\u0437\u0431\u0435\u0440\u0438 \u0440\u0430\u0431\u043E\u0442\u0435\u043D \u043F\u043B\u043E\u0442","EditDesktop":"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u0430\u0439 \u0440\u0430\u0431\u043E\u0442\u043D\u0438\u044F \u043F\u043B\u043E\u0442"},"BasePage":{"DesignButtonHint":"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u0430\u0439 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0430\u0442\u0430","ExpandButtonTitle":"\u0420\u0430\u0437\u0448\u0438\u0440\u044F\u0432\u0430\u043D\u0435","CollapseButtonTitle":"\u0421\u0432\u0438\u0432\u0430\u043D\u0435"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u0438 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u0438","ServiceResult":{"ErrorMessage":"\u0412\u044A\u0437\u043D\u0438\u043A\u043D\u0430 \u0433\u0440\u0435\u0448\u043A\u0430. \u041C\u043E\u043B\u044F, \u0441\u0432\u044A\u0440\u0436\u0435\u0442\u0435 \u0441\u0435 \u0441\u044A\u0441 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u0438\u044F \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"\u041C\u0430\u0440\u043A\u0438\u0440\u0430\u043D\u0438 {{ count }} \u0435\u043B\u0435\u043C\u0435\u043D\u0442(\u0430)","RemoveTagsMessage":"\u041D\u0435\u043C\u0430\u0440\u043A\u0438\u0440\u0430\u043D\u0438 {{ count }} \u0435\u043B\u0435\u043C\u0435\u043D\u0442(\u0430)","AddTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441\u044A\u0442 \u043D\u0430 \u0433\u0440\u0443\u043F\u043E\u0432\u043E \u043C\u0430\u0440\u043A\u0438\u0440\u0430\u043D\u0435 \u0441\u0442\u0430\u0440\u0442\u0438\u0440\u0430 \u0437\u0430 \u0438\u0437\u0431\u0440\u0430\u043D\u0438\u044F(\u0442\u0435) \u0430\u0440\u0442\u0438\u043A\u0443\u043B(\u0438). \u0422\u043E\u0432\u0430 \u043C\u043E\u0436\u0435 \u0434\u0430 \u043E\u0442\u043D\u0435\u043C\u0435 \u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E \u0432\u0440\u0435\u043C\u0435","RemoveTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441\u044A\u0442 \u043D\u0430 \u0433\u0440\u0443\u043F\u043E\u0432\u043E \u043F\u0440\u0435\u043C\u0430\u0445\u0432\u0430\u043D\u0435 \u043D\u0430 \u0442\u0430\u0433\u043E\u0432\u0435 \u0435 \u0441\u0442\u0430\u0440\u0442\u0438\u0440\u0430\u043D \u0437\u0430 \u0438\u0437\u0431\u0440\u0430\u043D\u0438\u044F \u0435\u043B\u0435\u043C\u0435\u043D\u0442(\u0438). \u0422\u043E\u0432\u0430 \u043C\u043E\u0436\u0435 \u0434\u0430 \u043E\u0442\u043D\u0435\u043C\u0435 \u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E \u0432\u0440\u0435\u043C\u0435"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"\u0414\u043E\u0431\u0430\u0432\u0435\u043D\u0438 \u0441\u0430 {{ count }} \u0437\u0430\u043F\u0438\u0441(\u0430) \u0432 \u043F\u0430\u043F\u043A\u0430\u0442\u0430(\u0438\u0442\u0435)","RemoveRecordsMessage":"\u041F\u0440\u0435\u043C\u0430\u0445\u043D\u0430\u0442(\u0438) {{ count }} \u0437\u0430\u043F\u0438\u0441(\u0430) \u043E\u0442 \u043F\u0430\u043F\u043A\u0430\u0442\u0430(\u0438\u0442\u0435)"}},"RunProcessHandler":{"ProcessHasStarted":"\u0410\u043A\u0446\u0438\u044F\u0442\u0430 \u0441\u0442\u0430\u0440\u0442\u0438\u0440\u0430 \u0443\u0441\u043F\u0435\u0448\u043D\u043E","CannotRunProcess":{"NoRecordsSelected":"\u0422\u043E\u0432\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0441\u0435 \u043D\u0443\u0436\u0434\u0430\u0435 \u043E\u0442 \u043F\u043E\u043D\u0435 \u0435\u0434\u0438\u043D \u0437\u0430\u043F\u0438\u0441, \u0437\u0430 \u0434\u0430 \u0441\u0435 \u0438\u0437\u043F\u044A\u043B\u043D\u0438. \u041C\u043E\u043B\u044F, \u0438\u0437\u0431\u0435\u0440\u0435\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438\u0442\u0435, \u043A\u044A\u043C \u043A\u043E\u0438\u0442\u043E \u0438\u0441\u043A\u0430\u0442\u0435 \u0434\u0430 \u0433\u043E \u043F\u0440\u0438\u043B\u043E\u0436\u0438\u0442\u0435, \u0438 \u043E\u043F\u0438\u0442\u0430\u0439\u0442\u0435 \u043E\u0442\u043D\u043E\u0432\u043E"}}}'),an=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}},"RunProcessHandler":{"ProcessHasStarted":"The action has successfully started","CannotRunProcess":{"NoRecordsSelected":"This action needs at least one record to run. Please select the records you want to apply it to and try again"}}}'),rn=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"Select desktop","EditDesktop":"Edit desktop"},"BasePage":{"DesignButtonHint":"Edit page","ExpandButtonTitle":"Expand","CollapseButtonTitle":"Collapse"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"Not valid parameters","ServiceResult":{"ErrorMessage":"An error occurred. Please contact the system administrator"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"Tagged {{ count }} item(s)","RemoveTagsMessage":"Untagged {{ count }} item(s)","AddTagsSuccessfulRunProcess":"Bulk tagging process started for the chosen item(s). This might take some time","RemoveTagsSuccessfulRunProcess":"Bulk remove tags process started for the chosen item(s). This might take some time"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"Added {{ count }} record(s) in the folder(s)","RemoveRecordsMessage":"Removed {{ count }} record(s) from the folder(s)"}},"RunProcessHandler":{"ProcessHasStarted":"The action has successfully started","CannotRunProcess":{"NoRecordsSelected":"This action needs at least one record to run. Please select the records you want to apply it to and try again"}}}'),sn=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0440\u0430\u0431\u043E\u0447\u0438\u0439 \u0441\u0442\u043E\u043B","EditDesktop":"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0440\u0430\u0431\u043E\u0447\u0438\u0439 \u0441\u0442\u043E\u043B"},"BasePage":{"DesignButtonHint":"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443","ExpandButtonTitle":"\u0420\u0430\u0437\u0432\u0435\u0440\u043D\u0443\u0442\u044C","CollapseButtonTitle":"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"\u041D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0435 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B","ServiceResult":{"ErrorMessage":"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0441\u0432\u044F\u0436\u0438\u0442\u0435\u0441\u044C \u0441 \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u044B\u043C \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u043E\u043C"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u043C {{ count }} \u0437\u0430\u043F\u0438\u0441\u044F\u043C \u0431\u044B\u043B\u0438 \u043F\u0440\u043E\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u044B \u0442\u0435\u0433\u0438","RemoveTagsMessage":"\u0412\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u043C {{ count }} \u0437\u0430\u043F\u0438\u0441\u044F\u043C \u0431\u044B\u043B\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u044B \u0442\u0435\u0433\u0438","AddTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441\u0441 \u043C\u0430\u0441\u0441\u043E\u0432\u043E\u0433\u043E \u0442\u0435\u0433\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F \u0437\u0430\u043F\u0443\u0449\u0435\u043D \u0434\u043B\u044F \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0437\u0430\u043F\u0438\u0441\u0435\u0439. \u042D\u0442\u043E \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u043D\u044F\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0438\u043D\u0443\u0442","RemoveTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441\u0441 \u043C\u0430\u0441\u0441\u043E\u0432\u043E\u0433\u043E \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F \u0442\u0435\u0433\u043E\u0432 \u0437\u0430\u043F\u0443\u0449\u0435\u043D \u0434\u043B\u044F \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0437\u0430\u043F\u0438\u0441\u0435\u0439. \u042D\u0442\u043E \u043C\u043E\u0436\u0435\u0442 \u0437\u0430\u043D\u044F\u0442\u044C \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u043C\u0438\u043D\u0443\u0442"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E {{ count }} \u0437\u0430\u043F\u0438\u0441\u0435\u0439 \u0432 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0433\u0440\u0443\u043F\u043F\u044B","RemoveRecordsMessage":"\u0423\u0434\u0430\u043B\u0435\u043D\u043E {{ count }} \u0437\u0430\u043F\u0438\u0441\u0435\u0439 \u0438\u0437 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0445 \u0433\u0440\u0443\u043F\u043F"}},"RunProcessHandler":{"ProcessHasStarted":"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u043E","CannotRunProcess":{"NoRecordsSelected":"\u0414\u043B\u044F \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u044D\u0442\u043E\u0433\u043E \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044F \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0432\u044B\u0431\u0440\u0430\u0442\u044C \u0445\u043E\u0442\u044F \u0431\u044B \u043E\u0434\u043D\u0443 \u0437\u0430\u043F\u0438\u0441\u044C. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0438 \u043F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u0435 \u043F\u043E\u043F\u044B\u0442\u043A\u0443"}}}'),nn=JSON.parse('{"DesktopSelector":{"ShowDesktopSelector":"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u0440\u043E\u0431\u043E\u0447\u0438\u0439 \u0441\u0442\u0456\u043B","EditDesktop":"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0440\u043E\u0431\u043E\u0447\u0438\u0439 \u0441\u0442\u0456\u043B"},"BasePage":{"DesignButtonHint":"\u0420\u0435\u0434\u0430\u0433\u0443\u0432\u0430\u0442\u0438 \u0441\u0442\u043E\u0440\u0456\u043D\u043A\u0443","ExpandButtonTitle":"\u0420\u043E\u0437\u0433\u043E\u0440\u043D\u0443\u0442\u0438","CollapseButtonTitle":"\u0417\u0433\u043E\u0440\u043D\u0443\u0442\u0438"},"BaseRelatedInMainRecordsService":{"NotValidParametersMessage":"\u041D\u0435\u043F\u0440\u0438\u043F\u0443\u0441\u0442\u0438\u043C\u0456 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u0438","ServiceResult":{"ErrorMessage":"\u0421\u0442\u0430\u043B\u0430\u0441\u044F \u043F\u043E\u043C\u0438\u043B\u043A\u0430. \u0411\u0443\u0434\u044C \u043B\u0430\u0441\u043A\u0430, \u0437\u0432\u0435\u0440\u043D\u0456\u0442\u044C\u0441\u044F \u0434\u043E \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u0433\u043E \u0430\u0434\u043C\u0456\u043D\u0456\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0430"}},"TaggingService":{"ServiceResult":{"AddTagsMessage":"\u0412\u0438\u0431\u0440\u0430\u043D\u0438\u043C {{ count }} \u0437\u0430\u043F\u0438\u0441\u0430\u043C \u0431\u0443\u043B\u0438 \u043F\u0440\u043E\u0441\u0442\u0430\u0432\u043B\u0435\u043D\u0456 \u0442\u0435\u0433\u0438","RemoveTagsMessage":"\u0412\u0438\u0431\u0440\u0430\u043D\u0438\u043C {{ count }} \u0437\u0430\u043F\u0438\u0441\u0430\u043C \u0431\u0443\u043B\u0438 \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u0456 \u0442\u0435\u0433\u0438","AddTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441 \u043C\u0430\u0441\u043E\u0432\u043E\u0433\u043E \u0442\u0435\u0433\u0443\u0432\u0430\u043D\u043D\u044F \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u043E \u0434\u043B\u044F \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u0437\u0430\u043F\u0438\u0441\u0456\u0432. \u0426\u0435 \u043C\u043E\u0436\u0435 \u0437\u0430\u0439\u043D\u044F\u0442\u0438 \u043A\u0456\u043B\u044C\u043A\u0430 \u0445\u0432\u0438\u043B\u0438\u043D","RemoveTagsSuccessfulRunProcess":"\u041F\u0440\u043E\u0446\u0435\u0441 \u043C\u0430\u0441\u043E\u0432\u043E\u0433\u043E \u0432\u0438\u0434\u0430\u043B\u0435\u043D\u043D\u044F \u0442\u0435\u0433\u0456\u0432 \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u043E \u0434\u043B\u044F \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u0437\u0430\u043F\u0438\u0441\u0456\u0432.. \u0426\u0435 \u043C\u043E\u0436\u0435 \u0437\u0430\u0439\u043D\u044F\u0442\u0438 \u043A\u0456\u043B\u044C\u043A\u0430 \u0445\u0432\u0438\u043B\u0438\u043D"}},"StaticFolderService":{"ServiceResult":{"AddRecordsMessage":"\u0414\u043E\u0434\u0430\u043D\u043E {{ count }} \u0437\u0430\u043F\u0438\u0441\u0456\u0432 \u0443 \u0432\u0438\u0431\u0440\u0430\u043D\u0456 \u0433\u0440\u0443\u043F\u0438","RemoveRecordsMessage":"\u0412\u0438\u0434\u0430\u043B\u0435\u043D\u043E {{ count }} \u0437\u0430\u043F\u0438\u0441\u0456\u0432 \u0456\u0437 \u0432\u0438\u0431\u0440\u0430\u043D\u0438\u0445 \u0433\u0440\u0443\u043F"}},"RunProcessHandler":{"ProcessHasStarted":"\u0414\u0456\u044F \u0443\u0441\u043F\u0456\u0448\u043D\u043E \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u0430","CannotRunProcess":{"NoRecordsSelected":"\u0414\u043B\u044F \u0432\u0438\u043A\u043E\u043D\u0430\u043D\u043D\u044F \u0446\u0456\u0454\u0457 \u0434\u0456\u0457 \u043F\u043E\u0442\u0440\u0456\u0431\u043D\u043E \u0432\u0438\u0431\u0440\u0430\u0442\u0438 \u043F\u0440\u0438\u043D\u0430\u0439\u043C\u043D\u0456 \u043E\u0434\u0438\u043D \u0437\u0430\u043F\u0438\u0441. \u0411\u0443\u0434\u044C \u043B\u0430\u0441\u043A\u0430, \u043F\u043E\u0437\u043D\u0430\u0447\u0442\u0435 \u0437\u0430\u043F\u0438\u0441\u0438 \u0442\u0430 \u0441\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0449\u0435 \u0440\u0430\u0437"}}}'),on={"hr-HR":Ms,"lv-LV":xs,"hu-HU":bs,"zh-TW":ws,"zh-CN":ks,"vi-VN":Os,"tr-TR":Vs,"th-TH":Fs,"sv-SE":Hs,"sq-AL":Bs,"ro-RO":Ls,"pt-PT":Us,"pt-BR":js,"pl-PL":$s,"nl-NL":Gs,"ko-KR":Zs,"ja-JP":zs,"it-IT":qs,"id-ID":Ks,"he-IL":Ws,"fr-FR":Js,"es-ES":Qs,"en-GB":Xs,"de-DE":Ys,"cs-CZ":en,"bg-BG":tn,"ar-SA":an,"en-US":rn,"uk-UA":nn,"ru-RU":sn};let q=class{};q.\u0275fac=function(e){return new(e||q)},q.\u0275mod=s.\u0275\u0275defineNgModule({type:q}),q.\u0275inj=s.\u0275\u0275defineInjector({providers:[g.ChangeComposerService,C.PACKAGE_INFO_INITIALIZER_PROVIDER,C.HANDLER_CHAIN_ADAPTER_APP_INITIALIZER_PROVIDER,C.HandlerChainAdapter,h.REQUIRE_JS_PATH_REGISTER_PROVIDER,S.REQUEST_HANDLER_REGISTER_SERVICE_APP_INITIALIZER_PROVIDER,S.MODEL_LIVE_EDITING_NOTIFICATION_APP_INITIALIZER_PROVIDER,{provide:g.DATA_GRID_STATE_HANDLER,useClass:De.ex},K.DATA_GRID_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,{provide:g.DataGridColumnSelectionService,useFactory:i=>new K.SchemaDataGridColumnSelectionService(i),deps:[K.StructureExplorerDataGridColumnSelectionService]},K.StructureExplorerDataGridColumnSelectionService,{provide:S.DataSourceFactoryService,useClass:R.Q1},h.FileReaderService,h.FileApiService,C.FEATURE_VALUES_APP_INITIALIZER_PROVIDER,C.FEATURE_VALUES_PROVIDER,{provide:g.DATA_GRID_COLUMN_EDIT_HANDLER,useClass:K.SchemaDataGridColumnEditHandler},h.DATA_SERVICE_URI_PROVIDER,h.USER_INFO_PROVIDER,{provide:Ce.DataServiceQueryExecutor,useExisting:Ce.QueryExecutor},{provide:Ka.RemoteEntryLoader,useFactory:Ka.getGlobalRemoteEntryLoader},{provide:j.JIT_MODULES,multi:!0,useValue:[g.CrtComponentsModule,De.vq,z,g.CrtActionDashboardModule,g.CrtCampaignViewerModule,w.CrtChartWidgetModule,w.CrtGaugeWidgetModule,w.CrtFunnelWidgetModule,w.CrtIndicatorWidgetModule,O.CdkModule,B]},{provide:h.APPEARANCE_SETTINGS_LOADER,useClass:C.AppearanceSettingsApiService},{provide:h.APPEARANCE_SETTINGS_DEFAULT_LOADER,useClass:R.jZ},{provide:R.F$,useValue:oe},R.FL,R.N1,{provide:S.CRT_METADATA_PREPROCESSOR,useClass:se,multi:!0},{provide:S.CRT_METADATA_PREPROCESSOR,useClass:pe,multi:!0},{provide:D.ClientParentSchemaService,useClass:R.Tx},{provide:V.SCHEMA_COMPONENT_INJECTION_TOKEN,useValue:P},{provide:s.APP_INITIALIZER,useFactory:Ns,deps:[C.FeatureService,C.RemoteEntryService],multi:!0}],imports:[za.BrowserAnimationsModule,w.CrtChartWidgetModule,w.CrtGaugeWidgetModule,x.CommonModule,g.CrtComponentsModule,b.DialogModule,Pe.FormsModule,w.CrtFunnelWidgetModule,w.CrtIndicatorWidgetModule,S.ModelModule,Pe.ReactiveFormsModule,V.SchemaModule,z,De.vq,j.ViewModule,je.HttpClientXsrfModule.withOptions({cookieName:"BPMCSRF",headerName:"BPMCSRF"}),k.TranslateModule.forRoot({defaultLanguage:"en-US",loader:{provide:k.TranslateLoader,useFactory:(i,e)=>new br.TranslateHttpLoader(i,e+"ClientApp/assets/i18n/"),deps:[je.HttpClient,x.APP_BASE_HREF]}}),N.CrtLibTranslateModule.forRoot({i18n:(0,E.merge)({},on,Is)}),qa.StructureExplorerModule,B,h.SaveScrollPositionModule,O.CheckOperationPermissionPipeModule,C.CommonApiModule]}),q=(0,l.__decorate)([(0,o.CrtModule)({includes:[{load:()=>v.e(5345).then(v.t.bind(v,35345,23)).then(i=>i.CrtCalendarModule),...window.creatio._lazyModulesMetadata.host.CrtCalendarModule},g.CrtComponentsModule,w.CrtChartWidgetModule,w.CrtFunnelWidgetModule,w.CrtIndicatorWidgetModule,w.CrtGaugeWidgetModule,S.ModelModule,De.vq,B],converters:[Ke,ze,We,we,Je,Qe,qe,Xe,Ee,Ye,et,rt,tt,st,nt,ot],requestHandlers:[Ra,Ia,jt,it,ct,Tt,lt,ht,gt,_t,St,ft,vt,Ct,yt,Sa,fa,va,Oe,Dt,Nt,It,Mt,Ve,xt,bt,ke,wt,Pt,kt,Ot,Vt,Ta,ja,Ft,Ht,Bt,Lt,Ut,Gt,Et,Zt,zt,qt,Kt,Wt,Jt,Ea,Qt,Yt,Xt,ea,Da,ta,aa,ra,sa,La,Na,$t,oa,ia,Rt,ca,la,da,ua,ma,pa,ha,ga,_a,Ca,ya,Ua,Aa,Pa,Ue,Ma,xa,$a,Ga,ba,na,wa,ka,Oa,Va,Fa,Ha,Ba],handlerChainServices:[h.ApplicationInfoService,Ce.DataServiceQueryExecutor,C.FeatureService,C.HttpClientService,C.LicenseService,b.MaskService,S.ModelGenerator,C.RightsService,C.SysSettingsService,h.CrtZoneService]})],q),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(q,{declarations:[te,J,Q,X,ae,ge,oe,Z,G],imports:[za.BrowserAnimationsModule,w.CrtChartWidgetModule,w.CrtGaugeWidgetModule,x.CommonModule,g.CrtComponentsModule,b.DialogModule,Pe.FormsModule,w.CrtFunnelWidgetModule,w.CrtIndicatorWidgetModule,S.ModelModule,Pe.ReactiveFormsModule,V.SchemaModule,z,De.vq,j.ViewModule,je.HttpClientXsrfModule,k.TranslateModule,N.CrtLibTranslateModule,qa.StructureExplorerModule,B,h.SaveScrollPositionModule,O.CheckOperationPermissionPipeModule,C.CommonApiModule],exports:[P]})}();class fe extends T.aK{constructor(e){super(),this._schemaModalService=e,this._dialogList=new Map}_showSegments(e=[]){var t=this;return(0,d.Z)(function*(){for(const a of e){const r=t._getSegmentKey(a);if(!t._dialogList.has(r)){const n=yield t._schemaModalService.show({...a,preventDefaultCloseCommand:!0});t._dialogList.set(r,n)}yield t._showSegments(a.children)}})()}_getNeedToCloseSegmentKeys(e){const t=Array.from(this._dialogList.keys()),a=this._getFlatSegments(e);return t.filter(n=>!a.some(c=>n===this._getSegmentKey(c)))}_getSegmentKey(e){return`${e.contextName}_${e.schemaName}_${e.action}_${e.recordId}`}_getFlatSegments(e){let t=[];return e.forEach(a=>{if(t.push(a),a.children){const r=this._getFlatSegments(a.children);t=t.concat(r)}}),t}applySegments(e){var t=this;return(0,d.Z)(function*(){t._getNeedToCloseSegmentKeys(e).forEach(r=>{t._dialogList.get(r).close(),t._dialogList.delete(r)}),yield t._showSegments(e)})()}getTarget(){return A.CHILD_NAVIGATION_TARGETS.Modal}}fe.\u0275fac=function(e){return new(e||fe)(s.\u0275\u0275inject(_e.L))},fe.\u0275prov=s.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac})},60954:Ae=>{Ae.exports=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24">
  <defs>
    <path id="a" fill="#fff" d="M0,0H1.7V5.1H0V0"/>
    <path id="b" fill="#fff" d="M0,0H10.774V2.552H0V0"/>
  </defs>
  <rect width="24" height="24" fill="none" rx="4"/>
  <path fill="#fff" d="M0,0H4.031V2.552H0V0" transform="rotate(180 3.701 3.488)"/>
  <use xlink:href="#a" transform="rotate(180 4.23 4.125)"/>
  <use xlink:href="#a" transform="rotate(180 8.095 7.276)"/>
  <use xlink:href="#a" transform="rotate(180 4.095 10.421)"/>
  <path fill="#fff" d="M0,0H11.969V2.552H0V0" transform="rotate(180 7.67 6.634)"/>
  <path fill="#fff" d="M0,0H3.18V2.552H0V0" transform="rotate(180 3.276 9.823)"/>
  <use xlink:href="#b" transform="rotate(180 10.364 3.488)"/>
  <path fill="#fff" d="M0,0H3.122V2.552H0V0" transform="rotate(180 10.364 6.634)"/>
  <use xlink:href="#b" transform="rotate(180 10.364 9.823)"/>
</svg>
`},94171:Ae=>{Ae.exports=`<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18.333 5.83325H2.83301C2.28072 5.83325 1.83301 6.28097 1.83301 6.83325V13.1666C1.83301 13.7189 2.28072 14.1666 2.83301 14.1666H18.333C18.8853 14.1666 19.333 13.7189 19.333 13.1666V6.83325C19.333 6.28097 18.8853 5.83325 18.333 5.83325Z" stroke="white" stroke-width="2"/>
<path d="M10.5889 15.0925V17.9167" stroke="white" stroke-width="2" stroke-linecap="round"/>
<path d="M7.25586 17.9165H13.9225" stroke="white" stroke-width="2" stroke-linecap="round"/>
<path d="M6.00586 6.25V13.75" stroke="white"/>
<path d="M6.00586 9.58325H18.5059" stroke="white"/>
</svg>
`}}]);
