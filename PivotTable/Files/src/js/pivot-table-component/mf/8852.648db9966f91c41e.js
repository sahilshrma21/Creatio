(self.webpackChunkapp_studio_enterprise_pivot_table=self.webpackChunkapp_studio_enterprise_pivot_table||[]).push([[8852],{78852:(Jr,en,d)=>{d.r(en),d.d(en,{ARITHMETIC_OPERATOR_ORDER_VALIDATOR:()=>jn,AggregationSubQueryOperandDefinition:()=>nn,ArithmeticOperator:()=>we,ArithmeticOperatorDataTypeValidator:()=>Oe,ArithmeticOperatorDefinition:()=>O,BaseFormulaConverter:()=>Ye,BaseFormulaItem:()=>yt,BinaryOperatorOrderValidator:()=>Yt,CHECK_NOT_ONLY_COLUMN_FORMULA_VALIDATOR:()=>An,COLUMN_FUNCTION_NAME:()=>Gt,COMMA_ORDER_VALIDATOR:()=>Ln,CONST_FUNCTION_NAME:()=>Ut,CheckNotOnlyColumnFormulaValidator:()=>Mn,ColumnOperand:()=>Ve,ColumnOperandDefinition:()=>Ee,CommaOperator:()=>wt,CommaOperatorDefinition:()=>ke,CommaOrderValidator:()=>Fn,ConstantOperand:()=>Q,DECIMAL_SEPARATOR_VALIDATOR:()=>Wn,DIVISION_BY_ZERO_VALIDATOR:()=>zn,DecimalSeparatorValidator:()=>xn,DefaultFormulaItemDefinitionProvider:()=>be,DivisionByZeroError:()=>hn,DivisionByZeroValidator:()=>vn,EXPRESSION_VALIDATOR:()=>Qt,EXPRESSION_VALIDATORS_COLLECTION:()=>He,ExpressionToFormulaConverter:()=>y,ExpressionToFormulaConverterMock:()=>Pr,FORMULA_ITEMS_VALIDATOR:()=>Jt,FORMULA_ITEMS_VALIDATORS_COLLECTION:()=>Bt,FUNCTION_DEFINITIONS:()=>Vt,FUNCTION_STRUCTURE_VALIDATOR:()=>Pn,Formula:()=>We,FormulaAdvancedToolbarComponentModule:()=>w,FormulaDefinitionToItemConversionVisitor:()=>v,FormulaDefinitionsToItemsConversionVisitorDecorator:()=>J,FormulaDesignerComponent:()=>q,FormulaDesignerModule:()=>W,FormulaInputModelsConverter:()=>X,FormulaItem:()=>ot,FormulaItemConverterExpressionVisitor:()=>G,FormulaItemDefinition:()=>Re,FormulaItemDefinitionMock:()=>cr,FormulaItemDefinitionProvider:()=>M,FormulaItemDefinitionProviderMock:()=>cn,FormulaItemDefinitionVisitor:()=>z,FormulaItemDefinitionVisitorMock:()=>un,FormulaItemValidationError:()=>S,FormulaItemVisitor:()=>Nt,FormulaItemsDefinitionsVisitor:()=>Ge,FormulaMock:()=>Pe,FormulaModule:()=>xe,FormulaToExpressionConverter:()=>Ae,Function:()=>xt,FunctionArgumentsCountValidator:()=>ge,FunctionArgumentsDataTypeValidator:()=>De,FunctionDefinition:()=>m,FunctionParameterDefinition:()=>qn,FunctionReturnDefinition:()=>er,FunctionStructureValidator:()=>Cn,FunctionType:()=>l,InvalidFunctionArgumentDataTypeError:()=>mn,InvalidFunctionArgumentsCountError:()=>pn,ItemDefinitionGroup:()=>jt,MAX_NUMBER_LENGTH_VALIDATOR:()=>Gn,MathjsExpressionTextConverter:()=>K,MathjsFormulaConverter:()=>Ie,MathjsFormulaItemVisitor:()=>C,MaxNumberLengthError:()=>Rt,MaxNumberLengthValidator:()=>Tn,MissingOperandError:()=>kt,MissingParenthesesError:()=>zt,NUMBER_CORRECTNESS_VALIDATOR:()=>Un,NotSupportedOnlyColumnError:()=>dn,NumberCorrectnessValidator:()=>yn,OPERAND_ORDER_VALIDATOR:()=>Rn,Operand:()=>Le,OperandDefinition:()=>st,OperandOrderValidator:()=>_e,Operator:()=>ve,OperatorDefinition:()=>Se,PARENTHESES_COUNT_VALIDATOR:()=>kn,PARENTHESES_ORDER_VALIDATOR:()=>Vn,ParenthesesCountValidator:()=>wn,ParenthesesOperator:()=>at,ParenthesesOperatorDefinition:()=>Ne,ParenthesesOrderValidator:()=>En,ParenthesesType:()=>p,PointOperator:()=>Et,PointOperatorDefinition:()=>ze,RELATION_OPERATOR_ORDER_VALIDATOR:()=>Cr,REQUIRED_FORMULA_VALIDATOR:()=>bn,RelationOperator:()=>St,RelationOperatorDefinition:()=>rn,RequiredError:()=>Sn,RequiredFormulaValidator:()=>Nn,SubQueryOperandDefinition:()=>bt,SysSettingOperand:()=>Ft,SysSettingOperandDefinition:()=>At,SysVariableOperand:()=>vt,SysVariableOperandDefinition:()=>Pt,UnexpectedDecimalSeparatorError:()=>fn,UnexpectedItemError:()=>T,UnexpectedParenthesesError:()=>In,UnsupportedBinaryOperatorDataTypeError:()=>gn,additionOperator:()=>Ht,additionOperatorDefinition:()=>Ze,aggregationSubQueryDefinition:()=>It,aggregationSubQueryOperand:()=>kr,closingParenthesesOperator:()=>Kt,closingParenthesesOperatorDefinition:()=>et,columnDefinition:()=>ft,columnOperand:()=>Zn,commaOperator:()=>$n,commaOperatorDefinition:()=>Ot,divisionOperator:()=>Kn,divisionOperatorDefinition:()=>Xe,equalOperator:()=>Qr,equalOperatorDefinition:()=>Ct,formulaItemDefinitionProviderMock:()=>Xn,formulaItemDefinitionVisitResultMock:()=>ur,functionDefinitions:()=>Qn,functionsDefinitions:()=>Vr,generateConstant:()=>tt,getDesignTimeFunctionConfig:()=>Ue,getMetadataFunctionConfig:()=>an,groupFunctions:()=>sn,multiplicationOperator:()=>Wr,multiplicationOperatorDefinition:()=>$e,openingParenthesesOperator:()=>Zt,openingParenthesesOperatorDefinition:()=>qe,operandDefinitions:()=>Jn,operandsDefinitions:()=>Lr,operatorDefinitions:()=>Bn,operatorsDefinitions:()=>jr,pointOperator:()=>Yr,pointOperatorDefinition:()=>_t,subQueryDefinition:()=>ht,subQueryOperand:()=>Rr,subtractionOperator:()=>Gr,subtractionOperatorDefinition:()=>Ke,sumFunction:()=>Hn,sumFunctionDefinition:()=>dt,sysSettingDefinition:()=>gt,sysSettingOperand:()=>zr,sysVariableDefinition:()=>Dt,sysVariableOperand:()=>Ur});var f=d(31134),F=d(14535),re=d(32820),ie=d(95697),tn=d(34560),Fe=d(30955),Mt=d(72856),nt=d(66868),Tt=d(30738),rt=d(59972),it=d(24141),n=d(94450),a=d(49475),oe=d(97600),l;(function(i){i[i.Logic=0]="Logic",i[i.String=1]="String",i[i.DateTime=2]="DateTime",i[i.Math=3]="Math"})(l||(l={}));var c=d(75378),p;(function(i){i.Opening="(",i.Closing=")"})(p||(p={}));class yt{constructor(e,t){this.type=e,this.caption=t}}class ot extends yt{constructor(e,t,r){super(t,r),this._id=e}get id(){return this._id}checkVisitorAndVisitFormulaItem(e,t){return c.ValidationUtilities.checkArgumentEmpty("visitor",e),t(e)}}class xt extends ot{constructor(e,t){super(e,a.ExpressionType.Function,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitFunctionFormulaItem(this))}}class Le extends ot{constructor(e,t,r){super(e,a.ExpressionType.Operand,r),this.operandType=t}}class Ve extends Le{constructor(e,t){super(e,a.OperandType.Column,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitColumnOperand(this))}}class Q extends Le{constructor(e,t,r,o){super(r,a.OperandType.Const,o||Q._getSafeValue(e)),this.dataType=t,this.value=Q._getSafeValue(e),this.dataType=t??a.ConstantOperandDataTypeResolver.getResultDataType(e)}static _getSafeValue(e){return e!=null?String(e):""}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitConstantOperand(this))}}class Ft extends Le{constructor(e,t){super(e,a.OperandType.SysSetting,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitSysSettingOperand(this))}}class vt extends Le{constructor(e,t){super(e,a.OperandType.SysVariable,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitSysVariableOperand(this))}}class ve extends ot{constructor(e,t,r){super(e,a.ExpressionType.Operator,r),this.operatorType=t}}class we extends ve{constructor(e,t,r){super(e,a.OperatorType.Arithmetic,r),this.arithmeticOperatorType=t}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitArithmeticOperator(this))}}class wt extends ve{constructor(e,t){super(e,a.OperatorType.Comma,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitCommaOperator(this))}}class at extends ve{constructor(e,t,r){super(e,a.OperatorType.Parentheses,r),this.parenthesesType=t}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitParenthesesOperator(this))}}class Et extends ve{constructor(e,t){super(e,a.OperatorType.Point,t)}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitPointOperator(this))}}class St extends ve{constructor(e,t,r){super(e,a.OperatorType.Relation,r),this.relationOperationType=t}accept(e){return this.checkVisitorAndVisitFormulaItem(e,t=>t.visitRelationOperator(this))}}class Nt{}class Re extends yt{constructor(e,t){super(e,t)}checkVisitorAndVisitDefinition(e,t){return c.ValidationUtilities.checkArgumentEmpty("visitor",e),t(e)}}class m extends Re{constructor(e,t,r,o,s){super(a.ExpressionType.Function,e),this.code=t,this.functionType=r,this.parameterDefinitions=o,this.returnDefinition=s}get id(){return this.code}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitFunctionDefinition(this))}}class qn{}class er{}class st extends Re{constructor(e,t,r){super(a.ExpressionType.Operand,r),this.operandType=e,this.dataType=t}}class Ee extends st{constructor(e,t,r){super(a.OperandType.Column,e,r||t),this.columnPath=t}get id(){return(0,a.getColumnDefinitionId)(this)}get columnType(){return a.ColumnOperandType.SchemaColumn}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitColumnOperandDefinition(this))}}class bt extends Ee{constructor(e,t,r,o){super(e,t,o),this.subFilters=r}get id(){return(0,a.getSubQueryColumnDefinitionId)(this)}get columnType(){return a.ColumnOperandType.SubQuery}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitSubQueryOperandDefinition(this))}}class nn extends bt{constructor(e,t,r,o,s){super(e,t,o,s),this.aggregationType=r}get id(){return(0,a.getAggregationSubQueryColumnDefinitionId)(this)}get columnType(){return a.ColumnOperandType.Aggregation}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitAggregationSubQueryOperandDefinition(this))}}class At extends st{constructor(e,t,r){super(a.OperandType.SysSetting,t,r||e),this.code=e}get id(){return this.code}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitSysSettingOperandDefinition(this))}}class Pt extends st{constructor(e,t,r){super(a.OperandType.SysVariable,t,r||e),this.name=e}get id(){return this.name}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitSysVariableOperandDefinition(this))}}class Se extends Re{constructor(e,t){super(a.ExpressionType.Operator,t),this.operatorType=e}}class O extends Se{constructor(e,t){super(a.OperatorType.Arithmetic,t||(0,a.convertArithmeticOperatorTypeToString)(e)),this.arithmeticOperatorType=e}get id(){return(0,a.convertArithmeticOperatorTypeToString)(this.arithmeticOperatorType)}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitArithmeticOperatorDefinition(this))}}class ke extends Se{constructor(e){super(a.OperatorType.Comma,e)}get id(){return","}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitCommaOperatorDefinition(this))}}class Ne extends Se{constructor(e,t){super(a.OperatorType.Parentheses,t||e),this.parenthesesType=e}get id(){return this.parenthesesType}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitParenthesesOperatorDefinition(this))}}class ze extends Se{constructor(e){super(a.OperatorType.Point,e)}get id(){return"."}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitPointOperatorDefinition(this))}}class rn extends Se{constructor(e,t){super(a.OperatorType.Relation,t||(0,a.convertRelationOperatorTypeToString)(e)),this.relationOperationType=e}get id(){return(0,a.convertRelationOperatorTypeToString)(this.relationOperationType)}accept(e){return this.checkVisitorAndVisitDefinition(e,t=>t.visitRelationOperatorDefinition(this))}}class jt{constructor(e,t){this.captionKey=e,this.items=t}}var ae=d(77207);class M{getById(e){const t=this.findWhere({id:e});if(!t)throw new Error(`definition with id:${e} not found`);return t}findWhere(e){const t=this.getDefinitions();return(0,oe.find)(t,e)}}const P="DATEDIFF",j="DATEADD",se="DATEPART",D=[c.DataValueType.Date,c.DataValueType.DateTime],ce=[c.DataValueType.Time,c.DataValueType.DateTime],Lt=[c.DataValueType.Date,c.DataValueType.Time,c.DataValueType.DateTime],L=i=>[{name:"date1",dataTypes:i,description:"The first date to calculate the difference."},{name:"date2",dataTypes:i,description:"The second date to calculate the difference."}],V={dataType:c.DataValueType.Integer,description:"Result date."},tr=[new m("localizableStrings.FunctionDateDiffYearsCaption",P+"YEARS",l.DateTime,L(D),V),new m("localizableStrings.FunctionDateDiffQuartersCaption",P+"QUARTERS",l.DateTime,L(D),V),new m("localizableStrings.FunctionDateDiffMonthsCaption",P+"MONTHS",l.DateTime,L(D),V),new m("localizableStrings.FunctionDateDiffWeeksCaption",P+"WEEKS",l.DateTime,L(D),V),new m("localizableStrings.FunctionDateDiffDaysCaption",P+"DAYS",l.DateTime,L(D),V),new m("localizableStrings.FunctionDateDiffHoursCaption",P+"HOURS",l.DateTime,L(ce),V),new m("localizableStrings.FunctionDateDiffMinutesCaption",P+"MINUTES",l.DateTime,L(ce),V),new m("localizableStrings.FunctionDateDiffSecondsCaption",P+"SECONDS",l.DateTime,L(ce),V)],R=i=>[{name:"date",dataTypes:i,description:"The date that will be modified."},{name:"number",dataTypes:[c.DataValueType.Integer],description:"The number of interval to add to date."}],k={dataType:c.DataValueType.DateTime,description:"Result date."},nr=[new m("localizableStrings.FunctionDateAddYearsCaption",j+"YEARS",l.DateTime,R(D),k),new m("localizableStrings.FunctionDateAddQuartersCaption",j+"QUARTERS",l.DateTime,R(D),k),new m("localizableStrings.FunctionDateAddMonthsCaption",j+"MONTHS",l.DateTime,R(D),k),new m("localizableStrings.FunctionDateAddWeeksCaption",j+"WEEKS",l.DateTime,R(D),k),new m("localizableStrings.FunctionDateAddDaysCaption",j+"DAYS",l.DateTime,R(D),k),new m("localizableStrings.FunctionDateAddHoursCaption",j+"HOURS",l.DateTime,R(ce),k),new m("localizableStrings.FunctionDateAddMinutesCaption",j+"MINUTES",l.DateTime,R(ce),k),new m("localizableStrings.FunctionDateAddSecondsCaption",j+"SECONDS",l.DateTime,R(ce),k)],ue=i=>[{name:"date",dataTypes:i,description:"The date form which to take part."}],le={dataType:c.DataValueType.Integer,description:"Result date."},rr=[new m("localizableStrings.FunctionDatePartYearsCaption",se+"YEARS",l.DateTime,ue(D),le),new m("localizableStrings.FunctionDatePartMonthsCaption",se+"MONTHS",l.DateTime,ue(D),le),new m("localizableStrings.FunctionDatePartWeeksCaption",se+"WEEKS",l.DateTime,ue(D),le),new m("localizableStrings.FunctionDatePartDaysWeeksCaption",se+"DAYSWEEKS",l.DateTime,ue(D),le),new m("localizableStrings.FunctionDatePartDaysCaption",se+"DAYS",l.DateTime,ue(D),le),new m("localizableStrings.FunctionDatePartHoursCaption",se+"HOURS",l.DateTime,ue(ce),le)],ir={dataType:c.DataValueType.DateTime,description:"Result date."},or=[new m("localizableStrings.FunctionGetDateTimeCaption","GETDATE",l.DateTime,[],ir)],Vt=[...tr,...nr,...rr,...or],ct=new m("localizableStrings.FunctionDateDiffYearsCaption",P,l.DateTime,L(Lt).concat({name:"interval",dataTypes:[c.DataValueType.Integer],description:"The time/date interval to add."}),V),ut=new m("localizableStrings.FunctionDatePartCaption",se,l.DateTime,ue(Lt).concat({name:"interval",dataTypes:[c.DataValueType.Integer],description:"The time/date interval to add."}),le),lt=new m("localizableStrings.FunctionDateAddCaption",j,l.DateTime,R(Lt).concat({name:"interval",dataTypes:[c.DataValueType.Integer],description:"The time/date interval to add."}),k);function on(i){const e=i.code;return e.startsWith(ct.code)?{fnCode:ct.code,fnDefinitionId:ct.id}:e.startsWith(lt.code)?{fnCode:lt.code,fnDefinitionId:lt.id}:e.startsWith(ut.code)?{fnCode:ut.code,fnDefinitionId:ut.id}:{fnCode:e,fnDefinitionId:i.id}}function ar(i){let e="";switch(i){case"DATEPARTYEARS":case"DATEDIFFYEARS":case"DATEADDYEARS":{e="Y";break}case"DATEPARTQUARTERS":case"DATEDIFFQUARTERS":case"DATEADDQUARTERS":{e="Q";break}case"DATEPARTMONTHS":case"DATEDIFFMONTHS":case"DATEADDMONTHS":{e="M";break}case"DATEPARTWEEKS":case"DATEADDWEEKS":case"DATEDIFFWEEKS":{e="W";break}case"DATEPARTDAYS":case"DATEDIFFDAYS":case"DATEADDDAYS":{e="D";break}case"DATEPARTHOURS":case"DATEDIFFHOURS":case"DATEADDHOURS":{e="H";break}case"DATEPARTMINUTES":case"DATEDIFFMINUTES":case"DATEADDMINUTES":{e="Mi";break}case"DATEPARTDAYSWEEKS":case"DATEDIFFDAYSWEEKS":case"DATEADDDAYSWEEKS":{e="DW";break}case"DATEDIFFSECONDS":case"DATEPARTSECONDS":case"DATEADDSECONDS":{e="S";break}default:return[]}return[new a.ConstOperandExpression(e,c.DataValueType.Text)]}function an(i,e){const t=ar(i.code),r=e.concat(t),o=on(i);return{fnArgs:r,fnCode:o.fnCode,fnDefinitionId:o.fnDefinitionId}}function sn(i){return oe.chain(i).map(t=>t).groupBy(t=>on(t).fnCode).map((t,r)=>t.length>1?new jt(`localizableStrings.${r}FunctionsMenuCaption`,t):t[0]).value()}function Ue(i){const e=i.arguments;switch(i.code){case ct.code:case ut.code:case lt.code:{const t=sr(i);return{fnArgs:e.slice(0,e.length-1),fnCode:t?.code||i.code,fnDefinitionId:t?.id||i.definitionId}}default:return{fnArgs:e,fnCode:i.code,fnDefinitionId:i.definitionId}}}function sr(i){const e=i.arguments,t=e[e.length-1];let r=i.code;switch(t.value){case"Y":r+="YEARS";break;case"Q":r+="QUARTERS";break;case"M":r+="MONTHS";break;case"D":r+="DAYS";break;case"W":r+="WEEKS";break;case"H":r+="HOURS";break;case"Mi":r+="MINUTES";break;case"DW":r+="DAYSWEEKS";break;case"S":r+="SECONDS";break}return Vt.find(o=>o.code===r)}class be extends M{constructor(e){super(),this._translateService=e,this._defaultPinnedOperatorsDefinitions=[new O(a.ArithmeticOperatorType.Addition,"+"),new O(a.ArithmeticOperatorType.Subtraction,"\u2212"),new O(a.ArithmeticOperatorType.Multiplication,"\u2217"),new O(a.ArithmeticOperatorType.Division,"/"),new Ne(p.Opening,"("),new Ne(p.Closing,")")],this._defaultOperatorsDefinitions=[...this._defaultPinnedOperatorsDefinitions,new ze("."),new ke(",")],this.definitions=new Map,this._defaultFunctionDefinitions=this.getDefaultFunctionDefinitions()}get functionDefinitions(){return this._defaultFunctionDefinitions}get operandDefinitions(){return[]}get operatorDefinitions(){return this._defaultOperatorsDefinitions}getDefaultFunctionDefinitions(){return(0,oe.cloneDeep)(Vt).map(e=>{const t=e;return new m(this._translateService.instant(t.caption),t.code,t.functionType,t.parameterDefinitions,t.returnDefinition)})}addDefinition(e){e&&this.definitions.set(e.id,e)}getDefinitions(){return[...this.definitions.values(),...this.functionDefinitions,...this.operandDefinitions,...this.operatorDefinitions]}getPinnedDefinitions(){return[...this._defaultPinnedOperatorsDefinitions]}addDefinitions(e){e&&e.length>0&&e.forEach(t=>this.addDefinition(t))}clearDefinitions(){this.definitions.clear()}}be.\u0275fac=function(e){return new(e||be)(n.\u0275\u0275inject(ae.TranslateService))},be.\u0275prov=n.\u0275\u0275defineInjectable({token:be,factory:be.\u0275fac});class z{}class v extends z{_checkDefinitionIsDefined(e){c.ValidationUtilities.checkArgumentEmpty("definition",e)}_createColumnOperand(e){return this._checkDefinitionIsDefined(e),new Ve(e.id,e.caption)}visitFunctionDefinition(e){return this._checkDefinitionIsDefined(e),new xt(e.id,e.caption)}visitAggregationSubQueryOperandDefinition(e){return this._createColumnOperand(e)}visitColumnOperandDefinition(e){return this._createColumnOperand(e)}visitSubQueryOperandDefinition(e){return this._createColumnOperand(e)}visitSysSettingOperandDefinition(e){return this._checkDefinitionIsDefined(e),new Ft(e.id,e.caption)}visitSysVariableOperandDefinition(e){return this._checkDefinitionIsDefined(e),new vt(e.id,e.caption)}visitArithmeticOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new we(e.id,e.arithmeticOperatorType,e.caption)}visitCommaOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new wt(e.id,e.caption)}visitParenthesesOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new at(e.id,e.parenthesesType,e.caption)}visitPointOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new Et(e.id,e.caption)}visitRelationOperatorDefinition(e){return this._checkDefinitionIsDefined(e),new St(e.id,e.relationOperationType,e.caption)}}v.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(v)))(t||v)}}(),v.\u0275prov=n.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac,providedIn:"root"});class J extends z{constructor(e,t){super(),this._formulaDefinitionToItemConversionVisitor=e,this._formulaItemDefinitionProvider=t}_getFormulaItem(e){return this._formulaItemDefinitionProvider.findWhere(e).accept(this._formulaDefinitionToItemConversionVisitor)}_visitDefinition(e){return[e.accept(this._formulaDefinitionToItemConversionVisitor)]}visitFunctionDefinition(e){const t=[this._formulaDefinitionToItemConversionVisitor.visitFunctionDefinition(e)],r=this._getFormulaItem({parenthesesType:p.Opening});t.push(r);const o=e.parameterDefinitions.length-1;for(let u=0;u<o;u++){const I=this._getFormulaItem({operatorType:a.OperatorType.Comma});t.push(I)}const s=this._getFormulaItem({parenthesesType:p.Closing});return t.push(s),t}visitAggregationSubQueryOperandDefinition(e){return this._visitDefinition(e)}visitColumnOperandDefinition(e){return this._visitDefinition(e)}visitSubQueryOperandDefinition(e){return this._visitDefinition(e)}visitSysSettingOperandDefinition(e){return this._visitDefinition(e)}visitSysVariableOperandDefinition(e){return this._visitDefinition(e)}visitArithmeticOperatorDefinition(e){return this._visitDefinition(e)}visitCommaOperatorDefinition(e){return this._visitDefinition(e)}visitParenthesesOperatorDefinition(e){return this._visitDefinition(e)}visitPointOperatorDefinition(e){return this._visitDefinition(e)}visitRelationOperatorDefinition(e){return this._visitDefinition(e)}}J.\u0275fac=function(e){return new(e||J)(n.\u0275\u0275inject(v),n.\u0275\u0275inject(M))},J.\u0275prov=n.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac,providedIn:"root"});class cr extends Re{constructor(e,t,r){super(t,r),this._id=e}get id(){return this._id}accept(e){throw new Error("Method not implemented.")}}class cn extends M{constructor(e=[]){super(),this._definitions=e}getDefinitions(){return this._definitions}getPinnedDefinitions(){return[]}addDefinitions(e){e&&e.length>0&&(this._definitions=this._definitions.concat(e))}clearDefinitions(){this._definitions=[]}}const ur={id:(0,c.generateGuid)()};class un{visitFunctionDefinition(e){throw new Error("Method not implemented.")}visitAggregationSubQueryOperandDefinition(e){throw new Error("Method not implemented.")}visitColumnOperandDefinition(e){throw new Error("Method not implemented.")}visitSubQueryOperandDefinition(e){throw new Error("Method not implemented.")}visitSysSettingOperandDefinition(e){throw new Error("Method not implemented.")}visitSysVariableOperandDefinition(e){throw new Error("Method not implemented.")}visitArithmeticOperatorDefinition(e){throw new Error("Method not implemented.")}visitCommaOperatorDefinition(e){throw new Error("Method not implemented.")}visitParenthesesOperatorDefinition(e){throw new Error("Method not implemented.")}visitPointOperatorDefinition(e){throw new Error("Method not implemented.")}visitRelationOperatorDefinition(e){throw new Error("Method not implemented.")}}const Ge=new n.InjectionToken(`An injection token for visiting an array of Fomula
		items`);function lr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",11),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(o.filteringValue="")}),n.\u0275\u0275element(1,"mat-icon",12),n.\u0275\u0275elementEnd()}}function mr(i,e){i&1&&n.\u0275\u0275element(0,"mat-icon",13)}function pr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"mat-list-item",15),n.\u0275\u0275listener("click",function(){const s=n.\u0275\u0275restoreView(t).$implicit,u=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(u.onFormulaItemSelected(s))}),n.\u0275\u0275elementStart(1,"div"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()}if(i&2){const t=e.$implicit;n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function dr(i,e){if(i&1&&(n.\u0275\u0275elementStart(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),n.\u0275\u0275text(3),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(4,"mat-action-list"),n.\u0275\u0275template(5,pr,3,1,"mat-list-item",14),n.\u0275\u0275elementEnd()()),i&2){const t=e.$implicit;n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",t.key," "),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngForOf",t.value)}}function fr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"mat-list-item",15),n.\u0275\u0275listener("click",function(){const s=n.\u0275\u0275restoreView(t).$implicit,u=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(u.onFormulaItemSelected(s))}),n.\u0275\u0275elementStart(1,"div"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()}if(i&2){const t=e.$implicit;n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function hr(i,e){if(i&1&&(n.\u0275\u0275elementStart(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),n.\u0275\u0275text(3),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(4,"mat-action-list"),n.\u0275\u0275template(5,fr,3,1,"mat-list-item",14),n.\u0275\u0275elementEnd()()),i&2){const t=e.$implicit;n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",t.key," "),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngForOf",t.value)}}class me{constructor(){this.filteringValue="",this.formulaItems=[],this.formulaItemSelected=new n.EventEmitter}get functionItems(){if(this._groupedFunctionItems)return this._groupedFunctionItems;const e=oe.filter(this.formulaItems,t=>t.type===a.ExpressionType.Function);return this._groupedFunctionItems=oe.chain(e).map(t=>t).groupBy(t=>Object.keys(l).find(r=>l[r]===t.functionType)).value(),this._groupedFunctionItems}get operandItems(){if(this._groupedOperandItems)return this._groupedOperandItems;const e=oe.filter(this.formulaItems,t=>t.type===a.ExpressionType.Operand);return this._groupedOperandItems=oe.chain(e).map(t=>t).groupBy(t=>Object.keys(l).find(r=>l[r]===t.operandType)).value(),this._groupedOperandItems}onFormulaItemSelected(e){this.formulaItemSelected.emit(e)}onFilteringValueChanged(e){this.filteringValue=e}}me.\u0275fac=function(e){return new(e||me)},me.\u0275cmp=n.\u0275\u0275defineComponent({type:me,selectors:[["ts-formula-advanced-toolbar"]],inputs:{formulaItems:"formulaItems"},outputs:{formulaItemSelected:"formulaItemSelected"},decls:17,vars:9,consts:[[1,"formula-advanced-toolbar"],[1,"filter-input-container"],["floatLabel","never"],["matInput","","type","text","spellcheck","false","autocomplete","off","placeholder","Search","data-qa","search-input",3,"value","input"],["matSuffix","","mat-icon-button","","aria-label","Clear","data-qa","clear-filter-btn",3,"click",4,"ngIf","ngIfElse"],["searchIcon",""],[1,"toolbar-items"],["label","Functions"],["multi",""],[4,"ngFor","ngForOf"],["label","Operands"],["matSuffix","","mat-icon-button","","aria-label","Clear","data-qa","clear-filter-btn",3,"click"],["matSuffix","","title","Clear",1,"clear-icon"],["matSuffix","",1,"search-icon"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(e,t){if(e&1&&(n.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"mat-form-field",2)(3,"input",3),n.\u0275\u0275listener("input",function(o){return t.onFilteringValueChanged(o.target.value)}),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(4,lr,2,0,"button",4),n.\u0275\u0275template(5,mr,1,0,"ng-template",null,5,n.\u0275\u0275templateRefExtractor),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(7,"div",6)(8,"mat-tab-group")(9,"mat-tab",7)(10,"mat-accordion",8),n.\u0275\u0275template(11,dr,6,2,"mat-expansion-panel",9),n.\u0275\u0275pipe(12,"keyvalue"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(13,"mat-tab",10)(14,"mat-accordion",8),n.\u0275\u0275template(15,hr,6,2,"mat-expansion-panel",9),n.\u0275\u0275pipe(16,"keyvalue"),n.\u0275\u0275elementEnd()()()()()),e&2){const r=n.\u0275\u0275reference(6);n.\u0275\u0275advance(3),n.\u0275\u0275property("value",t.filteringValue),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",t.filteringValue)("ngIfElse",r),n.\u0275\u0275advance(7),n.\u0275\u0275property("ngForOf",n.\u0275\u0275pipeBind1(12,5,t.functionItems)),n.\u0275\u0275advance(4),n.\u0275\u0275property("ngForOf",n.\u0275\u0275pipeBind1(16,7,t.operandItems))}},dependencies:[f.NgForOf,f.NgIf,F.MatLegacyButton,Fe.MatAccordion,Fe.MatExpansionPanel,Fe.MatExpansionPanelHeader,Fe.MatExpansionPanelTitle,nt.MatLegacyFormField,nt.MatLegacySuffix,Mt.MatIcon,Tt.MatLegacyInput,rt.MatLegacyList,rt.MatLegacyListItem,it.MatLegacyTabGroup,it.MatLegacyTab,f.KeyValuePipe],styles:[".formula-advanced-toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]   .mat-list.mat-list-base.mat-action-list[_ngcontent-%COMP%]   .mat-list-item[_ngcontent-%COMP%]{font-size:13px}.formula-advanced-toolbar[_ngcontent-%COMP%]   .toolbar-items[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]{font-size:16px}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]{display:flex;flex-direction:row}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{font-size:13px;width:100%}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-family:Open Sans,Regular,sans-serif;color:#444}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-input-element[_ngcontent-%COMP%]{vertical-align:middle}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-ripple[_ngcontent-%COMP%]{top:1px;height:1px;background:#006ce0}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-underline[_ngcontent-%COMP%]{border-bottom:1px #c8c8c8 solid;background-color:transparent;margin-top:3px}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-wrapper[_ngcontent-%COMP%]{padding-top:5px;margin-bottom:-1.25em}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-empty.mat-form-field-label[_ngcontent-%COMP%]{padding-top:2px;color:#999}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]   .mat-form-field-infix[_ngcontent-%COMP%]{border-top:none}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon-button[_ngcontent-%COMP%], .formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;margin-right:8px}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#999;vertical-align:middle}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon.search-icon[_ngcontent-%COMP%]{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiPjxnIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzgwOTViMyIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCI+PGNpcmNsZSBjeD0iNiIgY3k9IjYiIHI9IjQuNSIvPjxwYXRoIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTSA5LjQsOS40IDE0LDE0Ii8+PC9nPjwvc3ZnPg==)}.formula-advanced-toolbar[_ngcontent-%COMP%]   .filter-input-container[_ngcontent-%COMP%]   .mat-form-field-appearance-legacy[_ngcontent-%COMP%]   .mat-form-field-suffix[_ngcontent-%COMP%]   .mat-icon.clear-icon[_ngcontent-%COMP%]{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4NCiAgPGcgaWQ9Ikdyb3VwXzIzNTUiIGRhdGEtbmFtZT0iR3JvdXAgMjM1NSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTk0MyAtMjEzNCkiPg0KICAgIDxsaW5lIGlkPSJMaW5lXzE0NiIgZGF0YS1uYW1lPSJMaW5lIDE0NiIgeTE9IjEwIiB4Mj0iMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk0Ni41IDIxMzcuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzc1NzU3NSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgICA8bGluZSBpZD0iTGluZV8xNDciIGRhdGEtbmFtZT0iTGluZSAxNDciIHgyPSIxMCIgeTI9IjEwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5NDYuNSAyMTM3LjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM3NTc1NzUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV8xMDkyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSAxMDkyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk0MyAyMTM0KSIgZmlsbD0ibm9uZSIvPg0KICA8L2c+DQo8L3N2Zz4NCg==)}"]});class w{}w.\u0275fac=function(e){return new(e||w)},w.\u0275mod=n.\u0275\u0275defineNgModule({type:w}),w.\u0275inj=n.\u0275\u0275defineInjector({imports:[f.CommonModule,tn.FormsModule,F.MatLegacyButtonModule,Fe.MatExpansionModule,nt.MatLegacyFormFieldModule,Mt.MatIconModule,Tt.MatLegacyInputModule,rt.MatLegacyListModule,it.MatLegacyTabsModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(w,{declarations:[me],imports:[f.CommonModule,tn.FormsModule,F.MatLegacyButtonModule,Fe.MatExpansionModule,nt.MatLegacyFormFieldModule,Mt.MatIconModule,Tt.MatLegacyInputModule,rt.MatLegacyListModule,it.MatLegacyTabsModule],exports:[me]})}();var ln=d(99293);class S{constructor(e,t,r){this.code=e,this.itemIndex=t,this.item=r}get invalidItemIndex(){return(this.itemIndex||0)+1}get invalidItemCaption(){return this.item?.caption||""}get interpolateParams(){return[this.invalidItemIndex,this.invalidItemCaption]}}class mn extends S{constructor(e,t,r,o,s){super("invalidFunctionArgumentDataType",e,t),this.argumentIndex=r,this.actualArgumentDataType=o,this.expectedArgumentDataTypes=s,this.message=`Position: ${this.itemIndex}. Invalid data type for argument ${this.argumentIndex} of the '${this.invalidItemCaption}' function. Expected one of '${this._expectedArgumentDataTypesName}' data types, but got '${this._actualArgumentDataTypeName}' data type.`}get _actualArgumentDataTypeName(){return c.DataValueType[this.actualArgumentDataType]}get _expectedArgumentDataTypesName(){return this.expectedArgumentDataTypes.map(e=>c.DataValueType[e]).join(", ")}get interpolateParams(){const e=(this.argumentIndex??0)+1;return[this.invalidItemIndex,e,this.invalidItemCaption,this._actualArgumentDataTypeName,this._expectedArgumentDataTypesName]}}class pn extends S{constructor(e,t,r,o){super("invalidFunctionArgumentsCount",e,t),this.actualArgumentsCount=r,this.expectedArgumentsCount=o,this.message=`Position: ${this.itemIndex}. Wrong number of arguments of the '${this.invalidItemCaption}' function. Expected ${this.expectedArgumentsCount} arguments, but got ${this.actualArgumentsCount} arguments.`}get interpolateParams(){return[this.invalidItemIndex,this.invalidItemCaption,this.actualArgumentsCount,this.expectedArgumentsCount]}}class Rt extends S{constructor(e,t,r){super(e,t),this.maxSupportedNumerLength=r,this.message=this.code==="maxNumberLength"?`Position: ${this.itemIndex}. Maximum number length should not exceed ${this.maxSupportedNumerLength} digits.`:`Position: ${this.itemIndex}. Number precision should not exceed ${this.maxSupportedNumerLength} digits.`}get interpolateParams(){return[this.invalidItemIndex,this.maxSupportedNumerLength]}}class dn{constructor(){this.code="notSupportedOnlyColumn",this.message="Formula expression cannot have one column."}}class T extends S{constructor(e,t){super("unexpectedItem",e,t),this.message=`Position: ${this.itemIndex}. Unexpected formula item '${this.invalidItemCaption}'.`}}class fn extends T{constructor(e,t){super(e,t),this.code="unexpectedDecimalSeparator",this.message=`Position: ${this.invalidItemIndex}. Unexpected formula item '${this.invalidItemCaption}'. The decimal separator is a '.'.`}}class hn extends S{constructor(e,t){super("divisionByZero",e,t),this.message=`Position: ${this.itemIndex}. Unexpected division by zero.`}}class kt extends S{constructor(e,t){super("missingOperand",e,t),this.message=`Position: ${this.itemIndex}. Missing operand near '${this.invalidItemCaption}'.`}}class zt extends S{constructor(e,t){super(e,t)}}class In extends S{constructor(e,t){super(e,t)}}class gn extends S{constructor(e,t,r,o){super("unsupportedBinaryOperandDataType",e,t),this.leftOperandDataType=r,this.rightOperandDataType=o,this.message=`Position: ${this.itemIndex}. Unsupported operator '${this.invalidItemCaption}' between operand types '${this._leftOperandDataTypeName}' and '${this._rightOperandDataTypeName}'.`}get _leftOperandDataTypeName(){return c.DataValueType[this.leftOperandDataType]}get _rightOperandDataTypeName(){return c.DataValueType[this.rightOperandDataType]}get interpolateParams(){return[this.invalidItemIndex,this.invalidItemCaption,this._leftOperandDataTypeName,this._rightOperandDataTypeName]}}class We{constructor(e,t,r){this._formulaDefinitionToItemConverter=e,this._formulaItems=t,this._cursorPosition=r,this.FUNCTION_CURSOR_OFFSET=2}get formulaItems(){return this._formulaItems||[]}set cursorPosition(e){this._cursorPosition=e}get cursorPosition(){const e=this._cursorPosition,t=this.formulaItems.length,r=e<0||e>t;return e&&r?t:e}_insertFormulaItems(e,t){const r=this.cursorPosition;this._formulaItems.splice(r,0,...e),this.cursorPosition=r+t}addItem(e){const t=e.accept(this._formulaDefinitionToItemConverter);let r=t.length;e.type===a.ExpressionType.Function&&(r=e?.parameterDefinitions?.length>0?this.FUNCTION_CURSOR_OFFSET:r),this._insertFormulaItems(t,r)}}class y{constructor(e,t){this._expressionToFormulaItemsConverter=e,this._formulaDefinitionsToItemsConverter=t}toFormula(e){c.ValidationUtilities.checkArgumentEmpty("expression",e);const t=e.accept(this._expressionToFormulaItemsConverter);return new We(this._formulaDefinitionsToItemsConverter,t)}}y.\u0275fac=function(e){return new(e||y)(n.\u0275\u0275inject(a.ExpressionVisitor),n.\u0275\u0275inject(Ge))},y.\u0275prov=n.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac});class Ye{constructor(e){this._formulaItemsPipe=e}pipeFormulaItems(e){return this._formulaItemsPipe.transform(e)}}class x extends Nt{visitFunctionFormulaItem(e){return{success:!1}}visitConstantOperand(e){return{success:!1}}visitColumnOperand(e){return{success:!1}}visitSysSettingOperand(e){return{success:!1}}visitSysVariableOperand(e){return{success:!1}}visitArithmeticOperator(e){return{success:!1}}visitCommaOperator(e){return{success:!1}}visitParenthesesOperator(e){return{success:!1}}visitPointOperator(e){return{success:!1}}visitRelationOperator(e){return{success:!1}}}class B extends x{visitFunctionFormulaItem(e){return{success:!0,formulaItem:e}}}B.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(B)))(t||B)}}(),B.\u0275prov=n.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac});class U extends x{visitConstantOperand(e){return{success:!0,formulaItem:e}}}U.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(U)))(t||U)}}(),U.\u0275prov=n.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac});class N extends U{constructor(){super(...arguments),this._numberDataTypes=[c.DataValueType.Integer,c.DataValueType.Float,c.DataValueType.Money,c.DataValueType.FLOAT1,c.DataValueType.FLOAT2,c.DataValueType.FLOAT3,c.DataValueType.FLOAT4,c.DataValueType.FLOAT8]}visitConstantOperand(e){return this._numberDataTypes.includes(e.dataType)?{success:!0,formulaItem:e}:{success:!1}}}N.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(N)))(t||N)}}(),N.\u0275prov=n.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac});class pe extends x{_createSuccessParseResult(e){return{success:!0,formulaItem:e}}visitConstantOperand(e){return this._createSuccessParseResult(e)}visitColumnOperand(e){return this._createSuccessParseResult(e)}visitSysSettingOperand(e){return this._createSuccessParseResult(e)}visitSysVariableOperand(e){return this._createSuccessParseResult(e)}}pe.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(pe)))(t||pe)}}(),pe.\u0275prov=n.\u0275\u0275defineInjectable({token:pe,factory:pe.\u0275fac});class H extends x{visitArithmeticOperator(e){return{success:!0,formulaItem:e}}}H.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(H)))(t||H)}}(),H.\u0275prov=n.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac});class de extends x{_createSuccessParseResult(e){return{success:!0,formulaItem:e}}visitArithmeticOperator(e){return this._createSuccessParseResult(e)}visitCommaOperator(e){return this._createSuccessParseResult(e)}visitParenthesesOperator(e){return this._createSuccessParseResult(e)}visitPointOperator(e){return this._createSuccessParseResult(e)}visitRelationOperator(e){return this._createSuccessParseResult(e)}}de.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(de)))(t||de)}}(),de.\u0275prov=n.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac});class _ extends x{visitParenthesesOperator(e){return{success:!0,formulaItem:e}}}_.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(_)))(t||_)}}(),_.\u0275prov=n.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac});class E extends x{visitPointOperator(e){return{success:!0,formulaItem:e}}}E.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(E)))(t||E)}}(),E.\u0275prov=n.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac});class fe extends x{visitRelationOperator(e){return{success:!0,formulaItem:e}}}fe.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(fe)))(t||fe)}}(),fe.\u0275prov=n.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac});class Z extends x{visitCommaOperator(e){return{success:!0,formulaItem:e}}}Z.\u0275fac=function(){let i;return function(t){return(i||(i=n.\u0275\u0275getInheritedFactory(Z)))(t||Z)}}(),Z.\u0275prov=n.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac});class Qe{constructor(){this._resultStack=[],this._operatorsStack=[],this._operatorsPriority={[a.ArithmeticOperatorType.Addition]:1,[a.ArithmeticOperatorType.Subtraction]:1,[a.ArithmeticOperatorType.Multiplication]:2,[a.ArithmeticOperatorType.Division]:2}}_visitOperand(e){this._resultStack.push(e)}_visitOpeningParenthesesOperator(e){this._resultStack.push(e),this._operatorsStack.push(e)}_visitClosingParenthesesOperator(e){for(;this._hasSavedOperators();){const t=this._operatorsStack.pop();if(this._isOpeningParenthesesOperator(t))break;this._resultStack.push(t)}this._resultStack.push(e)}_hasSavedOperators(){return this._operatorsStack.length>0}_isOpeningParenthesesOperator(e){return(this._isParenthesesOperator(e)&&e).parenthesesType===p.Opening}_isParenthesesOperator(e){return e.operatorType===a.OperatorType.Parentheses}_isArithmeticOperator(e){return e.operatorType===a.OperatorType.Arithmetic}_isHigherPriorityOperator(e,t){return this._operatorsPriority[e.arithmeticOperatorType]>=this._operatorsPriority[t.arithmeticOperatorType]}visitFunctionFormulaItem(e){throw new Error("Method not implemented.")}visitConstantOperand(e){this._visitOperand(e)}visitColumnOperand(e){this._visitOperand(e)}visitSysSettingOperand(e){this._visitOperand(e)}visitSysVariableOperand(e){this._visitOperand(e)}visitArithmeticOperator(e){for(;this._hasSavedOperators();){const t=this._operatorsStack.pop();if(this._isArithmeticOperator(t)&&this._isHigherPriorityOperator(t,e))this._resultStack.push(t);else{this._operatorsStack.push(t);break}}this._operatorsStack.push(e)}visitCommaOperator(e){throw new Error("Method not implemented.")}visitParenthesesOperator(e){e.parenthesesType===p.Opening?this._visitOpeningParenthesesOperator(e):this._visitClosingParenthesesOperator(e)}visitPointOperator(e){}visitRelationOperator(e){throw new Error("Method not implemented.")}toPostfixNotation(e){for(this._resultStack=[],this._operatorsStack=[],e.forEach(t=>t.accept(this));this._hasSavedOperators();)this._resultStack.push(this._operatorsStack.pop());return this._resultStack}}Qe.\u0275fac=function(e){return new(e||Qe)},Qe.\u0275prov=n.\u0275\u0275defineInjectable({token:Qe,factory:Qe.\u0275fac});class Ir{}class Je{constructor(e){this._formulaItemDefinitions=e.getDefinitions()}_getFormulaItemDefinition(e){return this._formulaItemDefinitions.find(t=>t.id===e)}_createAggregationSubQueryOperandExpression(e){return new a.AggregationSubQueryOperandExpression(e.columnPath,e.dataType,e.aggregationType,e.subFilters)}_createColumnOperandExpression(e){return new a.ColumnOperandExpression(e.columnPath,e.dataType)}_createSubQueryOperandExpression(e){return new a.SubQueryOperandExpression(e.columnPath,e.dataType,e.subFilters)}visitFunctionFormulaItem(e){throw new Error("Method not implemented.")}visitConstantOperand(e){const t=new a.ConstOperandExpression(e.value,e.dataType);this._treeStack.push(t)}visitColumnOperand(e){const t=this._getFormulaItemDefinition(e.id);let r;switch(t.columnType){case a.ColumnOperandType.Aggregation:r=this._createAggregationSubQueryOperandExpression(t);break;case a.ColumnOperandType.SchemaColumn:r=this._createColumnOperandExpression(t);break;case a.ColumnOperandType.SubQuery:r=this._createSubQueryOperandExpression(t);break;default:throw new Error(`The '${t.columnType}' column type is not supported.`)}this._treeStack.push(r)}visitSysSettingOperand(e){const t=e.id,r=this._getFormulaItemDefinition(t),o=new a.SysSettingOperandExpression(r.code,r.dataType);this._treeStack.push(o)}visitSysVariableOperand(e){const t=e.id,r=this._getFormulaItemDefinition(t),o=new a.SysVariableOperandExpression(r.name,r.dataType);this._treeStack.push(o)}visitArithmeticOperator(e){const t=this._treeStack.pop(),r=this._treeStack.pop(),o=e.arithmeticOperatorType;if(!t||!r)throw new Error(`Cound to find left or(and) right operands for the '${o}' arithmetic operation.`);const s=new a.ArithmeticOperatorExpression(o,r,t);this._treeStack.push(s)}visitCommaOperator(e){throw new Error("Method not implemented.")}visitParenthesesOperator(e){if(e.parenthesesType===p.Opening)return;const t=this._treeStack.pop();if(!t)throw new Error("Cound not found expression inside parentheses.");const r=new a.ParenthesesOperatorExpression(t);this._treeStack.push(r)}visitPointOperator(e){throw new Error("Method not implemented.")}visitRelationOperator(e){throw new Error("Method not implemented.")}toTree(e){return this._treeStack=[],e.forEach(t=>t.accept(this)),this._treeStack.pop()}}Je.\u0275fac=function(e){return new(e||Je)(n.\u0275\u0275inject(M))},Je.\u0275prov=n.\u0275\u0275defineInjectable({token:Je,factory:Je.\u0275fac});class gr{}class mt{setNext(e){return this.next=e}transform(e){const t=this.internalTransform(e);return this.next?this.next.transform(t):t}}class Dr extends mt{constructor(e,t){super(),this._pointOperantorParser=e,this._constantOperandParser=t}_isNumberOrPoint(e){return this._isPointOperator(e)||e.accept(this._constantOperandParser).success}_isPointOperator(e){const{success:t}=e.accept(this._pointOperantorParser);return t}_createNumericConstant(e){const t=e.map(r=>r.caption).join("");return new Q(t)}internalTransform(e){const t=[];let r=[];if(e.forEach(o=>{if(this._isNumberOrPoint(o))r.push(o);else{if(r.length>0){const s=this._createNumericConstant(r);t.push(s),r=[]}t.push(o)}}),r.length>0){const o=this._createNumericConstant(r);t.push(o)}return t}}class Ae extends Ye{constructor(e,t,r){super(r),this._postfixNotationConverter=e,this._postfixNotationToExpressionConverter=t}toExpression(e){c.ValidationUtilities.checkArgumentEmpty("formula",e);const t=this.pipeFormulaItems(e.formulaItems),r=this._postfixNotationConverter.toPostfixNotation(t);return this._postfixNotationToExpressionConverter.toTree(r)}}Ae.\u0275fac=function(e){return new(e||Ae)(n.\u0275\u0275inject(Ir),n.\u0275\u0275inject(gr),n.\u0275\u0275inject(mt))},Ae.\u0275prov=n.\u0275\u0275defineInjectable({token:Ae,factory:Ae.\u0275fac});var _r=d(82850);const Ut="CONST",Gt="COLUMN";class C extends Nt{static _toStringFromOperator(e){return e.id}constructor(e){super(),this._formulaItemDefinitionProvider=e}toString(e){return e.accept(this)}visitArithmeticOperator(e){return C._toStringFromOperator(e)}visitColumnOperand(e){return`${Gt}("${e.id}")`}visitCommaOperator(e){return C._toStringFromOperator(e)}visitConstantOperand(e){return`${Ut}("${e.value}", "${e.dataType}")`}visitFunctionFormulaItem(e){return this._formulaItemDefinitionProvider.getById(e.id).code}visitParenthesesOperator(e){return C._toStringFromOperator(e)}visitPointOperator(e){return C._toStringFromOperator(e)}visitRelationOperator(e){throw new Error("method visitRelationOperator not implemented")}visitSysSettingOperand(e){throw new Error("method visitSysSettingOperand not implemented")}visitSysVariableOperand(e){throw new Error("method visitSysVariableOperand not implemented")}}C.\u0275fac=function(e){return new(e||C)(n.\u0275\u0275inject(M))},C.\u0275prov=n.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac});var he;(function(i){i.OperatorNode="OperatorNode",i.ConstantNode="ConstantNode",i.SymbolNode="SymbolNode",i.ParenthesisNode="ParenthesisNode",i.FunctionNode="FunctionNode"})(he||(he={}));class Or{_createAggregationSubQueryOperandExpression(e){return new a.AggregationSubQueryOperandExpression(e.columnPath,e.dataType,e.aggregationType,e.subFilters)}_createColumnOperandExpression(e){return new a.ColumnOperandExpression(e.columnPath,e.dataType)}_createSubQueryOperandExpression(e){return new a.SubQueryOperandExpression(e.columnPath,e.dataType,e.subFilters)}createFromDefinition(e){switch(e.columnType){case a.ColumnOperandType.Aggregation:return this._createAggregationSubQueryOperandExpression(e);case a.ColumnOperandType.SchemaColumn:return this._createColumnOperandExpression(e);case a.ColumnOperandType.SubQuery:return this._createSubQueryOperandExpression(e);default:throw new Error(`The '${e.columnType}' column type is not supported.`)}}}class K{constructor(e){this._formulaItemDefinitionProvider=e}_fromConstant(e){const t=e.value;let r=c.DataValueType.Text;return typeof t=="number"&&(r=Number(t)===t&&t%1===0?c.DataValueType.Integer:c.DataValueType.Float),new a.ConstOperandExpression(`${e.value}`,r)}_fromOperator(e){const t=e.op,r=(0,a.getArithmeticOperatorTypeFromString)(t),o=e.args[0],s=e.args[1];if(!s)throw new Error(`operator: "${t} with only one node not supporting`);return new a.ArithmeticOperatorExpression(r,this._fromMathjsNode(o),this._fromMathjsNode(s))}_fromSymbol(e){return new a.ConstOperandExpression(e.name,c.DataValueType.Text)}_fromParenthesis(e){return new a.ParenthesesOperatorExpression(this._fromMathjsNode(e.content))}_fromFunction(e){if(e.name===Gt)return this._fromColumnFunction(e);if(e.name===Ut)return this._fromConstantFunction(e);const t=e.name,r=this._formulaItemDefinitionProvider.findWhere({code:t}),o=e.args.map(u=>this._fromMathjsNode(u)),s=an(r,o);return new a.FunctionExpression(s.fnCode,r.returnDefinition.dataType,s.fnArgs)}_fromColumnFunction(e){const r=e.args[0].value,o=this._formulaItemDefinitionProvider.getById(r);return new Or().createFromDefinition(o)}_fromConstantFunction(e){const t=e.args[0],r=e.args[1],o=t.value,s=parseInt(r.value.toString(),10);return new a.ConstOperandExpression(`${o}`,s)}_fromMathjsNode(e){switch(e.type){case he.OperatorNode:return this._fromOperator(e);case he.ConstantNode:return this._fromConstant(e);case he.SymbolNode:return this._fromSymbol(e);case he.ParenthesisNode:return this._fromParenthesis(e);case he.FunctionNode:return this._fromFunction(e);default:throw new Error(`Mathjs node:'${e}' not supported`)}}toExpression(e){const t=(0,_r.parse)(e);return this._fromMathjsNode(t)}}K.\u0275fac=function(e){return new(e||K)(n.\u0275\u0275inject(M))},K.\u0275prov=n.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac});class Ie extends Ye{constructor(e,t,r){super(e),this._mathjsExpressionTextConverter=t,this._mathjsFormulaItemVisitor=r}toExpression(e){const r=this.pipeFormulaItems(e.formulaItems).map(o=>this._mathjsFormulaItemVisitor.toString(o)).join("");return this._mathjsExpressionTextConverter.toExpression(r)}}Ie.\u0275fac=function(e){return new(e||Ie)(n.\u0275\u0275inject(mt),n.\u0275\u0275inject(K),n.\u0275\u0275inject(C))},Ie.\u0275prov=n.\u0275\u0275defineInjectable({token:Ie,factory:Ie.\u0275fac});class Dn extends a.AbstractValidator{get formulaItems(){return this._formulaItems||[]}get currentItem(){return this.formulaItems[this.currentItemIndex]}get currentItemIndex(){return this._currentItemIndex??0}set currentItemIndex(e){this._currentItemIndex=e}constructor(e){super(),this._expressionToFormulaConverter=e}_validateExpression(e){return e?e.accept(this):a.ValidationResult.createSuccess()}validateFunctionExpression(e){return a.ValidationResult.createSuccess()}validateFunctionArgumentExpression(e,t,r){return this._validateExpression(t)}validateAggregationSubQueryOperandExpression(e){return a.ValidationResult.createSuccess()}validateColumnOperandExpression(e){return a.ValidationResult.createSuccess()}validateConstOperandExpression(e){return a.ValidationResult.createSuccess()}validateSubQueryOperandExpression(e){return a.ValidationResult.createSuccess()}validateArithmeticOperatorExpression(e){return a.ValidationResult.createSuccess()}visitFunctionExpression(e){const t=this.validateFunctionExpression(e);this.currentItemIndex++,this.currentItemIndex++;const{fnArgs:r}=Ue(e),o=r.length,s=r.map((u,I)=>{const Y=this.validateFunctionArgumentExpression(e,u,I);return I<o-1&&this.currentItemIndex++,Y});return this.currentItemIndex++,a.ValidationResult.unionResults(t,...s)}visitAggregationSubQueryOperandExpression(e){const t=this.validateAggregationSubQueryOperandExpression(e);return this.currentItemIndex++,t}visitColumnOperandExpression(e){const t=this.validateColumnOperandExpression(e);return this.currentItemIndex++,t}visitConstOperandExpression(e){const t=this.validateConstOperandExpression(e);return this.currentItemIndex+=String(e.value).length,t}visitSubQueryOperandExpression(e){const t=this.validateSubQueryOperandExpression(e);return this.currentItemIndex++,t}visitSysSettingOperandExpression(e){throw new Error("Method not implemented.")}visitSysVariableOperandExpression(e){throw new Error("Method not implemented.")}visitArithmeticOperatorExpression(e){const t=this._validateExpression(e.leftExpression),r=this.validateArithmeticOperatorExpression(e);this.currentItemIndex++;const o=this._validateExpression(e.rightExpression);return a.ValidationResult.unionResults(t,r,o)}visitParenthesesOperatorExpression(e){this.currentItemIndex++;const t=this._validateExpression(e.expression);return this.currentItemIndex++,t}visitRelationOperatorExpression(e){throw new Error("Method not implemented.")}visitTernaryOperatorExpression(e){throw new Error("Method not implemented.")}validate(e){return e?(this._formulaItems=this._expressionToFormulaConverter.toFormula(e)?.formulaItems,this._currentItemIndex=0,e.accept(this)):a.ValidationResult.createSuccess()}}class _n extends Dn{constructor(e,t,r){super(e),this._formulaItemDefinitionProvider=t,this._formulaItemDefinitionConverter=r}getFunctionItem(e){return e&&e.accept(this._formulaItemDefinitionConverter)}getFunctionDefinition(e){const{fnDefinitionId:t}=Ue(e);return this._formulaItemDefinitionProvider.findWhere({id:t})}getParameterDefinition(e,t){return(e&&e.parameterDefinitions||[])[t]}validateFunctionExpression(e){const t=this.getFunctionDefinition(e);return t?this.validateFunctionExpressionByDefinition(e,t):a.ValidationResult.createSuccess()}validateFunctionArgumentExpression(e,t,r){const o=this.getFunctionDefinition(e),s=o?this.validateFunctionArgumentExpressionByDefinition(t,r,o):a.ValidationResult.createSuccess(),u=super.validateFunctionArgumentExpression(e,t,r);return a.ValidationResult.unionResults(s,u)}validateFunctionExpressionByDefinition(e,t){return a.ValidationResult.createSuccess()}validateFunctionArgumentExpressionByDefinition(e,t,r){return a.ValidationResult.createSuccess()}}class ge extends _n{constructor(e,t,r){super(e,t,r)}validateFunctionExpressionByDefinition(e,t){const{fnArgs:r}=Ue(e),o=r.length,s=t.parameterDefinitions.length;return o===s?a.ValidationResult.createSuccess():a.ValidationResult.createError([new pn(this.currentItemIndex,this.getFunctionItem(t),o,s)])}}ge.\u0275fac=function(e){return new(e||ge)(n.\u0275\u0275inject(y),n.\u0275\u0275inject(M),n.\u0275\u0275inject(z))},ge.\u0275prov=n.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac});class De extends _n{constructor(e,t,r){super(e,t,r)}validateFunctionArgumentExpressionByDefinition(e,t,r){const o=this.getParameterDefinition(r,t);if(!o)return a.ValidationResult.createSuccess();const s=e.dataType,u=o.dataTypes;return u.includes(s)?a.ValidationResult.createSuccess():a.ValidationResult.createError([new mn(this.currentItemIndex,this.getFunctionItem(r),t,s,u)])}}De.\u0275fac=function(e){return new(e||De)(n.\u0275\u0275inject(y),n.\u0275\u0275inject(M),n.\u0275\u0275inject(z))},De.\u0275prov=n.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac});class pt extends a.AbstractValidator{validate(e){if(!e)return a.ValidationResult.createSuccess();try{this.validateFormulaItems(e)}catch(t){return a.ValidationResult.createError([t])}return a.ValidationResult.createSuccess()}}class On extends pt{constructor(e){super(),this.formulaItemParser=e}get formulaItems(){return this._formulaItems}validateFormulaItems(e){this._formulaItems=e,this._formulaItems.forEach((t,r)=>{const{success:o,formulaItem:s}=t.accept(this.formulaItemParser);!o||this.validateFormulaItemNeighbors(s,r)})}}class Be extends On{constructor(e,t){super(e),this._parenthesesParser=t}isParenthesesOperator(e,t){const{success:r,formulaItem:o}=e.accept(this._parenthesesParser);return r&&o.parenthesesType===t}}class Cn extends Be{constructor(e,t){super(e,t)}validateFormulaItemNeighbors(e,t){const r=t+1,o=this.formulaItems[r];if(!o)throw new zt("missingOpeningParentheses",r);if(!this.isParenthesesOperator(o,p.Opening))throw new T(r,o)}}class Mn extends pt{constructor(e){super(),this._constantOperandParser=e}validateFormulaItems(e){if(e.length!==1)return;const t=e[e.length-1];if(!t)return;const r=t.type===a.ExpressionType.Operand,{success:o}=t.accept(this._constantOperandParser);if(r&&!o)throw new dn}}class Wt extends pt{constructor(e,t){super(),this._pointOperatorParser=e,this._numericConstantOperandParser=t}isPointOperator(e){const{success:t}=e.accept(this._pointOperatorParser);return t}isNumericConstant(e){const{success:t}=e.accept(this._numericConstantOperandParser);return t}}class Tn extends Wt{constructor(e,t,r,o){super(e,t),this.MAX_NUMBER_LENGTH=r,this.MAX_NUMBER_PRECISION_LENGTH=o}_createMaxNumberLenghtError(e){return new Rt("maxNumberLength",e,this.MAX_NUMBER_LENGTH)}_createMaxNumberPrecisionLenghtError(e){return new Rt("maxNumberPrecisionLength",e,this.MAX_NUMBER_PRECISION_LENGTH)}validateFormulaItems(e){let t=-1,r=!1,o=0,s=0;e.forEach((u,I)=>{if(this.isPointOperator(u)){r=!0;return}if(!this.isNumericConstant(u)){r=!1,o=0,s=0;return}if(o===0&&s===0&&(t=I),r){if(++o>this.MAX_NUMBER_PRECISION_LENGTH)throw this._createMaxNumberPrecisionLenghtError(t)}else if(++s>this.MAX_NUMBER_LENGTH)throw this._createMaxNumberLenghtError(t)})}}class yn extends Wt{constructor(e,t){super(e,t)}validateFormulaItems(e){let t=!1,r=!1,o=!1;if(e.forEach((I,Y)=>{const $t=this.isPointOperator(I),Xt=this.isNumericConstant(I);if($t){if(t||!o)throw new T(Y,I);t=!0}else if(Xt)r=t,o=o||!t;else{if(t&&!r)throw new T(Y,I);t=!1,r=!1,o=!1}}),r||!t)return;const s=e.length-1,u=e[s];throw new T(s,u)}}class _e extends Be{constructor(e,t,r){super(e,t),this._operatorParser=r}_isSupportedNextOperand(e,t){const{success:r,formulaItem:o}=t.accept(this.formulaItemParser);if(!r)return!1;const s=o.operandType===a.OperandType.Const;return e.operandType===a.OperandType.Const&&s}_isSupportedNextOperator(e,t){const{success:r,formulaItem:o}=t.accept(this._operatorParser);if(!r||this.isParenthesesOperator(t,p.Opening))return!1;const u=e.operandType===a.OperandType.Const;return!(o.operatorType===a.OperatorType.Point)||u}validateFormulaItemNeighbors(e,t){const r=t+1,o=this.formulaItems[r];if(!o)return;const s=!this._isSupportedNextOperand(e,o),u=!this._isSupportedNextOperator(e,o);if(s&&u)throw new T(r,o)}}_e.\u0275fac=function(e){return new(e||_e)(n.\u0275\u0275inject(x),n.\u0275\u0275inject(x),n.\u0275\u0275inject(x))},_e.\u0275prov=n.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac});var g;(function(i){i[i.SimpleExpressionWaitsForOperand=0]="SimpleExpressionWaitsForOperand",i[i.FunctionDeclarationWaitsForOpeningParenthesis=1]="FunctionDeclarationWaitsForOpeningParenthesis",i[i.FunctionWaitsForOperand=2]="FunctionWaitsForOperand",i[i.FunctionWaitsForDelimiterOrOperand=3]="FunctionWaitsForDelimiterOrOperand"})(g||(g={}));class xn extends Wt{constructor(e,t,r,o,s){super(e,t),this.commaOperatorParser=r,this.functionParser=o,this.parenthesesParser=s}_processFormulaItem(e,{whenFunctionOperandDelimiter:t,whenFunctionDeclaration:r,whenOpeningParenthesis:o,whenClosingParenthesis:s,whenAnotherItem:u}){return this.isCommaOperator(e)?t():this.isFunction(e)?r():this.isParenthesesOperator(e,p.Opening)?o():this.isParenthesesOperator(e,p.Closing)?s():u()}_throwError(e){const t=e.previousValue&&this.isNumericConstant(e.previousValue),r=e.nextValue&&this.isNumericConstant(e.nextValue);throw t&&r?new fn(e.currentIndex,e.currentValue):new T(e.currentIndex,e.currentValue)}_processSimpleExpressionWaitsForOperandState(e,t){const r={whenFunctionOperandDelimiter:()=>{this._throwError(e)},whenFunctionDeclaration:()=>(t.push(g.FunctionDeclarationWaitsForOpeningParenthesis),t),whenOpeningParenthesis:()=>(t.push(g.SimpleExpressionWaitsForOperand),t),whenClosingParenthesis:()=>(t.length>1&&t.pop(),t),whenAnotherItem:()=>t};return this._processFormulaItem(e.currentValue,r)}_processFunctionDeclarationWaitsForOpeningParenthesisState(e,t){const r={whenFunctionOperandDelimiter:()=>t,whenFunctionDeclaration:()=>t,whenOpeningParenthesis:()=>(t[t.length-1]=g.FunctionWaitsForDelimiterOrOperand,t),whenClosingParenthesis:()=>(t.pop(),t),whenAnotherItem:()=>(t.pop(),t)};return this._processFormulaItem(e.currentValue,r)}_processFunctionWaitsForOperandState(e,t){const r={whenFunctionOperandDelimiter:()=>{this._throwError(e)},whenFunctionDeclaration:()=>(t[t.length-1]=g.FunctionWaitsForDelimiterOrOperand,t.push(g.FunctionDeclarationWaitsForOpeningParenthesis),t),whenOpeningParenthesis:()=>(t[t.length-1]=g.FunctionWaitsForDelimiterOrOperand,t.push(g.SimpleExpressionWaitsForOperand),t),whenClosingParenthesis:()=>(t.pop(),t),whenAnotherItem:()=>(t[t.length-1]=g.FunctionWaitsForDelimiterOrOperand,t)};return this._processFormulaItem(e.currentValue,r)}_processFunctionWaitsForDelimiterOrOperandState(e,t){const r={whenFunctionOperandDelimiter:()=>(t[t.length-1]=g.FunctionWaitsForOperand,t),whenFunctionDeclaration:()=>(t.push(g.FunctionDeclarationWaitsForOpeningParenthesis),t),whenOpeningParenthesis:()=>(t.push(g.SimpleExpressionWaitsForOperand),t),whenClosingParenthesis:()=>(t.pop(),t),whenAnotherItem:()=>t};return this._processFormulaItem(e.currentValue,r)}_processSingleState(e,t){switch(t[t.length-1]){case g.SimpleExpressionWaitsForOperand:return this._processSimpleExpressionWaitsForOperandState(e,t);case g.FunctionDeclarationWaitsForOpeningParenthesis:return this._processFunctionDeclarationWaitsForOpeningParenthesisState(e,t);case g.FunctionWaitsForOperand:return this._processFunctionWaitsForOperandState(e,t);case g.FunctionWaitsForDelimiterOrOperand:return this._processFunctionWaitsForDelimiterOrOperandState(e,t);default:return null}}isCommaOperator(e){const{success:t}=e.accept(this.commaOperatorParser);return t}isFunction(e){const{success:t}=e.accept(this.functionParser);return t}isParenthesesOperator(e,t){const{success:r,formulaItem:o}=e.accept(this.parenthesesParser);return r&&o.parenthesesType===t}validateFormulaItems(e){const t=[g.SimpleExpressionWaitsForOperand];e.reduce((r,o,s,u)=>this._processSingleState({currentValue:o,currentIndex:s,previousValue:u[s-1],nextValue:u[s+1]},r),t)}}class Oe extends Dn{constructor(e){super(e)}validateArithmeticOperatorExpression(e){if(e.dataType!=null)return a.ValidationResult.createSuccess();const t=e.leftExpression?.dataType,r=e.rightExpression?.dataType;return t==null||r==null?a.ValidationResult.createSuccess():a.ValidationResult.createError([new gn(this.currentItemIndex,this.currentItem,t,r)])}}Oe.\u0275fac=function(e){return new(e||Oe)(n.\u0275\u0275inject(y))},Oe.\u0275prov=n.\u0275\u0275defineInjectable({token:Oe,factory:Oe.\u0275fac});class Yt extends Be{_checkIsOperandsExist(e,t){const r=this.formulaItems[t-1],o=this.formulaItems[t+1];if(!r||!o)throw new kt(t,e)}_validateNextOperand(e){const t=e+1,r=this.formulaItems[t],o=r.type===a.ExpressionType.Operator,s=!this.isParenthesesOperator(r,p.Opening);if(o&&s)throw new T(t,r)}validateFormulaItemNeighbors(e,t){this._checkIsOperandsExist(e,t),this._validateNextOperand(t)}}class Fn extends Be{constructor(e,t){super(e,t)}_checkIsOperandsExist(e,t){const r=this.formulaItems[t-1],o=this.formulaItems[t+1];if(!r||!o)throw new kt(t,e)}_validateNextOperand(e){const t=e+1,r=this.formulaItems[t],o=r.type===a.ExpressionType.Operator,s=!this.isParenthesesOperator(r,p.Opening);if(o&&s)throw new T(t,r)}validateFormulaItemNeighbors(e,t){this._checkIsOperandsExist(e,t),this._validateNextOperand(t)}}class vn extends On{constructor(e,t,r){super(e),this._pointOperatorParser=t,this._numericConstantOperandParser=r}_isNextFormulaItemsZero(e){let t=!1;for(let r=e;r<this.formulaItems.length;r++){const o=this.formulaItems[r];if(this._isPointOperator(o))continue;if(!this._isNumericConstant(o)||(t=this._isZeroNumericConstant(o),!t))break}return t}_isPointOperator(e){const{success:t}=e.accept(this._pointOperatorParser);return t}_isNumericConstant(e){const{success:t}=e.accept(this._numericConstantOperandParser);return t}_isZeroNumericConstant(e){const{success:t,formulaItem:r}=e.accept(this._numericConstantOperandParser);return t&&r.value===String(0)}validateFormulaItemNeighbors(e,t){const r=e.arithmeticOperatorType===a.ArithmeticOperatorType.Division,o=this._isNextFormulaItemsZero(t+1);if(r&&o)throw new hn(t,e)}}class wn extends pt{constructor(e){super(),this._parenthesesOperatorParser=e}validateFormulaItems(e){let t=0;if(e.forEach((r,o)=>{const{success:s,formulaItem:u}=r.accept(this._parenthesesOperatorParser);if(!!s)if(u.parenthesesType===p.Opening)t++;else{if(t===0)throw new In("unexpectedClosingParentheses",o);t--}}),t>0)throw new zt("missingClosingParentheses",e.length)}}class En extends Be{constructor(e){super(e,e)}_validateOpeningParentheseNextItem(e,t){const o=this.formulaItems[t-2]?.type===a.ExpressionType.Function,s=this.isParenthesesOperator(e,p.Closing);if(o&&s)return;const u=e.type===a.ExpressionType.Operator,I=!this.isParenthesesOperator(e,p.Opening);if(u&&I)throw new T(t,e)}_validateClosingParentheseNextItem(e,t){const r=e.type!==a.ExpressionType.Operator,o=this.isParenthesesOperator(e,p.Opening);if(r||o)throw new T(t,e)}validateFormulaItemNeighbors(e,t){const r=t+1,o=this.formulaItems[r];!o||(e.parenthesesType===p.Opening?this._validateOpeningParentheseNextItem(o,r):this._validateClosingParentheseNextItem(o,r))}}class Sn{constructor(){this.code="required",this.message="Formula expression cannot be empty."}}class Nn extends a.AbstractValidator{validate(e){return e&&e.length>0?a.ValidationResult.createSuccess():a.ValidationResult.createError([new Sn])}}const bn=new Nn,An=new Mn(new U),Pn=new Cn(new B,new _),jn=new Yt(new H,new _),Ln=new Fn(new Z,new _),Cr=new Yt(new fe,new _),Vn=new En(new _),Rn=new _e(new pe,new _,new de),kn=new wn(new _),zn=new vn(new H,new E,new U),Un=new yn(new E,new N),Gn=(i,e)=>new Tn(new E,new N,i,e),Wn=new xn(new E,new N,new Z,new B,new _),Qt=new n.InjectionToken("Represents an expression validator"),He=new n.InjectionToken("Represents a collection of expression validators"),Jt=new n.InjectionToken("Represents a formula items validator"),Bt=new n.InjectionToken("Represents a collection of formula items validators");class ${get iconClassName(){switch((this.operatorItemDefinition||{}).operatorType){case a.OperatorType.Arithmetic:case a.OperatorType.Parentheses:return this.operatorItemDefinition.id;default:return null}}}$.\u0275fac=function(e){return new(e||$)},$.\u0275cmp=n.\u0275\u0275defineComponent({type:$,selectors:[["ts-operator-item"]],inputs:{operatorItemDefinition:"operatorItemDefinition"},decls:3,vars:3,consts:[["mat-button","","disableRipple","",1,"operator-item"]],template:function(e,t){e&1&&(n.\u0275\u0275elementStart(0,"button",0)(1,"span"),n.\u0275\u0275text(2),n.\u0275\u0275elementEnd()()),e&2&&(n.\u0275\u0275attribute("data-qa",t.operatorItemDefinition==null?null:t.operatorItemDefinition.caption),n.\u0275\u0275advance(1),n.\u0275\u0275attribute("icon",t.iconClassName),n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate(t.operatorItemDefinition==null?null:t.operatorItemDefinition.caption))},dependencies:[F.MatLegacyButton],styles:[`ts-operator-item .mat-button.operator-item{color:#54657d;border-radius:0}ts-operator-item .mat-button.operator-item .mat-button-wrapper{text-overflow:ellipsis;display:flex;overflow:hidden}ts-operator-item .mat-button.operator-item [icon]{font-size:0;width:16px;height:16px;display:inline-block;background-position:center;background-repeat:no-repeat}ts-operator-item .mat-button.operator-item [icon="+"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a,.b{fill:none;}.a{stroke:rgba(84, 101, 125, 1);stroke-miterlimit:10;}<\\/style></defs><g transform="translate(2.5 2.5)"><line class="a" x2="12" transform="translate(0 6)"/><line class="a" y1="12" transform="translate(6)"/></g><rect class="b" width="16" height="16"/></svg>')}ts-operator-item .mat-button.operator-item [icon="-"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a,.b{fill:none;}.a{stroke:rgba(84, 101, 125, 1);stroke-miterlimit:10;}<\\/style></defs><g transform="translate(2.5 8.5)"><line class="a" x2="12"/></g><rect class="b" width="16" height="16"/></svg>')}ts-operator-item .mat-button.operator-item [icon="*"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a{fill:none;}.b{fill:rgba(84, 101, 125, 1);}<\\/style></defs><rect class="a" width="16" height="16"/><path class="b" d="M5.133-12.156,4.8-9.07l3.109-.867.2,1.422-2.977.242L7.07-5.727l-1.344.734L4.352-7.82,3.1-4.992,1.727-5.727,3.617-8.273.672-8.516.9-9.937l3.055.867-.336-3.086Z" transform="translate(3.328 16.156)"/></svg>')}ts-operator-item .mat-button.operator-item [icon="/"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a{fill:none;}.b{fill:rgba(84, 101, 125, 1);}<\\/style></defs><rect class="a" width="16" height="16"/><path class="b" d="M5.711-11.422,1.453,0H.156L4.414-11.422Z" transform="translate(4.844 13.422)"/></svg>')}ts-operator-item .mat-button.operator-item [icon="("]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a{fill:rgba(84, 101, 125, 1);}.b{fill:none;}<\\/style></defs><path class="a" d="M.641-4.383a12.106,12.106,0,0,1,.605-3.875,9.633,9.633,0,0,1,1.746-3.164H4.258A11.015,11.015,0,0,0,2.566-8.109,12.32,12.32,0,0,0,2-4.4,11.844,11.844,0,0,0,2.578-.734,11.375,11.375,0,0,0,4.242,2.531H2.992a9.207,9.207,0,0,1-1.75-3.1A11.793,11.793,0,0,1,.641-4.383Z" transform="translate(5.359 12.422)"/><rect class="b" width="16" height="16"/></svg>')}ts-operator-item .mat-button.operator-item [icon=")"]{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a{fill:rgba(84, 101, 125, 1);}.b{fill:none;}<\\/style></defs><path class="a" d="M.641-4.383a12.106,12.106,0,0,1,.605-3.875,9.633,9.633,0,0,1,1.746-3.164H4.258A11.015,11.015,0,0,0,2.566-8.109,12.32,12.32,0,0,0,2-4.4,11.844,11.844,0,0,0,2.578-.734,11.375,11.375,0,0,0,4.242,2.531H2.992a9.207,9.207,0,0,1-1.75-3.1A11.793,11.793,0,0,1,.641-4.383Z" transform="translate(10.641 3.578) rotate(180)"/><rect class="b" width="16" height="16" transform="translate(16 16) rotate(180)"/></svg>')}ts-operator-item:hover{background-color:#f2f5ff}ts-operator-item:active{background-color:#e3e9f9}
`],encapsulation:2});function Mr(i,e){if(i&1&&n.\u0275\u0275element(0,"span"),i&2){const t=n.\u0275\u0275nextContext(2);n.\u0275\u0275classMapInterpolate1("",t.iconClassName," button-icon")}}function Tr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ts-operator-item",14),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext().$implicit,s=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275elementEnd()}if(i&2){const t=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275property("operatorItemDefinition",t)}}function yr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",15),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext().$implicit,s=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()}if(i&2){const t=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275attribute("data-qa",t.caption),n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function xr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",15),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275nextContext().$implicit,s=n.\u0275\u0275nextContext(2);return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()}if(i&2){const t=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275attribute("data-qa",t.caption),n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function Fr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",15),n.\u0275\u0275listener("click",function(){const s=n.\u0275\u0275restoreView(t).$implicit,u=n.\u0275\u0275nextContext(4);return n.\u0275\u0275resetView(u.formulaItemSelected.emit(s))}),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()}if(i&2){const t=e.$implicit;n.\u0275\u0275attribute("data-qa",t.caption),n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function vr(i,e){if(i&1&&(n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275elementStart(1,"button",16),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275text(3),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(5,"mat-menu",17,18),n.\u0275\u0275template(7,Fr,2,2,"button",19),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementContainerEnd()),i&2){const t=n.\u0275\u0275reference(6),r=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275advance(1),n.\u0275\u0275property("matMenuTriggerFor",t),n.\u0275\u0275attribute("data-qa",n.\u0275\u0275pipeBind1(2,4,r.captionKey)),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(4,6,r.captionKey)," "),n.\u0275\u0275advance(4),n.\u0275\u0275property("ngForOf",r.items)}}function wr(i,e){if(i&1&&(n.\u0275\u0275elementContainerStart(0)(1,10),n.\u0275\u0275template(2,Tr,1,1,"ts-operator-item",11),n.\u0275\u0275template(3,yr,2,2,"button",12),n.\u0275\u0275template(4,xr,2,2,"button",12),n.\u0275\u0275elementContainerEnd(),n.\u0275\u0275template(5,vr,8,8,"ng-container",13),n.\u0275\u0275elementContainerEnd()),i&2){const t=e.$implicit,r=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(1),n.\u0275\u0275property("ngSwitch",t.type),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngSwitchCase",r.expressionType.Operator),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngSwitchCase",r.expressionType.Operand),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngSwitchCase",r.expressionType.Function),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",r.isGroupItem(t))}}function Er(i,e){if(i&1&&(n.\u0275\u0275elementStart(0,"div",1)(1,"button",2,3),n.\u0275\u0275template(3,Mr,1,3,"span",4),n.\u0275\u0275elementStart(4,"span",5),n.\u0275\u0275text(5),n.\u0275\u0275elementEnd(),n.\u0275\u0275element(6,"span",6),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(7,"mat-menu",7,8),n.\u0275\u0275template(9,wr,6,5,"ng-container",9),n.\u0275\u0275elementEnd()()),i&2){const t=n.\u0275\u0275reference(8),r=n.\u0275\u0275nextContext();n.\u0275\u0275advance(1),n.\u0275\u0275property("matMenuTriggerFor",t),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",r.iconClassName),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(r.caption),n.\u0275\u0275advance(4),n.\u0275\u0275property("ngForOf",r.formulaItemsDefinitions)}}class Ce{constructor(){this.formulaItemsDefinitions=[],this.caption="",this.iconClassName="",this.formulaItemSelected=new n.EventEmitter,this.expressionType=a.ExpressionType}isGroupItem(e){return e instanceof jt}}Ce.\u0275fac=function(e){return new(e||Ce)},Ce.\u0275cmp=n.\u0275\u0275defineComponent({type:Ce,selectors:[["ts-formula-items-drop-down"]],inputs:{formulaItemsDefinitions:"formulaItemsDefinitions",caption:"caption",iconClassName:"iconClassName"},outputs:{formulaItemSelected:"formulaItemSelected"},decls:1,vars:1,consts:[["class","formula-item-drop-down",4,"ngIf"],[1,"formula-item-drop-down"],["mat-button","",3,"matMenuTriggerFor"],["menuTrigger","matMenuTrigger"],[3,"class",4,"ngIf"],[1,"caption"],[1,"menu-icon","button-icon"],["yPosition","below",1,"formula-mat-menu"],["menu","matMenu"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"operatorItemDefinition","click",4,"ngSwitchCase"],["mat-menu-item","",3,"click",4,"ngSwitchCase"],[4,"ngIf"],[3,"operatorItemDefinition","click"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"matMenuTriggerFor"],[1,"formula-mat-menu","second-mat-menu"],["secondLevelMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"]],template:function(e,t){e&1&&n.\u0275\u0275template(0,Er,10,4,"div",0),e&2&&n.\u0275\u0275property("ngIf",(t.formulaItemsDefinitions==null?null:t.formulaItemsDefinitions.length)>0)},dependencies:[f.NgForOf,f.NgIf,f.NgSwitch,f.NgSwitchCase,F.MatLegacyButton,re.MatLegacyMenu,re.MatLegacyMenuItem,re.MatLegacyMenuTrigger,$,ae.TranslatePipe],styles:[`.formula-item-drop-down{display:inline-block}.formula-item-drop-down:hover{background-color:#f2f5ff}.formula-item-drop-down:active{background-color:#e3e9f9}.formula-item-drop-down .button-icon{display:inline-block;height:16px;width:16px;background-position:center;background-repeat:no-repeat;margin-top:-2px}.formula-item-drop-down .caption{padding:0 8px;font-size:13px}.formula-item-drop-down .mat-menu-trigger{padding:0 10px 0 8px}.formula-item-drop-down .menu-icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojNTQ2NTdkO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQgNykiPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTc4Ny43NzktNjcuNDU1bDQsNCw0LTRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTc4Ny43NzkgNjcuNDU1KSIvPjwvZz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+)}.formula-item-drop-down .mat-button{font-size:13px}.formula-item-drop-down .mat-button .mat-button-wrapper{display:flex;align-items:center}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu{border-radius:0}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu.mat-menu-panel{min-height:auto;max-height:200px;width:min-content;margin-top:1px}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu.second-mat-menu{margin:2px 7px 0;max-height:225px}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content:empty{margin:0}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content{padding:0;margin:6px}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content ts-operator-item{display:block;width:100%}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content ts-operator-item .operator-item{width:100%}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-button,.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-menu-item{font-family:Open Sans,Regular,sans-serif;font-size:13px;width:100%;text-align:left;padding:0 32px;line-height:30px;height:30px;color:#444}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-button:hover,.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-menu-item:hover{background-color:#f2f5ff}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-button:active,.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-menu-item:active{background-color:#e3e9f9}.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-button .mat-button-wrapper,.cdk-overlay-connected-position-bounding-box .cdk-overlay-pane .formula-mat-menu .mat-menu-content .mat-menu-item .mat-button-wrapper{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;display:block}
`],encapsulation:2});function Sr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ts-formula-items-drop-down",5),n.\u0275\u0275listener("formulaItemSelected",function(o){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.formulaItemSelected.emit(o))}),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275elementEnd()}if(i&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(1,2,"localizableStrings.OperatorsMenuCaption"))("formulaItemsDefinitions",t.operators)}}function Nr(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ts-operator-item",6),n.\u0275\u0275listener("click",function(){const s=n.\u0275\u0275restoreView(t).$implicit,u=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(u.formulaItemSelected.emit(s))}),n.\u0275\u0275elementEnd()}if(i&2){const t=e.$implicit;n.\u0275\u0275property("operatorItemDefinition",t),n.\u0275\u0275attribute("data-qa",t.caption)}}class Me{constructor(){this.formulaItemsDefinitions=[],this.pinnedFormulaItemsDefinitions=[],this.formulaItemSelected=new n.EventEmitter,this.operands=[],this.functions=[],this.operators=[]}_getFormulaItemDefinitionByType(e){return this.formulaItemsDefinitions.filter(t=>t.type===e)}ngOnInit(){const e=this._getFormulaItemDefinitionByType(a.ExpressionType.Function);this.functions=sn(e),this.operands=this._getFormulaItemDefinitionByType(a.ExpressionType.Operand),this.operators=this._getFormulaItemDefinitionByType(a.ExpressionType.Operator)}}Me.\u0275fac=function(e){return new(e||Me)},Me.\u0275cmp=n.\u0275\u0275defineComponent({type:Me,selectors:[["ts-formula-toolbar"]],inputs:{formulaItemsDefinitions:"formulaItemsDefinitions",pinnedFormulaItemsDefinitions:"pinnedFormulaItemsDefinitions"},outputs:{formulaItemSelected:"formulaItemSelected"},decls:7,vars:10,consts:[[1,"formula-toolbar"],["iconClassName","operand-icon","data-qa","operands",3,"caption","formulaItemsDefinitions","formulaItemSelected"],["iconClassName","function-icon","data-qa","functions",3,"caption","formulaItemsDefinitions","formulaItemSelected"],["iconClassName","operator-icon","data-qa","operators",3,"caption","formulaItemsDefinitions","formulaItemSelected",4,"ngIf"],["class","pinned-item",3,"operatorItemDefinition","click",4,"ngFor","ngForOf"],["iconClassName","operator-icon","data-qa","operators",3,"caption","formulaItemsDefinitions","formulaItemSelected"],[1,"pinned-item",3,"operatorItemDefinition","click"]],template:function(e,t){e&1&&(n.\u0275\u0275elementStart(0,"div",0)(1,"ts-formula-items-drop-down",1),n.\u0275\u0275listener("formulaItemSelected",function(o){return t.formulaItemSelected.emit(o)}),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"ts-formula-items-drop-down",2),n.\u0275\u0275listener("formulaItemSelected",function(o){return t.formulaItemSelected.emit(o)}),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(5,Sr,2,4,"ts-formula-items-drop-down",3),n.\u0275\u0275template(6,Nr,1,2,"ts-operator-item",4),n.\u0275\u0275elementEnd()),e&2&&(n.\u0275\u0275advance(1),n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(2,6,"localizableStrings.OperandsMenuCaption"))("formulaItemsDefinitions",t.operands),n.\u0275\u0275advance(2),n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(4,8,"localizableStrings.FunctionsMenuCaption"))("formulaItemsDefinitions",t.functions),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",t.pinnedFormulaItemsDefinitions.length===0),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngForOf",t.pinnedFormulaItemsDefinitions))},dependencies:[f.NgForOf,f.NgIf,Ce,$,ae.TranslatePipe],styles:[`.formula-toolbar{display:flex;flex-wrap:wrap;background-color:#fff;border-bottom:1px solid #e7e7e7;border-left:1px solid #e7e7e7;border-right:1px solid #e7e7e7}.formula-toolbar .operator-item,.formula-toolbar .mat-menu-trigger{height:32px;line-height:32px;border-radius:0;color:#444;font-size:13px;font-family:Open Sans,Regular,sans-serif}.formula-toolbar .mat-menu-trigger{border-right:1px solid #e7e7e7}.formula-toolbar .pinned-item .operator-item{max-width:100px;min-width:45px;font-size:20px}.formula-toolbar .operand-icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6IzU0NjU3ZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9LmN7c3Ryb2tlOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEgMSkiPjxnIGNsYXNzPSJhIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDExKSI+PHJlY3QgY2xhc3M9ImMiIHdpZHRoPSIzIiBoZWlnaHQ9IjMiLz48cmVjdCBjbGFzcz0iYiIgeD0iMC41IiB5PSIwLjUiIHdpZHRoPSIyIiBoZWlnaHQ9IjIiLz48L2c+PGcgY2xhc3M9ImEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYgMTEpIj48cmVjdCBjbGFzcz0iYyIgd2lkdGg9IjMiIGhlaWdodD0iMyIvPjxyZWN0IGNsYXNzPSJiIiB4PSIwLjUiIHk9IjAuNSIgd2lkdGg9IjIiIGhlaWdodD0iMiIvPjwvZz48ZyBjbGFzcz0iYSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTIgMTEpIj48cmVjdCBjbGFzcz0iYyIgd2lkdGg9IjMiIGhlaWdodD0iMyIvPjxyZWN0IGNsYXNzPSJiIiB4PSIwLjUiIHk9IjAuNSIgd2lkdGg9IjIiIGhlaWdodD0iMiIvPjwvZz48ZyBjbGFzcz0iYSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNiAwKSI+PHJlY3QgY2xhc3M9ImMiIHdpZHRoPSIzIiBoZWlnaHQ9IjMiLz48cmVjdCBjbGFzcz0iYiIgeD0iMC41IiB5PSIwLjUiIHdpZHRoPSIyIiBoZWlnaHQ9IjIiLz48L2c+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMjIwOS44MTMsMjE5LjU5di00Ljg2NGgxMnY0Ljg2NCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjIxMS4zMTMgLTIwOC4yMjUpIi8+PGxpbmUgY2xhc3M9ImEiIHkyPSI5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg3LjUgMi41MDEpIi8+PC9nPjxyZWN0IGNsYXNzPSJiIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48L3N2Zz4=)}.formula-toolbar .operator-icon{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyNC4zLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAxNiAxNiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTYgMTY7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsOm5vbmU7fQ0KCS5zdDF7ZmlsbDpub25lO3N0cm9rZTojNTQ2NTdEO3N0cm9rZS1taXRlcmxpbWl0OjEwO30NCjwvc3R5bGU+DQo8ZyBpZD0iR3JvdXBfNzcyMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjIxMi44MTMgLTMyOS45NDgpIj4NCgk8ZyBpZD0iUmVjdGFuZ2xlXzY3MjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMjEwLjgxMyAzMjkuOTQ4KSI+DQoJCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xLDBoMTBjMC41NSwwLDEsMC40NSwxLDF2MTRjMCwwLjU1LTAuNDUsMS0xLDFIMWMtMC41NSwwLTEtMC40NS0xLTFWMUMwLDAuNDUsMC40NSwwLDEsMHoiLz4NCgkJPHBhdGggY2xhc3M9InN0MSIgZD0iTTEsMC41aDEwYzAuMjgsMCwwLjUsMC4yMiwwLjUsMC41djE0YzAsMC4yOC0wLjIyLDAuNS0wLjUsMC41SDFjLTAuMjgsMC0wLjUtMC4yMi0wLjUtMC41VjENCgkJCUMwLjUsMC43MiwwLjcyLDAuNSwxLDAuNXoiLz4NCgk8L2c+DQoJPGcgaWQ9IlJlY3RhbmdsZV82NzI3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjIwOC44MTMgMzMxLjk0OCkiPg0KCQk8cmVjdCBjbGFzcz0ic3QwIiB3aWR0aD0iOCIgaGVpZ2h0PSI0Ii8+DQoJCTxyZWN0IHg9IjAuNSIgeT0iMC41IiBjbGFzcz0ic3QxIiB3aWR0aD0iNyIgaGVpZ2h0PSIzIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjcyOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDguODEzIDMzNi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjcyOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDUuODEzIDMzNi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDIuODEzIDMzNi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDguODEzIDMzOC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDUuODEzIDMzOC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDIuODEzIDMzOC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDguODEzIDM0MC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDUuODEzIDM0MC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDIuODEzIDM0MC45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDguODEzIDM0Mi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDUuODEzIDM0Mi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KCTxnIGlkPSJSZWN0YW5nbGVfNjczOSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyMDIuODEzIDM0Mi45NDgpIj4NCgkJPHJlY3QgY2xhc3M9InN0MCIgd2lkdGg9IjIiIGhlaWdodD0iMSIvPg0KCQk8cG9seWdvbiBjbGFzcz0ic3QxIiBwb2ludHM9IjAuMjgsMC41IDEuMjgsMC41IDEuMjgsMC41IAkJIi8+DQoJPC9nPg0KPC9nPg0KPHJlY3QgaWQ9IlJlY3RhbmdsZV82NzQwIiBjbGFzcz0ic3QwIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz4NCjwvc3ZnPg0K)}.formula-toolbar .function-icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojNTQ2NTdkO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuNTU4IDEuNTg1KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMjQwOS4zNjcsMjk0LjkxOWwtLjEzMS40ODNoLTEuMDdsLS44LDMuMmExOS4xNzEsMTkuMTcxLDAsMCwxLTEuMDc3LDMuMjc0LDUuNjUzLDUuNjUzLDAsMCwxLTEuNjU1LDIuMjU1LDIuMzIzLDIuMzIzLDAsMCwxLTEuMzQ4LjQ3NiwxLjEwNiwxLjEwNiwwLDAsMS0uNzQ3LS4yNjMuNTgxLjU4MSwwLDAsMS0uMjI3LS40NzYuNTM0LjUzNCwwLDAsMSwuMTg3LS40MDcuNjQ4LjY0OCwwLDAsMSwuNDU3LS4xNzIuNDc3LjQ3NywwLDAsMSwuMzM0LjEyNS4zNzguMzc4LDAsMCwxLC4xMzUuMjg1LjQuNCwwLDAsMS0uMTU0LjNxLS4xMTcuMS0uMTE3LjE1M2EuMTIuMTIsMCwwLDAsLjA1MS4xLjMzNi4zMzYsMCwwLDAsLjIuMDUxLDEuMzQ1LDEuMzQ1LDAsMCwwLC42NjMtLjIsMS45LDEuOSwwLDAsMCwuNjE5LS41ODksNC40ODcsNC40ODcsMCwwLDAsLjUxMy0xLjEzMnEuMS0uMzA4LjU0OS0yLjAyOWwxLjI3NS00Ljk1OGgtMS4yNzVsLjEtLjQ4M2EyLjg4OCwyLjg4OCwwLDAsMCwuODQ5LS4wODUsMS4wMjQsMS4wMjQsMCwwLDAsLjQ0My0uMzIyLDQuODM0LDQuODM0LDAsMCwwLC41MjQtLjg5LDcuMTg5LDcuMTg5LDAsMCwxLC44MjgtMS4zNjIsNCw0LDAsMCwxLDEuMTM4LS45NzgsMi4zNjUsMi4zNjUsMCwwLDEsMS4xMjUtLjMyNiwxLjM0NiwxLjM0NiwwLDAsMSwuODkzLjI4Mi44LjgsMCwwLDEsLjMzNy42MTIuNi42LDAsMCwxLS4xNjguNDMyLjU3MS41NzEsMCwwLDEtLjQzMi4xNzYuNTIyLjUyMiwwLDAsMS0uMzctLjEzMi40MTUuNDE1LDAsMCwxLS4xNDMtLjMxNS42MzMuNjMzLDAsMCwxLC4wOTUtLjI4OS42NDcuNjQ3LDAsMCwwLC4xLS4yMzEuMTg1LjE4NSwwLDAsMC0uMDY2LS4xNTQuNDUzLjQ1MywwLDAsMC0uMjc5LS4wNzMsMS4yOSwxLjI5LDAsMCwwLS44MjguMjkzLDMuMywzLjMsMCwwLDAtLjg3OCwxLjIxNnEtLjIuNDMyLS43MjUsMi4xNDZaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDE2LjQyNyAtMjkwLjk1NikiLz48cGF0aCBjbGFzcz0iYSIgZD0iTS0yNDA3LjA0NSwyOTQuNzQzYTMuMDgyLDMuMDgyLDAsMCwxLC41NDIuNzYxLDEwLjE1NCwxMC4xNTQsMCwwLDEsLjQzMiwxLjM4NWwuNjQ1LS45NjdhNC4wNzgsNC4wNzgsMCwwLDEsLjYyMi0uNjcsMi41MjIsMi41MjIsMCwwLDEsLjY0NS0uNDM2Ljk5Mi45OTIsMCwwLDEsLjM4OC0uMDczLjcyNC43MjQsMCwwLDEsLjUuMTY4LjUzMi41MzIsMCwwLDEsLjE4Ni40MS41MTUuNTE1LDAsMCwxLS4xMDkuMzgxLjY4NS42ODUsMCwwLDEtLjQ2OS4xODMuOTQ0Ljk0NCwwLDAsMS0uMzMtLjA2NiwxLjgzNiwxLjgzNiwwLDAsMC0uNDYxLS4xMTcuNzA4LjcwOCwwLDAsMC0uNDE4LjIwNSw1Ljg0Miw1Ljg0MiwwLDAsMC0xLjA4NCwxLjQ3MmwuNiwyLjUyYTIuMjQyLDIuMjQyLDAsMCwwLC4yMzQuNjkyLjI2MS4yNjEsMCwwLDAsLjE5MS4xMTQuNjEuNjEsMCwwLDAsLjM1OS0uMTY5LDIuODU2LDIuODU2LDAsMCwwLC42ODgtLjg3OWwuMjU2LjEzMmE0LjU4OSw0LjU4OSwwLDAsMS0xLjE3MSwxLjQzNiwxLjE5MiwxLjE5MiwwLDAsMS0uNjgyLjMyMi43MjguNzI4LDAsMCwxLS42NTEtLjQ2MSwxNy45NzIsMTcuOTcyLDAsMCwxLS42MzgtMi40NjEsMTAuMzg4LDEwLjM4OCwwLDAsMS0xLjgzMSwyLjU1NiwxLjM4MiwxLjM4MiwwLDAsMS0uODY0LjM2Ni44LjgsMCwwLDEtLjUzNS0uMjEyLjU2LjU2LDAsMCwxLS4xNzUtLjQzMy41NDIuNTQyLDAsMCwxLC4xNjEtLjQuNTM1LjUzNSwwLDAsMSwuNC0uMTYyLjc3OC43NzgsMCwwLDEsLjUuMjM1LjU0My41NDMsMCwwLDAsLjI5My4xNjguNC40LDAsMCwwLC4yMjctLjExNyw1LjUzOSw1LjUzOSwwLDAsMCwuOTM4LTEuMiwxMS44NzksMTEuODc5LDAsMCwwLC43NzYtMS4zMzNxLS40NTQtMS43OC0uNDkxLTEuODgyYTEuMzY5LDEuMzY5LDAsMCwwLS40MzktLjY3NCwxLjM0NiwxLjM0NiwwLDAsMC0uOC0uMmMtLjExMywwLS4yNDIuMDA1LS4zODkuMDE1di0uMjY0WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjQxNi40MjcgLTI5MC45NTYpIi8+PC9nPjxyZWN0IGNsYXNzPSJiIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48L3N2Zz4=)}
`],encapsulation:2});var h=d(96923);class X{constructor(e,t,r){this._formulaDefinitionToItemConverter=t,this._formulaDefinitionsToItemsConverter=r,this._formulaItemDefinitions=e.getDefinitions()}_convertFormulaItemsToAnotherFormulaItems(e){const t=[];return e&&e.forEach(r=>{switch(r.type){case a.ExpressionType.Operand:t.push(this._convertFormulaOperandToFormulaItem(r));break;case a.ExpressionType.Operator:t.push(this._convertFormulaOperatorToFormulaItem(r));break;case a.ExpressionType.Function:t.push(this._convertFormulaFunctionToFormulaItem(r));break}}),t}_convertFormulaOperandToFormulaItem(e){let t,r;switch(e.operandType){case a.OperandType.Const:t=h.FormulaItemType.Number,r=e?.value;break;case a.OperandType.Column:t=h.FormulaItemType.ColumnOperand;break;default:throw new Error(`not supporting operand type: ${e.operandType}`)}return new h.FormulaItem({id:e.id,type:t,value:r&&r.toString(),caption:e.caption})}_convertFormulaOperatorToFormulaItem(e){switch(e.operatorType){case a.OperatorType.Point:case a.OperatorType.Comma:return new h.FormulaItem({id:e.id,type:h.FormulaItemType.Number,value:e.caption,caption:e.caption});case a.OperatorType.Arithmetic:case a.OperatorType.Parentheses:return new h.FormulaItem({id:e.id,type:h.FormulaItemType.Operator,caption:e.caption});default:throw new Error(`The '${e.operatorType}' operator type is not supported.`)}}_convertFormulaFunctionToFormulaItem(e){return new h.FormulaItem({id:e.id,type:h.FormulaItemType.Function,caption:e.caption})}_convertAnotherFormulaItemsToFormulaItems(e){const t=[];for(const r of e)switch(r.type){case h.FormulaItemType.Operator:case h.FormulaItemType.ColumnOperand:case h.FormulaItemType.Function:const o=this._convertAnotherFormulaItemToFormulaItem(r);t.push(o);break;case h.FormulaItemType.Number:const s=r.value;s==="."?t.push(this._createFormulaItemByDefinitionType(ze,"Point definition not found. Need provide it.")):s===","?t.push(this._createFormulaItemByDefinitionType(ke,"Comma definition not found. Need provide it.")):t.push(this._createNumericConstantOperand(r));break}return t}_createFormulaItemByDefinitionType(e,t){const r=this._formulaItemDefinitions.find(o=>o instanceof e);if(r)return r.accept(this._formulaDefinitionToItemConverter);throw new Error(t)}_createNumericConstantOperand(e){return new Q(Number(e.value),c.DataValueType.Integer,e.id,e.caption)}_convertAnotherFormulaItemToFormulaItem(e){const t=e.id||e.caption;let r=this._formulaItemDefinitions.find(o=>o.id===t);if(r||(r=this._formulaItemDefinitions.find(o=>o.caption===e.caption)),!r)throw new Error(`Could not found formula item definition with '${e.id}' id or '${e.caption}' caption.`);return r.accept(this._formulaDefinitionToItemConverter)}convertFormulaToFormulaItems(e){const t=e&&e.formulaItems,r=this._convertFormulaItemsToAnotherFormulaItems(t),o=new h.FormulaItem({type:h.FormulaItemType.Cursor}),s=e&&e.cursorPosition;return r.splice(s,0,o),r}convertFormulaItemsToFormula(e){e=e||[];const t=this._convertAnotherFormulaItemsToFormulaItems([...e]),r=e.findIndex(o=>o.type===h.FormulaItemType.Cursor);return new We(this._formulaDefinitionsToItemsConverter,t,r)}}X.\u0275fac=function(e){return new(e||X)(n.\u0275\u0275inject(M),n.\u0275\u0275inject(z),n.\u0275\u0275inject(Ge))},X.\u0275prov=n.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac});class Te{constructor(e){this._formulaInputModelsConverter=e,this.formulaChanged=new n.EventEmitter}get formulaItems(){return this._formulaInputModelsConverter.convertFormulaToFormulaItems(this.formula)}onFormulaChanged(e){const t=this._formulaInputModelsConverter.convertFormulaItemsToFormula(e);this.formulaChanged.emit(t)}}Te.\u0275fac=function(e){return new(e||Te)(n.\u0275\u0275directiveInject(X))},Te.\u0275cmp=n.\u0275\u0275defineComponent({type:Te,selectors:[["ts-formula-input-editor"]],inputs:{formula:"formula"},outputs:{formulaChanged:"formulaChanged"},features:[n.\u0275\u0275ProvidersFeature([X])],decls:1,vars:2,consts:[[3,"formulaData","focusFormulaInputOnFormulaDataChange","itemsChanged"]],template:function(e,t){e&1&&(n.\u0275\u0275elementStart(0,"ts-formula-editor",0),n.\u0275\u0275listener("itemsChanged",function(o){return t.onFormulaChanged(o)}),n.\u0275\u0275elementEnd()),e&2&&n.\u0275\u0275property("formulaData",t.formulaItems)("focusFormulaInputOnFormulaDataChange",!0)},dependencies:[h.FormulaEditorComponent],styles:[`ts-formula-editor{display:flex}ts-formula-editor .formula-input{padding:0 16px 3px}
`],encapsulation:2});class ye{constructor(){this.formulaItems=[],this.pinnedFormulaItems=[],this.formulaChanged=new n.EventEmitter}_emitFormulaChanged(){this.formulaChanged.emit(this.formula)}onFormulaChanged(e){this.formula=e,this._emitFormulaChanged()}onFormulaItemSelected(e){this.formula.addItem(e),this._emitFormulaChanged()}}ye.\u0275fac=function(e){return new(e||ye)},ye.\u0275cmp=n.\u0275\u0275defineComponent({type:ye,selectors:[["ts-advanced-formula-editor"]],inputs:{formula:"formula",formulaItems:"formulaItems",pinnedFormulaItems:"pinnedFormulaItems"},outputs:{formulaChanged:"formulaChanged"},decls:5,vars:3,consts:[[1,"editor"],[3,"formula","formulaChanged"],[1,"toolbar"],[3,"formulaItemsDefinitions","pinnedFormulaItemsDefinitions","formulaItemSelected"]],template:function(e,t){e&1&&(n.\u0275\u0275elementStart(0,"div")(1,"div",0)(2,"ts-formula-input-editor",1),n.\u0275\u0275listener("formulaChanged",function(o){return t.onFormulaChanged(o)}),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(3,"div",2)(4,"ts-formula-toolbar",3),n.\u0275\u0275listener("formulaItemSelected",function(o){return t.onFormulaItemSelected(o)}),n.\u0275\u0275elementEnd()()()),e&2&&(n.\u0275\u0275advance(2),n.\u0275\u0275property("formula",t.formula),n.\u0275\u0275advance(2),n.\u0275\u0275property("formulaItemsDefinitions",t.formulaItems)("pinnedFormulaItemsDefinitions",t.pinnedFormulaItems))},dependencies:[Me,Te],styles:[".editor[_ngcontent-%COMP%]{padding-top:8px;border-top:1px solid #e7e7e7;border-left:1px solid #e7e7e7;border-right:1px solid #e7e7e7;background-color:#fff;overflow-y:auto;max-height:300px;display:flex;flex-direction:column-reverse}"]});function br(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementContainerStart(0),n.\u0275\u0275elementStart(1,"mat-drawer-container")(2,"mat-drawer",2,3)(4,"ts-formula-advanced-toolbar",4),n.\u0275\u0275listener("formulaItemSelected",function(o){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.onFormulaItemSelected(o))}),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(5,"mat-drawer-content",5)(6,"button",6),n.\u0275\u0275listener("click",function(){n.\u0275\u0275restoreView(t);const o=n.\u0275\u0275reference(3);return n.\u0275\u0275resetView(o.toggle())}),n.\u0275\u0275text(7),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(8,"ts-advanced-formula-editor",7),n.\u0275\u0275listener("formulaChanged",function(o){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.onFormulaChanged(o))}),n.\u0275\u0275elementEnd()()(),n.\u0275\u0275elementContainerEnd()}if(i&2){const t=n.\u0275\u0275reference(3),r=n.\u0275\u0275nextContext();n.\u0275\u0275advance(2),n.\u0275\u0275property("mode","side"),n.\u0275\u0275advance(2),n.\u0275\u0275property("formulaItems",r.formulaItemDefinitions),n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",t.opened?"<":">"," "),n.\u0275\u0275advance(1),n.\u0275\u0275property("formula",r.formula)("formulaItems",r.formulaItemDefinitions)("pinnedFormulaItems",r.pinnedFormulaItemDefinitions)}}function Ar(i,e){if(i&1){const t=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ts-advanced-formula-editor",7),n.\u0275\u0275listener("formulaChanged",function(o){n.\u0275\u0275restoreView(t);const s=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(s.onFormulaChanged(o))}),n.\u0275\u0275elementEnd()}if(i&2){const t=n.\u0275\u0275nextContext();n.\u0275\u0275property("formula",t.formula)("formulaItems",t.formulaItemDefinitions)("pinnedFormulaItems",t.pinnedFormulaItemDefinitions)}}class q{constructor(e,t,r,o,s,u,I,Y){this._formulaValidator=t,this._expressionValidator=r,this._expressionFactoryMediator=o,this._expressionToFormulaConverter=s,this._formulaConverter=u,this._formulaDefinitionsToItemsConverter=I,this._dialogService=Y,this._formulaCursorPosition=-1,this._formulaItemDefinitions=[],this._pinnedFormulaItemDefinitions=[],this.advancedFormulaToolbarVisible=!1,this.showFunctions=!0,this.expressionChanged=new n.EventEmitter,this.expressionValidated=new n.EventEmitter,this._formulaItemDefinitions=e.getDefinitions(),this._pinnedFormulaItemDefinitions=e.getPinnedDefinitions()}set expression(e){this._formula=e?this._initFormulaFromExpression(e):this._initEmptyFormula(),this._formula.cursorPosition=this._formulaCursorPosition}get formula(){return this._formula}get formulaItemDefinitions(){return this.showFunctions?this._formulaItemDefinitions:this._formulaItemDefinitions.filter(e=>e.type!==a.ExpressionType.Function)}get pinnedFormulaItemDefinitions(){return this._pinnedFormulaItemDefinitions}_initEmptyFormula(){const e=this._createEmptyFormula();return this._validateFormulaItems(e.formulaItems),e}_initFormulaFromExpression(e){return e=this._getSafeExpression(e),this._validateExpression(e),this._createFormulaFromExpression(e)}_getSafeExpression(e){return e instanceof a.Expression?e:this._expressionFactoryMediator.createExpression("expression",e)}_createEmptyFormula(){return new We(this._formulaDefinitionsToItemsConverter,[])}_createFormulaFromExpression(e){try{return this._expressionToFormulaConverter.toFormula(e)}catch(t){return this._dialogService.openInfoDialog(t.message),this._initEmptyFormula()}}_onFormulaChanged(e){if(this._formulaCursorPosition=e.cursorPosition,!this._validateFormulaItems(e.formulaItems).success)return;const o=this._formulaConverter.toExpression(e);this._validateExpression(o).success&&this.expressionChanged.emit(o)}_validateFormulaItems(e){const t=this._formulaValidator.validate(e);return this.expressionValidated.emit(t),t}_validateExpression(e){const t=this._expressionValidator.validate(e);return this.expressionValidated.emit(t),t}onFormulaChanged(e){this._onFormulaChanged(e)}onFormulaItemSelected(e){this.formula.addItem(e),this._onFormulaChanged(this.formula)}}q.\u0275fac=function(e){return new(e||q)(n.\u0275\u0275directiveInject(M),n.\u0275\u0275directiveInject(Jt),n.\u0275\u0275directiveInject(Qt),n.\u0275\u0275directiveInject(a.AbstractExpressionFactoryMediator),n.\u0275\u0275directiveInject(y),n.\u0275\u0275directiveInject(Ye),n.\u0275\u0275directiveInject(Ge),n.\u0275\u0275directiveInject(ln.DialogService))},q.\u0275cmp=n.\u0275\u0275defineComponent({type:q,selectors:[["ts-formula-designer"]],inputs:{advancedFormulaToolbarVisible:"advancedFormulaToolbarVisible",showFunctions:"showFunctions",expression:"expression"},outputs:{expressionChanged:"expressionChanged",expressionValidated:"expressionValidated"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["elseBlock",""],[3,"mode"],["drawer",""],[3,"formulaItems","formulaItemSelected"],[1,"drawer-content"],[1,"drawer-toggle-btn",3,"click"],[3,"formula","formulaItems","pinnedFormulaItems","formulaChanged"]],template:function(e,t){if(e&1&&(n.\u0275\u0275template(0,br,9,6,"ng-container",0),n.\u0275\u0275template(1,Ar,1,3,"ng-template",null,1,n.\u0275\u0275templateRefExtractor)),e&2){const r=n.\u0275\u0275reference(2);n.\u0275\u0275property("ngIf",t.advancedFormulaToolbarVisible)("ngIfElse",r)}},dependencies:[me,ye,ie.MatDrawer,ie.MatDrawerContainer,ie.MatDrawerContent,f.NgIf],styles:[`:host mat-drawer-container{height:250px}.drawer-content{display:flex}.drawer-content .drawer-toggle-btn{height:100%;padding:0}ts-advanced-formula-editor{display:block}ts-advanced-formula-editor .formula-input{min-height:90px}
`],encapsulation:2});var Yn=d(75903);class ee{}ee.\u0275fac=function(e){return new(e||ee)},ee.\u0275mod=n.\u0275\u0275defineNgModule({type:ee}),ee.\u0275inj=n.\u0275\u0275defineInjector({imports:[h.FormulaEditorModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(ee,{declarations:[Te],imports:[h.FormulaEditorModule],exports:[Te]})}();class b{}b.\u0275fac=function(e){return new(e||b)},b.\u0275mod=n.\u0275\u0275defineNgModule({type:b}),b.\u0275inj=n.\u0275\u0275defineInjector({imports:[F.MatLegacyButtonModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(b,{declarations:[$],imports:[F.MatLegacyButtonModule],exports:[$]})}();class te{}te.\u0275fac=function(e){return new(e||te)},te.\u0275mod=n.\u0275\u0275defineNgModule({type:te}),te.\u0275inj=n.\u0275\u0275defineInjector({imports:[f.CommonModule,F.MatLegacyButtonModule,re.MatLegacyMenuModule,b,ae.TranslateModule.forChild()]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(te,{declarations:[Ce],imports:[f.CommonModule,F.MatLegacyButtonModule,re.MatLegacyMenuModule,b,ae.TranslateModule],exports:[Ce]})}();class ne{}ne.\u0275fac=function(e){return new(e||ne)},ne.\u0275mod=n.\u0275\u0275defineNgModule({type:ne}),ne.\u0275inj=n.\u0275\u0275defineInjector({imports:[f.CommonModule,te,b,ae.TranslateModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(ne,{declarations:[Me],imports:[f.CommonModule,te,b,ae.TranslateModule],exports:[Me]})}();class A{}A.\u0275fac=function(e){return new(e||A)},A.\u0275mod=n.\u0275\u0275defineNgModule({type:A}),A.\u0275inj=n.\u0275\u0275defineInjector({imports:[ne,ee]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(A,{declarations:[ye],imports:[ne,ee],exports:[ye]})}();class G{constructor(e,t){this._formulaItemDefinitionProvider=e,this._formulaDefinitionToItemConverter=t}get _formulaItemDefinitions(){return this._formulaItemDefinitionProvider.getDefinitions()}_getFormulaItemDefinition(e){return this._formulaItemDefinitions.find(t=>t.id===e)}_createFormulaOperandItems(e){return[this._createFormulaItemFromDefinition(e.definitionId)]}_createPointOperator(){const e=this._formulaItemDefinitions.find(t=>t instanceof ze);if(e)return e.accept(this._formulaDefinitionToItemConverter);throw new Error("Point definition not found. Need provide it.")}_createCommaOperator(){const e=this._formulaItemDefinitions.find(t=>t instanceof ke);if(e)return e.accept(this._formulaDefinitionToItemConverter);throw new Error("Comma definition not found. Need provide it.")}_createParenthesesOperator(e){const t=this._formulaItemDefinitions.filter(r=>r instanceof Ne).find(r=>r.parenthesesType===e);return this._createFormulaItemFromDefinition(t.id)}_createFormulaItemFromDefinition(e){const t=this._getFormulaItemDefinition(e);if(!t)throw new Error(`Definition with id '${e}' not found.`);return t.accept(this._formulaDefinitionToItemConverter)}visitFunctionExpression(e){const t=this._createCommaOperator(),r=this._createParenthesesOperator(p.Opening),o=this._createParenthesesOperator(p.Closing),{fnArgs:s,fnDefinitionId:u}=Ue(e),I=this._createFormulaItemFromDefinition(u),Y=s.map(je=>je.accept(this)),$t=Y.length-1,Xt=Y.map((je,qt)=>qt===$t?je:je.concat(t)).reduce((je,qt)=>je.concat(qt),[]);return[I,r,...Xt,o]}visitAggregationSubQueryOperandExpression(e){return this._createFormulaOperandItems(e)}visitColumnOperandExpression(e){return this._createFormulaOperandItems(e)}visitConstOperandExpression(e){return e.definitionId?this._createFormulaOperandItems(e):String(e.value).split("").map(o=>o==="."?this._createPointOperator():new Q(Number(o)))}visitSubQueryOperandExpression(e){return this._createFormulaOperandItems(e)}visitSysSettingOperandExpression(e){return this._createFormulaOperandItems(e)}visitSysVariableOperandExpression(e){return this._createFormulaOperandItems(e)}visitArithmeticOperatorExpression(e){const t=e.leftExpression.accept(this),r=e.rightExpression.accept(this),o=this._createFormulaItemFromDefinition(e.definitionId);return[...t,o,...r]}visitParenthesesOperatorExpression(e){const t=this._createParenthesesOperator(p.Opening),r=this._createParenthesesOperator(p.Closing),o=e.expression.accept(this);return[t,...o,r]}visitRelationOperatorExpression(e){const t=e.leftExpression.accept(this),r=e.rightExpression.accept(this),o=this._createFormulaItemFromDefinition(e.definitionId);return[...t,o,...r]}visitTernaryOperatorExpression(e){throw new Error("Method not implemented.")}}G.\u0275fac=function(e){return new(e||G)(n.\u0275\u0275inject(M),n.\u0275\u0275inject(z))},G.\u0275prov=n.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac});class W{}W.\u0275fac=function(e){return new(e||W)},W.\u0275mod=n.\u0275\u0275defineNgModule({type:W}),W.\u0275inj=n.\u0275\u0275defineInjector({providers:[ln.DialogService,C,K,y,{provide:a.ExpressionVisitor,useClass:G},{provide:z,useClass:v},{provide:a.ERROR_TRANSLATION_KEY_PATTERN,useValue:"localizableStrings.Formula{0}"},{provide:He,useClass:Oe,multi:!0},{provide:He,useClass:ge,multi:!0},{provide:He,useClass:De,multi:!0},{provide:Bt,useValue:[bn,An,Pn,jn,Ln,Rn,Vn,kn,zn,Un,Wn,Gn(14,8)]},{provide:Qt,useFactory:(i,e)=>new a.ValidatorTranslateDecorator(i,e),deps:[He,a.ValidationErrorTranslateService]},{provide:Jt,useFactory:(i,e)=>new a.ValidatorTranslateDecorator(i,e),deps:[Bt,a.ValidationErrorTranslateService]},{provide:Ye,useClass:Ie},{provide:Ge,useClass:J},{provide:mt,useFactory:()=>new Dr(new E,new N)}],imports:[a.ExpressionFactoryModule,w,A,Yn.MatLegacyDialogModule,ie.MatSidenavModule,f.CommonModule]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(W,{declarations:[q],imports:[a.ExpressionFactoryModule,w,A,Yn.MatLegacyDialogModule,ie.MatSidenavModule,f.CommonModule],exports:[q]})}();class xe{}xe.\u0275fac=function(e){return new(e||xe)},xe.\u0275mod=n.\u0275\u0275defineNgModule({type:xe}),xe.\u0275inj=n.\u0275\u0275defineInjector({providers:[{provide:z,useClass:v},{provide:G,useClass:G}],imports:[f.CommonModule,w,re.MatLegacyMenuModule,F.MatLegacyButtonModule,ie.MatSidenavModule,A,W]}),function(){(typeof ngJitMode>"u"||ngJitMode)&&n.\u0275\u0275setNgModuleScope(xe,{imports:[f.CommonModule,w,re.MatLegacyMenuModule,F.MatLegacyButtonModule,ie.MatSidenavModule,A,W],exports:[q]})}();class Pr extends y{constructor(e=new a.ExpressionVisitorMock,t=new un){super(e,t)}}const jr=[new O(a.ArithmeticOperatorType.Addition,"+"),new O(a.ArithmeticOperatorType.Subtraction,"-"),new O(a.ArithmeticOperatorType.Multiplication,"*"),new O(a.ArithmeticOperatorType.Division,"/")],Lr=[new Ee(c.DataValueType.Integer,"COLUMN_1"),new Ee(c.DataValueType.Integer,"COLUMN_2"),new Ee(c.DataValueType.Integer,"AGE"),new At("SYS SYS_SETTING",c.DataValueType.Integer),new Pt("SYS SYS_VARIABLE",c.DataValueType.Integer)],Vr=[new m("SUM","SUM",l.Math,[{name:"ARG_1",dataTypes:[c.DataValueType.Float],description:"SUM FUNCTION ARGUMENT 1 DESCRIPTION"},{name:"ARG_2",dataTypes:[c.DataValueType.Float],description:"SUM FUNCTION ARGUMENT 2 DESCRIPTION"}],{dataType:c.DataValueType.Float,description:"SUM FUNCTION RETURN DESCRIPTION"}),new m("DATEDIFF","DATEDIFF",l.DateTime,[{name:"ARG_1",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:"DATEDIFF FUNCTION ARGUMENT 1 DESCRIPTION"},{name:"ARG_2",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:"DATEDIFF FUNCTION ARGUMENT 1 DESCRIPTION"}],{dataType:c.DataValueType.DateTime,description:"DATEDIFF FUNCTION RETURN DESCRIPTION"}),new m("DATEDIFFYEARS","DATEDIFFYEARS",l.DateTime,[{name:"ARG_1",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""},{name:"ARG_2",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""}],{dataType:c.DataValueType.Integer,description:""}),new m("DATEADDMONTHS","DATEADDMONTHS",l.DateTime,[{name:"ARG_1",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""},{name:"ARG_2",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""}],{dataType:c.DataValueType.DateTime,description:""}),new m("DATEPARTDAYS","DATEPARTDAYS",l.DateTime,[{name:"ARG_1",dataTypes:[c.DataValueType.Date,c.DataValueType.DateTime],description:""}],{dataType:c.DataValueType.Integer,description:""})],dt=new m("SUM","SUM",l.Math,[{name:"PARAM 1",dataTypes:[c.DataValueType.Integer],description:""},{name:"PARAM 2",dataTypes:[c.DataValueType.Integer],description:""}],null),Qn=[dt],ft=new Ee(c.DataValueType.Float,"COLUMN PATH","COLUMN"),ht=new bt(c.DataValueType.Integer,"SUBQUERY COLUMN PATH",null,"SUBQUERY COLUMN"),It=new nn(c.DataValueType.Integer,"AGGREGATION COLUMN PATH",c.AggregationType.Avg,null,"AGGREGATION COLUMN"),gt=new At("SYS SETTING CODE",c.DataValueType.Integer,"SYS SETTING"),Dt=new Pt("SYS VARIABLE NAME",c.DataValueType.Integer,"SYS VARIABLE"),Jn=[ft,ht,It,gt,Dt],Ze=new O(a.ArithmeticOperatorType.Addition,"+"),Ke=new O(a.ArithmeticOperatorType.Subtraction,"-"),$e=new O(a.ArithmeticOperatorType.Multiplication,"*"),Xe=new O(a.ArithmeticOperatorType.Division,"/"),qe=new Ne(p.Opening,"("),et=new Ne(p.Closing,")"),_t=new ze("."),Ot=new ke(","),Ct=new rn(a.RelationOperatorType.Equal,"="),Bn=[Ze,Ke,$e,Xe,qe,et,_t,Ot],Hn=new xt(dt.id,dt.caption),Zn=new Ve(ft.id,ft.caption),Rr=new Ve(ht.id,ht.caption),kr=new Ve(It.id,It.caption),zr=new Ft(gt.id,gt.caption),Ur=new vt(Dt.id,Dt.caption),tt=(i=c.DataValueType.Integer)=>{const e=Math.round((Math.random()+.1)*10);return new Q(e,i)},Ht=new we(Ze.id,Ze.arithmeticOperatorType,Ze.caption),Gr=new we(Ke.id,Ke.arithmeticOperatorType,Ke.caption),Wr=new we($e.id,$e.arithmeticOperatorType,$e.caption),Kn=new we(Xe.id,Xe.arithmeticOperatorType,Xe.caption),Zt=new at(qe.id,qe.parenthesesType,qe.caption),Kt=new at(et.id,et.parenthesesType,et.caption),Yr=new Et(_t.id,_t.caption),$n=new wt(Ot.id,Ot.caption),Qr=new St(Ct.id,Ct.relationOperationType,Ct.caption),Xn=new cn([...Qn,...Jn,...Bn]);class Pe extends We{constructor(e,t){super(new J(new v,Xn),e||Pe._defaultFormulaItems,t||Pe._defaultCursorPosition)}}Pe._defaultFormulaItems=[Zn,Ht,Zt,tt(),Ht,tt(),Kt,Kn,Hn,Zt,tt(),$n,tt(),Kt],Pe._defaultCursorPosition=-1}}]);
